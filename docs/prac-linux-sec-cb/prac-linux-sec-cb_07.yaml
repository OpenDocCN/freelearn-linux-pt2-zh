- en: Chapter 7. Security Tools
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第7章。安全工具
- en: 'In this chapter, we will discuss:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论：
- en: Linux sXID
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Linux sXID
- en: PortSentry
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PortSentry
- en: Using Squid Proxy
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Squid代理
- en: OpenSSL Server
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenSSL服务器
- en: Tripwire
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tripwire
- en: Shorewall
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Shorewall
- en: Linux sXID
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Linux sXID
- en: In Linux, normally a file has permissions of read, write, and execute. Apart
    from these permissions, it can also have special permissions, such as **Set owner
    User ID** (**SUID**) and **Set Group ID up on execution** (**SGID**). Due to these
    permissions, it is possible for a user to log in from their account and still
    run a particular file/program with the permissions of the actual file owner (which
    can be root also).
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux中，通常文件具有读、写和执行权限。除了这些权限，它还可以具有特殊权限，如**设置所有者用户ID**（**SUID**）和**在执行时设置组ID**（**SGID**）。由于这些权限，用户可以从他们的帐户登录，仍然以实际文件所有者的权限运行特定的文件/程序（也可以是root）。
- en: sXid is the tool for monitoring SUID/SGID on a regular basis. Using this tool,
    we can track changes in the SUID/SGID of files and folders.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: sXid是用于定期监视SUID/SGID的工具。使用这个工具，我们可以跟踪文件和文件夹中SUID/SGID的更改。
- en: Getting Ready
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: To use the tool, we need to install the `sxid` package on our Linux system.
    We can either use the `apt-get` command to install the package, or we can download
    the package and manually configure and install it.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用这个工具，我们需要在Linux系统上安装`sxid`软件包。我们可以使用`apt-get`命令来安装软件包，或者我们可以下载软件包并手动配置和安装它。
- en: How to do it...
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To start monitoring SUID/SGID files and folders, we begin with the installation
    of the package and then we configure the tool as per our requirements:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始监视SUID/SGID文件和文件夹，我们首先安装软件包，然后根据我们的要求配置工具：
- en: 'The first step is to install the `sxid` package. To do so, we run the command
    as follows:'
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一步是安装`sxid`软件包。为此，我们运行以下命令：
- en: '[PRE0]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![How to do it...](img/B04234_07_01.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/B04234_07_01.jpg)'
- en: 'Once the installation completes, we start editing the file `/etc/sxid.conf`
    to use the tool as per our requirements. Open the file in any editor of your choice:'
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，我们开始编辑文件`/etc/sxid.conf`，根据我们的要求使用该工具。在您选择的任何编辑器中打开文件：
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: In the configuration file, look for the line shown in the following screenshot:![How
    to do it...](img/B04234_07_02.jpg)
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在配置文件中，查找以下截图中显示的行：![如何操作...](img/B04234_07_02.jpg)
- en: Change the value for `EMAIL` to any other email ID if you wish to get the output
    of changes whenever `sxid` is run to your email ID.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望在运行`sxid`时将更改的输出发送到您的电子邮件地址，请将`EMAIL`的值更改为任何其他电子邮件ID。
- en: Next, look for the line which reads `KEEP_LOGS` and change the value to any
    numerical value of your choice. This number defines how many log files to keep:![How
    to do it...](img/B04234_07_03.jpg)
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，查找读取`KEEP_LOGS`的行，并将值更改为您选择的任何数字值。这个数字定义了要保留多少个日志文件：![如何操作...](img/B04234_07_03.jpg)
- en: If you wish to get the logs even when `sXid` finds no changes, then change the
    value for `ALWAYS_NOTIFY` to `yes`:![How to do it...](img/B04234_07_04.jpg)
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您希望在`sXid`找不到更改时也获得日志，那么将`ALWAYS_NOTIFY`的值更改为`yes`：![如何操作...](img/B04234_07_04.jpg)
- en: We can define a list of directories, separated with spaces, for the option `SEARCH`
    for `sXID` to use as a starting point for its search.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以定义一个目录列表，用空格分隔，作为`sXID`的`SEARCH`选项的起始点进行搜索。
- en: 'However, if we wish to exclude any directory from the search, we can specify
    it under the `EXCLUDE` option:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，如果我们希望从搜索中排除任何目录，我们可以在`EXCLUDE`选项下指定它：
- en: '![How to do it...](img/B04234_07_05.jpg)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/B04234_07_05.jpg)'
- en: Suppose we have a directory `/usr/local/share` to be searched, and the `/usr/local`
    directory has been mentioned in the exclude list, then it will still be searched.
    This becomes useful for excluding a main directory, and only specifying one.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们有一个要搜索的目录`/usr/local/share`，并且在排除列表中已经提到了`/usr/local`目录，那么它仍然会被搜索。这对于排除一个主目录并且只指定一个目录变得有用。
- en: There are many more options in `/etc/sxid.conf` that can be configured as per
    our requirements. Once we are done with editing the file, save and close the file.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`/etc/sxid.conf`中还有许多可以根据我们的要求进行配置的选项。编辑文件后，保存并关闭文件。'
- en: 'Now, if we want to run `sXid` manually for spot-checking, we use the following
    command:'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，如果我们想要手动运行`sXid`进行抽查，我们使用以下命令：
- en: '[PRE2]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![How to do it...](img/B04234_07_06.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/B04234_07_06.jpg)'
- en: Here, the `-c` option helps to define the path of the `config` file if it is
    not automatically picked by the command. The `-k` option runs the tool.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`-c`选项有助于定义`config`文件的路径，如果命令没有自动选择。`-k`选项运行该工具。
- en: How it works...
  id: totrans-33
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: First we install the `sXid` package, and then we configure it by editing the
    file `/etc/sxid.conf` as per our requirements.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 首先安装`sXid`软件包，然后通过编辑文件`/etc/sxid.conf`根据我们的要求进行配置。
- en: Once the configuration has been done, we run `sXid` manually to perform spot-checking.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦配置完成，我们就手动运行`sXid`进行抽查。
- en: We can even add an entry in `crontab` to run `sXid` automatically at a defined
    interval if we wish to.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要的话，我们甚至可以在`crontab`中添加一个条目，以便在定义的时间间隔内自动运行`sXid`。
- en: PortSentry
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: PortSentry
- en: As a system administrator, one major concern is to protect the system from network
    intrusions.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 作为系统管理员，一个主要的关注点是保护系统免受网络入侵。
- en: This is where **PortSentry** comes into the picture. It has the ability to detect
    scans on a host system and react to those scans in the way we choose.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是**PortSentry**的作用。它有能力检测主机系统上的扫描，并以我们选择的方式对这些扫描做出反应。
- en: Getting Ready
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: To demonstrate the implementation and usage of PortSentry, we need two systems
    on the same network that can ping each other.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 为了演示PortSentry的实施和使用，我们需要在同一网络上有两个系统，它们可以相互ping通。
- en: Also, we need the `Nmap` package on one system, which will be used as the client,
    and on the other system, we will install and configure the `PortSentry` package.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们需要在一个系统上安装`Nmap`软件包，该软件包将用作客户端，另一个系统上，我们将安装和配置`PortSentry`软件包。
- en: 'To install the `Nmap` package, use the following command:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装`Nmap`软件包，请使用以下命令：
- en: '[PRE3]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![Getting Ready](img/B04234_07_07.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![准备就绪](img/B04234_07_07.jpg)'
- en: How to do it?
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作？
- en: 'On the first system, we install the `Portsentry` package, using the following
    command:'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在第一个系统上，我们使用以下命令安装`Portsentry`软件包：
- en: '[PRE4]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![How to do it?](img/B04234_07_08.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![如何做？](img/B04234_07_08.jpg)'
- en: During the installation process a window will open containing some information
    about `Portsentry`. Just click `OK` to continue:![How to do it?](img/B04234_07_09.jpg)
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在安装过程中，将打开一个窗口，其中包含有关`Portsentry`的一些信息。只需单击“确定”继续：![如何做？](img/B04234_07_09.jpg)
- en: 'As soon as the installation completes, `portsentry` starts monitoring on the
    TCP and UDP ports. We can verify this by checking the file `/var/log/syslog` using
    the following command:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，`portsentry`立即开始监视TCP和UDP端口。我们可以通过使用以下命令检查文件`/var/log/syslog`来验证这一点：
- en: '[PRE5]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![How to do it?](img/B04234_07_10.jpg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![如何做？](img/B04234_07_10.jpg)'
- en: We can see messages related to `portsentry` in the log.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在日志中看到与`portsentry`相关的消息。
- en: Now, on the second machine, which we are using as client, run the `Nmap` command
    as shown in the following:![How to do it?](img/B04234_07_11.jpg)
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，在我们用作客户端的第二台机器上，运行如下所示的`Nmap`命令：![如何做？](img/B04234_07_11.jpg)
- en: We can also use any other command of Nmap to perform a TCP or UDP scan on the
    first system, which has `portsentry` running. To learn more about `Nmap` commands,
    see [Chapter 1](ch01.html "Chapter 1. Linux Security Problems"), *Linux Security
    Problems*.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以使用`Nmap`的任何其他命令在第一个运行`portsentry`的系统上执行TCP或UDP扫描。要了解更多关于`Nmap`命令的信息，请参阅[第1章](ch01.html
    "第1章。Linux安全问题")，*Linux安全问题*。
- en: In the above result, we can see that `Nmap` is able to scan successfully even
    when `portsentry` is running on the first system.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述结果中，我们可以看到即使在第一个系统上运行`portsentry`时，`Nmap`也能够成功扫描。
- en: We can even try to ping the server system from the client to see if it is working
    after installing `portsentry`.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 我们甚至可以尝试从客户端ping服务器系统，看看在安装`portsentry`后它是否正常工作。
- en: Now let's configure `portsentry` by editing the file `/etc/portsentry/portsentry.conf`
    on the server system.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在让我们通过编辑服务器系统上的文件`/etc/portsentry/portsentry.conf`来配置`portsentry`。
- en: 'After opening in an editor of your choice, look for the following lines and
    change the value to `1`:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在您选择的编辑器中打开后，查找以下行并将值更改为`1`：
- en: '![How to do it?](img/B04234_07_12.jpg)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![如何做？](img/B04234_07_12.jpg)'
- en: 'Scroll down and then find and uncomment the following line:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 向下滚动，然后找到并取消注释以下行：
- en: '![How to do it?](img/B04234_07_13.jpg)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![如何做？](img/B04234_07_13.jpg)'
- en: 'Next, uncomment the line shown in the following:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，取消注释以下行：
- en: '![How to do it?](img/B04234_07_14.jpg)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![如何做？](img/B04234_07_14.jpg)'
- en: Once done, save and close the file.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，保存并关闭文件。
- en: Next, edit the file `/etc/default/portsentry`:![How to do it?](img/B04234_07_15.jpg)
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，编辑文件`/etc/default/portsentry`：![如何做？](img/B04234_07_15.jpg)
- en: In the lines shown above, we need to mention for which protocol `portsentry`
    should be working, TCP or ATCP.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面显示的行中，我们需要说明`portsentry`应该使用TCP还是ATCP协议。
- en: Now edit the file `/etc/portsentry/portsentry.ignore.static` and add a line
    at the bottom, as shown in the following screenshot:![How to do it?](img/B04234_07_16.jpg)
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在编辑文件`/etc/portsentry/portsentry.ignore.static`，并在底部添加一行，如下面的屏幕截图所示：![如何做？](img/B04234_07_16.jpg)
- en: Here, `192.168.1.104` is the IP address of the client machine which we are trying
    to block.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`192.168.1.104`是我们试图阻止的客户机的IP地址。
- en: Now restart the `portsentry` service by running the following command:![How
    to do it?](img/B04234_07_17.jpg)
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在通过运行以下命令重新启动`portsentry`服务：![如何做？](img/B04234_07_17.jpg)
- en: Once the above steps are complete, we will again try to run `Nmap` on the client
    machine and see if it still works properly:![How to do it?](img/B04234_07_18.jpg)
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成上述步骤后，我们将再次尝试在客户机上运行`Nmap`，看看它是否仍然正常工作：![如何做？](img/B04234_07_18.jpg)
- en: We can see that now `Nmap` is not able to scan the IP address.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到现在`Nmap`无法扫描IP地址。
- en: If we try to ping the server from the client, even that does not work:![How
    to do it?](img/B04234_07_19.jpg)
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们尝试从客户端ping服务器，甚至那也不起作用：![如何做？](img/B04234_07_19.jpg)
- en: If we check the file `/etc/hosts.deny`, we shall see the following line has
    automatically been added:![How to do it?](img/B04234_07_20.jpg)
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们检查文件`/etc/hosts.deny`，我们将看到自动添加了以下行：![如何做？](img/B04234_07_20.jpg)
- en: Similarly, when we check the file `/var/lib/portsentry/portsentry.history`,
    we get a result similar to the last line in the image below:![How to do it?](img/B04234_07_21.jpg)
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同样，当我们检查文件`/var/lib/portsentry/portsentry.history`时，我们得到一个类似于下面图片中最后一行的结果：![如何做？](img/B04234_07_21.jpg)
- en: How it works...
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: We use two systems. The first system acts as a `portsentry` server, while the
    other acts as the client.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用两个系统。第一个系统充当`portsentry`服务器，而另一个充当客户端。
- en: On the first system, we install the `portsentry` package, and on the second
    system we install `Nmap`, which will be used to demonstrate the working.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一个系统上，我们安装`portsentry`软件包，在第二个系统上，我们安装`Nmap`，用于演示工作。
- en: Now we perform an `Nmap` scan from the client machine on the server. We can
    see that it works fine.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们从客户机对服务器执行`Nmap`扫描。我们可以看到它工作正常。
- en: After this, we configure `portsentry` as per the requirements, by editing various
    files.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们根据要求配置`portsentry`，编辑各种文件。
- en: Once editing is complete, restart the `portsentry` service and again try to
    perform the `Nmap` scan from the client on the server. We see that now the scan
    does not work properly.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑完成后，重新启动`portsentry`服务，然后再次尝试从客户端对服务器执行`Nmap`扫描。我们看到现在扫描无法正常工作。
- en: Using Squid proxy
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Squid代理
- en: Squid is a web proxy application with a variety of configurations and uses.
    Squid has a large number of access controls, and supports different protocols,
    such as HTTP, HTTPS, FTP, SSL, and so on.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: Squid是一个具有各种配置和用途的Web代理应用程序。Squid具有大量的访问控制，并支持不同的协议，如HTTP、HTTPS、FTP、SSL等。
- en: In this section we will see how to use Squid as an HTTP proxy.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将看到如何将Squid用作HTTP代理。
- en: Getting Ready
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: To install and use Squid on a particular system on a network, ensure that the
    particular system has enough physical memory, because Squid also works as a cache
    proxy server and thus needs space to maintain the cache.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 要在网络上的特定系统上安装和使用Squid，请确保该特定系统具有足够的物理内存，因为Squid还可以作为缓存代理服务器工作，因此需要空间来维护缓存。
- en: 'We are using a Ubuntu system for our example and Squid is available in Ubuntu
    repositories, so we need to ensure that our system is up to date. For doing this
    we run the following command:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在示例中使用的是Ubuntu系统，Squid可在Ubuntu存储库中获得，因此我们需要确保我们的系统是最新的。为此，我们运行以下命令：
- en: '[PRE6]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'After that, run the following command:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，运行以下命令：
- en: '[PRE7]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: How to do it...
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To install and configure Squid on our system, we have to take the following
    steps:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 要在我们的系统上安装和配置Squid，我们必须采取以下步骤：
- en: The first step is to install the `squid` package, and to do so, we run the command
    as follows:![How to do it...](img/B04234_07_22.jpg)
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一步是安装`squid`软件包，为此，我们运行以下命令：![如何操作...](img/B04234_07_22.jpg)
- en: As soon as the installation of Squid completes, it starts running with the default
    configuration, which is defined to block all the HTTP/HTTPs traffic on the network.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦Squid安装完成，它将以默认配置开始运行，该配置定义了阻止网络上所有HTTP/HTTPs流量。
- en: 'To check this, we just need to configure the browser, on any system on the
    network, to use the IP address of the proxy system as proxy, as shown in the following
    screenshot:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查这一点，我们只需要在网络上的任何系统上配置浏览器，使用代理系统的IP地址作为代理，如下面的截图所示：
- en: '![How to do it...](img/B04234_07_23.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/B04234_07_23.jpg)'
- en: Once done, we can now try to access any website and we will see an error screen
    as shown in the following image:![How to do it...](img/B04234_07_24.jpg)
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，我们现在可以尝试访问任何网站，我们将看到一个错误屏幕，如下图所示：![如何操作...](img/B04234_07_24.jpg)
- en: Now we will start configuring our proxy server to get it to work as per our
    requirements. For this we will edit the file `/etc/squid3/squid.conf` in any editor.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们将开始配置我们的代理服务器，使其按照我们的要求工作。为此，我们将在任何编辑器中编辑文件`/etc/squid3/squid.conf`。
- en: 'Once the file is open in the editor, search for the category which reads:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦文件在编辑器中打开，搜索读作：
- en: '`TAG: visible_hostname`:Under this category, add the line—`visible_hostname
    ourProxyServer`:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '`TAG: visible_hostname`：在这个类别下，添加一行——`visible_hostname ourProxyServer`：'
- en: '![How to do it...](img/B04234_07_25.jpg)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/B04234_07_25.jpg)'
- en: Here, `ourProxyServer` is a name we have given to our proxy server. You can
    choose any name you like.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`ourProxyServer`是我们给代理服务器起的名字。你可以选择任何你喜欢的名字。
- en: 'Next, search for the category which reads `TAG: cache_mgr` and add the line
    `cache_mgr email@yourdomainname`. Here, mention the email ID of the administrator,
    who can be contacted instead of `email@yourdomainname`.![How to do it...](img/B04234_07_26.jpg)'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '接下来，搜索读作`TAG: cache_mgr`的类别，并添加一行`cache_mgr email@yourdomainname`。在这里，提及管理员的电子邮件ID，可以联系管理员而不是`email@yourdomainname`。![如何操作...](img/B04234_07_26.jpg)'
- en: Next we search for the line which reads as shown in the following screenshot.
    The `http_port` variable defines the port on which the Squid proxy will listen.
    The default port is 3128; however, we can change to any other port which is not
    being used. We can even define more than one port for Squid to listen to, as shown
    in the following screenshot:![How to do it...](img/B04234_07_27.jpg)
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们搜索以下截图中显示的行。`http_port`变量定义了Squid代理将监听的端口。默认端口是3128；但是，我们可以更改为任何未被使用的端口。我们甚至可以定义Squid监听多个端口，如下面的截图所示：![如何操作...](img/B04234_07_27.jpg)
- en: Now we need to add the rule to allow traffic on the network computers, as per
    our requirements. For this we will search for the line which reads `acl localnet
    src 10.0.0.8`.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们需要添加规则，根据我们的需求允许网络计算机上的流量。为此，我们将搜索读作`acl localnet src 10.0.0.8`。
- en: 'Here, we add our rule `acl localnetwork src 192.168.1.0/24`, as shown in the
    following image:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们添加了我们的规则`acl localnetwork src 192.168.1.0/24`，如下图所示：
- en: '![How to do it...](img/B04234_07_28.jpg)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/B04234_07_28.jpg)'
- en: In the preceding rule, `acl` is used to define a new rule and `localnetwork`
    is the name we have given to our rule. `src` defines the source of the traffic
    which will come to the proxy server. We define the network IP address with the
    subnet in bits as shown previously.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述规则中，`acl`用于定义一个新规则，`localnetwork`是我们给规则起的名字。`src`定义了将要传输到代理服务器的流量的来源。我们使用子网位数定义网络IP地址，如前面所示。
- en: We can add as many rules as we wish to, according to our requirements.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们的需求，我们可以添加任意多的规则。
- en: Next, search for the line which reads `http_access allow localhost`, and below
    this add the line `http_access allow localnetwork` to start using the rule which
    we added in the previous step, to allow the traffic:![How to do it...](img/B04234_07_29.jpg)
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，搜索读作`http_access allow localhost`，并在其下添加一行`http_access allow localnetwork`，以开始使用我们在上一步中添加的规则，允许流量：![如何操作...](img/B04234_07_29.jpg)
- en: 'Once we are done with the preceding configuration steps, we restart the Squid
    service using the following command:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成上述配置步骤后，我们使用以下命令重新启动Squid服务：
- en: '[PRE8]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Now our Squid proxy server is running. To check, we can try to access the IP
    address of the proxy server from a browser on any system on the network:![How
    to do it...](img/B04234_07_30.jpg)
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们的Squid代理服务器正在运行。要检查，我们可以尝试从网络上的任何系统的浏览器访问代理服务器的IP地址：![如何操作...](img/B04234_07_30.jpg)
- en: The above error screen tells us that the Squid proxy is working fine.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的错误屏幕告诉我们Squid代理工作正常。
- en: Now we can try to visit any other website and it should open as per the rule
    we have added in the configuration file of Squid.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以尝试访问任何其他网站，它应该根据我们在Squid的配置文件中添加的规则打开。
- en: How it works...
  id: totrans-117
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: We start by installing the Squid package. Once the package is installed, we
    edit its configuration file `/etc/squid3/squid.conf` and add the hostname, email
    ID of the administrator, and the port on which Squid will listen.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先安装Squid软件包。软件包安装完成后，我们编辑其配置文件`/etc/squid3/squid.conf`，并添加主机名、管理员的电子邮件ID以及Squid将监听的端口。
- en: Then we create the rule to allow traffic for all the systems on the same network.
    Once we save all the configurations, we restart the Squid service, and our proxy
    server is now working.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们创建规则，允许同一网络中所有系统的流量。一旦保存了所有配置，我们重新启动Squid服务，我们的代理服务器现在正在工作。
- en: OpenSSL Server
  id: totrans-120
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: OpenSSL服务器
- en: SSL is a protocol used for transmitting sensitive information over the Internet.
    This could include information such as account passwords, credit card details,
    and so on. SSL is most popularly used in conjunction with web browsing over the
    HTTP protocol.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: SSL是一种用于在互联网上传输敏感信息的协议。这可能包括帐户密码、信用卡详细信息等信息。SSL最常用于与HTTP协议一起进行的网络浏览。
- en: '`OpenSSL` library provides an implementation of **Secure Sockets Layer (SSL)**
    and TLS **Transport Layer Security (TLS)** protocols.'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '`OpenSSL`库提供了**安全套接字层（SSL）**和**传输层安全性（TLS）**协议的实现。'
- en: Getting Ready
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To demonstrate the use of `OpenSSL`, we need two systems. One will be used as
    a server on which we will install the `OpenSSL` package and also Apache. The second
    system will be used as the client.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 为了演示`OpenSSL`的使用，我们需要两个系统。一个将用作服务器，我们将在其中安装`OpenSSL`软件包和Apache。第二个系统将用作客户端。
- en: How to do it...
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'We will now see how to create a self-signed certificate using `OpenSSL`, for
    Apache. This will help encrypt traffic to the server:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将看到如何使用`OpenSSL`为Apache创建自签名证书。这将有助于加密到服务器的流量：
- en: We start by installing `OpenSSL` package on the first system using the following
    command:![How to do it...](img/B04234_07_31.jpg)
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们首先使用以下命令在第一个系统上安装`OpenSSL`软件包：![如何做...](img/B04234_07_31.jpg)
- en: Next, we will install Apache on the same system, as shown in the following:![How
    to do it...](img/B04234_07_32.jpg)
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将在同一系统上安装Apache，如下所示：![如何做...](img/B04234_07_32.jpg)
- en: Once Apache is installed, we need to enable SSL support, which comes as standard
    in the Apache package for Ubuntu. To do this, we run the command as follows:![How
    to do it...](img/B04234_07_33.jpg)
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装Apache后，我们需要启用SSL支持，这在Ubuntu的Apache软件包中是标准的。为此，我们运行以下命令：![如何做...](img/B04234_07_33.jpg)
- en: 'After enabling SSL support, restart Apache as shown in the preceding screenshot,
    using this command:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 启用SSL支持后，按照上面的屏幕截图重启Apache，使用以下命令：
- en: '[PRE9]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Now create a directory inside Apache''s configuration directory. This is the
    place where we shall keep the certificate files, which we will be making in the
    next step:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在在Apache的配置目录中创建一个目录。这是我们将保存证书文件的地方，我们将在下一步中创建这些文件：
- en: '[PRE10]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Now we will create the key and the certificate using the following command:![How
    to do it...](img/B04234_07_34.jpg)
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们将使用以下命令创建密钥和证书：![如何做...](img/B04234_07_34.jpg)
- en: In the preceding command, `req –x509` specifies that we will be creating a self-signed
    certificate, which will adhere to X.509 **Certificate Signing Request** (**CSR**)
    management.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述命令中，`req –x509`指定我们将创建一个符合X.509 **证书签名请求**（**CSR**）管理的自签名证书。
- en: '`-nodes` specifies that the key file will be created without being protected
    with any password.'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '`-nodes`指定将创建不受任何密码保护的密钥文件。'
- en: '`-days 365` tells us that the certificate being created will be valid for one
    year.'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '`-days 365`告诉我们，正在创建的证书将在一年内有效。'
- en: '`-newkeyrsa:2048` tells us that the private key file and the certificate file
    will both be created at the same time and that the key generated will be 2048
    bits long.'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '`-newkeyrsa:2048`告诉我们，私钥文件和证书文件将同时创建，并且生成的密钥将为2048位长。'
- en: The next parameter, `-keyout`, specifies the name for the private key which
    will be created.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个参数`-keyout`指定要创建的私钥的名称。
- en: The `-out` parameter mentions the name of the certificate file being created.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '`-out`参数提及正在创建的证书文件的名称。'
- en: When the key and certificate files are being created, you will be asked a few
    questions. Provide the details as per your configuration. However, the option
    which reads `Common Name (e.g. server FQDN or YOUR name)` is important, and we
    have to provide either the domain name or the server's public IP:![How to do it...](img/B04234_07_35.jpg)
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在创建密钥和证书文件时，将会询问您一些问题。根据您的配置提供详细信息。但是，读取`通用名称（例如服务器FQDN或您的名称）`的选项很重要，我们必须提供域名或服务器的公共IP：![如何做...](img/B04234_07_35.jpg)
- en: Next, we need to edit the file `/etc/apache2/sites-available/default` to configure
    Apache to use the key file and the certificate file created in the previous steps.
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要编辑文件`/etc/apache2/sites-available/default`，以配置Apache使用在上一步中创建的密钥文件和证书文件。
- en: 'Find and edit the lines as shown in the following screenshot. For `ServerName`,
    we have provided the IP address of the Apache server system:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 找到并编辑如下屏幕截图中显示的行。对于`ServerName`，我们提供了Apache服务器系统的IP地址：
- en: '![How to do it...](img/B04234_07_36.jpg)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/B04234_07_36.jpg)'
- en: 'In the same file, scroll to the end of the file, and before the `<VirtualHost>`
    block closes, add the lines given in the following screenshot. Mention the key
    file name and certificate file name which was used while creating these files:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 在同一文件中，滚动到文件末尾，在`<VirtualHost>`块关闭之前，添加以下屏幕截图中给出的行。提及在创建这些文件时使用的密钥文件名和证书文件名：
- en: '![How to do it...](img/B04234_07_37.jpg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/B04234_07_37.jpg)'
- en: Now, on the client system, open any browser and visit the Apache server's public
    IP using the `https://` protocol, as shown in the following:![How to do it...](img/B04234_07_38.jpg)
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，在客户端系统上，打开任何浏览器，并使用`https://`协议访问Apache服务器的公共IP，如下所示：![如何做...](img/B04234_07_38.jpg)
- en: The browser will show a warning message regarding the connection not being secure,
    because the certificate is not signed by any trusted authorities.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 浏览器将显示有关连接不安全的警告消息，因为证书未经任何受信任的机构签名。
- en: Click on **I Understand the Risks** and then click on the button **Add Exception**
    to add the certificate in the browser:![How to do it...](img/B04234_07_39.jpg)
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**我了解风险**，然后单击**添加例外**按钮将证书添加到浏览器中：![如何做...](img/B04234_07_39.jpg)
- en: The next windows will show some information about the server. To proceed further
    and add the certificate, click on **Confirm Security Exception**:![How to do it...](img/B04234_07_40.jpg)
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个窗口将显示有关服务器的一些信息。要继续并添加证书，请点击**确认安全异常**：![如何操作...](img/B04234_07_40.jpg)
- en: If you wish to check more the details of the certificate, click on **View**
    in the previous screen and you will get a new window showing complete details
    of the certificate, as shown in the following:![How to do it...](img/B04234_07_41.jpg)
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您希望检查证书的更多细节，请在上一个屏幕上点击**查看**，您将会看到一个新窗口显示证书的完整细节，如下所示：![如何操作...](img/B04234_07_41.jpg)
- en: Once the certificate has been added successfully, the web page loading will
    complete, as shown in the following:![How to do it...](img/B04234_07_42.jpg)
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 证书成功添加后，网页加载将完成，如下所示：![如何操作...](img/B04234_07_42.jpg)
- en: How it works...
  id: totrans-153
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: We use two systems in this setup. First is the Apache server, on which we install
    the `OpenSSL` package. The second system works as the client, from which we will
    try to connect to the Apache web server.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 在此设置中，我们使用两个系统。第一个是Apache服务器，我们在其中安装了`OpenSSL`软件包。第二个系统作为客户端，我们将尝试连接到Apache
    Web服务器。
- en: After installing the Apache and `OpenSSL` package on the first system, we enable
    SSL support for Apache. Then we create the server key and server certificate file
    using the `OpenSSL` tool and a few arguments.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一个系统上安装Apache和`OpenSSL`软件包后，我们为Apache启用SSL支持。然后，我们使用`OpenSSL`工具和一些参数创建服务器密钥和服务器证书文件。
- en: After this, we edit the file `/etc/apache2/sites-available/default`, so that
    Apache can use the key and certificate that we have created.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们编辑文件`/etc/apache2/sites-available/default`，以便Apache可以使用我们创建的密钥和证书。
- en: Once done, we try to access the Apache web server through a browser on the client
    machine.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，我们尝试通过客户端机器上的浏览器访问Apache Web服务器。
- en: We see that it asks for the new certificate to be added to the browser, and
    after doing this, we are able to visit the web browser using HTTPS protocol.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到它要求将新证书添加到浏览器中，完成后，我们可以使用HTTPS协议访问Web浏览器。
- en: Tripwire
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Tripwire
- en: With the increasing number of attacks on servers nowadays, administering the
    server securely is becoming a complex problem. It is difficult to be sure that
    every attack has been effectively blocked.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 随着对服务器的攻击数量不断增加，安全地管理服务器变得越来越复杂。很难确定每次攻击是否已被有效阻止。
- en: '**Tripwire** is a host-based **Intrusion Detection System** (**IDS**), which
    can be used to monitor different filesystem data points and then alert us if any
    file gets modified or changed.'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: '**Tripwire**是一种基于主机的**入侵检测系统**（**IDS**），可用于监视不同的文件系统数据点，然后在任何文件被修改或更改时向我们发出警报。'
- en: Getting Ready
  id: totrans-162
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: We only need to install the Tripwire package on our Linux system to configure
    our IDS. In the next section, we will see how to install and configure the tool.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 我们只需要在Linux系统上安装Tripwire软件包来配置我们的IDS。在下一节中，我们将看到如何安装和配置该工具。
- en: How to do it...
  id: totrans-164
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will discuss how to install and configure Tripwire on our Ubuntu system
    in the following steps:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在以下步骤中讨论如何在我们的Ubuntu系统上安装和配置Tripwire：
- en: The first step will be to install the Tripwire package using `apt-get`, as shown
    here:![How to do it...](img/B04234_07_43.jpg)
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一步将是使用`apt-get`安装Tripwire软件包，如下所示：![如何操作...](img/B04234_07_43.jpg)
- en: During the installation process it will show an information window. Press **OK**
    to continue.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在安装过程中，它将显示一个信息窗口。按**确定**继续。
- en: In the next window select **Internet Site** for type of mail configuration and
    press **OK**:![How to do it...](img/B04234_07_44.jpg)
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个窗口中，选择**Internet Site**作为邮件配置类型，然后按**确定**：![如何操作...](img/B04234_07_44.jpg)
- en: The next window will will ask for the **system mail name**. Enter the domain
    name of the system on which you are configuring Tripwire:![How to do it...](img/B04234_07_45.jpg)
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个窗口将要求输入**系统邮件名称**。输入您正在配置Tripwire的系统的域名：![如何操作...](img/B04234_07_45.jpg)
- en: Press *O* in the next screen to continue.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个屏幕上按*O*继续。
- en: Now we will be asked if we want to create a passphrase for Tripwire. Select
    **Yes** and continue:![How to do it...](img/B04234_07_46.jpg)
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们将被问及是否要为Tripwire创建密码。选择**是**并继续：![如何操作...](img/B04234_07_46.jpg)
- en: Now we will be asked if we want to rebuild the configuration file. Select **Yes**
    and continue:![How to do it...](img/B04234_07_47.jpg)
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们将被问及是否要重建配置文件。选择**是**并继续：![如何操作...](img/B04234_07_47.jpg)
- en: Next, select **Yes** to rebuild the policy file of Tripwire:![How to do it...](img/B04234_07_48.jpg)
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择**是**以重建Tripwire的策略文件：![如何操作...](img/B04234_07_48.jpg)
- en: Next, provide the passphrase you wish to configure for Tripwire:![How to do
    it...](img/B04234_07_49.jpg)
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，提供您希望为Tripwire配置的密码：![如何操作...](img/B04234_07_49.jpg)
- en: It will also ask to re-confirm the passphrase in the next screen.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 它还会在下一个屏幕上要求重新确认密码。
- en: Next, provide a passphrase for the local key and also re-confirm in the next
    screen:![How to do it...](img/B04234_07_50.jpg)
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，为本地密钥提供一个密码，并在下一个屏幕上重新确认：![如何操作...](img/B04234_07_50.jpg)
- en: The next screen confirms that the installation process has completed successfully.
    Press **OK** to complete the installation:![How to do it...](img/B04234_07_51.jpg)
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个屏幕确认安装过程已成功完成。按**确定**完成安装：![如何操作...](img/B04234_07_51.jpg)
- en: Once the installation has been completed successfully, our next step is to initialize
    the Tripwire database. To do so we run the command as shown in the following screenshot:![How
    to do it...](img/B04234_07_52.jpg)
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装成功后，我们的下一步是初始化Tripwire数据库。为此，我们运行如下截图中显示的命令：![如何操作...](img/B04234_07_52.jpg)
- en: In the preceding output, we can see that an error called `No such file or directory`
    is displayed for many filenames. This happens because Tripwire scans for every
    file which is mentioned in its configuration file, whether it exists on the system
    or not.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的输出中，我们可以看到许多文件名显示为`没有这样的文件或目录`的错误。这是因为Tripwire扫描其配置文件中提到的每个文件，无论它是否存在于系统中。
- en: If we wish to remove the error shown in the previous screenshot, we have to
    edit the file `/etc/tripwire/tw.pol` and comment the lines for the file/directory
    which are not present in our system. We can even leave it as it is if we wish
    to as it does not hamper the working of Tripwire.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们希望删除前面屏幕截图中显示的错误，我们必须编辑文件`/etc/tripwire/tw.pol`，并注释掉我们系统中不存在的文件/目录的行。如果愿意，我们甚至可以将其保留不变，因为这不会影响Tripwire的工作。
- en: 'We will now test how Tripwire is working. To do so, we will create a new file
    by running the following command:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在将测试Tripwire的工作情况。为此，我们将通过运行以下命令创建一个新文件：
- en: '[PRE11]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: You can choose any name for the file as per your choice.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以根据自己的选择为文件选择任何名称。
- en: 'Now run the Tripwire interactive command to test it is working. To do so, the
    command is as follows:'
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在运行Tripwire交互命令来测试它是否正常工作。为此，命令如下：
- en: '[PRE12]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![How to do it...](img/B04234_07_53.jpg)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![操作步骤...](img/B04234_07_53.jpg)'
- en: 'We will get an out put, as shown in the preceding screenshot. Tripwire checks
    all the files/directories, and if there are any modifications, it will be shown
    in the result:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将得到一个输出，如前面的屏幕截图所示。 Tripwire检查所有文件/目录，如果有任何修改，将显示在结果中：
- en: '![How to do it...](img/B04234_07_54.jpg)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![操作步骤...](img/B04234_07_54.jpg)'
- en: In our case, it displays a line as shown in the preceding screenshot, which
    tells us that a file `tripwire_testing` has been added to the `/root` directory.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的案例中，它显示了如前面的屏幕截图所示的一行，告诉我们在`/root`目录中添加了一个名为`tripwire_testing`的文件。
- en: If we wish to keep the changes shown, just save the result file that was automatically
    opened in an editor.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们希望保留所显示的更改，只需保存自动在编辑器中打开的结果文件。
- en: While saving the result, you will be prompted for the local passphrase. Enter
    the passphrase which you configured during the installation of Tripwire.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在保存结果时，系统将提示您输入本地密码。输入您在安装Tripwire时配置的密码。
- en: Finally, we add an entry to crontab to run Tripwire automatically to check for
    the changes in file /directory. Open the file `/etc/crontab` in any editor of
    your choice and add the following line:![How to do it...](img/B04234_07_55.jpg)
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们在crontab中添加一个条目，以便自动运行Tripwire来检查文件/目录中的更改。在您选择的任何编辑器中打开文件`/etc/crontab`并添加以下行：![操作步骤...](img/B04234_07_55.jpg)
- en: Here, `00 6` tells us that Tripwire will check daily at 6 o'clock.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`00 6`告诉我们Tripwire将在每天6点检查一次。
- en: How it works...
  id: totrans-194
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: First we install the Tripwire package, and during the installation we fill in
    the details as asked. Once the installation completes, we initialize the Tripwire
    database.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 首先安装Tripwire软件包，并在安装过程中填写所需的详细信息。安装完成后，我们初始化Tripwire数据库。
- en: After this, we check whether Tripwire is working properly or not. For this,
    we first create a new file at any location and then we run the Tripwire interactive
    command. Once the command completes, we see in the output that it shows the new
    file that has been added. This confirms that Tripwire is working perfectly.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们检查Tripwire是否正常工作。为此，我们首先在任何位置创建一个新文件，然后运行Tripwire交互命令。命令完成后，我们在输出中看到显示已添加的新文件。这证实了Tripwire的完美工作。
- en: We then edit Crontab configuration to run Tripwire automatically at a particular
    interval.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们编辑Crontab配置，以便以特定间隔自动运行Tripwire。
- en: Shorewall
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Shorewall
- en: Do you wish to set up a Linux system as a firewall for a small network? Shorewall
    helps us to configure an enterprise-level firewall via standard Shorewall tools.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 您是否希望将Linux系统设置为小型网络的防火墙？ Shorewall通过标准Shorewall工具帮助我们配置企业级防火墙。
- en: Shorewall is actually built upon Iptables. However, Shorewall makes it easier
    to configure the things.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: Shorewall实际上是建立在Iptables之上的。但是，Shorewall使配置变得更加容易。
- en: Getting ready
  id: totrans-201
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: A Linux system with two network cards installed and working is needed to configure
    Shorewall. One card will be used as an external network interface and the second
    will be used as an internal network interface. In our example, we are using `eth0`
    as the external, and `eth1` as the internal interface.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 需要安装并运行两张网络卡的Linux系统才能配置Shorewall。一张卡将用作外部网络接口，第二张卡将用作内部网络接口。在我们的示例中，我们使用`eth0`作为外部接口，`eth1`作为内部接口。
- en: Configure both cards as per the network configuration. Make sure that you are
    able to ping another system on the local network and also something on the external
    network, the Internet.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 根据网络配置配置两张卡。确保您能够ping本地网络上的另一个系统，也能够ping外部网络，即互联网上的某些内容。
- en: On this system, we will be installing the Shorewall package and then configuring
    it as per our requirements.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个系统上，我们将安装Shorewall软件包，然后根据我们的要求进行配置。
- en: How to do it...
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作步骤...
- en: We begin by installing `shorewall` on our system using the `apt-get` command:![How
    to do it...](img/B04234_07_56.jpg)
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们首先使用`apt-get`命令在系统上安装`shorewall`：![操作步骤...](img/B04234_07_56.jpg)
- en: Once the installation is complete, try to start `shorewall`. You will get an
    error message, as follows:![How to do it...](img/B04234_07_57.jpg)
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，尝试启动`shorewall`。您将收到以下错误消息：![操作步骤...](img/B04234_07_57.jpg)
- en: This means we need to first configure Shorewall before it can start running.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着我们需要先配置Shorewall，然后它才能开始运行。
- en: To configure Shorewall, edit the file `/etc/default/shorewall` in any editor
    of your choice. Look for the line that reads `startup=0` and change its value
    to the following:![How to do it...](img/B04234_07_58.jpg)
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要配置Shorewall，请在您选择的任何编辑器中编辑文件`/etc/default/shorewall`。查找包含`startup=0`的行，并将其值更改为以下内容：![操作步骤...](img/B04234_07_58.jpg)
- en: Next, edit the file `/etc/shorewall/shorewall.conf` and find the line which
    reads `IP_FORWARDING`. Verify that its value is set to `On`:![How to do it...](img/B04234_07_59.jpg)
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，编辑文件`/etc/shorewall/shorewall.conf`，找到包含`IP_FORWARDING`的行。验证其值是否设置为`On`：![操作步骤...](img/B04234_07_59.jpg)
- en: 'The configuration files of Shorewall are located in the `/etc/shorewall` directory.
    The minimum essential files which are essential for its working are as follows:'
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Shorewall的配置文件位于`/etc/shorewall`目录中。对于其工作至关重要的最低必需文件如下：
- en: Interfaces
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 接口
- en: Policy
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 策略
- en: Rules
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 规则
- en: Zones
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 区域
- en: If any of these files is not found in `/etc/shorewall` directory after its installation,
    we can find the same files in the directory `/usr/share/doc/shorewall/default-config/`.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在安装后在`/etc/shorewall`目录中找不到这些文件中的任何一个，我们可以在目录`/usr/share/doc/shorewall/default-config/`中找到相同的文件。
- en: Copy the required files from this location to the `/etc/shorewall` directory.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 从此位置复制所需文件到`/etc/shorewall`目录。
- en: Now edit the file `/etc/shorewall/`interfaces and add the lines as shown in
    the following image:![How to do it...](img/B04234_07_60.jpg)
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在编辑文件`/etc/shorewall/`interfaces，并按以下图像中显示的添加行：![如何做...](img/B04234_07_60.jpg)
- en: We are referring `eth0` as `net` in our configuration, and `eth1` as `local`.
    You can choose any other name as long as it is alphanumeric and five characters
    or less.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在配置中将`eth0`称为`net`，将`eth1`称为`local`。只要是字母数字且不超过五个字符，您可以选择任何其他名称。
- en: Next, edit the file `/etc/shorewall/zones`. Zone is mainly used to set whether
    to use `ipv4` or `ipv6`:![How to do it...](img/B04234_07_61.jpg)
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，编辑文件`/etc/shorewall/zones`。区域主要用于设置是否使用`ipv4`或`ipv6`：![如何做...](img/B04234_07_61.jpg)
- en: In the preceding configuration, `fw` refers to me, or the Shorewall firewall
    itself. The next two lines define ipv4 for both the network interfaces.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的配置中，`fw`指的是我，或者说是Shorewall防火墙本身。接下来的两行定义了两个网络接口的ipv4。
- en: Now edit the policy file `/etc/shorewall/`. This file is mainly used to set
    the overall policy about who is allowed to go where.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在编辑策略文件`/etc/shorewall/`。该文件主要用于设置关于谁被允许去哪里的整体策略。
- en: 'Each line in this file is processed from top to bottom and each is read in
    the following format:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 该文件中的每一行都是从上到下处理的，并且每一行都是按以下格式读取的：
- en: If a packet is sent from the____to the____then______it
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 如果从____发送数据包到____，则______。
- en: '![How to do it...](img/B04234_07_62.jpg)'
  id: totrans-225
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/B04234_07_62.jpg)'
- en: In our example, if we read the first policy, it will be read as—If a packet
    is sent from the local to the net then Accept it.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的示例中，如果我们读取第一个策略，它将被读取为——如果从本地发送数据包到网络，则接受它。
- en: You can add as many policies as you want in the same way, and the Shorewall
    firewall will work accordingly.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以以相同的方式添加尽可能多的策略，Shorewall防火墙将相应地工作。
- en: Finally, we edit the file `/etc/shorewall/rules`. This file is used to create
    exceptions to the policy. It is mainly used if you wish to allow people from the
    external network into the internal network.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，编辑文件`/etc/shorewall/rules`。该文件用于创建对策略的例外。如果您希望允许外部网络中的人进入内部网络，则主要使用该文件。
- en: 'A sample rules files is shown in the following screenshot:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 示例规则文件如下截图所示：
- en: '![How to do it...](img/B04234_07_63.jpg)'
  id: totrans-230
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/B04234_07_63.jpg)'
- en: We have added the rule which says Accept a packet if it is sent from the `net`
    to the `fw`, using the protocol of `tcp` on port number `80`.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经添加了一条规则，该规则表示如果从`net`发送数据包到`fw`，并且使用端口号`80`的`tcp`协议，则接受该数据包。
- en: 'Once we are done with configuring the preceding files as per the requirements,
    we can test the settings by running the following command:'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦我们根据要求配置了上述文件，我们可以通过运行以下命令来测试设置：
- en: '[PRE13]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'In the output shown, scroll to the bottom, and if it says `Shorewall configuration
    verified`, it means the settings have been done properly and that Shorewall can
    now be used as a firewall:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 在显示的输出中，滚动到底部，如果显示`Shorewall配置已验证`，这意味着设置已正确完成，Shorewall现在可以用作防火墙：
- en: '![How to do it...](img/B04234_07_64.jpg)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/B04234_07_64.jpg)'
- en: 'Now restart the Shorewall service to apply the settings as follows:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在重新启动Shorewall服务以应用设置，如下所示：
- en: '[PRE14]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: How it works...
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: We begin with installing Shorewall on the system, which has two network interface
    cards.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先在系统上安装Shorewall，该系统有两个网络接口卡。
- en: Once the installation is done, we edit the `/etc/default/shorewall` file and
    also the `/etc/shorewall/shorewall.conf` file.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，我们编辑`/etc/default/shorewall`文件和`/etc/shorewall/shorewall.conf`文件。
- en: 'Then we edit or create these files in the `/etc/shorewall` location: interfaces,
    policy, rules, and zones. And we add the lines to each file as per the requirements
    given.'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在`/etc/shorewall`位置编辑或创建这些文件：interfaces、policy、rules和zones。然后根据要求向每个文件添加行。
- en: Once the editing is done, we check if everything is fine and then we start the
    Shorewall service to start our firewall.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑完成后，我们检查一切是否正常，然后启动Shorewall服务以启动我们的防火墙。
