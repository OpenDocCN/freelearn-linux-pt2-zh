["```\n$ ls -l .\ntotal 0\n-rw-rw-r--. 1 vagrant vagrant 0 Oct 28 10:42 examplefile\n```", "```\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\n$provisionScript = <<-SCRIPT\nsed -i 's/console=tty0 console=ttyS0,115200n8//g' /boot/grub2/grub.cfg\nsystemctl restart sshd\nSCRIPT\n\nVagrant.configure(\"2\") do |config|\n\n config.vm.define \"centos7\" do |centos7|\n centos7.vm.box = \"centos/7\"\n centos7.vm.box_version = \"1804.02\"\n centos7.vm.provision \"shell\",\n inline: $provisionScript\n end\n\n config.vm.define \"ubuntu1804\" do |ubuntu1804|\n ubuntu1804.vm.box = \"ubuntu/bionic64\"\n ubuntu1804.vm.box_version = \"20180927.0.0\"\n end\n\nend\n```", "```\n$ vagrant ssh centos7\n```", "```\n$ touch examplefile\n$ mkdir exampledir\n$ touch exampledir/examplefile-in-exampledir\n```", "```\n$ ls -l\ntotal 0\ndrwxrwxr-x. 2 vagrant vagrant 39 Oct 28 11:01 exampledir\n-rw-rw-r--. 1 vagrant vagrant 0 Oct 28 11:00 examplefile\n```", "```\ndrwxrwxr-x. 2 vagrant vagrant\n```", "```\ndrwxrwxr-x.\n```", "```\ndrwxrwxr-x.\n```", "```\ndrwxrwxr-x.\n```", "```\ndrwxrwxr-x.\n```", "```\ndrwxrwxr-x. 2\n```", "```\n$ ls -la exampledir/\ntotal 0\ndrwxrwxr-x. 2 vagrant vagrant 39 Oct 28 11:18 .\ndrwx------. 4 vagrant vagrant 132 Oct 28 11:01 ..\n-rw-rw-r--. 1 vagrant vagrant 0 Oct 28 11:18 examplefile-in-exampledir\n```", "```\nvagrant vagrant\n```", "```\n-rw-rw-r--. 1 vagrant vagrant  0 Oct 28 11:00 examplefile\n```", "```\n-rw-rw-r--.\n```", "```\n-rw-rw-r--.\n```", "```\n-rw-rw-r--. 1\n```", "```\n$ sudo cat examplefile\n```", "```\n$ ls -l /usr/bin/wall\n-r-xr-sr-x. 1 root tty 15344 Jun 9 2014 /usr/bin/wall\n```", "```\n$ wall There is no Hitchhikers Movie! \n$ \nBroadcast message from vagrant@localhost.localdomain (pts/0) (Sun Oct 28 11:52:12 2018):\n\nThere is no Hitchhikers Movie!\n```", "```\n$ ls -la /tmp\ntotal 0\ndrwxrwxrwt. 8 root root 172 Oct 28 11:54 .\n<SNIP>\n```", "```\n$ rm /tmp/test2 \nrm: remove write-protected regular empty file '/tmp/test2'? y\nrm: cannot remove '/tmp/test2': Operation not permitted\n```", "```\n$ vagrant ssh centos7\n```", "```\n$ cd /home\n$ sudo touch permissionfile\n$ sudo mkdir permissiondir\n$ sudo touch permissiondir/permissionfile-in-permissiondir\n```", "```\n$ sudo adduser packt -s /bin/bash -p '$1$2QzaOp2Q$Ke2yWZ1N2h4rk8r8P95Sv/'\n\n```", "```\n$ ls -lha\ntotal 0\ndrwxr-xr-x. 4 root root 64 Oct 28 12:37 .\ndr-xr-xr-x. 18 root root 239 Oct 28 12:35 ..\ndrwxr-xr-x. 2 root root 45 Oct 28 12:37 permissiondir\n-rw-r--r--. 1 root root 0 Oct 28 12:37 permissionfile\ndrwx------. 3 vagrant vagrant 74 May 12 18:54 vagrant\n```", "```\n$ echo \"RFCs are great if boring.\" > permissionfile\n-bash: permissionfile: Permission denied\n```", "```\n$ sudo chown vagrant:root permissionfile\n```", "```\n$ ls -l permissionfile\n-rw-r--r--. 1 vagrant root 0 Oct 28 12:37 permissionfile\n```", "```\n$ echo \"RFCs are great if boring.\" > permissionfile\n$ cat permissionfile\nRFCs are great if boring.\n```", "```\n$ su - packt -c \"echo IMPOSSIBLE > /home/permissionfile\"\nPassword: \n-bash: /home/permissionfile: Permission denied\n```", "```\n$ sudo chmod 646 permissionfile $ ls -l permissionfile\n-rw-r--rw-. 1 vagrant root 26 Oct 28 12:48 permissionfile\n```", "```\n$ su - packt -c \"echo POSSIBLE > /home/permissionfile\"\nPassword: \n$ cat permissionfile \nPOSSIBLE\n```", "```\n$ sudo chattr +i permissionfile\n```", "```\n$ echo \"RFCs are great if boring.\" > permissionfile\n-bash: permissionfile: Permission denied\n```", "```\n$ lsattr permissionfile\n----i----------- permissionfile\n```", "```\n$ sudo echo \"RFCs are great if boring.\" > permissionfile\n-bash: permissionfile: Permission denied\n```", "```\n$ sudo chattr -i permissionfile\n```", "```\n$ sudo chown vagrant:root permissionfile\n```", "```\n$ sudo chown vagrant permissionfile\n```", "```\n$ sudo chmod 646 permissionfile\n```", "```\n$ sudo chmod uo=rw,g=r permissionfile\n```", "```\n$ sudo chmod g+x permissionfile \n```", "```\n$ ls -l permissionfile\n-rw-r-xrw-. 1 vagrant root 26 Oct 28 13:03 permissionfile\n```", "```\n$ ls -la permissiondir\ntotal 0\ndrwxr-xr-x. 2 root root 45 Oct 28 12:37 .\ndrwxr-xr-x. 5 root root 77 Oct 28 12:37 ..\n-rw-r--r--. 1 root root 0 Oct 28 12:37 permissionfile-in-permissiondir\n```", "```\n$ mv permissiondir/permissionfile-in-permissiondir permissiondir/permissionfile2\nmv: cannot move 'permissiondir/permissionfile-in-permissiondir' to 'permissiondir/permissionfile2': Permission denied\n```", "```\n$ sudo chmod 646 permissiondir/permissionfile-in-permissiondir\n```", "```\n$ mv permissiondir/permissionfile-in-permissiondir permissiondir/permissionfile2\nmv: cannot move 'permissiondir/permissionfile-in-permissiondir' to 'permissiondir/permissionfile2': Permission denied\n```", "```\n$ sudo chmod 667 permissiondir/\n```", "```\n$ mv permissiondir/permissionfile-in-permissiondir permissiondir/permissionfile2\n```", "```\n$ echo \"printf 'Fire indeed hot'\" > permissionfile\n```", "```\n$ getfacl permissionfile \n# file: permissionfile\n# owner: vagrant\n# group: root\nuser::rw-\ngroup::r-x\nother::rw-\n```", "```\n$ setfacl -m u:packt:rwx permissionfile\n```", "```\n$ ls -l permissionfile\n-rw-r-xrw-+ 1 vagrant root 26 Oct 28 13:03 permissionfile\n```", "```\n$ getfacl permissionfile \n# file: permissionfile\n# owner: vagrant\n# group: root\nuser::rw-\nuser:packt:rwx\ngroup::r-x\nmask::rwx\nother::rw-\n```", "```\n$ ./permissionfile\n-bash: ./permissionfile: Permission denied\n```", "```\n$ su - packt -c \"/home/permissionfile\" \nPassword: \nFire indeed hot\n```", "```\n$ vagrant ssh centos7 $ vagrant ssh ubuntu1804\n```", "```\n$ whoami\nvagrant $ sudo whoami\nroot\n```", "```\n$ cat /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nsync:x:5:0:sync:/sbin:/bin/sync\nshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\nhalt:x:7:0:halt:/sbin:/sbin/halt\nmail:x:8:12:mail:/var/spool/mail:/sbin/nologin\noperator:x:11:0:operator:/root:/sbin/nologin\ngames:x:12:100:games:/usr/games:/sbin/nologin\nftp:x:14:50:FTP User:/var/ftp:/sbin/nologin\nnobody:x:99:99:Nobody:/:/sbin/nologin\nsystemd-network:x:192:192:systemd Network Management:/:/sbin/nologin\ndbus:x:81:81:System message bus:/:/sbin/nologin\npolkitd:x:999:998:User for polkitd:/:/sbin/nologin\nrpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin\nrpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin\nnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin\nsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin\npostfix:x:89:89::/var/spool/postfix:/sbin/nologin\nchrony:x:998:996::/var/lib/chrony:/sbin/nologin\nvagrant:x:1000:1000:vagrant:/home/vagrant:/bin/bash\npackt:x:1001:1001::/home/packt:/bin/bash\n```", "```\n$ cat /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin\nsyslog:x:102:106::/home/syslog:/usr/sbin/nologin\nmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin\n_apt:x:104:65534::/nonexistent:/usr/sbin/nologin\nlxd:x:105:65534::/var/lib/lxd/:/bin/false\nuuidd:x:106:110::/run/uuidd:/usr/sbin/nologin\ndnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin\nlandscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin\nsshd:x:109:65534::/run/sshd:/usr/sbin/nologin\npollinate:x:110:1::/var/cache/pollinate:/bin/false\nvagrant:x:1000:1000:,,,:/home/vagrant:/bin/bash\nubuntu:x:1001:1001:Ubuntu:/home/ubuntu:/bin/bash\n```", "```\n$ cat /etc/group\nroot:x:0:\nbin:x:1:\ndaemon:x:2:\nsys:x:3:\nadm:x:4:\ntty:x:5:\ndisk:x:6:\nlp:x:7:\nmem:x:8:\nkmem:x:9:\nwheel:x:10:\n<SNIP>\npostfix:x:89:\nchrony:x:996:\nscreen:x:84:\nvagrant:x:1000:vagrant\npackt:x:1001:\n```", "```\n$ cat /etc/group\nroot:x:0:\ndaemon:x:1:\nbin:x:2:\nsys:x:3:\nadm:x:4:syslog,ubuntu\ntty:x:5:\n<SNIP>\nlandscape:x:112:\nadmin:x:113:\nnetdev:x:114:ubuntu\nvboxsf:x:115:\nvagrant:x:1000:\nubuntu:x:1001:\n```", "```\n$ pidof rsyslogd\n917\n$ ps -up 917\nUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND\nsyslog 917 0.0 0.4 263036 4416 ? Ssl 10:41 0:00 /usr/sbin/rsyslogd -n\n```", "```\n$ grep PrivDrop /etc/rsyslog.conf\n$PrivDropToUser syslog\n$PrivDropToGroup syslog\n```", "```\n$ ps aux | grep -v root\nUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND\ndbus 558 0.0 0.5 66428 2568 ? Ssl 12:34 0:00 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation\nrpc 559 0.0 0.2 69220 1060 ? Ss 12:34 0:00 /sbin/rpcbind -w\npolkitd 568 0.0 1.6 538436 8020 ? Ssl 12:34 0:00 /usr/lib/polkit-1/polkitd --no-debug\nchrony 581 0.0 0.3 117752 1828 ? S 12:34 0:00 /usr/sbin/chronyd\npostfix 1088 0.0 0.8 89792 4080 ? S 12:35 0:00 qmgr -l -t unix -u\nvagrant 3369 0.0 0.5 154904 2688 ? S 14:11 0:00 sshd: vagrant@pts/0\nvagrant 3370 0.0 0.5 15776 2660 pts/0 Ss 14:11 0:00 -bash\npostfix 3399 0.0 0.8 89724 4052 ? S 14:15 0:00 pickup -l -t unix -u\nvagrant 3404 0.0 0.3 55140 1872 pts/0 R+ 14:32 0:00 ps aux\n```", "```\n$ grep apt /etc/passwd\n_apt:x:104:65534::/nonexistent:/usr/sbin/nologin\n```", "```\n$ vagrant ssh ubuntu1804\n```", "```\n$ systemctl status apparmor\n\u25cf apparmor.service - AppArmor initialization\n Loaded: loaded (/lib/systemd/system/apparmor.service; enabled; vendor preset: enabled)\n Active: active (exited) since Sun 2018-10-28 10:41:23 UTC; 4h 21min ago\n Docs: man:apparmor(7)\n http://wiki.apparmor.net/\n Process: 426 ExecStart=/etc/init.d/apparmor start (code=exited, status=0/SUCCESS)\n Main PID: 426 (code=exited, status=0/SUCCESS)\n\nWarning: Journal has been rotated since unit was started. Log output is incomplete or unavailable.\n```", "```\n$ sudo apparmor_status \napparmor module is loaded.\n15 profiles are loaded.\n15 profiles are in enforce mode.\n /sbin/dhclient\n /usr/bin/lxc-start\n /usr/bin/man\n /usr/lib/NetworkManager/nm-dhcp-client.action\n /usr/lib/NetworkManager/nm-dhcp-helper\n /usr/lib/connman/scripts/dhclient-script\n /usr/lib/snapd/snap-confine\n /usr/lib/snapd/snap-confine//mount-namespace-capture-helper\n /usr/sbin/tcpdump\n lxc-container-default\n lxc-container-default-cgns\n lxc-container-default-with-mounting\n lxc-container-default-with-nesting\n man_filter\n man_groff\n0 profiles are in complain mode.\n0 processes have profiles defined.\n0 processes are in enforce mode.\n0 processes are in complain mode.\n0 processes are unconfined but have a profile defined.\n```", "```\n$ sudo sed -i 's/capability net_raw,/#capability net_raw,/g' /etc/apparmor.d/usr.sbin.tcpdump\n$ sudo systemctl restart apparmor\n```", "```\n$ sudo tcpdump -i enp0s3\ntcpdump: enp0s3: You don't have permission to capture on that device\n(socket: Operation not permitted)\n```", "```\n$ sudo journalctl -k --since 15:34 --no-pager\n-- Logs begin at Sun 2018-10-28 10:41:21 UTC, end at Sun 2018-10-28 15:39:29 UTC. --\nOct 28 15:34:34 ubuntu-bionic kernel: kauditd_printk_skb: 6 callbacks suppressed\nOct 28 15:34:34 ubuntu-bionic kernel: audit: type=1400 audit(1540740874.554:97): apparmor=\"DENIED\" operation=\"capable\" profile=\"/usr/sbin/tcpdump\" pid=3365 comm=\"tcpdump\" capability=13 capname=\"net_raw\"\n```", "```\n/sbin/dhclient -> sbin.dhclient\n/usr/sbin/tcpdump -> usr.sbin.tcpdump\n```", "```\n$ cat /etc/apparmor.d/usr.sbin.tcpdump \n# vim:syntax=apparmor\n#include <tunables/global>\n\n/usr/sbin/tcpdump {\n #include <abstractions/base>\n #include <abstractions/nameservice>\n #include <abstractions/user-tmp>\n\n #capability net_raw,\n capability setuid,\n capability setgid,\n capability dac_override,\n network raw,\n network packet,\n\n # for -D\n @{PROC}/bus/usb/ r,\n @{PROC}/bus/usb/** r,\n<SNIP>\n```", "```\n # for -z\n /{usr/,}bin/gzip ixr,\n /{usr/,}bin/bzip2 ixr,\n```", "```\n$ sudo ln /usr/sbin/tcpdump /usr/sbin/tcpdump-clone\n```", "```\n$ sudo tcpdump -i enp0s3\ntcpdump: enp0s3: You don't have permission to capture on that device\n(socket: Operation not permitted)\n$ sudo tcpdump-clone -i enp0s3\ntcpdump-clone: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes\n15:52:52.803301 IP ubuntu-bionic.ssh > _gateway.37936: Flags [P.], seq 410213354:410213518, ack 1991801602, win 36720, length 164\n<SNIP>\n```", "```\n$ vagrant ssh centos7 -- -L 127.0.0.1:5858:127.0.0.1:5858\n```", "```\n$ sudo yum install epel-release -y\n$ sudo yum install policycoreutils-python setroubleshoot -y\n$ sudo yum install nginx -y\n$ sudo systemctl enable --now nginx\n```", "```\n$ curl -I localhost:80 \nHTTP/1.1 200 OK\nServer: nginx/1.12.2\nDate: Mon, 29 Oct 2018 17:36:35 GMT\nContent-Type: text/html\nContent-Length: 3700\nLast-Modified: Tue, 06 Mar 2018 09:26:21 GMT\nConnection: keep-alive\nETag: \"5a9e5ebd-e74\"\nAccept-Ranges: bytes\n```", "```\n$ sudo sed -i 's/80 default_server;/5858 default_server;/g' /etc/nginx/nginx.conf\n$ sudo systemctl restart nginx\nJob for nginx.service failed because the control process exited with error code. See \"systemctl status nginx.service\" and \"journalctl -xe\" for details.\n```", "```\n$ curl -I localhost:5858\ncurl: (7) Failed connect to localhost:5858; Connection refused\n```", "```\n$ sudo semanage port --add --type http_port_t --proto tcp 5858\nValueError: Port tcp/5858 already defined\n```", "```\n$ sudo semanage port --modify --type http_port_t --proto tcp 5858\n```", "```\n$ sudo systemctl restart nginx\n$ curl -I localhost:5858\nHTTP/1.1 200 OK\nServer: nginx/1.12.2\nDate: Mon, 29 Oct 2018 18:17:37 GMT\nContent-Type: text/html\nContent-Length: 3700\nLast-Modified: Tue, 06 Mar 2018 09:26:21 GMT\nConnection: keep-alive\nETag: \"5a9e5ebd-e74\"\nAccept-Ranges: bytes\n```", "```\n$ sudo mkdir -p /srv/webserver/arbitrary-location/\n$ echo \"HELLO WORLD\" | sudo tee /srv/webserver/arbitrary-location/index.html\nHELLO WORLD\n```", "```\n$ ls -lha /usr/share/nginx/html/\ntotal 20K\ndrwxr-xr-x. 2 root root 99 Oct 29 17:36 .\ndrwxr-xr-x. 4 root root 33 Oct 29 17:36 ..\n-rw-r--r--. 1 root root 3.6K Mar 6 2018 404.html\n-rw-r--r--. 1 root root 3.7K Mar 6 2018 50x.html\n-rw-r--r--. 1 root root 3.7K Mar 6 2018 index.html\n-rw-r--r--. 1 root root 368 Mar 6 2018 nginx-logo.png\n-rw-r--r--. 1 root root 2.8K Mar 6 2018 poweredby.png\n```", "```\n$ ls -lha /srv/webserver/arbitrary-location/\ntotal 4.0K\ndrwxr-xr-x. 2 root root 24 Oct 29 18:43 .\ndrwxr-xr-x. 4 root root 62 Oct 29 18:40 ..\n-rw-r--r--. 1 root root 12 Oct 29 18:43 index.html\n```", "```\n$ sudo sed -i 's/\\/usr\\/share\\/nginx\\/html/\\/srv\\/webserver\\/arbitrary-location/g' /etc/nginx/nginx.conf\n```", "```\n$ sudo systemctl restart nginx\n```", "```\n$ curl localhost:5858\n<html>\n<head><title>403 Forbidden</title></head>\n<body bgcolor=\"white\">\n<center><h1>403 Forbidden</h1></center>\n<hr><center>nginx/1.12.2</center>\n</body>\n</html>\n```", "```\n$ sudo semanage fcontext --add --type httpd_sys_content_t /srv/webserver/arbitrary-location/index.html\n$ sudo restorecon /srv/webserver/arbitrary-location/index.html\n```", "```\n$ curl localhost:5858\nHELLO WORLD\n```", "```\n$ sudo journalctl -e -u nginx --no-pager | tail -n 8\nOct 29 17:43:17 localhost.localdomain systemd[1]: Starting The nginx HTTP and reverse proxy server...\nOct 29 17:43:17 localhost.localdomain nginx[4334]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nOct 29 17:43:17 localhost.localdomain nginx[4334]: nginx: [emerg] bind() to 0.0.0.0:5858 failed (13: Permission denied)\nOct 29 17:43:17 localhost.localdomain nginx[4334]: nginx: configuration file /etc/nginx/nginx.conf test failed\nOct 29 17:43:17 localhost.localdomain systemd[1]: nginx.service: control process exited, code=exited status=1\nOct 29 17:43:17 localhost.localdomain systemd[1]: Failed to start The nginx HTTP and reverse proxy server.\nOct 29 17:43:17 localhost.localdomain systemd[1]: Unit nginx.service entered failed state.\nOct 29 17:43:17 localhost.localdomain systemd[1]: nginx.service failed.\n```", "```\n$ sudo semanage port -l | grep http\nhttp_cache_port_t tcp 8080, 8118, 8123, 10001-10010\nhttp_cache_port_t udp 3130\nhttp_port_t tcp 80, 81, 443, 488, 8008, 8009, 8443, 9000\npegasus_http_port_t tcp 5988\npegasus_https_port_t tcp 5989\n```", "```\n$ sudo semanage port -l | grep http\nhttp_cache_port_t tcp 8080, 8118, 8123, 10001-10010\nhttp_cache_port_t udp 3130\nhttp_port_t tcp 5858, 80, 81, 443, 488, 8008, 8009, 8443, 9000\npegasus_http_port_t tcp 5988\npegasus_https_port_t tcp 5989\n```", "```\n$ ls -lhaZ /usr/share/nginx/html/\ndrwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 .\ndrwxr-xr-x. root root system_u:object_r:usr_t:s0 ..\n-rw-r--r--. root root system_u:object_r:httpd_sys_content_t:s0 404.html\n-rw-r--r--. root root system_u:object_r:httpd_sys_content_t:s0 50x.html\n-rw-r--r--. root root system_u:object_r:httpd_sys_content_t:s0 index.html\n-rw-r--r--. root root system_u:object_r:httpd_sys_content_t:s0 nginx-logo.png\n-rw-r--r--. root root system_u:object_r:httpd_sys_content_t:s0 poweredby.png\n```", "```\n$ vagrant ssh centos7\n```", "```\n$ sudo yum install epel-release -y\n$ sudo yum install policycoreutils-python setroubleshoot -y\n$ sudo yum install nginx -y\n$ sudo systemctl enable --now nginx\n```", "```\n$ sestatus\nSELinux status: enabled\nSELinuxfs mount: /sys/fs/selinux\nSELinux root directory: /etc/selinux\nLoaded policy name: targeted\nCurrent mode: enforcing\nMode from config file: enforcing\nPolicy MLS status: enabled\nPolicy deny_unknown status: allowed\nMax kernel policy version: 31\n```", "```\n$ sudo setenforce Permissive\n```", "```\n$ sudo setenforce Enforcing\n```", "```\n$ sudo sed -i 's/5858 default_server;/5757 default_server;/g' /etc/nginx/nginx.conf \n```", "```\n$ sudo systemctl restart nginx\nJob for nginx.service failed because the control process exited with error code. See \"systemctl status nginx.service\" and \"journalctl -xe\" for details.\n```", "```\n$ sudo sealert -a /var/log/audit/audit.log\n```", "```\n--------------------------------------------------------------------------------\n\nSELinux is preventing /usr/sbin/nginx from name_bind access on the tcp_socket port 5757.\n\n***** Plugin bind_ports (92.2 confidence) suggests ************************\n\nIf you want to allow /usr/sbin/nginx to bind to network port 5757\nThen you need to modify the port type.\nDo\n# semanage port -a -t PORT_TYPE -p tcp 5757\n where PORT_TYPE is one of the following: http_cache_port_t, http_port_t, jboss_management_port_t, jboss_messaging_port_t, ntop_port_t, puppet_port_t.\n\n***** Plugin catchall_boolean (7.83 confidence) suggests ******************\n\nIf you want to allow nis to enabled\nThen you must tell SELinux about this by enabling the 'nis_enabled' boolean.\n\nDo\nsetsebool -P nis_enabled 1\n\n***** Plugin catchall (1.41 confidence) suggests **************************\n\nIf you believe that nginx should be allowed name_bind access on the port 5757 tcp_socket by default.\nThen you should report this as a bug.\nYou can generate a local policy module to allow this access.\nDo\nallow this access for now by executing:\n# ausearch -c 'nginx' --raw | audit2allow -M my-nginx\n# semodule -i my-nginx.pp\n\nAdditional Information:\nSource Context system_u:system_r:httpd_t:s0\nTarget Context system_u:object_r:unreserved_port_t:s0\nTarget Objects port 5757 [ tcp_socket ]\nSource nginx\nSource Path /usr/sbin/nginx\nPort 5757\nHost <Unknown>\nSource RPM Packages nginx-1.12.2-2.el7.x86_64\nTarget RPM Packages \nPolicy RPM selinux-policy-3.13.1-192.el7_5.3.noarch\nSelinux Enabled True\nPolicy Type targeted\nEnforcing Mode Enforcing\nHost Name localhost.localdomain\nPlatform Linux localhost.localdomain\n                              3.10.0-862.2.3.el7.x86_64 #1 SMP Wed May 9\n                              18:05:47 UTC 2018 x86_64 x86_64\nAlert Count 1\nFirst Seen 2018-10-30 17:27:06 UTC\nLast Seen 2018-10-30 17:27:06 UTC\nLocal ID 65a65b11-892c-4795-8a1f-163822aa3a0f\n\nRaw Audit Messages\ntype=AVC msg=audit(1540920426.452:335): avc: denied { name_bind } for pid=4551 comm=\"nginx\" src=5757 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket\n\ntype=SYSCALL msg=audit(1540920426.452:335): arch=x86_64 syscall=bind success=no exit=EACCES a0=6 a1=5580c9397668 a2=10 a3=7fff97b00870 items=0 ppid=1 pid=4551 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=nginx exe=/usr/sbin/nginx subj=system_u:system_r:httpd_t:s0 key=(null)\n\nHash: nginx,httpd_t,unreserved_port_t,tcp_socket,name_bind\n```", "```\n$ sudo ausearch -c 'nginx' --raw | audit2allow -M my-nginx\n******************** IMPORTANT ***********************\nTo make this policy package active, execute:\n\nsemodule -i my-nginx.pp$ sudo semodule -i my-nginx.pp\n```", "```\n$ sudo systemctl restart nginx\n$ curl -I localhost:5757\nHTTP/1.1 200 OK\nServer: nginx/1.12.2\nDate: Tue, 30 Oct 2018 17:41:42 GMT\nContent-Type: text/html\nContent-Length: 12\nLast-Modified: Mon, 29 Oct 2018 18:43:12 GMT\nConnection: keep-alive\nETag: \"5bd754c0-c\"\nAccept-Ranges: bytes\n```", "```\n$ cat /etc/selinux/config \n\n# This file controls the state of SELinux on the system.\n# SELINUX= can take one of these three values:\n# enforcing - SELinux security policy is enforced.\n# permissive - SELinux prints warnings instead of enforcing.\n# disabled - No SELinux policy is loaded.\nSELINUX=enforcing\n# SELINUXTYPE= can take one of three two values:\n# targeted - Targeted processes are protected,\n# minimum - Modification of targeted policy. Only selected processes are protected. \n# mls - Multi Level Security protection.\nSELINUXTYPE=targeted\n```", "```\n$ sudo ausearch -c 'nginx' --raw | audit2allow -M my-nginx\n$ ls\nmy-nginx.pp my-nginx.te\n```", "```\n$ sudo semodule -l | grep my-nginx\nmy-nginx 1.0\n```", "```\n$ vagrant ssh centos7\n```", "```\n$ ls -lhaZ .bashrc \n-rw-r--r--. vagrant vagrant unconfined_u:object_r:user_home_t:s0 .bashrc\n```", "```\n$ ls -lhaZ .ssh/authorized_keys \n-rw-------. vagrant vagrant unconfined_u:object_r:ssh_home_t:s0 .ssh/authorized_keys $ chcon --reference=.ssh/authorized_keys .bashrc\n```", "```\n$ ls -lhaZ .bashrc \n-rw-r--r--. vagrant vagrant unconfined_u:object_r:ssh_home_t:s0 .bashrc\n```", "```\n$ restorecon .bashrc \n$ ls -lhaZ .bashrc \n-rw-r--r--. vagrant vagrant unconfined_u:object_r:user_home_t:s0 .bashrc\n```", "```\n$ chcon --reference=.ssh/authorized_keys .bashrc\n```", "```\n$ sudo touch /.autorelabel\n$ sudo reboot\n```", "```\n$ ls -lhaZ .bashrc \n-rw-r--r--. vagrant vagrant unconfined_u:object_r:user_home_t:s0 .bashrc\n```"]