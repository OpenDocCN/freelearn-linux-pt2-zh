- en: Troubleshooting and Workplace Diplomacy
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障排除和职场外交
- en: 'In this chapter, we will examine the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将研究以下主题：
- en: What is troubleshooting?
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 什么是故障排除？
- en: Isolating the real issue
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 隔离真正的问题
- en: Giving estimates and deciding on next steps
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 给出估计并决定下一步
- en: Using `ss`, `iftop`, `tcpdump`, and others for network issues
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`ss`、`iftop`、`tcpdump`和其他工具解决网络问题
- en: Using `curl`, `wget`, and `openssl` for remote web issues
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`curl`、`wget`和`openssl`解决远程网络问题
- en: Using `itop`, `top`, and `vmstat` for local resource issues
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`itop`、`top`和`vmstat`解决本地资源问题
- en: Using `ps`, `lsof`, `strace`, and `/proc` for service issues
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`ps`、`lsof`、`strace`和`/proc`解决服务问题
- en: Making a copy of problems for later debugging
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 复制问题以供以后调试
- en: Temporary solutions and when to invoke them
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 临时解决方案及何时调用它们
- en: Handling irate developers
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理愤怒的开发人员
- en: Handling irate managers
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理愤怒的经理
- en: Handling irate business owners
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理愤怒的业主
- en: Introduction
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: In this chapter, we're going to start winding down on the technical aspects
    of what we've looked at. We're not going to look at new services and software
    too much, and the software we do use is going to be mostly those tools we've already
    covered in other areas (only here we will talk about when and how you might use
    them).
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将开始逐渐减少我们所看到的技术方面。我们不会过多地看新的服务和软件，我们所使用的软件大多是我们已经在其他领域涵盖过的工具（只是在这里我们将讨论何时以及如何使用它们）。
- en: Troubleshooting is the main focus of this chapter, with a lot of emphasis on
    doing the communication aspect of troubleshooting too. You can be the best engineer
    in the world, a literal code-whisperer, and yet if you're not able to relay your
    findings in a way that someone else can understand, all your ability amounts to
    naught.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的主要重点是故障排除，同时也非常强调故障排除的沟通方面。你可能是世界上最优秀的工程师，一个真正的代码耳语者，但如果你不能以其他人能够理解的方式传达你的发现，那么你的能力就毫无意义。
- en: When you troubleshoot something, in extra-time or under-fire, you've got to
    make sure that what you learn is properly noted (even if it's on a scrap of paper
    initially, and in a document store such as Confluence later) so that, should it
    happen again, someone who isn't you will be able to work out what's going on faster,
    and hopefully fix the issue sooner.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 当你排除故障时，不管是在额外的时间还是在火线下，你必须确保你学到的东西得到适当的记录（即使最初只是在一张纸上，以后可以存储在Confluence等文档存储中），这样，如果再次发生，不是你的人能够更快地弄清楚发生了什么，并希望更快地解决问题。
- en: While you troubleshoot, it's also worth keeping those around you informed of
    what's happening. I've seen this done in various ways over the years, but a more
    common-place solution to keeping people in the picture these days seems to be
    a Rocket.Chat or Slack channel that you can post announcements and information
    into. That way, anyone can keep abreast of the situation, even if it's only due
    to a passing interest.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在你排除故障的同时，也值得让周围的人知道发生了什么。多年来，我见过各种各样的做法，但如今让人们了解情况的一种更常见的解决方案似乎是通过Rocket.Chat或Slack频道发布公告和信息。这样，任何人都可以了解情况，即使只是出于一时的兴趣。
- en: And, yes, there will be occasions where you're troubleshooting that someone
    wants an update every five minutes on what's going on. This can be a client, a
    manager, a developer, or a business owner, but it's important to keep your cool
    in these situations, not get stressed, and ensure you keep your answers succinct
    and to the point, without too much guesswork.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 是的，有时你在排除故障时，有人希望每五分钟得到一个关于发生了什么的更新。这个人可以是客户、经理、开发人员或业主，但在这种情况下保持冷静，不要感到压力，确保你的回答简洁明了，不要有太多的猜测，这很重要。
- en: Technical requirements
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: All of what we do in this chapter can be accomplished using a single node; in
    this case, I'm using a CentOS machine.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们所做的一切都可以通过单个节点完成；在这种情况下，我使用的是一个CentOS机器。
- en: 'Feel free to use the `Vagrantfile` to play along:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 随时可以使用`Vagrantfile`来一起玩：
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: What is troubleshooting?
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 什么是故障排除？
- en: '**Troubleshooting**, or **debugging** (more frequently used for specific software),
    is the act of trying to work out what''s going wrong with a solution right now
    or what went wrong historically during an incident. That incident can be anything
    from the entire network going down in a data center, to working out why that one
    Docker container suddenly decided it was going to bounce itself up and down like
    a tennis ball.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '**故障排除**，或者**调试**（更常用于特定软件），是试图弄清楚解决方案出了什么问题，或者在事件发生时历史上出了什么问题的行为。那个事件可以是数据中心整个网络崩溃，也可以是弄清楚为什么一个Docker容器突然决定像网球一样上下弹跳。'
- en: No software is perfect. If it were, we'd all be out of jobs, and it's because
    of this simple statement of fact that you will almost inevitably find yourself
    in a situation at some point in your life where you're faced with a broken system
    and there's someone screaming at you to fix it.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 没有完美的软件。如果有的话，我们都会失业，正是因为这个简单的事实陈述，你几乎不可避免地会发现自己在生活中的某个时刻面临一个破损的系统，有人在对你大喊要你修复它。
- en: You can do everything in your power before this point to try to ensure you never
    experience something such as a production outage, including using multiple environments
    and testing changes through a promotion pipeline. But I can guarantee that you'll
    never account for everything, and, as most companies will tell you, issues can
    and will happen in production too. You just have to hope that when issues do happen,
    you're not being woken up at two in the morning to fix them, because you're the
    on-call engineer.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点之前，你可以尽一切努力，试图确保你永远不会遇到像生产中断这样的事情，包括使用多个环境和通过升级管道测试更改。但我可以保证你永远不可能考虑到一切，正如大多数公司会告诉你的那样，问题也可能发生在生产中。你只能希望当问题发生时，你不会在凌晨两点被叫醒去解决它们，因为你是值班工程师。
- en: How to do it...
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'When troubleshooting an issue, there''s some important first steps to take:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在排除故障时，有一些重要的第一步要采取：
- en: Get a drink of your choice, or ask someone nicely to make one for you (if the
    incident is so serious it requires an immediate immediate response). Try to avoid
    this drink being alcoholic. I usually go for tea.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 喝一杯你喜欢的饮料，或者礼貌地请别人为你倒一杯（如果事件需要立即立即响应）。尽量避免饮酒。我通常选择喝茶。
- en: Ensure you know what raised the alert. Generally, this will be from a monitoring
    system, or a panicked shift engineer on the other end of the phone. This is a
    good jumping-off point for the next step.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保你知道是什么引起了警报。通常，这将来自监控系统，或者是电话那头慌张的值班工程师。这是下一步的好起点。
- en: Get the impact of the problem; for example, does it mean that the website is
    down and no one can do their Christmas shopping, or is the system that routes
    incoming support calls down? This will help you to assess the importance of the
    issue.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 了解问题的影响；例如，这是否意味着网站宕机，没有人能购物，还是系统路由了进来的支持电话宕机？这将帮助你评估问题的重要性。
- en: There is a difference between people not being able to call into the support
    desk at three in the morning, and a traffic routing system for a small municipality
    being down. Surprisingly, though, some people will panic the exact same amount,
    no matter the scale of the issue.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 人们凌晨三点无法打进支持台和一个小城市的交通路由系统宕机是有区别的。令人惊讶的是，有些人会因为问题的规模而感到同样恐慌。
- en: Once these things are established, move on to isolating the real issue.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦这些事情确定下来，就开始隔离真正的问题。
- en: Isolating the real issue
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 隔离真正的问题
- en: When you're troubleshooting, or you've been presented with an obvious problem
    and it's up to you to work out what's going on, it's important not to jump to
    conclusions. It can be extremely easy to see a problem, such as a website being
    down, and immediately think, *Ah, I've seen this before; it was that time the
    database had too many rows to count and the website slowed to a crawl—I'll look
    there*.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 当你进行故障排除，或者你面临一个明显的问题，需要你弄清楚发生了什么时，重要的是不要草率下结论。很容易看到一个问题，比如网站宕机，立刻想到，“啊，我以前见过这种情况；那次是数据库行数过多，网站变得缓慢——我会从那里开始查找。”
- en: Lightning does strike twice in computing, especially when root causes haven't
    been addressed, but it's an anti-troubleshooting technique to immediately assume
    you know the cause of a problem, based on tentative similarities with past issues.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在计算机领域，闪电确实会击中两次，特别是当根本原因没有得到解决时，但是如果立刻假设你知道问题的原因，这是一种反故障排除的技术，只是基于与过去问题的暂时相似性。
- en: Getting ready
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 做好准备
- en: After you've got as much information about the problem, either from your own
    cursory glance of the symptoms (the website is down) or the support person who
    pestered you with it, it's time to get to the issue of isolation.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在你已经从自己对症状的粗略观察（网站宕机）或者那个支持人员向你烦扰的问题中获得了关于问题的尽可能多的信息后，就是时候开始隔离问题了。
- en: Be sure to recreate the issue for yourself. It's an important and often overlooked
    step that should be taken by anyone looking into an issue. If you have the means
    to recreate a problem, you should start by doing so, even if it's as simple as
    going to the company's URL in your browser and checking for yourself that the
    site doesn't load. This is important, as it gives you a base from which to start,
    and you can use the same series of steps every time you make a change, or believe
    you've fixed the problem. If you can confirm that the problem exists, work to
    fix the said problem. Then, prove it's fixed for at least you, after which you
    can start to engage other people in the process and ask them to confirm the same.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 一定要为自己重新创建问题。这是一个重要的步骤，经常被忽视，任何人在调查问题时都应该采取这一步骤。如果你有能力重新创建一个问题，你应该从这里开始，即使只是简单地在浏览器中输入公司的网址并亲自检查网站是否无法加载。这很重要，因为它为你提供了一个起点，你可以在每次进行更改或认为已经解决问题时使用相同的一系列步骤。如果你能确认问题存在，就努力解决这个问题。然后，证明至少对你来说问题已经解决，然后你可以开始让其他人参与这个过程，并要求他们确认相同的问题。
- en: Stabbing around in the dark doesn't only put you at risk of losing fingers,
    but it also makes it incredibly hard to determine when, or if, a chance you've
    made has actually had an impact.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在黑暗中乱刺并不仅会让你有失手的风险，而且也会让你极难确定你所做的改变何时或是否真的产生了影响。
- en: You might also find that in recreating the issue for yourself, you come across
    some pertinent information that hasn't been readily shared with you. "The website
    is down" is a vague statement, but "the website is timing out" is more informative,
    and if you go to a site to find it's been hijacked by someone using it to share
    pictures of their cat, then it might not be down, but the URL could be compromised.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会发现，在为自己重新创建问题时，你会遇到一些尚未与你分享的相关信息。“网站宕机”是一个模糊的说法，但“网站超时”更具信息量，如果你发现网站被某人劫持用来分享猫的照片，那么它可能并没有宕机，但URL可能已经被篡改。
- en: How to do it...
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 操作方法...
- en: 'Once the issue is recreated, you can get down to the meat of the work:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦问题被重新创建，你就可以开始着手解决问题的核心工作：
- en: To begin, you need to know which boxes are likely to be connected to the problem,
    either directly, or by one degree of separation. For example, if the company website
    is down, I would immediately log on to whichever system hosted the website, while
    trying to find information on any systems that supplied it, such as messaging
    brokers or databases.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，你需要知道哪些设备可能与问题直接或间接相关。例如，如果公司网站宕机，我会立即登录托管网站的系统，同时尝试查找任何为其提供服务的系统，比如消息代理或数据库。
- en: If you don't know what the topology of the deployment looks like off the top
    of your head, and you can't find a document in your internal systems that details
    the layout, it can be a good idea to engage others in the process of troubleshooting.
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你不知道部署的拓扑结构是什么样子，也找不到内部系统中详细描述布局的文件，最好让其他人参与故障排除过程。
- en: You might not feel entirely comfortable about waking someone else up in the
    middle of the night, or pestering someone at their desk, but if it would take
    you literally hours to reverse-engineer a setup, and it's definitely worth considering
    circumventing this effort and going to the source instead. If the other person
    is reasonable, they'll probably offer their knowledge, though they may be grumpy
    about it, and you'll have to apologise the next time you see them.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能不太愿意在半夜叫醒别人，或者在他们的桌子上打扰他们，但如果你需要花几个小时来逆向工程一个设置，那么绕过这种努力直接去找源头可能是绝对值得考虑的。如果对方是讲道理的，他们可能会提供他们的知识，尽管他们可能会对此感到不悦，你下次见到他们时就得道歉了。
- en: Once you are sure you've got all the systems you might need to check in your
    head, or better yet, on a notepad, you should begin the isolation. Depending on
    how lucky you are, this can be a quick or a slow process.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦你确定你已经在脑海中检查了所有可能需要检查的系统，或者更好的是，在记事本上，你应该开始隔离。这取决于你有多幸运，这可能是一个快速或缓慢的过程。
- en: 'Using the example of web servers and websites being down, you might try to
    SSH to your company website boxes and find that you can''t. This could mean one
    of two things straight away:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Web服务器和网站宕机的例子，你可能会尝试SSH到你公司的网站服务器，发现你无法连接。这可能意味着两件事：
- en: There's a network problem hampering communication
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有一个妨碍通信的网络问题
- en: The box is down
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器宕机
- en: These issues may seem wide-ranging, but they're easy to isolate. The next step
    here would be trying to SSH to another box, preferably in the same network, and
    if you can connect to it you've narrowed the field of what the issue might be.
    It would suggest that the first box is down, or experiencing personal network
    issues.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这些问题可能看起来很广泛，但很容易隔离。下一步是尝试SSH到另一个服务器，最好是在同一网络中，如果你可以连接到它，你就缩小了问题可能出现的范围。这表明第一个服务器宕机，或者遇到了个人网络问题。
- en: Assuming you can't get to another box, you should try another couple to be sure,
    and if you can't get to them either, it might be time to get your network team
    involved (or if you have the power to do so, logging on to the switches or routers
    yourself).
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 假设你无法连接到另一个服务器，你应该尝试另外几个以确保，如果你也无法连接到它们，那么可能是时候让你的网络团队介入了（或者如果你有权利这样做，自己登录交换机或路由器）。
- en: If you've determined that it's one or two boxes having a problem, you might
    have to get a data center engineer into the situation (or drive down yourself,
    if it's your job) and plug into the box directly. If it's a cloud solution, it'll
    be time to break open whatever console you have access to and check for obvious
    issues that way.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你已经确定是一个或两个服务器出了问题，你可能需要让数据中心的工程师介入（或者如果这是你的工作，自己去），并直接连接到服务器。如果是云解决方案，那么现在是时候打开你可以访问的控制台，以此方式检查明显的问题。
- en: Once you're on the box, it's a good idea to check that the same issues can be
    recreated locally on the box itself. We'll talk about ways you might do this in
    a little while.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦你进入服务器，最好检查是否可以在服务器本身上重现相同的问题。我们稍后会讨论你可能会这样做的方法。
- en: If you work through your troubleshooting steps and determine that the local
    box isn't the issue, it's time to work outwards and test the other parts of the
    solution that you haven't checked yet, or might not have direct control over.
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你按照故障排除步骤工作，并确定本地服务器不是问题所在，那么就是时候向外部工作并测试你尚未检查或可能没有直接控制的解决方案的其他部分了。
- en: People have different techniques when it comes to troubleshooting, but I like
    to check the stuff I have direct access and control over first. There's a good
    chance for certain issues that problems are being caused by external factors (such
    as your distributed content delivery provider having problems), but in cases such
    as these, it's a good idea to try to prove external factors as much as possible
    before you get on the phone yourself and start blaming other people.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 人们在故障排除时有不同的技巧，但我喜欢先检查我可以直接访问和控制的东西。对于某些问题，很有可能是由外部因素（比如你的分布式内容交付提供商出现问题）造成的，但在这种情况下，最好尽可能证明外部因素，然后再自己打电话开始责怪别人。
- en: Check the next most likely candidate for the source of the issue (the load balancer
    in front of the web server maybe, or the database behind it) and carry on until
    you find something that isn't behaving as it should.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查下一个最有可能成为问题源的候选项（可能是Web服务器前面的负载均衡器，或者后面的数据库），并继续直到找到一些行为不正常的东西。
- en: Giving estimates and deciding on next steps
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 给出估计并决定下一步
- en: 'While you''re working through the troubleshooting process, it''s a great idea
    to make notes as you go, and keep track of significant times during the incident:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在你进行故障排除过程中，随时做笔记并记录事件期间的重要时间是个好主意：
- en: What time was the incident first reported?
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件首次报告时间是什么时候？
- en: What time did you get into a position to start troubleshooting?
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你准备开始故障排除的时间是什么时候？
- en: What time did you isolate the issue?
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你隔离问题的时间是什么时候？
- en: What time was pertinent information discovered?
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发现相关信息的时间是什么时候？
- en: And so on
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 等等
- en: Another thing to be aware of is the **estimate**. Estimates are something that
    higher-ups like to hear, in a lot of cases, because it means they can pass the
    estimates on to their own higher-ups, or to customers.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 另一件需要注意的事情是**估计**。在很多情况下，高层领导喜欢听到估计，因为这意味着他们可以把估计传达给他们自己的上级或客户。
- en: If you have no clear idea what's causing an issue yet, you can't give a reliable
    estimate, and you should explain this. However, if you've managed to isolate the
    issue and found it to be caused by something such as a stored procedure running
    against a database, it may be possible to give a rough estimate in that situation.
    Deciding on the next steps can be tricky due to various factors, as we'll see
    here.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你还不清楚问题的根源，你就不能给出可靠的估计，你应该解释这一点。然而，如果你已经成功隔离了问题，并发现是由于诸如针对数据库运行的存储过程之类的东西引起的，那么在这种情况下可能可以给出一个粗略的估计。由于各种因素，决定下一步可能会很棘手，我们将在这里看到。
- en: Getting ready
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 做好准备
- en: Using the example from the last recipe, you've discovered that the website you're
    looking at is going slow because of a stored procedure running against the database.
    You've determined that this stored procedure runs weekly, and that it ran successfully
    last Sunday, where it took about an hour to complete before everything went back
    to normal, and no alarms were triggered.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 使用上一个示例，你已经发现你正在查看的网站因为针对数据库运行的存储过程而变慢。你已经确定这个存储过程每周运行一次，并且上个星期日成功运行，花了大约一个小时才完成，然后一切恢复正常，没有触发警报。
- en: Now, though, it's been an hour and a half, with no obvious sign of the stored
    procedure finishing its run. You should note what you've found, make a note of
    the time that you found it, and inform whoever you need to that you believe you've
    found the source of the problem.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，现在已经过去一个半小时了，但没有明显迹象表明存储过程已经完成了。你应该记录下你发现的问题，记录下你发现问题的时间，并通知你认为已经找到问题源头的人。
- en: Try to avoid using phrases such as "it's definitely this" or "I've found the
    problem," because those kinds of absolutes only succeed in making you look foolish
    and potentially making other people angry when they turn out to be red herrings.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 尽量避免使用诸如"肯定是这样"或"我找到问题了"之类的短语，因为这些绝对的说法只会让你看起来愚蠢，并且在它们被证明是误导时可能会让其他人生气。
- en: How to do it...
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'Estimates can be easy, or they can be incredibly difficult. I wouldn''t advise
    pulling numbers out of the air, as they can make you seem incompetent when you
    end up waving at your self-imposed deadlines as they fly by. What you can check,
    though, are historical records:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 估计可能很容易，也可能非常困难。我不建议凭空捏造数字，因为当你自己设定的截止日期被无视时，这会让你看起来无能。然而，你可以检查历史记录：
- en: If your stored procedure is running and taking a while, start by looking back
    through your logs and trying to determine how long the last few runs took. The
    more data the better.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你的存储过程正在运行并且需要一段时间，首先要回顾日志，尝试确定最近几次运行花了多长时间。数据越多越好。
- en: If you've got logs going back two years, and you can see that the stored procedure
    took a few minutes to run at the beginning of its life, when the company was small
    and the database was smaller, then you might start to build a picture of a job
    taking longer to run, the larger the database gets. You could confirm this by
    checking each run in a chart and seeing whether the increase in the time taken
    correlates with size. At this point, you might be able to pull a figure out that
    you know will be roughly when the job will finish.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有两年的日志，你可以看到存储过程在其生命周期的开始时需要几分钟才能运行，当公司规模较小，数据库规模较小时。然后你可能开始建立一个任务运行时间随着数据库规模增大而变长的情况。你可以通过检查图表中的每次运行来确认这一点，并查看所花时间的增加是否与规模相关。在这一点上，你可能能够得出一个你知道大致会完成任务的数字。
- en: If, however, those historic logs show that the stored procedure always runs
    at the same time, for the same amount of time, then you might start to believe
    something else has caused the sudden uptick in processing time. You should note
    this, and decide what to do next.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然而，如果历史日志显示存储过程总是在相同的时间运行相同的时间，那么你可能会开始相信其他原因导致了处理时间的突然增加。你应该注意这一点，并决定下一步该怎么做。
- en: It goes without saying, but checking specific process logs (if they exist) is
    also a must in situations such as this, as is reading through and understanding
    what the script or stored procedure might do. Again, if you need to get others
    involved, make a judgement call, but don't try and shoulder absolutely everything
    yourself, as this only results in more pressure and more stress.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 不用说，但在这种情况下，检查特定的过程日志（如果存在）也是必须的，就像阅读和理解脚本或存储过程可能会做的那样。再次强调，如果需要让其他人参与，要做出判断，但不要试图自己承担所有事情，因为这只会导致更大的压力和更多的压力。
- en: 'In this situation, you have to start thinking about factors outside the database
    that might be affecting processing time:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，你必须开始考虑影响处理时间的数据库外因素：
- en: Has there been any recent work that might have changed how the stored procedure
    works (check Git logs)?
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最近有没有进行过可能改变存储过程工作方式的工作（检查Git日志）？
- en: Has anyone logged on to the box recently and made changes (check audit logs)?
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最近有没有人登录到服务器并进行更改（检查审计日志）？
- en: Is there anything else running on the database server that could be impacting
    performance (check top for process information)?
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库服务器上是否还有其他正在运行可能影响性能的东西（检查进程信息）？
- en: It's up to you to decide on the priority of these things and work through them
    one at a time.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 由你决定这些事情的优先级，并逐个解决。
- en: 'Back to the estimates problem: if you''ve determined that the cause of the
    problem is a code change, and you need to roll back to an earlier version, then
    it''s not impossible to again provide an estimate. You should know how long a
    package is going to take to build, and how soon it will be deployed to boxes before
    a service can be restarted.'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 回到估计问题：如果你已经确定问题的原因是代码更改，并且需要回滚到早期版本，那么再次提供估计并不是不可能的。你应该知道一个软件包需要多长时间才能构建，以及在服务重新启动之前需要多长时间才能部署到服务器。
- en: Ultimately, though, the adage of "*it takes as long as it takes"* is true, though
    it's best not to say this to people pestering you for answers. Let them down more
    gently, and assure them you're working on it... show them your notes.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然而，"需要多长时间就需要多长时间"的谚语是真实的，尽管最好不要对那些向你追问答案的人说这句话。让他们更温和地失望，并向他们保证你正在努力解决问题...向他们展示你的笔记。
- en: There's more...
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'A lot of places have timetables for what''s supposed to happen during an incident,
    for example:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 很多地方都有关于事故期间应该发生什么的时间表，例如：
- en: If the issue is ongoing within an hour, inform only designated individuals
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果问题在一个小时内仍在进行中，请只通知指定的个人
- en: If the issue is taking longer than an hour or up to two, inform stakeholders
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果问题持续时间超过一个小时或两个小时，请通知利益相关者
- en: If the issue looks likely to leave systems offline for longer, arrange meetings
    every thirty minutes to keep stakeholders updated
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果问题看起来可能导致系统长时间离线，安排每30分钟开一次会议，以便让利益相关者了解最新情况
- en: Though not consistent anywhere I've worked, good companies have plans in place
    to make sure everyone is on the same page, and better places don't invite the
    troubleshooting engineers to these meetings, instead designating a liaison who
    gets the information from the engineers while they're working.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我在任何地方工作的情况并不一致，但是好的公司都有计划确保每个人都在同一页面，而更好的公司不会邀请故障排除工程师参加这些会议，而是指定一个联络人在工程师工作时获取信息。
- en: Using ss, iftop, tcpdump, and others for network issues
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用ss，iftop，tcpdump和其他工具解决网络问题
- en: In this recipe, we're going to list a few tools that can be used for isolating
    and debugging network issues, most of which can be found in the default repositories
    of common distributions.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在本文中，我们将列出一些可用于隔离和调试网络问题的工具，其中大多数可以在常见发行版的默认存储库中找到。
- en: A lot of these, if not all, where covered before in this book, but it's a good
    idea to repeat these tools over and over again, because 20% of what you'll find
    yourself doing in a troubleshooting scenario is trying to remember which tool
    is good for troubleshooting this particular problem.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 这本书中许多（如果不是全部）内容之前已经涵盖过，但是反复使用这些工具是个好主意，因为在故障排除场景中，你会发现自己要做的工作中有20%是试图记住哪个工具适合解决特定的问题。
- en: Getting ready
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: In this recipe, feel free to try out some or all of the commands listed (or
    even go off script and have a read of the relevant man pages). We will be using
    the CentOS VM.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在本文中，随时尝试执行列出的一些或所有命令（甚至可以离开脚本并阅读相关的man页面）。我们将使用CentOS虚拟机。
- en: 'SSH to your CentOS VM:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: SSH到您的CentOS虚拟机：
- en: '[PRE1]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Install two of the tools we will be using:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 安装我们将要使用的两个工具：
- en: '[PRE2]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: How to do it...
  id: totrans-100
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: We're going to run through our tools in turn.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将依次运行我们的工具。
- en: Ping
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Ping
- en: 'If you think you''ve got a network problem, the `ping` command is one of the
    oldest tools available to you, and one of your best friends:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您认为自己遇到了网络问题，`ping`命令是您可以使用的最古老的工具之一，也是您最好的朋友之一：
- en: 'Start by making sure your networking is up, pinging your loopback address and
    your own node IP. We will check whether the localhost is working:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先确保您的网络正常运行，ping您的环回地址和您自己的节点IP。我们将检查本地主机是否正常工作：
- en: '[PRE3]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Then, check your `Eth1` address:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，检查您的`Eth1`地址：
- en: '[PRE4]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Now that you''re sure your networking stack is up, check that you can talk
    to your router. If you don''t know your router''s IP, grab that first:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在您确定您的网络堆栈正常运行，请检查您是否可以与路由器通信。如果您不知道您的路由器IP，请先获取它：
- en: '[PRE5]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'We will now ping that IP:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们将ping该IP：
- en: '[PRE6]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Awesome! We're relatively sure that our actual packet routing is fine.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 太棒了！我们相对确定我们的实际数据包路由是正常的。
- en: 'Next, check whether your DNS works using the `ping` command:'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用`ping`命令检查您的DNS是否正常工作：
- en: '[PRE7]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Cool, so we know we can resolve domain names to IPs.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 很好，所以我们知道我们可以将域名解析为IP。
- en: Should name resolution not work for some reason, try checking that your `/etc/resolv.conf`
    actually has a `nameserver` entry in it, and try pinging that server to see whether
    you can actually reach it for communication. DNS resolution failures can have
    weird knock-on effects (such as slow SSH connections on some default installations).
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 如果由于某种原因名称解析无法工作，请尝试检查您的`/etc/resolv.conf`中是否实际有一个`nameserver`条目，并尝试ping该服务器，以查看您是否实际上可以与其进行通信。
    DNS解析失败可能会产生奇怪的连锁效应（例如在某些默认安装中导致SSH连接缓慢）。
- en: Ping is great, and many issues that are encountered can be tracked down immediately,
    thanks to its simplicity.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: Ping非常好，许多遇到的问题都可以立即追踪到，这要归功于其简单性。
- en: ss
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ss
- en: 'The `ss` is great for local port checking, as I might have made obvious for
    the number of times we''ve used it throughout this book so far:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '`ss`非常适合本地端口检查，因为我们迄今为止在本书中多次使用它：'
- en: 'If you have a web server on your machine, and you know for a fact it should
    be running on port `80`, you might find yourself using the `fish` arguments first,
    regardless:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您的计算机上有Web服务器，并且您确切知道它应该在端口`80`上运行，您可能会首先使用`fish`参数：
- en: '[PRE8]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: We do this immediately in some situations, just to get an overview of what the
    box thinks it's doing in terms of IP networking.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，我们立即执行此操作，只是为了概述主机在IP网络方面的活动。
- en: We get to see what ports are active and listening on the box, immediately ruling
    out usual suspects (such as `22` and `25`), and we get to see connected (ESTAB)
    sessions from remote connections, in this case, my machine.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到主机上活动和监听的端口，立即排除通常的嫌疑对象（如`22`和`25`），并且我们可以看到来自远程连接的已连接（ESTAB）会话，例如我的计算机。
- en: You can also run `ss` without the -n argument, if you want to see a best-guess
    at service names. I call it "best-guess" because all `ss` will do is read the
    `/etc/services` file and match a port to a name, but there's no guarantee that
    SSH is really running on `22`, instead of `2323` or something else.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想要查看服务名称的最佳猜测，也可以在不带-n参数的情况下运行`ss`。我称之为“最佳猜测”，因为`ss`将只是读取`/etc/services`文件并将端口与名称匹配，但不能保证SSH实际上是在`22`上运行，而不是在`2323`或其他端口上运行。
- en: 'You can also use `ss` to get a snapshot of what the machine looks like in terms
    of networking right now:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您还可以使用`ss`来获取主机在网络方面的快照：
- en: '[PRE9]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: iftop
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: iftop
- en: This is the first of the tools in this recipe that's unlikely to be installed
    by default; we sometimes come to `iftop` during the troubleshooting process because
    it's great for visualization. Humans tend to like visualization. We're simple
    creatures with simple dreams, and those dreams are generally vivid in color, and
    feature confusing graphs and charts (if you're me).
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 这是本文中第一个不太可能默认安装的工具；我们有时会在故障排除过程中使用`iftop`，因为它非常适合可视化。人类倾向于喜欢可视化。我们是简单的生物，有着简单的梦想，而这些梦想通常是色彩鲜艳的，并且包含令人困惑的图表（如果你是我）。
- en: 'As a result, where a computer prefers strings and structure, we tend to like
    a good representation of what it is we''re looking at, and `iftop` gives us this:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，当计算机更喜欢字符串和结构时，我们倾向于喜欢我们正在查看的东西的良好表示，而`iftop`给了我们这个：
- en: '[PRE10]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'We''ve generated a bit of traffic here, to three different locations, to show
    how easy it can be to see different sources and communication:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里生成了一些流量，到三个不同的位置，以展示看到不同来源和通信有多容易：
- en: '![](img/77681ee2-ecf3-4d5b-868c-a8ef1dc7560e.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![](img/77681ee2-ecf3-4d5b-868c-a8ef1dc7560e.png)'
- en: We went into `iftop` a lot earlier in this book, but remember that it exists!
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在本书的前面讨论了`iftop`，但请记住它确实存在！
- en: tcpdump
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: tcpdump
- en: 'Another tool we''ve used before is `tcpdump`; it prints and saves network traffic
    for debugging later or in the moment:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 我们以前使用过的另一个工具是`tcpdump`；它打印并保存网络流量以供以后调试或即时调试：
- en: '[PRE11]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Note the preceding example, where I specifically ran `tcpdump` but excluded
    SSH traffic:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意前面的例子，我特意运行了`tcpdump`，但排除了SSH流量：
- en: '[PRE12]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: As a result, what I got was a lot of information on the ping requests from my
    second session, but, crucially, I avoided the noise from the SSH traffic. (Which
    would be extra noisy, because every time something is printed to my session, that's
    SSH traffic, meaning it would grow and grow and grow.)
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我得到了关于来自我的第二个会话的ping请求的大量信息，但是关键是，我避免了SSH流量的噪音。（这将会非常嘈杂，因为每次有东西打印到我的会话时，那就是SSH流量，这意味着它会不断增长。）
- en: 'Though if we did want to debug SSH, this is possible and quite easy, given
    that `tcpdump` lets you output to a file:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如果我们确实想要调试SSH，这是可能的，并且相当容易，因为`tcpdump`可以让您将输出到文件：
- en: '[PRE13]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: This file can then be opened and read with tools such as Wireshark: [https://www.wireshark.org/](https://www.wireshark.org/).
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 然后可以使用Wireshark等工具打开并阅读此文件：[https://www.wireshark.org/](https://www.wireshark.org/)。
- en: Using cURL, wget, and OpenSSL for remote web issues
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用cURL、wget和OpenSSL解决远程网络问题
- en: 'If you''ve come to the conclusion that during your immense troubleshooting
    session that the issue you''re facing is one of the following, then some of these
    tools might be for you:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您得出结论，在您的大量故障排除会话期间，您面临的问题是以下之一，那么这些工具中的一些可能适合您：
- en: Something to do with the connectivity to a remote site
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与远程站点的连接有关
- en: Something to do with the certificates associated with a remote site
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与远程站点相关的证书问题
- en: Getting ready
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'SSH to your CentOS VM:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: SSH到您的CentOS VM：
- en: '[PRE14]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: cURL and OpenSSL should be universal at this point, and you can expect a system
    to have them by default.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，cURL和OpenSSL应该是普遍存在的，您可以期望系统默认安装它们。
- en: 'Wget is a bit more elusive, and is rarely part of a default install, but it''s
    easy enough to install:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: Wget有点难以捉摸，并且很少作为默认安装的一部分，但很容易安装：
- en: '[PRE15]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: At the moment, OpenSSL is everywhere, but due to a string of high-profile vulnerabilities,
    *cough* heartbleed *cough*, it has been forked a couple of times to produce approximations,
    though hopefully approximations with a limited number of problems. The most famous
    of these is `LibreSSL` by the OpenBSD folks, and while it's the default in that
    particular OS, it's unlikely to be the default in CentOS or Ubuntu any time soon.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，OpenSSL随处可见，但由于一系列备受关注的漏洞，*咳咳*心脏出血*咳咳*，它已经被分叉了几次以产生近似值，尽管希望是有限数量的问题。其中最著名的是OpenBSD团队的`LibreSSL`，虽然它是该特定操作系统的默认选项，但在CentOS或Ubuntu中不太可能成为默认选项。
- en: 'For the examples in this recipe, we''re also going to break the trust of some
    key areas of the internet (only locally to your VM, though—don''t worry). To do
    this, you can run the following command:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，我们还将打破互联网一些关键领域的信任（尽管只是在您的VM本地），不用担心。要做到这一点，您可以运行以下命令：
- en: '[PRE16]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: How to do it...
  id: totrans-156
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: We're going to run through these three programs, including examples of how you
    might use them as we go.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将运行这三个程序，包括在我们进行时如何使用它们的示例。
- en: cURL
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: cURL
- en: 'If you''ve ever used an open source OS, of any sort, there''s a good chance
    that cURL has been bundled alongside it, and as a result you will find its license
    agreements under the license agreements page (things such as game consoles, intelligent
    cars, and fridges usually feature a build of cURL). However, it''s generally always
    available to you on the command line, and, as a result, it''s a favorite of a
    lot of admins. This is partly because cURL features an extensive (and highly detailed)
    list of exit codes:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您曾经使用过任何类型的开源操作系统，很有可能cURL已经与其捆绑在一起，因此您将在许可协议页面下找到其许可协议（例如游戏机、智能汽车和冰箱通常都包含cURL的构建）。但是，它通常总是可以在命令行中使用，因此它是许多管理员的最爱。这在一定程度上是因为cURL具有一个广泛（并且高度详细）的退出代码列表：
- en: 'For example, curling the BBC results in the following:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 例如，对BBC进行cURL操作的结果如下：
- en: '[PRE17]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The `curl` command was successful, so we got a `0` exit code, which pretty much
    universally means OK.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '`curl`命令成功了，所以我们得到了`0`退出代码，这几乎普遍意味着OK。'
- en: 'We can try to `curl` an illegal URL:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以尝试`curl`一个非法的URL：
- en: '[PRE18]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Here, we get a `6` exit code. This is defined in the cURL manual, as follows:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们得到了一个`6`退出代码。这在cURL手册中定义如下：
- en: '[PRE19]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Another popular flag, which you''ll see used frequently, is `-I`:'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 另一个常用的标志是`-I`：
- en: '[PRE20]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'What you''re looking at are the headers from the site we''ve tried to hit.
    Instantly, this tells us a couple of things:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 你所看到的是我们试图访问的网站的标头。瞬间，这告诉我们一些事情：
- en: We're actually getting a `301`, redirecting us to a different address
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们实际上得到了`301`，将我们重定向到不同的地址
- en: We're hitting a `varnish` server (a popular caching server)
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们正在访问一个`varnish`服务器（一个流行的缓存服务器）
- en: 'If we instead attempt to hit the BBC on HTTPS, and with the `www` subdomain,
    we get the following exit code:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们尝试通过HTTPS访问BBC，并使用`www`子域，我们会得到以下退出代码：
- en: '[PRE21]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: This, crucially, is caused because cURL doesn't have access to a **Certificate
    Authority** (**CA**), as we moved the only authority on the system, at the head
    of this chapter. Helpfully, it even gives you the exit code, and details of what
    it thinks the problem is, in the output.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 这是至关重要的，因为cURL没有访问**证书颁发机构**（**CA**），因为我们已经在本章开头移动了系统上唯一的授权机构。幸运的是，它甚至会给你退出代码，并在输出中详细说明它认为问题所在。
- en: 'This brings us to another cURL option, `-k`:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这带我们来到另一个cURL选项，`-k`：
- en: '[PRE22]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Here note that we've got a `200 (OK)` response, despite not having access to
    a CA to validate the website as being legitimate. `-k` is used to set the insecure flag,
    see the following section of the cURL documentation (available at [https://curl.haxx.se/docs/manpage.html](https://curl.haxx.se/docs/manpage.html)[):](https://curl.haxx.se/docs/manpage.html)
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里请注意，尽管没有访问CA来验证网站的合法性，我们得到了`200（OK）`的响应。`-k`用于设置不安全标志，请参阅cURL文档的以下部分（可在[https://curl.haxx.se/docs/manpage.html](https://curl.haxx.se/docs/manpage.html)找到）：
- en: -k, --insecure
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: -k，--insecure
- en: (TLS) By default, every SSL connection curl makes is verified to be secure.
    This option allows curl to proceed and operate even for server connections otherwise
    considered insecure.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: （TLS）默认情况下，curl进行的每个SSL连接都经过验证，以确保安全。此选项允许curl继续运行，即使服务器连接在其他情况下被认为是不安全的。
- en: Obviously, using `-k` isn't advisable, ideal, or practical for everyday use.
    Instead, you should ensure that your CAs are up to date and the site you're trying
    to connect to isn't fraudulent.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，使用`-k`并不是一个明智、理想或实际的日常使用方法。相反，您应该确保您的CA是最新的，并且您要连接的站点不是欺诈性的。
- en: 'Feel free to replace your CA certificates now:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在可以随意替换您的CA证书：
- en: '[PRE23]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'You can also use `curl` to download remote files by using the `-o` option (after
    you''ve replaced your CA certificates, or you will get a certificate error):'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您还可以使用`curl`通过使用`-o`选项下载远程文件（在替换了CA证书之后，否则会出现证书错误）：
- en: '[PRE24]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Here, we simply pulled the entire page and saved it to `index.html` locally.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们只是拉取了整个页面并将其保存在本地的`index.html`中。
- en: cURL is also frequently used during troubleshooting and debugging to talk to
    REST APIs; this is because, from the command line, an engineer or admin can easily
    craft custom requests and see the output from the web server.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: cURL还经常用于故障排除和调试，以与REST API进行通信；这是因为，从命令行，工程师或管理员可以轻松地制作自定义请求并查看来自Web服务器的输出。
- en: Wget
  id: totrans-187
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Wget
- en: Like cURL, Wget is a tool for talking to web servers.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 与cURL一样，Wget是一个与Web服务器通信的工具。
- en: 'By default, the output is quite verbose and will tell you exactly what''s happening:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，输出相当冗长，并会准确告诉您发生了什么：
- en: '[PRE25]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Here, we can see the following:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到以下内容：
- en: '`wget` resolving the website to an IP address'
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`wget`将网站解析为IP地址'
- en: Connecting and getting a `301` telling it the site has moved
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接并获得`301`告诉它网站已经移动了
- en: Following the site to `http://www.bbc.co.uk`
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 跟随网站到`http://www.bbc.co.uk`
- en: Getting another `301` telling the client to use HTTPS
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得另一个`301`，告诉客户端使用HTTPS
- en: Following the site to `https://www.bbc.co.uk`
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 跟随网站到`https://www.bbc.co.uk`
- en: Finally, connecting, getting a `200`, and immediately downloading index.html
    (which it saves to `index.html.1` as we already have one from `curl`)
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后，连接，获得`200`，并立即下载index.html（保存为`index.html.1`，因为我们已经有一个来自`curl`的文件）
- en: From this, we can deduce that the BBC could save milliseconds with each request
    if it just knocked out one of those redirects (pointing to HTTPS straight away),
    and we also learn that wget's default behaviour is to save the content locally
    (instead of spitting things to stdout like cURL).
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 从中我们可以推断，如果BBC只是取消了其中一个重定向（直接指向HTTPS），它可以为每个请求节省毫秒级的时间，我们还了解到wget的默认行为是将内容保存在本地（而不是像cURL那样将内容输出到stdout）。
- en: '`wget` also features an "insecure" flag in the form of `--no-check-certificate`,
    though I don''t want to bang on about skipping certificate checks in this book
    (because they''re important).'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: '`wget`还具有一个“不安全”标志，即`--no-check-certificate`，尽管我不想在本书中过多地谈论跳过证书检查（因为它们很重要）。'
- en: '`wget` is found to be ideal for downloading multiple files from websites, manipulating
    what we are downloading, and running checksum checks on the content. Personally,
    I think the flags are a little more intuitive than cURL, and it''s the default
    behaviour of downloading files locally that I find more than useful when troubleshooting.'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '`wget`被发现非常适合从网站下载多个文件，操纵我们正在下载的内容，并对内容运行校验和检查。就我个人而言，我认为这些标志比cURL更直观，而且在故障排除时，下载文件到本地的默认行为对我来说非常有用。'
- en: OpenSSL
  id: totrans-201
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: OpenSSL
- en: When it comes to certificate checking, there isn't a better tool (right now)
    than OpenSSL.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行证书检查时，没有比OpenSSL更好的工具（目前）。
- en: Used to create both certificates, and entire CAs, OpenSSL can also be an excellent
    troubleshooting tool for your certificate problems.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 用于创建证书和整个CA，OpenSSL也可以成为您解决证书问题的出色工具。
- en: 'For example, if you want to quickly check the certificate chain of a website,
    you can use `s_client`:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果您想快速检查网站的证书链，可以使用`s_client`：
- en: '[PRE26]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Here, we can see the `Root CA` (GlobalSign Root CA), followed by the `GlobalSign
    Organization Validation CA`, and finishing with the `British Broadcasting Corporation`
    certificate. It also shows us the **common name** (**CN**) of the site (`www.bbc.com`).
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到`根CA`（GlobalSign根CA），然后是`GlobalSign组织验证CA`，最后是`英国广播公司`的证书。它还向我们显示了站点的**通用名称**（**CN**）（`www.bbc.com`）。
- en: 'This is actually interesting, because we''re not following redirects when we
    do this, so we''re actually returning the certificates used by `bbc.co.uk` instead
    of `www.bbc.co.uk`, which look like this:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 这实际上很有趣，因为我们在这样做时没有跟随重定向，所以我们实际上返回的是`bbc.co.uk`而不是`www.bbc.co.uk`使用的证书，看起来是这样的：
- en: '[PRE27]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'If you wanted the actual text representation of certificates in the chain,
    you can print these:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想要证书链中实际的文本表示，可以打印这些：
- en: '[PRE28]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: First, we get the text representation of the BBC certificate, then the text
    representation of the intermediary CA.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们获得BBC证书的文本表示，然后是中间CA的文本表示。
- en: 'If we want to test and make sure that a secure protocol is being used, we can
    do so with simple flags:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要测试并确保使用了安全协议，我们可以通过简单的标志来做到：
- en: 'First, we''ll check that the insecure `sslv3` isn''t enabled:'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们将检查不安全的`sslv3`是否已启用：
- en: '[PRE29]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: This doesn't work (thankfully).
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 这不起作用（幸好）。
- en: 'Now, we''ll check for `TLS1.2` support:'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将检查`TLS1.2`支持：
- en: '[PRE30]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Phew! So, we've established that we can talk to `bbc.co.uk` and that the certificates
    we see are functional. But what if we wanted information on those certificates?
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 哦哦！所以，我们已经确定我们可以与`bbc.co.uk`通信，并且我们看到的证书是有效的。但是如果我们想要关于这些证书的信息呢？
- en: We know that we're hitting `bbc.co.uk`, and yet the certificate CN is `www.bbc.com`; logically,
    this should result in a certificate error in your browser, so why doesn't it?
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 我们知道我们正在访问`bbc.co.uk`，但证书CN是`www.bbc.com`；逻辑上，这应该导致浏览器中的证书错误，那为什么没有呢？
- en: Let's check!
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们来检查一下！
- en: '[PRE31]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Here, we're piping the output of our `s_client` command into OpenSSL again.
    We're then using the `x509` (certificate management tool) to output the text information
    of the cert (decoded from that splodge of text seen previously), and then we're
    grepping out for DNS.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将我们的`s_client`命令的输出再次传输到OpenSSL。然后我们使用`x509`（证书管理工具）来输出证书的文本信息（从之前看到的那些文本中解码出来），然后我们使用grep来查找DNS。
- en: 'Specifically, DNS usually sits under this heading:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，DNS位于这个标题下：
- en: '[PRE32]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '**Subject Alternative Names** (**SANs**) are alternative names that this certificate
    can cover. One of these names is `bbc.co.uk`, and another is `www.bbc.co.uk`.
    There''s also a `news` one and a couple of **mobile** (**m**) entries (presumably
    for historic reasons).'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: '**主题备用名称**（**SANs**）是此证书可以覆盖的备用名称。其中一个名称是`bbc.co.uk`，另一个是`www.bbc.co.uk`。还有一个`news`和一对**移动**（**m**）条目（可能是出于历史原因）。'
- en: Isn't OpenSSL cool?
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: OpenSSL很酷，不是吗？
- en: '...When it''s not causing mass hysteria.'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: '...当它没有引起大规模恐慌时。'
- en: Using iotop, top, and vmstat for local resource issues
  id: totrans-228
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用iotop，top和vmstat解决本地资源问题
- en: Again, these are more tools that we've definitely covered before, but which
    can be extremely handy when it comes to troubleshooting local problems, specifically
    those around resources.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，这些是我们之前肯定已经涵盖过的工具，但在解决本地问题时可能会非常有用，特别是围绕资源的问题。
- en: Getting ready
  id: totrans-230
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 做好准备
- en: 'SSH to your CentOS VM:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: SSH到你的CentOS VM：
- en: '[PRE33]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Install the appropriate packages:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 安装适当的软件包：
- en: '[PRE34]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: How to do it...
  id: totrans-235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: We'll run through these tools in brief, but hopefully you've already picked
    up their basic usage from the rest of this book.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将简要介绍这些工具，但希望你已经从本书的其他部分中掌握了它们的基本用法。
- en: iotop
  id: totrans-237
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: iotop
- en: 'Invoked with the following command, `iotop` displays I/O usage on a system,
    by process:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令调用，`iotop`显示系统上的I/O使用情况，按进程：
- en: '[PRE35]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'On our system, this means that we can see very little in the way of activity
    (because the VM isn''t doing much by default):'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的系统上，这意味着我们几乎看不到任何活动（因为默认情况下VM并没有做太多事情）：
- en: '![](img/7b19d7e3-dc42-4b9b-a098-66ddecf2ed93.png)'
  id: totrans-241
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7b19d7e3-dc42-4b9b-a098-66ddecf2ed93.png)'
- en: As with `ps`, the square brackets around a thread (such as `"[kthrotld]"`, for
    example) denote kernel threads.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 与`ps`一样，括号中的线程（例如`"[kthrotld]"`）表示内核线程。
- en: 'If we wanted to see I/O in action, we could do the following in another session:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要看到I/O的操作，我们可以在另一个会话中执行以下操作：
- en: '[PRE36]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: We're specifically compressing and bandwidth, limiting the transfer of the preceding
    file. We've also got a -P in there, but that's mostly so that you can see what's
    happening as it happens.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 我们正在特定地压缩和带宽，限制传输前面的文件。我们还有一个-P在那里，但那主要是为了让你看到发生的事情。
- en: 'In our first session (`iotop`), we should see the rsync command in action:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的第一个会话（`iotop`）中，我们应该看到rsync命令在执行：
- en: '![](img/b0185065-f393-439c-99b2-52b91b015caa.png)'
  id: totrans-247
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b0185065-f393-439c-99b2-52b91b015caa.png)'
- en: Note how the very top line is our command, and shows our specific `DISK WRITEs`
    as being 95.21 M/s.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，最顶部的一行是我们的命令，并显示我们特定的`DISK WRITEs`为95.21 M/s。
- en: top
  id: totrans-249
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: top
- en: You've probably used top so many times now that you're sick of reading about
    it, and you probably know a great deal about how useful it can be, despite its
    simple invocation.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能已经使用了top很多次，以至于厌倦了它，你可能已经知道它有多么有用，尽管它的调用很简单。
- en: '[PRE37]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Pretty much universal across UNIX systems, top gives you a near-real-time representation
    of process usage across your system:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 在UNIX系统中几乎是通用的，top可以让你近乎实时地了解系统上的进程使用情况：
- en: '![](img/65d05501-10f4-4379-be95-82bf58c0c6c2.png)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![](img/65d05501-10f4-4379-be95-82bf58c0c6c2.png)'
- en: When it comes to troubleshooting, top is generally indispensable. Not only useful
    for seeing process, memory, and CPU information at a glance, top will work with
    an extremely small footprint, meaning that it's likely to work on systems that
    are seemingly exponentially contended.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 在故障排除方面，top通常是不可或缺的。不仅可以轻松查看进程、内存和CPU信息，top的工作占用空间极小，这意味着它可能在看似无限争用的系统上工作。
- en: Even if you prefer top alternatives, such as `htop` or glances, there's no guarantee
    that these programs will be available on each and every system you touch. Because
    of this, it's a good idea to become familiar with top, then fall back to alternatives
    once you're sure you can use it properly (or at least passably!).
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 即使你更喜欢顶级替代方案，比如`htop`或者glances，也不能保证这些程序在你接触的每个系统上都可用。因此，熟悉top是个好主意，然后在确保你可以正确使用它之后再使用替代方案（或者至少可以勉强使用）。
- en: vmstat
  id: totrans-256
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmstat
- en: 'On systems that are very contended, or where you might want to output system
    information for later correlation and debugging, vmstat is ideal. Giving you more
    of a global overview of your system, it can be handy to store periodic values
    to a file, which you can then check later:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 在非常争用的系统上，或者你可能想要输出系统信息以供以后相关和调试时，vmstat是理想的。它可以给你更全面的系统概览，将周期性的值存储到文件中会很方便，之后你可以随后检查：
- en: 'When run on its own, it can also be set to periodically print to screen:'
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当单独运行时，它也可以定期打印到屏幕上：
- en: '[PRE38]'
  id: totrans-259
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Outputting to a file is just as easy; simply redirect `stdout`:'
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将输出到文件同样简单；只需重定向`stdout`：
- en: '[PRE39]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Using ps, lsof, Strace, and /proc for service issues
  id: totrans-262
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用ps，lsof，Strace和/proc来解决服务问题
- en: '`ps`, `lsof`, `strace`, and `/proc` are all valuable tools when troubleshooting
    under fire. They can display something so obvious that you''d never have thought
    to look for it in a million years, and they can also work through certain tasks
    quicker than you''ll be able to do so yourself.'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: '`ps`，`lsof`，`strace`和`/proc`在紧急情况下进行故障排除时都是有价值的工具。它们可以显示一些如此明显的东西，以至于你在一百万年内都不会想到去寻找它，而且它们也可以比你自己做得更快地完成某些任务。'
- en: '`strace` is probably the most often overlooked of these tools, and it''s easily
    one of the most awkward to learn well, but it should always be at the back of
    your mind for program debugging.'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: '`strace`可能是这些工具中最容易被忽视的，而且很容易学会，但它应该始终在你的脑海中用于程序调试。'
- en: Personally, I generally forget about `strace` quite a lot, that is until someone
    wanders over and asks me why I'm trying to debug something in the most awkward
    way possible, before reminding me that `strace` is a thing that exists.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 就我个人而言，我经常忘记`strace`，直到有人走过来问我为什么我要以最困难的方式调试某些东西，然后提醒我`strace`是存在的。
- en: Getting ready
  id: totrans-266
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'SSH to your CentOS VM:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 连接到你的CentOS VM：
- en: '[PRE40]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Install `lsof` for this section (the others should be installed already):'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 为本节安装`lsof`（其他应该已经安装）：
- en: '[PRE41]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: How to do it...
  id: totrans-271
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做到...
- en: Running through each of our commands in turn, let's make our `ps` rundown very
    quick!
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 依次运行我们的每个命令，让我们快速了解一下`ps`！
- en: ps
  id: totrans-273
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ps
- en: '`ps`, which is used to show a `snapshot` of the current processes on a system,
    is a first port of call for many admins, and with good reason:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: '`ps`，用于显示系统上当前进程的`快照`，是许多管理员的首选，理由充分：'
- en: '[PRE42]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: As noted, `ps` also includes kernel threads by default (those in square brackets).
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，`ps`默认还包括内核线程（用方括号括起来的线程）。
- en: 'More frequently than carefully crafted `ps` commands I''ve just seen people
    pipe the output through other commands to accomplish what they need. It''s not
    uncommon to see commands such as this in the wild:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 经常比精心制作的`ps`命令更有用的是，我只看到人们通过其他命令将输出通过管道传递来完成他们需要的功能。在野外经常看到这样的命令：
- en: '[PRE43]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: This isn't necessarily a bad thing, and it's generally done as a quick query
    instead of something you'd actually put in a script.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 这不一定是一件坏事，通常只是作为一个快速查询，而不是你真的会放在脚本中的东西。
- en: Big tip, no one (well... nearly no one) writes commands, as they're printed
    in text books. More often than not, the person crafting the command will get a
    close approximation of what they want using the primary command, and then they'll
    shove it through a series of other commands to get the output they really need.
    We all (well... nearly all) do it.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 大提示，没有人（嗯...几乎没有人）会像在教科书中打印的那样编写命令。往往情况下，制作命令的人会使用主要命令得到他们想要的东西的一个近似值，然后通过一系列其他命令来得到他们真正需要的输出。我们都（嗯...几乎都）这样做。
- en: What I'm getting at is don't worry when you can't remember exact `ps` syntax
    when troubleshooting; do whatever you can do quickly.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 我的意思是，当你在解决问题时无法记住确切的`ps`语法时，不要担心；尽快做你能做的事情。
- en: lsof
  id: totrans-282
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: lsof
- en: '`lsof` is a great tool with a very confusing help section. In short, it''s
    used to list open files on a system, but run raw (without arguments), that''s
    a lot of information.'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: '`lsof`是一个非常令人困惑的工具，帮助部分很混乱。简而言之，它用于列出系统上打开的文件，但是原始运行（不带参数），会得到大量信息。'
- en: 'The most common way I''ve seen it used is like so:'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 我经常看到它的最常见用法是这样的：
- en: '[PRE44]'
  id: totrans-285
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'This is confusing, yes, so let''s break it down a bit:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 这很令人困惑，所以让我们来详细分析一下：
- en: '[PRE45]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: This is one stupid trick to make sure you have the header line in your output
    to screen; it does arguably waste clock cycles, as we're running `lsof` twice
    (once just to get the first line), but who's counting?
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个愚蠢的技巧，确保你的输出屏幕上有标题行；可以说这浪费了时钟周期，因为我们运行`lsof`两次（一次只是为了获取第一行），但谁在计数呢？
- en: 'The semi-colon means the end of the command:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 分号表示命令的结束：
- en: '[PRE46]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Now, we''re using `lsof` again, only this time we''re specifically grepping
    out lines that match the process ID of `rsyslogd`. The use of a dollar and parentheses
    here invokes a `subshell` that returns the value of the command run:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们再次使用`lsof`，只是这次我们专门筛选出与`rsyslogd`的进程ID匹配的行。在这里使用`$`和括号会调用一个`子shell`，返回运行命令的值：
- en: '[PRE47]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Lastly, we run our output through `grep -v` to return a list of strings. These
    are generally built up gradually by the person running the command, while they
    work out the entries they don''t need. Finally, we grep for `REG` explicitly to
    remove other entries we''re not interested in (such as `DIR`, for `directory`):'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们通过`grep -v`运行输出，返回一个字符串列表。这些通常是由运行命令的人逐渐构建的，当他们找出他们不需要的条目时。最后，我们明确地使用`grep`来删除我们不感兴趣的其他条目（比如`DIR`，表示`directory`）：
- en: '[PRE48]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: It looks stupid and long, but it works.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来很愚蠢和冗长，但它有效。
- en: Strace
  id: totrans-296
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Strace
- en: '`strace`, a program that''s written to specifically trace system calls (and
    signals), is often forgotten, but extremely powerful. If you want to find out
    what a program is doing in real-time, you can use `strace`.'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: '`strace`，一个专门用于跟踪系统调用（和信号）的程序，经常被遗忘，但非常强大。如果你想实时了解程序在做什么，你可以使用`strace`。'
- en: 'At a glance, it can be extremely baffling:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 乍一看，它可能会非常令人困惑：
- en: '[PRE49]'
  id: totrans-299
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: What we're looking at here are the events triggered by me connecting to a box
    (`NetworkManager` being the process we're following).
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里看到的是我连接到一个盒子时触发的事件（`NetworkManager`是我们正在跟踪的进程）。
- en: We can see that a few system calls are made, mainly `epoll_wait` and `poll`.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到有一些系统调用，主要是`epoll_wait`和`poll`。
- en: 'The man pages for these calls lists the following:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 这些调用的man页面列出了以下内容：
- en: '`epoll_wait`, `epoll_pwait`: Wait for an I/O event on an `epoll` file descriptor'
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`epoll_wait`，`epoll_pwait`：等待`epoll`文件描述符上的I/O事件'
- en: '`poll`, `ppoll`: Wait for some event on a file descriptor'
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`poll`，`ppoll`：等待文件描述符上的某个事件'
- en: These might not be overly helpful when you're not a C or kernel hacker, but
    with a perusal of the manual pages, they can point you to the source of the problems.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 当你不是C或内核黑客时，这可能不会太有帮助，但通过查阅手册页，它们可以指引你找到问题的源头。
- en: Generally, `strace` is a nice tool to use when a program is locking up, and
    you're not sure why (usually after you've checked the logs and discovered there's
    nothing useful in them). You can connect to the program as it's running, wait
    for (or cause) a lock, and then find the last few things it tried to do.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 通常情况下，当程序被锁定并且您不确定原因时（通常是在检查日志并发现其中没有有用信息后），`strace`是一个很好的工具。您可以在程序运行时连接到程序，等待（或导致）锁定，然后找到它最后尝试执行的几个操作。
- en: 'Another useful use of `strace` is finding files that a program is opening:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: '`strace`的另一个有用用途是查找程序正在打开的文件：'
- en: '[PRE50]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Here, we ran `cat testfile`, but did so with `strace` as the first command.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们运行了`cat testfile`，但是使用`strace`作为第一个命令。
- en: We can then see (by grepping for `open`) the files that cat attempted to use
    when reading our file, and we can also see the response when it determines the
    file doesn't exist.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们可以看到（通过使用`open`进行grep）在读取我们的文件时`cat`尝试使用的文件，我们还可以看到当它确定文件不存在时的响应。
- en: '`strace` prints to `stderr` by default, so we redirected `stderr` to `stdout`
    in our command using `2>&1` first.'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: '`strace`默认会打印到`stderr`，因此我们在命令中使用`2>&1`将`stderr`重定向到`stdout`。'
- en: /proc
  id: totrans-312
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: /proc
- en: Again, you're probably sick of reading about `/proc`, but here's a real-world
    example of how useful it can be.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，您可能已经厌倦了关于`/proc`的阅读，但这是一个`/proc`可以非常有用的现实例子。
- en: VMs suck for entropy, so it's usually a good idea to work out how much random
    data you can generate on your system. You can find that a lack of entropy can
    severely hamper processes that need to do things such as encrypt files.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: VM对于熵来说并不理想，因此通常最好确定您的系统可以生成多少随机数据。您会发现熵的缺乏会严重阻碍需要执行诸如加密文件之类的操作的进程。
- en: 'Using `/proc`, we can determine the entropy that''s currently available to
    our system:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`/proc`，我们可以确定当前可用于我们系统的熵：
- en: '[PRE51]'
  id: totrans-316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: This is one great example of how useful `/proc` can be. But what else is it
    useful for?
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 这是`/proc`可以非常有用的一个很好的例子。但它还有什么其他用途呢？
- en: 'We could use `/proc` to quickly count up the number of CPU cores our machine
    has:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`/proc`来快速计算出我们的机器有多少个CPU核心：
- en: '[PRE52]'
  id: totrans-319
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: We only have one CPU core in our machine. How about network statistics?
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的机器只有一个CPU核心。网络统计信息呢？
- en: 'Here, we''re using `/proc` to check the TCP statistics relating to our system,
    at the current point in time:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们使用`/proc`来检查与我们系统相关的TCP统计信息，当前时间点上：
- en: '[PRE53]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: Yes, there are better and faster ways of getting this information in general,
    but it's important to appreciate that a lot of the information you otherwise scrape
    is actually gained from the "process information pseudo-filesystem" in the first
    place.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 是的，通常有更好更快的方法来获取这些信息，但重要的是要意识到，您通常从第一手获得的大部分信息实际上是从"进程信息伪文件系统"中获得的。
- en: Making a copy of problems for later debugging
  id: totrans-324
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 复制问题以供以后调试
- en: In this section, we're going to talk about copying files for later debugging. Frequently,
    we find ourselves on systems where a problem has resulted in an outage. In these
    situations, the impetus among engineers can be to get the system up again, no
    matter what the problem is.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将讨论复制文件以供以后调试。经常情况下，我们发现自己在出现故障导致停机的系统上。在这些情况下，工程师们的动力可能是无论问题是什么都要让系统重新运行。
- en: You might discover, during your troubleshooting steps, that `/var/log` has filled
    up, and has taken the rest of the disk with it. In these situations, it can be
    incredibly tempting to simply delete the offending log file(s) and restart the
    broken daemon.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 在故障排除步骤中，您可能会发现`/var/log`已经填满，并且已经占用了剩余的磁盘空间。在这些情况下，很容易简单地删除有问题的日志文件并重新启动损坏的守护程序。
- en: You should do that, but not right away. First, you need to make sure you've
    got the file for later consumption so that the problem doesn't happen again.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该这样做，但不要立即这样做。首先，您需要确保将文件保存以供以后使用，以便问题不再发生。
- en: Getting ready
  id: totrans-328
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 做好准备
- en: In this example, we're going to mess around with some of the log files in `/var/log/`. We're
    going to use our CentOS VM again.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们将在`/var/log/`中玩弄一些日志文件。我们将再次使用我们的CentOS VM。
- en: How to do it...
  id: totrans-330
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做到...
- en: 'Take a quick look in `/var/log/` at the messages file:'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 快速查看`/var/log/`中的messages文件：
- en: '[PRE54]'
  id: totrans-332
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: It's not huge, but if you've got an incredibly small disk, this could be a massive
    problem.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 它不是很大，但如果您的磁盘非常小，这可能是一个巨大的问题。
- en: Say you've completely run out of space on the `/var/log` partition—what happens?
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您在`/var/log`分区上完全没有空间了，会发生什么？
- en: 'Let''s remind ourselves of an example VM''s partition layout, noting the lack
    of a dedicated `''/var''` partition:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回顾一下一个示例VM的分区布局，注意缺少专用的`'/var'`分区：
- en: '[PRE55]'
  id: totrans-336
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'The quick answers to the preceding question are as follows:'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 前面问题的快速答案如下：
- en: If the `/var/log` partition is the same one that `/` is on (as it is here),
    you've got a problem, and might even find yourself unable to reboot a system due
    to a lack of space. The `/var/log` partition could consume all available disk
    space, even what's needed by critical services, such as SSH.
  id: totrans-338
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果`/var/log`分区与`/`上的分区相同（就像这里一样），那么您将会遇到问题，甚至可能因为空间不足而无法重新启动系统。`/var/log`分区可能会占用所有可用的磁盘空间，甚至是关键服务所需的空间，比如SSH。
- en: If the `/var/log` partition is on its own partition (which it really should
    be), then you can't log anything anymore. While this might not bring the system
    down, it would still cause issues if you need to keep logs for debugging or auditing
    purposes (and don't pipe them away somewhere, such as an Elastic Stack cluster).
  id: totrans-339
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果`/var/log`分区是独立的分区（它确实应该是这样），那么您将无法再记录任何日志。虽然这可能不会导致系统崩溃，但如果您需要保留日志以进行调试或审计（并且没有将它们传送到其他地方，比如Elastic
    Stack集群），这仍然会导致问题。
- en: In the case of the first problem, you've pretty much got to resign yourself
    to rebooting the box using either one of several abrupt tricks (or getting the
    data center to take a look themselves).
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一个问题的情况下，您基本上必须接受使用几种突然的技巧（或者让数据中心自己来看一下）重新启动该框。
- en: 'In the case of the second problem, you''ll have to do a few things:'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二个问题的情况下，您需要做一些事情：
- en: Determine which process is running rampant, using the various other techniques
    we've discussed. Kill the process and stop the service if it can't be fixed immediately.
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定哪个进程正在肆虐，使用我们讨论过的其他各种技术。杀死进程并停止服务，如果不能立即修复。
- en: Copy the contents of `/var/log/messages` to another part of the system (a partition
    with more space) or a different system if required (using `rsync` or `scp`).
  id: totrans-343
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`/var/log/messages`的内容复制到系统的另一部分（具有更多空间的分区）或者如果需要的话复制到另一个系统（使用`rsync`或`scp`）。
- en: See if you can manually trigger `logrotate` to rotate and compress your messages
    log. This might fail depending on the actual space that's available.
  id: totrans-344
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 看看你是否可以手动触发`logrotate`来旋转和压缩你的消息日志。这可能会失败，取决于实际可用的空间。
- en: If you can't manually compress or `logrotate` a file, it may be time to delete
    the original messages file and create a new one in its place (with the same permissions).
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你无法手动压缩或`logrotate`一个文件，也许是时候删除原始的消息文件并在其位置创建一个新的文件（具有相同的权限）。
- en: You should make a copy of your logs prior to deleting them. Otherwise, you'll
    have no idea what happened to cause the issue in the first place.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 在删除日志之前，你应该先复制日志。否则，你将不知道是什么导致了问题。
- en: Temporary solutions and when to invoke them
  id: totrans-347
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 临时解决方案及何时调用它们
- en: Temporary solutions can be great, and necessary, depending on the situation
    you've found yourself in.
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 根据你发现自己所处的情况，临时解决方案可能是很好的，也是必要的。
- en: 'For example, if you''ve found yourself being awoken by an alarm at 5:00, informing
    you that a disk only has about 10% of disk space left available, you might decide
    to invoke a temporary fix:'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果你发现自己在凌晨5点被警报唤醒，通知你磁盘只剩下大约10%的空间，你可能决定调用一个临时解决方案：
- en: You've troubleshooted and determined that the disk is filling up at a rate of
    a gigabyte an hour, meaning it'll be full in an hour and a half
  id: totrans-350
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你已经排除故障并确定磁盘以每小时1GB的速度填满，这意味着一个半小时后磁盘就会满。
- en: You've also determined that the LVM setup on the box has 10 GB of free space
    available to you, to grow your logical volume
  id: totrans-351
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你还确定了盒子上的LVM设置为你提供了10GB的可用空间，以扩展你的逻辑卷。
- en: You check to make sure the problem isn't caused by a more significant issue
    (the site being down) and realize it's just a noisy log because of Christmas sales
  id: totrans-352
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你检查以确保问题不是由更重大的问题引起的（网站宕机），并意识到这只是因为圣诞销售而产生的嘈杂日志。
- en: You apply 50% of the free LVM space to your logical volume, and go back to bed
  id: totrans-353
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将50%的空闲LVM空间应用于你的逻辑卷，并回去睡觉。
- en: This is a good temporary solution because it means that the problem can be safely
    investigated during daylight hours (when others might be available, and you making
    the problem worse won't be that much of an issue). However, you should be aware
    of the flaws.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个很好的临时解决方案，因为这意味着问题可以在白天安全地调查（当其他人可能会在场，你让问题变得更糟的可能性不会太大）。然而，你应该意识到这种方法的缺陷。
- en: Temporary solutions in IT, as in UK politics, tend to become permanent fixes
    faster than you can blink. In our example, this will be less of an issue, because
    we only have a finite amount of disk space, but I've seen it happen whereby this
    solution becomes the recommended "fix" and engineers proceed to continue adding
    virtual disks for much longer than they should, only compounding the problem further
    (and potentially masking other issues, too).
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 临时解决方案在IT中，就像在英国政治中一样，往往比你眨眼更快地变成永久性的修复。在我们的例子中，这将不是一个问题，因为我们只有有限的磁盘空间，但我曾见过这种解决方案成为推荐的“修复”并且工程师继续添加虚拟磁盘的时间比他们应该的时间长得多，进一步加剧了问题（还可能掩盖其他问题）。
- en: How to do it...
  id: totrans-356
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: If a temporary solution buys you time, or means alarms stop going off and a
    website comes back online, then by all means do them, but also make a note of
    what you've done and log it in whatever ticketing system you use.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 如果临时解决方案为你赢得了时间，或者意味着警报停止响起，网站恢复在线，那么尽管这样做，但也要记下你做了什么，并在你使用的任何工单系统中记录下来。
- en: Be responsible for your own cludge. It's on you, and only you, to ensure that
    your temporary cron-job, system timer, or disk-space extension doesn't become
    the permanent fix for a problem.
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 对你自己的临时解决方案负责。你需要确保你的临时cron作业、系统定时器或磁盘空间扩展不会成为问题的永久解决方案。
- en: In a similar vein, if you write a bash script to periodically check a log file,
    and if it's over a certain size to compress it, make sure you also write checks
    to ensure that the bash script is working. There's nothing more annoying than
    coming to a system that has a "fix" applied to it, only to discover that the bash
    script eventually fell over due to being unable to work with files over a certain
    size, and nobody noticed.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 同样地，如果你编写一个bash脚本定期检查一个日志文件，如果超过一定大小就压缩它，确保你也编写检查以确保bash脚本正在工作。没有什么比来到一个应用了“修复”但最终由于无法处理超过一定大小的文件而崩溃的系统更令人恼火，而且没有人注意到。
- en: You will not be thanked if a temporary "fix" that you put in place brings down
    a box a few months later. This will also only be made worse if you've since left
    the company, and find that your name is jokingly dragged through the mud forevermore,
    whenever there's a similar issue to the one you've caused. If there's one thing
    you should avoid, it's allowing your name to become a verb in relation to something
    going wrong.
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你放置的临时“修复”在几个月后导致系统崩溃，你将不会受到感谢。如果你已经离开公司，发现你的名字被拖泥带水地拖着，每当出现类似你造成的问题时，情况只会变得更糟。如果有一件事你应该避免，那就是让你的名字与出现问题相关的事情成为动词。
- en: Handling irate developers
  id: totrans-361
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理愤怒的开发人员
- en: The systems administration life would be an awful lot easier if we never had
    to deal with other people (and I'd imagine those other people would say much the
    same about us).
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们从未不得不与其他人打交道，系统管理生活将会容易得多（我想那些其他人也会对我们说同样的话）。
- en: So, let's talk about developers. Our developer friends are doing their job,
    developing. It's in the nature of computing that no software is perfect, and bugs
    will creep in to even the most beautiful of code; it can even pass its previous
    tests, run perfectly in development and preprod environments, only to bring down
    production.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，让我们谈谈开发人员。我们的开发人员朋友正在做他们的工作，开发。在计算的本质中，没有软件是完美的，即使是最美丽的代码中也会出现错误；它甚至可能通过了以前的测试，在开发和预生产环境中运行完美，只是在生产环境中出现问题。
- en: You can think you've got a solution working perfectly, running like a dream,
    purring like a cat, and then one new "feature" from a developer can seemingly
    bring an entire solution crashing to the floor. It can be tempting to look for
    someone to blame in these scenarios. However, I would instead urge calm and composure,
    because getting annoyed at something usually only makes the situation worse (and,
    half of the time, it's something you did and forgot about that caused the problem
    anyway...). Everyone can start to blame everyone else in nightmare situations,
    so it's up to you (and your colleagues) to remain level-headed, working together
    to find the root of the problem.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会认为自己已经找到了一个完美运行的解决方案，像梦一样运行，像猫一样轻声细语，然后开发人员提出的一个新的“功能”似乎会导致整个解决方案崩溃。在这种情况下，很容易找人来批评。然而，我更希望保持冷静和镇定，因为对某事感到恼火通常只会使情况变得更糟（而且，一半的时间，问题其实是你自己忘记了导致的...）。在噩梦般的情况下，每个人都可能开始互相指责，所以你（和你的同事）需要保持头脑冷静，共同努力找到问题的根源。
- en: If a developer comes to you to report an issue, either in a live environment
    or a non-live environment, and assuming they've gone through the appropriate channels
    before doing so (submitting a ticket, talking to team leads, and so on), you may
    find that they're already frustrated with what's going on.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 如果开发人员来向你报告问题，无论是在实时环境还是非实时环境中，并且假设他们在这样做之前已经通过适当的渠道（提交工单，与团队领导交谈等）进行了沟通，你可能会发现他们已经对正在发生的事情感到沮丧。
- en: How to do it...
  id: totrans-366
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'It can be tempting to dismiss this sort of request out of hand because you''re
    busy on something else, or you don''t think it''s your job to fix the problem.
    This would be bad diplomacy, and would generally only result in both parties getting
    annoyed with each other:'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 很容易因为你正忙于其他事情，或者你认为解决问题不是你的工作，就驳回这种请求。这将是很糟糕的外交手段，通常只会导致双方对彼此感到恼火：
- en: Instead, appreciate that the other person is only trying to do their job, and
    whatever they've come to report, it's probably hindering them actually carrying
    on with the said job. The problem could be of their own design, or because of
    an issue you've missed in your infrastructure, but whatever the reason, it's important
    to handle the situation carefully.
  id: totrans-368
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要感激对方只是在尽力做好自己的工作，无论他们来报告的是什么问题，它可能会妨碍他们继续做自己的工作。问题可能是他们自己设计的，也可能是你在基础设施中忽略的问题，但无论原因如何，都很重要要小心处理这种情况。
- en: Even if you're not the point of contact for the issue in question, and you have
    no idea how you'd even start debugging it, consider smiling, politely explaining
    how much of an idiot you are with things such as that, and directing them (or
    better yet leading them) to someone who might be able to triage or help with their
    problem.
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 即使你不是问题的联系点，也不知道如何开始调试，也要微笑，礼貌地解释你在这方面是多么笨拙，并引导他们（或更好地带领他们）去找一个可能能够对他们的问题进行分类或帮助的人。
- en: Good communication and diplomacy results in a calmer working environment, and
    the idea of "you scratch my back, I'll scratch yours" comes into play, if you
    ever need a friendly `dev` to help you debug an issue you think might be caused
    by an application.
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 良好的沟通和外交手段会带来更加平静的工作环境，“你帮我，我帮你”的理念也会发挥作用，如果你需要一个友好的开发人员来帮助你调试你认为可能是由应用程序引起的问题。
- en: This goes the other way, too; don't feel pressured to drop absolutely everything
    just because someone has come over to you and started screaming that "your terrible
    infrastructure sucks"; in these situations, it's best to first find a mediator
    for the problem (a manager, usually) before looking into an issue. It's not appropriate
    for anyone to scream at or belittle anyone else in a workplace, remember that,
    and if you ever find yourself getting wound up, it might be a good idea to remove
    yourself from a situation entirely before it escalates. I've seen good engineers
    get into serious trouble and put their jobs on the line, just for having a temper.
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 这也适用于另一种情况；不要因为有人过来对你大喊“你糟糕的基础设施烂透了”而感到压力，最好是首先找一个问题的调解人（通常是经理），然后再去解决问题。在工作场所，任何人都不应该大声喊叫或贬低其他人，记住这一点，如果你发现自己变得焦躁不安，最好是在情况升级之前完全远离这种情况。我见过一些优秀的工程师因为脾气问题而陷入严重麻烦，甚至搭上了工作。
- en: Handling irate managers
  id: totrans-372
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理愤怒的经理
- en: Managers, such as developers, are only doing their jobs. They are perhaps harder
    to talk to in some circumstances, as they sometimes just want the problem and
    the solution to the problem in plain English, even if you don't know what the
    solution (or problem) is yet. Some of the best managers understand that not every
    problem can be located and fixed within ten minutes, and, likewise, some of the
    worst expects you to have fully formed solutions in the time it takes them to
    stand up from their desk and march over to yours.
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 像开发人员这样的经理只是在做他们的工作。在某些情况下，与他们交谈可能更加困难，因为有时他们只想用简单的英语表达问题和解决方案，即使你还不知道解决方案（或问题）是什么。一些最好的经理明白并不是每个问题都能在十分钟内找到并解决，同样，一些最糟糕的经理期望你在他们从办公桌站起来走到你的位置所需的时间内就能提出完全成熟的解决方案。
- en: Should you find yourself in the situation where you're having to talk to an
    irate manager, perhaps because there's a production issue and someone higher than
    them is breathing down their neck too, try not to wind them up further by bombarding
    them with jargon they're unlikely to understand, or similarly giving them vague
    platitudes.
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你发现自己不得不与一个愤怒的经理交谈，也许是因为出现了生产问题，而比他们更高层的人也在追问他们，那么最好不要用他们不太可能理解的行话来激怒他们，或者给他们模糊的套话。
- en: I'm using the term *manager* loosely here; the same logical could be applied
    to delivery leads, team leads, and so on.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 我在这里使用“经理”这个词比较宽泛；同样的逻辑也适用于交付负责人、团队负责人等。
- en: How to do it...
  id: totrans-376
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做到…
- en: Not all managers are technical, but a lot are. It's generally a good idea to
    establish how technical your manager is early on so that you can gauge the exact
    level of information you need to pass on to them during an issue. If they're on,
    above, or about your level, you can probably give them everything and allow for
    them to distill it upstream; if they're less technically minded, it's better to
    summarize key points.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 并非所有的经理都具备技术背景，但很多人都具备。最好在早期就确定你的经理的技术水平，这样你就能够评估在问题发生时需要向他们传达多少信息。如果他们的技术水平与你相当或更高，你可能可以把所有信息都告诉他们，让他们向上游传递；如果他们的技术水平较低，最好总结关键点。
- en: Remember that good managers manage and shield engineers or others from the day-to-day
    pressures of a workplace that aren't technical. Sure, you might get invited to
    the odd meeting to explain a solution, or defend a technical decision, but for
    the most part it's an engineer's job to engineer, an administrator's job to administrate,
    and a manager's job to manage (while also doing all the meetings the others don't
    want to).
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，优秀的经理要管理和保护工程师或其他人免受工作场所的日常压力，这些压力并非技术性质。当然，你可能会被邀请参加一些会议，解释解决方案，或者为技术决策辩护，但大部分时间，工程师的工作是工程师，行政人员的工作是行政管理，经理的工作是管理（同时也要参加其他人不想参加的所有会议）。
- en: Should an angry manager start bombarding you with questions, or asking for updates
    every five minutes, during a period when you're trying to concentrate, it might
    be time to direct them to a ticket you're keeping your logs in, and simply pasting
    a message in there every few minutes to update stakeholders on progress. I mentioned
    slack channels too, or other communication mediums, and these can be a good way
    of keeping people informed while allowing you time to concentrate.
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个愤怒的经理开始向你提问，或者在你专心工作时每五分钟要求更新，那么也许是时候把他们引导到你记录日志的工单上，然后每隔几分钟在那里发布一条消息，更新利益相关者的进展。我也提到了slack频道或其他沟通媒介，这些都是在让人们了解情况的同时，让你有时间专心工作的好方法。
- en: 'Before now, I''ve been dragged on to conference calls with the following people
    on during actual problems:'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: 在以前，我曾被拉到会议电话上，而实际上出现问题时，以下人员都在场：
- en: My manager
  id: totrans-381
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的经理
- en: My manager's manager
  id: totrans-382
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的经理的经理
- en: My manager's manager's manager
  id: totrans-383
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的经理的经理的经理
- en: Other members of the team
  id: totrans-384
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 团队的其他成员
- en: Members of the development team
  id: totrans-385
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开发团队的成员
- en: A representative of the sales team
  id: totrans-386
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 销售团队的代表
- en: A representative of the client-relations team
  id: totrans-387
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户关系团队的代表
- en: Now, I don't know about you, but that seems like too many people for a call
    when there's an ongoing problem.
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我不知道你怎么想，但在出现持续问题时，参与电话会议的人似乎太多了。
- en: In my professional opinion, it is OK to say you can't join a call of that magnitude
    right that second, while also providing an update of where exactly you are in
    your troubleshooting.
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 在我看来，当你无法立刻参加如此重要的电话会议时，同时提供一下你在故障排除中的进展是可以的。
- en: Handling irate business owners
  id: totrans-390
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理愤怒的企业主
- en: Above co-workers, managers, and even division leaders, are business owners.
    Again, there are good business owners, and there are bad business owners. Most
    of the time, you'll probably never meet them in larger companies, but it seems
    to be something of a universal law that you'll cross paths at some point, and
    sometimes, this will coincide with an actual outage, just because the universe
    thinks it's funny.
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 在同事、经理甚至部门领导之上，是企业主。同样，有好的企业主，也有坏的企业主。在大公司里，你可能永远不会见到他们，但似乎有一种普遍规律，你总会在某个时刻与他们交集，有时，这会与实际的故障同时发生，就好像宇宙觉得这很有趣一样。
- en: Business owners can lose their job and their business in one fell swoop if there's
    a perceived mistake in their leadership. This won't be a defense of capitalism,
    and I'm not about to suggest the rising up of the working classes to seize the
    means of production, but it's always worth bearing in mind that the person who's
    getting angry at you for not giving complete enough (in their mind) answers might
    actually be about to lose their customer base and, by extension, livelihood.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 如果领导层出现了错误，企业主可能一下子就会失去工作和生意。这不是为资本主义辩护，我也不打算建议工人阶级起来夺取生产资料，但值得记住的是，那些因为你没有给出足够完整的答案而生气的人，可能正在失去他们的客户群，进而失去生计。
- en: How to do it...
  id: totrans-393
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做到…
- en: Tread carefully when the person you're talking to has the power to hire or fire
    you, depending on what you say. Where you might lose your job if you royally screw
    up (and frankly, it would have to be continuous and egregious screw ups), it's
    only your job, and you might be able to find another one while putting that particular
    chapter of your life behind you.
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 当你和对话的人有权雇佣或解雇你时，要小心行事，因为你说的话可能会让你失去工作。如果你犯了严重错误（坦白说，那必须是持续且严重的错误），你可能会失去工作，但那只是一份工作，你可能会找到另一份工作，然后把那一段生活放在身后。
- en: Hopefully, you won't, but if you do ever find yourself in the situation where
    you're dealing with an extremely irate individual with the power to let you go
    (off a cliff or otherwise), it's generally tread-on-eggshells time. Assure them
    that you're doing everything in your power to resolve the issue, point to progress
    made, if there is any, and reassure them that every able-bodied individual is
    working on the problem.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 希望你不会，但如果你确实发现自己在处理一个极度愤怒的有权力让你下台的人（无论是在悬崖上还是其他地方），那么通常是小心翼翼的时候。向他们保证你正在尽一切努力解决问题，指出已经取得的进展，如果有的话，并向他们保证每个有能力的人都在解决问题。
- en: Who knows—if you impress them enough in a time of crisis, keeping your head
    when all around are losing theirs, you might find yourself in a favored position
    in the not-too-distant future.
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 谁知道——如果你在危机时刻给他们留下深刻印象，保持头脑冷静，而周围的人都在失去理智，你可能会发现自己在不久的将来处于一个受宠的位置。
- en: Roundup - Troubleshooting and workplace diplomacy
  id: totrans-397
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结-故障排除和职场外交
- en: This chapter was something of a mixed bag because I tried to suggest what the
    best courses of action can be during a production (or even a minor) problem. I
    included programs I thought might be useful to you in a pinch, some vague directives
    on what you should think about during an outage, and then concluded with a few
    suggestions on dealing with other people during what could be the most stressful
    time of your professional career.
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 这一章有点混杂，因为我试图建议在生产（甚至是小问题）期间可以采取的最佳行动。我包括了我认为在紧要关头对你有用的程序，一些关于你在停机期间应该考虑的模糊指导，然后总结了一些关于在你职业生涯中可能是最紧张的时刻与其他人打交道的建议。
- en: All that said, there's time for a few more points I'd like to make.
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，我还有一些要说的话。
- en: Don't trust time
  id: totrans-400
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 不要相信时间
- en: 'A good 70 percent of the time (random figure), I''ve found time to be the root
    cause of most of my problems. It is because of this that one of the first commands
    I run when I log on to a box is `date`:'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: 我发现有70%的时间（随机数字），时间是我问题的根本原因。正因为如此，当我登录到一个系统时，我运行的第一个命令之一就是`date`：
- en: '[PRE56]'
  id: totrans-402
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: If the time is wrong (and not just offset because of timezones), then there's
    a very good chance that the weird and wonderful problems you're seeing are the
    direct result of two or more computer systems arguing about which of their completely
    arbitrary representations of time is correct.
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 如果时间不对（而不仅仅是因为时区不同），那么你看到的奇怪问题很有可能是两个或更多计算机系统争论它们各自的完全任意的时间表示哪个是正确的直接结果。
- en: Fix time before you fix anything else.
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 先修复时间，然后再修复其他任何东西。
- en: Incorrect time and fixing incorrect time can cause problems of its own so, check
    and keep backups regularly.
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 不正确的时间和修复不正确的时间本身就会引起问题，所以要定期检查并备份。
- en: Don't overlook the simple
  id: totrans-406
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 不要忽视简单的问题
- en: 'Alongside `date`, another command I run almost as an impulse is `df -h`:'
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 除了`date`之外，我几乎本能地运行的另一个命令是`df -h`：
- en: '[PRE57]'
  id: totrans-408
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: Like time being wrong, cosmically stupid errors can occur when disk space has
    run out, with no actual indication as to what the real problem is. Programs rarely
    print *I can't write to this file, so I'm broken,* and instead usually settle
    on cryptic, baffling, and altogether mind-numbing errors that make no sense on
    the face of it.
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: 就像时间错误一样，当磁盘空间耗尽时，可能会出现宇宙级愚蠢的错误，而实际上并没有任何指示真正的问题是什么。程序很少打印“我无法写入这个文件，所以我出错了”，而通常只是停留在晦涩、令人困惑和完全令人昏昏欲睡的错误上，这在表面上是毫无意义的。
- en: Check disk space second.
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: 其次检查磁盘空间。
- en: On "cloud" deployments
  id: totrans-411
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 关于“云”部署
- en: Time for another small rant!
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 又到了发泄的时间！
- en: One of the most annoying things that "cloud" has done has been to introduce
    the "solution" of "destroy and redeploy".
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: “云”带来的最让人恼火的事情之一就是引入了“销毁和重新部署”的“解决方案”。
- en: In the realm of temporary fixes, I consider the most egregious temporary fix
    to be "Oh, just tear down the solution and let it rebuild; that error happens
    sometimes."
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 在临时修复的领域，我认为最严重的临时修复是“哦，只需拆除解决方案，让它重新构建；有时会出现这种错误。”
- en: This isn't a "fix", and it annoys me immensely when I hear it. Yes, we can simply
    destroy and recreate environments these days, at the drop of a hat usually, but
    that doesn't excuse the original error that caused your systems to break in the
    first place. If they did it once, there's every chance that they'll do it again,
    and if they wake me up in the middle of the night or interrupt my holiday to Egypt,
    someone is getting a sternly worded email.
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 这不是一个“解决方案”，当我听到这样的话时，我感到非常恼火。是的，我们现在可以简单地销毁和重建环境，通常一下子就能搞定，但这并不能原谅最初导致你的系统首次崩溃的错误。如果他们一次这样做了，他们很可能会再次这样做，如果他们在半夜叫醒我或者打断我在埃及度假，那么某人将会收到一封严厉的电子邮件。
- en: '"Destroy and recreate" should be a means for getting a solution back online,
    but as we covered in this chapter, you should also have a backup of any files
    you might need to work out what went wrong, and you shouldn''t consider the problem
    to be "resolved" until it stops happening.'
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: “销毁和重建”应该是让解决方案重新上线的手段，但正如我们在本章中所讨论的，你还应该备份可能需要用来解决问题的任何文件，并且在问题停止发生之前，你不应该认为问题已经“解决”。
- en: If anyone ever tells you a solution is to destroy and recreate, tell them to
    fix their code.
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有人告诉你解决方案是销毁和重建，告诉他们去修复他们的代码。
- en: Learn from my mistakes
  id: totrans-418
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从我的错误中学习
- en: In terms of handling irate people, I'm a good authority, because as many of
    my former colleagues will attest, I usually was that irate person.
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理愤怒的人方面，我是一个很好的权威，因为正如我的许多前同事所证明的那样，我通常就是那个愤怒的人。
- en: It took me a good few years to realize that getting angry at a situation or
    people didn't make the situation any better, or my workplace nicer; it only made
    my mood worse. Thankfully, I've learned from my mistakes, and I take a very different
    approach to problems these days, not just flipping immediately to complain-and-blame
    mode (though I would always endeavour to fix the problem) and instead taking a
    step back from the situation first, assessing it, and then diving in with a nice
    cup of tea.
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 我花了好几年的时间才意识到，对某种情况或人生气并不能让情况变得更好，或者让我的工作场所更愉快；它只会让我的心情变得更糟。谢天谢地，我从错误中吸取了教训，如今我对问题采取了非常不同的态度，不再立即转向抱怨和指责模式（尽管我总是努力解决问题），而是先退后一步，评估情况，然后带着一杯好茶投入其中。
- en: Being zen in a crisis is hard; I'm not going to claim otherwise, but the more
    people with level heads, the calmer the situation will stay. It's far too easy
    to jump on to random threads when you're worked up, reaching dead ends and getting
    more annoyed before backtracking.
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: 在危机中保持冷静很难；我不会否认这一点，但头脑冷静的人越多，情况就会越平静。当你情绪激动时，很容易跳到随机的思路上，走进死胡同，变得更烦恼，然后再退回来。
- en: Breathe.
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 深呼吸。
