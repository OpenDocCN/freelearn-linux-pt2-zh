- en: Chapter 5. Monitoring and Logging
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章。监控和日志
- en: In a large computer infrastructure, system administrators cannot easily handle
    the monitoring of all system services and hardware issues for every machine. There
    should be a tool that helps gather the statuses of every machine in the infrastructure
    and presents them in a comprehensive way to the system administrators. Therefore,
    monitoring systems have been developed to satisfy the needs of monitoring a wide
    variety of computer infrastructure and help prevent system or hardware damage.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在大型计算基础设施中，系统管理员无法轻松处理每台机器的所有系统服务和硬件问题的监控。应该有一个工具帮助收集基础设施中每台机器的状态，并以全面的方式呈现给系统管理员。因此，监控系统已经被开发出来满足监控各种计算基础设施的需求，并帮助防止系统或硬件损坏。
- en: This chapter is an exploration of the world of monitoring and logging tools
    and the methodologies needed to better implement the right tools and configure
    them with the right parameters to guard and supervise a personalized computer
    infrastructure.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章是对监控和日志工具世界的探索，以及更好地实施正确工具和配置正确参数来保护和监督个性化计算基础设施所需的方法。
- en: 'Through this chapter, you are going to learn these topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 通过本章，您将学习以下主题：
- en: The most common open source monitoring tools available
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最常见的开源监控工具
- en: How to set up Nagios as a monitoring server with some clients to monitor
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何设置Nagios作为监控服务器，并监控一些客户端
- en: The variety of tools used as a logging server
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 作为日志服务器使用的各种工具
- en: How to set up and configure syslog-ng as a logging server
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何设置和配置syslog-ng作为日志服务器
- en: Open source monitoring tools
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 开源监控工具
- en: Monitoring tools can show real-time information about the system, service, and
    hardware status. Through this information, a system administrator can tell whether
    there is something acting weirdly or showing weakness. Then, they can act and
    try to resolve the issue before it gets worse.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 监控工具可以显示关于系统、服务和硬件状态的实时信息。通过这些信息，系统管理员可以判断是否有异常情况或显示出弱点。然后，他们可以采取行动，尝试在问题恶化之前解决问题。
- en: This section presents the most common open source monitoring tools. A monitoring
    tool is usually chosen depending on what its main need is. Some monitoring tools
    are specialized in monitoring the characteristics of a set of machines. Others
    help store and generate a graph of the history to be used for future system analysis.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 本节介绍了最常见的开源监控工具。监控工具通常根据其主要需求来选择。一些监控工具专门用于监控一组机器的特性。其他工具帮助存储并生成历史图表，以供将来的系统分析使用。
- en: Many organizations rely on their monitoring tools to output, in order to not
    only maintain their system and prevent potential problems, but also to determine
    their system's rush hours and when the system is more idle status This helps them
    rather reinforce their system capacities and save power and resources.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 许多组织依赖他们的监控工具来输出，不仅是为了维护他们的系统和防止潜在问题，还为了确定他们的系统的高峰时段以及系统更空闲状态。这有助于他们加强系统容量，并节省电力和资源。
- en: Ganglia
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Ganglia
- en: We will start by talking about one of the most common monitoring system tools.
    Ganglia is a scalable distributed monitoring system for high-performance computing
    infrastructures. It is widely used with clusters and grid architectures. It is
    a web-based tool that allows its users to visualize the history of a machine's
    statistics, such as CPU load averages, network usage, and so on. It has been developed
    to achieve a low per-node overhead and high concurrency. It is currently used
    by thousands of clusters worldwide.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从讨论最常见的监控系统工具之一开始。Ganglia是一个可扩展的分布式监控系统，适用于高性能计算基础设施。它广泛用于集群和网格架构。这是一个基于Web的工具，允许用户可视化机器的统计历史，如CPU负载平均值，网络使用等。它已经被开发成具有低节点开销和高并发性。目前全球数千个集群正在使用它。
- en: '![Ganglia](img/B04674_05_01.jpg)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![Ganglia](img/B04674_05_01.jpg)'
- en: 'Source: [http://assets.digitalocean.com/](http://assets.digitalocean.com/)'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[http://assets.digitalocean.com/](http://assets.digitalocean.com/)
- en: 'Ganglia is based on two basic services, one installed on the client machine
    and one on the server. On the client-side, the service is called **gmond**. gmond
    is a multithreaded daemon that runs on the client machines that we want to monitor.
    Its services are basically related to:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: Ganglia基于两个基本服务，一个安装在客户端机器上，一个安装在服务器上。在客户端，服务称为**gmond**。gmond是在我们想要监视的客户机器上运行的多线程守护程序。其服务基本上与以下相关：
- en: Monitoring a machine's status change
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控机器状态的变化
- en: Announcing the relevant changes
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 宣布相关变化
- en: Listening to the state of other Ganglia nodes
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监听其他Ganglia节点的状态
- en: Responding to requests for the XML descriptions of the machines it is running
    on
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 响应对其正在运行的机器的XML描述的请求
- en: Then, we have the Ganglia PHP web frontend, which is installed on the monitoring
    server. It provides a view of the gathered information via real-time, dynamic
    web pages. These pages are the dashboards provided by Ganglia to its users (including
    system administrators). They are well organized in a meaningful way to present
    the machine's status to the system administrators to make the diagnostics part
    much more easier for them. The Ganglia web frontend stores data about machines
    for up to 1 year, and it has a lot of customizable parameters for viewing a machine's
    status history.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们有Ganglia PHP Web前端，它安装在监控服务器上。它通过实时、动态的网页提供了收集信息的视图。这些页面是Ganglia提供给用户（包括系统管理员）的仪表板。它们以有意义的方式组织，以向系统管理员呈现机器的状态，使诊断部分对他们来说更加容易。Ganglia
    Web前端存储有关机器的数据长达1年，并且有许多可自定义的参数，用于查看机器的状态历史。
- en: Ganglia is a very useful tool for monitoring machines' statuses and has a very
    reliable dashboard for history management and all types of troubleshooting related
    issues. Still, it is not a tool that can easily monitor every single service,
    especially when working in a server environment in which system administrators
    prioritize service administration over the machine itself.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: Ganglia是一个非常有用的工具，用于监控机器的状态，并具有非常可靠的历史管理仪表板和各种故障排除相关问题。然而，在服务器环境中工作时，它并不是一个可以轻松监控每一个服务的工具，特别是当系统管理员将服务管理置于机器本身之上时。
- en: '![Ganglia](img/B04674_05_02.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![Ganglia](img/B04674_05_02.jpg)'
- en: 'Source: [http://bezha.od.ua](http://bezha.od.ua)'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[http://bezha.od.ua](http://bezha.od.ua)
- en: OpenNMS
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: OpenNMS
- en: '**OpenNMS** is an open source, enterprise-grade network monitoring and management
    platform. It is a distributed and scalable management application for all aspects
    of network management. It is designed to be highly customizable to create a unique
    and integrated management solution.'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '**OpenNMS**是一个开源的、企业级的网络监控和管理平台。它是一个分布式和可扩展的管理应用程序，涵盖网络管理的各个方面。它被设计为高度可定制，以创建独特的、集成的管理解决方案。'
- en: 'OpenNMS supports four main functional areas:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: OpenNMS支持四个主要的功能领域：
- en: Event management and notification
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件管理和通知
- en: Discovery and provisioning
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发现和配置
- en: Service monitoring
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务监控
- en: Data collection
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据收集
- en: OpenNMS is accessible via a web-based interface that is smart and well organized
    to create high-level reports from the databases and the collected performance
    data. It is well used for its monitoring using the SNMP protocol, alerts/notifications,
    reporting, escalations, and its well-organized and clear dashboard. Still, it
    is pretty difficult to learn how to use it and personalize it by making personalized
    scripts. Also, most of the advanced features are paid and other costs are included.
    It could take a lot of time to set up and configure to work perfectly, but the
    result is always more than satisfying.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: OpenNMS可以通过一个智能而有组织的基于Web的界面访问，从数据库和收集的性能数据中创建高级报告。它非常适用于使用SNMP协议进行监控、警报/通知、报告、升级以及其组织良好、清晰的仪表板。然而，学习如何使用它并通过制作个性化脚本来个性化它是相当困难的。此外，大多数高级功能都是付费的，还包括其他成本。要使其完美运行，可能需要花费大量时间进行设置和配置，但结果总是令人满意的。
- en: '![OpenNMS](img/B04674_05_03.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![OpenNMS](img/B04674_05_03.jpg)'
- en: 'Source: [http://docs.opennms.org](http://docs.opennms.org)'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[http://docs.opennms.org](http://docs.opennms.org)
- en: Zabbix
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Zabbix
- en: '**Zabbix** is a piece of open source enterprise-level software used for the
    real-time monitoring of networks and applications. It has been designed to monitor
    and track the status of various network services, servers, and other pieces of
    network hardware. It has the capacity to monitor the main protocols (HTTP, FTP,
    SSH, POP3, SMTP, SNMP, MySQL, and so on).'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '**Zabbix**是一款用于实时监控网络和应用程序的开源企业级软件。它被设计用于监控和跟踪各种网络服务、服务器和其他网络硬件的状态。它有能力监控主要协议（HTTP、FTP、SSH、POP3、SMTP、SNMP、MySQL等）。'
- en: '![Zabbix](img/B04674_05_04.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![Zabbix](img/B04674_05_04.jpg)'
- en: 'Source: [http://image.slidesharecdn.com](http://image.slidesharecdn.com)'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[http://image.slidesharecdn.com](http://image.slidesharecdn.com)
- en: Zabbix features a high-performance capacity for handling hundreds of thousands
    of devices. Also, it has the capacity of auto-discovery to identify machines within
    the same network. Zabbix comes with a web-based interface meant to show the monitoring
    dashboard. This interface is accessible via a secure user's authentication, and
    it has distributed monitoring with a centralized web administration that can visualize
    and compare any value it monitors. This dashboard can be customized to the needs
    of its user.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: Zabbix具有处理数十万台设备的高性能能力。此外，它具有自动发现的能力，可以识别同一网络中的机器。Zabbix配备了一个基于Web的界面，用于显示监控仪表板。这个界面可以通过安全的用户认证访问，并且具有集中式Web管理，可以可视化和比较其监控的任何值。此仪表板可以根据用户的需求进行定制。
- en: Zabbix has the capability to monitor just about any event on your network, from
    network traffic to how many papers are left in your printer.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: Zabbix有能力监控网络上的任何事件，从网络流量到打印机中剩余的纸张数量。
- en: However, Zabbix is more complex to set up and configure compared to other monitoring
    tools and it requires a good documentation to install it with best practices.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，与其他监控工具相比，Zabbix设置和配置更复杂，需要良好的文档才能按照最佳实践进行安装。
- en: '![Zabbix](img/B04674_05_05.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![Zabbix](img/B04674_05_05.jpg)'
- en: 'Source: [http://dist.alternativeto.net/](http://dist.alternativeto.net/)'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[http://dist.alternativeto.net/](http://dist.alternativeto.net/)
- en: Zenoss
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Zenoss
- en: '**Zenoss**, sometimes called **Zenoss Core**, is a free open source application,
    server, and network management platform based on the Zope application server.
    It provides system administrators with a web-based interface that offers the capacity
    to monitor availability, inventory/configuration, performance, and events.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '**Zenoss**，有时被称为**Zenoss Core**，是一个基于Zope应用服务器的免费开源应用程序、服务器和网络管理平台。它为系统管理员提供了一个基于Web的界面，具有监控可用性、库存/配置、性能和事件的能力。'
- en: 'Zenoss features the following aspects:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: Zenoss具有以下特点：
- en: Monitoring a remote location worldwide through a nice-looking map, such as Google
    Maps
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过一个漂亮的地图（如Google Maps）监控全球范围内的远程位置
- en: A beautiful web interface that is very user friendly
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个非常用户友好的美丽的Web界面
- en: Automatic discovery of client system parameters
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动发现客户端系统参数
- en: Work with simple and plain SNMP
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用简单明了的SNMP
- en: Zenoss looks very advanced and fancy, but still it has a slightly slow web interface.
    It doesn't support real-time notification. We should always wait for it to process
    the information to have a clear view on what is happening on the environment.
    It has a single dashboard, which makes monitoring a little difficult for many
    system administrators. Also, it is a limited open source solution; for more advanced
    features, we need to pay more. However, for those willing to pay and invest in
    it, we would say that it is a very good choice.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: Zenoss看起来非常先进和花哨，但它的Web界面稍微慢一些。它不支持实时通知。我们必须等待它处理信息，才能清楚地了解环境中发生了什么。它只有一个仪表板，这使得对许多系统管理员来说监控有些困难。此外，它是一个有限的开源解决方案；对于更高级的功能，我们需要支付更多。然而，对于愿意支付和投资的人来说，我们可以说这是一个非常不错的选择。
- en: '![Zenoss](img/B04674_05_06.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![Zenoss](img/B04674_05_06.jpg)'
- en: 'Source: [http://socializedsoftware.com/](http://socializedsoftware.com/)'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[http://socializedsoftware.com/](http://socializedsoftware.com/)
- en: Nagios
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Nagios
- en: '**Nagios** is an open source application for monitoring systems, networks,
    and infrastructure. It offers monitoring and alerting services for servers, network
    equipment, applications, and services on large computer infrastructures. It has
    two types of alerts, one for notifying the issue and the other for notifying whether
    the issue has been resolved.'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**Nagios**是一个用于监控系统、网络和基础设施的开源应用程序。它为大型计算机基础设施上的服务器、网络设备、应用程序和服务提供监控和警报服务。它有两种类型的警报，一种是用于通知问题，另一种是用于通知问题是否已解决。'
- en: '![Nagios](img/B04674_05_07.jpg)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![Nagios](img/B04674_05_07.jpg)'
- en: 'Source: [http://n2rrd-wiki.diglinks.com](http://n2rrd-wiki.diglinks.com)'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[http://n2rrd-wiki.diglinks.com](http://n2rrd-wiki.diglinks.com)
- en: Nagios monitors network services, host resources, and probes via network plugins
    and via remotely run scripts. It has a large community, which has allowed the
    development of some really powerful plugins. It is considered one of the easiest
    monitoring tools to set up and use via its web interface. Still, it has some downsides
    related to the quality of third-party plugins and some complex writing and configuring
    of self-created plugins. Finally, it triggers a lot of notifications and alerts,
    so we might need to configure it with the proper plugins to help monitor everything
    in the infrastructure.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios通过网络插件和远程运行脚本来监控网络服务、主机资源和探针。它有一个庞大的社区，这使得开发了一些非常强大的插件。它被认为是最容易设置和使用的监控工具之一，通过其Web界面。但是，它也有一些缺点，与第三方插件的质量以及一些复杂的编写和配置自定义插件有关。最后，它会触发大量的通知和警报，因此我们可能需要使用适当的插件来帮助监控基础设施中的所有内容。
- en: Icinga
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Icinga
- en: '**Icinga** is an open source system and network-monitoring tool. It was originally
    created as a fork of the Nagios monitoring system. It is well developed in terms
    of its web interface, to provide something more beautiful and more interactive
    than Nagios.'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '**Icinga**是一个开源的系统和网络监控工具。它最初是作为Nagios监控系统的一个分支创建的。它在Web界面方面得到了很好的发展，提供了比Nagios更美观和更交互式的东西。'
- en: Icinga's efficacy lies in its capacity to implement really powerful plugins.
    It implements many famous preferment graphical tools, such as PNP4Nagios, inGraph,
    and Graphite. Icinga's most famous feature is its lightness, where it doesn't
    overload the system when running and it generates an information graph in real
    time. For extremely big infrastructures, Icinga is designed to run on multithreads
    to run thousands of checks every second without any overload on the system's resources.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: Icinga的有效性在于它能够实现非常强大的插件。它实现了许多著名的图形工具，如PNP4Nagios、inGraph和Graphite。Icinga最著名的功能是它的轻量性，在运行时不会过载系统，并且能够实时生成信息图。对于非常大的基础设施，Icinga被设计为多线程运行，每秒运行数千次检查而不会对系统资源造成任何过载。
- en: '![Icinga](img/B04674_05_08.jpg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![Icinga](img/B04674_05_08.jpg)'
- en: 'Source: [https://www.icinga.org/](https://www.icinga.org/)'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[https://www.icinga.org/](https://www.icinga.org/)
- en: 'Icinga has a pretty large community, and they help integrate patches very quickly.
    There are two official versions of **Icinga**: one for the **Web 1 Icinga** and
    one for the **Web 2 Icinga2**. But it is still on the way to being well developed.'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: Icinga有一个相当大的社区，他们能够很快地帮助集成补丁。**Icinga**有两个官方版本：一个是**Web 1 Icinga**，另一个是**Web
    2 Icinga2**。但它仍在不断发展中。
- en: '![Icinga](img/B04674_05_09.jpg)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![Icinga](img/B04674_05_09.jpg)'
- en: 'Source: [https://www.icinga.org/](https://www.icinga.org/)'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[https://www.icinga.org/](https://www.icinga.org/)
- en: Setting up Nagios as a monitoring server
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置Nagios作为监控服务器
- en: For this chapter, we are going to work with Nagios as our best choice, considering
    the performance and the simplicity of its setup and configuration. As we have
    already mentioned, Nagios is open source software that can be installed on multiple
    Linux distributions. In our case, we will be installing it on CentOS 7\. It is
    a network, infrastructure, and server-monitoring tool. It will be monitoring switches,
    applications, and services. It has an alerting feature that helps inform users
    about all issues that occur while the infrastructure is being monitored. It also
    alerts the user if the issues have been fixed. Other than monitoring, Nagios also
    has the ability to identify system or network issues that could cause problems,
    with real-time problem notification. Furthermore, it has some security features,
    by virtue of which it can identify security breaches in the infrastructure.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章，我们将选择Nagios作为最佳选择，考虑到其性能和设置配置的简单性。正如我们已经提到的，Nagios是可以安装在多个Linux发行版上的开源软件。在我们的案例中，我们将在CentOS
    7上安装它。它是一个网络、基础设施和服务器监控工具。它将监控交换机、应用程序和服务。它具有警报功能，可以帮助通知用户在监控基础设施时发生的所有问题。它还会在问题得到解决时通知用户。除了监控，Nagios还具有识别可能导致问题的系统或网络问题的能力，并进行实时问题通知。此外，它还具有一些安全功能，可以识别基础设施中的安全漏洞。
- en: In this section, we are going to install Nagios on a machine. It will act as
    our monitoring server. We need a test client to have it monitored. The client
    will have some common services; we will try to mess with them a little to test
    the Nagios notification service.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将在一台机器上安装Nagios。它将充当我们的监控服务器。我们需要一个测试客户端来进行监控。客户端将具有一些常见的服务；我们将尝试对它们进行一些操作，以测试Nagios的通知服务。
- en: Let's talk a bit about the things we need before we start our monitoring server
    installation.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始监控服务器安装之前，让我们先谈谈我们需要的东西。
- en: First, we need to have the **Linux Apache MySQL PHP** (**LAMP**) services installed
    on our machine. Since Nagios will be accessible via the web interface, having
    a web server installed is something obvious. For a more detailed and secure web
    server installation, you can go back and check out [Chapter 3](ch03.html "Chapter 3. Linux
    for Different Purposes"), *Linux for Different Purposes*.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要在我们的机器上安装**Linux Apache MySQL PHP**（**LAMP**）服务。由于Nagios将通过Web界面访问，安装Web服务器是显而易见的。对于更详细和安全的Web服务器安装，您可以返回并查看[第3章](ch03.html
    "第3章。不同用途的Linux")，*不同用途的Linux*。
- en: 'Nagios won''t be installed from the CentOS 7 package manager. We have to download
    it and then compile it, so we need basic compiling tools and a downloading tool
    to download the Nagios source code archive. We will install these using Yum, the
    CentOS package manager:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios不会从CentOS 7软件包管理器中安装。我们必须下载它，然后编译它，因此我们需要基本的编译工具和一个下载工具来下载Nagios源代码存档。我们将使用CentOS软件包管理器Yum来安装这些：
- en: '[PRE0]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: We wait until the installation is done and then proceed to the next step of
    the preparation.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 我们等待安装完成，然后继续准备的下一步。
- en: 'In order to run the Nagios process, we need to create a Nagios user and give
    it a password:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 为了运行Nagios进程，我们需要创建一个Nagios用户并为其设置密码：
- en: '[PRE1]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: We need to make sure that we are using well-secured passwords while creating
    any.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要确保在创建任何密码时使用安全的密码。
- en: 'Next, we create a new group called `nagcmd` to allow external commands to be
    submitted through the web interface once it''s up-and-running . Then, we need
    to add both Nagios and Apache to this group:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们创建一个名为`nagcmd`的新组，以允许通过Web界面提交外部命令一旦它运行起来。然后，我们需要将Nagios和Apache都添加到这个组中：
- en: '[PRE2]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: We move on to the final step, which is downloading the source archive for the
    latest version of Nagios. To do the downloading, we will be using **Wget**, a
    tool that we have already installed.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 我们继续进行最后一步，即下载最新版本的Nagios源存档。为了进行下载，我们将使用已经安装的工具**Wget**。
- en: 'During this tutorial, we will be using Nagios 4:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将使用Nagios 4：
- en: '[PRE3]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'After downloading the latest Nagios stable version, we need to extract it.
    Well, since Nagios will be installed at the position where we are going to extract
    its source, we are going to put it in an appropriate location. We have a choice
    between `/usr/local` and `/opt`, so we need to copy the source package file there
    and then extract it. For this example, we will just go with `/usr/local`:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在下载最新的Nagios稳定版本之后，我们需要进行解压。由于Nagios将安装在我们要提取其源代码的位置，我们需要将其放在一个合适的位置。我们可以选择在`/usr/local`和`/opt`之间，所以我们需要将源包文件复制到那里，然后进行解压。在这个例子中，我们将选择`/usr/local`：
- en: '[PRE4]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'After extracting the archive, there will be a new folder created, holding the
    named Nagios and including the corresponding version. We need to go inside the
    folder to start compiling it:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在解压存档之后，将创建一个新的文件夹，其中包含名为Nagios的文件夹和相应的版本。我们需要进入文件夹开始编译：
- en: '[PRE5]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Just before we start the compiling process, we need to run the configuration
    script that will help run the compiling process with no error by configuring it
    to use the available compiling tools that we have installed previously:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始编译过程之前，我们需要运行配置脚本，以便使用之前安装的可用编译工具来运行编译过程，以避免错误：
- en: '[PRE6]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This configuration process has the option to set up the latest created group
    as the one that will be running the internal commands.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 这个配置过程有一个选项，可以将最新创建的组设置为运行内部命令的组。
- en: 'Now, we are actually able to start the compiling process:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们实际上可以开始编译过程：
- en: '[PRE7]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: This command can take a lot of time depending on the machine's processing power.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令可能需要很长时间，取决于机器的处理能力。
- en: 'After doing this, we proceed to the installation phase. We need to install
    Nagios, its initialization scripts, some sample configuration files, and the Nagios
    web interface:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此操作后，我们继续进行安装阶段。我们需要安装Nagios、它的初始化脚本、一些示例配置文件和Nagios Web界面：
- en: '[PRE8]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Before moving on the next step, we need to set up our Nagios administrator
    user and password to access the web interface:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行下一步之前，我们需要设置Nagios管理员用户和密码以访问Web界面：
- en: '[PRE9]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Then, we type in the password twice to have our web interface administrator
    well created and configured.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们需要两次输入密码，以便创建和配置我们的Web界面管理员。
- en: 'After Nagios has been installed, we can add some useful plugins. First, we
    need to download the latest stable source version of those plugins. We need to
    go to the `/usr/local` folder and download the plugin''s source archive there.
    This step installs everything there well organized for future diagnostics:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios安装完成后，我们可以添加一些有用的插件。首先，我们需要下载这些插件的最新稳定源版本。我们需要进入`/usr/local`文件夹，并在那里下载插件的源存档。这一步将为未来的诊断安装好一切：
- en: '[PRE10]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Then, we start the download using **Wget**:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们使用**Wget**开始下载：
- en: '[PRE11]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Note
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: We used the `sudo` command because during the download, the file is written
    in a folder with no user access to write on it.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用了`sudo`命令，因为在下载过程中，文件是写入一个没有用户访问权限的文件夹中的。
- en: 'After completing the download, we can start extracting the archive using the
    same command:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 下载完成后，我们可以使用相同的命令开始解压存档：
- en: '[PRE12]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Then, we enter the directory we just created:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们进入刚刚创建的目录：
- en: '[PRE13]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Again, we need to compile the source files. Just before compiling, we need
    to run the configuration script with some useful options, as follows:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，我们需要编译源文件。在编译之前，我们需要使用一些有用的选项运行配置脚本，如下所示：
- en: '[PRE14]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: For the configuration option, we set the user and group Nagios as the default
    to access and use the plugins. Also, we use OpenSSL to secure the plugin usage.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 对于配置选项，我们将用户和组Nagios设置为访问和使用插件的默认值。此外，我们使用OpenSSL来保护插件的使用。
- en: 'Then, we start compiling the plugins:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们开始编译插件：
- en: '[PRE15]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'After that, we can start the installation:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们可以开始安装：
- en: '[PRE16]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Once this command is executed with no errors, we can say that our Nagios Plugins
    are well installed. We can move on to set up the **Nagios Remote Plugin Executor**
    (**NRPE**). This is a Nagios agent that simplifies remote system monitoring using
    scripts that are hosted on remote systems. We need to download, configure, compile,
    and install it in the same way. We first need to find the latest stable version
    of the source package, and then we download it to `/usr/local`:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦这个命令被执行且没有错误，我们就可以说我们的Nagios插件已经成功安装。我们可以继续设置**Nagios远程插件执行器**（**NRPE**）。这是一个简化远程系统监控的Nagios代理，使用托管在远程系统上的脚本。我们需要以相同的方式下载、配置、编译和安装它。首先，我们需要找到源包的最新稳定版本，然后将其下载到`/usr/local`：
- en: '[PRE17]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Next, we extract it at the same location, and go inside the folder to start
    the compilation:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们在相同位置解压它，并进入文件夹开始编译：
- en: '[PRE18]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'We start by running the NRPE configuration script. We define the user and the
    group using the Nagios process and the security tools:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先运行NRPE配置脚本。我们使用Nagios进程和安全工具来定义用户和组：
- en: '[PRE19]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Then, we run the compiling command, followed by the installation commands:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们运行编译命令，然后是安装命令：
- en: '[PRE20]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Next, we configure the `xinetd` startup script:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们配置`xinetd`启动脚本：
- en: '[PRE21]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'We need to look for the line that starts with `only_from` and then, add the
    IP address of the monitoring server. It can be a public or a private address depending
    on where we want to make the server accessible from:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要查找以`only_from`开头的行，然后添加监视服务器的IP地址。它可以是公共地址或私有地址，取决于我们希望从哪里让服务器可访问：
- en: '[PRE22]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Then, we save the file to give only our Nagios server the capacity to communicate
    with NRPE. After that, we add the following line to define the port number for
    the NRPE service:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们保存文件，只允许我们的Nagios服务器与NRPE通信。之后，我们添加以下行来定义NRPE服务的端口号：
- en: '[PRE23]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'To have this configuration active and running, we need to restart `xinetd`
    to launch **NRPE**:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使这个配置生效并运行，我们需要重新启动`xinetd`来启动**NRPE**：
- en: '[PRE24]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Now, we have our Nagios monitoring server officially installed. We can proceed
    with the configuration steps. We go to the Nagios main configuration file and
    activate the folder that will store all the configuration files:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们的Nagios监控服务器已经正式安装。我们可以继续配置步骤。我们进入Nagios主配置文件并激活将存储所有配置文件的文件夹：
- en: '[PRE25]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Then, we uncomment the following line, save the file, and exit:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们取消注释以下行，保存文件并退出：
- en: '[PRE26]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Note
  id: totrans-135
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This is just an example of a server. It can also be done for network equipments
    or workstations or any other type of network-connected machine.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 这只是一个服务器的示例。它也可以用于网络设备、工作站或任何其他类型的网络连接机器。
- en: 'We create the configuration folder that will store the configuration file for
    each machine that will be monitored:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 我们创建一个配置文件夹，用于存储将要被监视的每台机器的配置文件：
- en: '[PRE27]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Then, we move on to configure the Nagios contacts file to set the e-mail address
    associated with the Nagios administrator. Usually, it is used to receive alerts:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们继续配置Nagios联系人文件，以设置与Nagios管理员关联的电子邮件地址。通常用于接收警报：
- en: '[PRE28]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Now, we need to change the administrator e-mail address. To do so, we need
    to type in the right one after the `email` option:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要更改管理员的电子邮件地址。为此，我们需要在`email`选项后输入正确的电子邮件地址：
- en: '[PRE29]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Then, we save the file and exit it.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们保存文件并退出。
- en: 'Now, we proceed to the `check_nrpe` command configuration. We start by adding
    a new command to our Nagios server:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们进行`check_nrpe`命令配置。我们首先向Nagios服务器添加一个新命令：
- en: '[PRE30]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'We add the following lines at the end:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在末尾添加以下行：
- en: '[PRE31]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: We save the file and exit to allow the new command to become usable.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 我们保存文件并退出，以使新命令可用。
- en: 'Now, we go ahead and configure the access restriction to IP addresses that
    can access the Nagios web interface:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们继续配置访问限制，以允许访问Nagios Web界面的IP地址：
- en: '[PRE32]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'We need to comment these two lines:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要注释掉这两行：
- en: '[PRE33]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Next, we uncomment the following three lines:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们取消注释以下三行：
- en: '[PRE34]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Note
  id: totrans-155
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: These lines appear twice in the configuration file, so we need to do the same
    thing twice in the same file. This step is only for reinforcing Nagios security.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 这些行在配置文件中出现两次，因此我们需要在同一个文件中执行两次相同的操作。这一步只是为了加强Nagios的安全性。
- en: 'We can always add any network or address to allow it to have access to the
    monitoring server:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 我们总是可以添加任何网络或地址以允许其访问监视服务器：
- en: '[PRE35]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'We can always check whether there is any configuration error in the Nagios
    configuration file using the following command:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 我们总是可以检查Nagios配置文件中是否存在任何配置错误，使用以下命令：
- en: '[PRE36]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Just before starting Nagios, we need to make the Nagios CGI accessible by changing
    SELinux actions from enforcing mode to permissive:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在启动Nagios之前，我们需要通过将SELinux操作从强制模式更改为宽松模式来使Nagios CGI可访问：
- en: '[PRE37]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Then, we change this line to look like the following:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们将这一行修改成以下的样子：
- en: '[PRE38]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Now, we can restart the Nagios service and add it to the startup menu. We also
    need to restart the Apache service:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以重新启动Nagios服务并将其添加到启动菜单中。我们还需要重新启动Apache服务：
- en: '[PRE39]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: We can now access the Nagios server, but still we need to be allowed to try
    accessing it from the server itself, or from a machine that is connected to the
    network that is allowed to access the server. So, we go to the web browser and
    type `http://Nagios_server_IP_Address/nagios`. Then, we type the admin username,
    `nagiosadmin`, and its password, which has already been defined earlier, to get
    access to the Nagios interface.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以访问Nagios服务器，但是我们仍然需要被允许尝试从服务器本身访问它，或者从连接到允许访问服务器的网络的机器上访问它。因此，我们打开网页浏览器，输入`http://Nagios_server_IP_Address/nagios`。然后，我们输入管理员用户名`nagiosadmin`和之前已经定义好的密码，以便访问Nagios界面。
- en: 'Now, we move on to our client server—the one that we want to monitor using
    Nagios. First, we need to install the required packages. For CentOS 7, we need
    to have the EPEL repository installed in order to get the required packages:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们转向我们的客户服务器 - 我们想要使用Nagios进行监视的服务器。首先，我们需要安装所需的软件包。对于CentOS 7，我们需要安装EPEL存储库以获取所需的软件包：
- en: '[PRE40]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Now, we can install the Nagios plugins and NRPE:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以安装Nagios插件和NRPE：
- en: '[PRE41]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Let''s start by updating the NRPE configuration file:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从更新NRPE配置文件开始：
- en: '[PRE42]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'We have to find the line that starts with `allowed_hosts` and add the IP address
    of our monitoring server:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 我们必须找到以`allowed_hosts`开头的行，并添加我们监视服务器的IP地址：
- en: '[PRE43]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Then, we save and exit the file. To complete the configuration, we need to
    start the **NRPE** service and add it to the startup menu:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们保存并退出文件。要完成配置，我们需要启动**NRPE**服务并将其添加到启动菜单中：
- en: '[PRE44]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: Once we are done configuring the host that we want to monitor, we go to the
    Nagios server to add it to the configuration folder.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们完成配置要监视的主机，我们转到Nagios服务器将其添加到配置文件夹中。
- en: 'On the Nagios server, we need to create a file with the name of the machine.
    We can take the machine hostname or put something that indicates the role of the
    machine or any other indication:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios服务器上，我们需要创建一个以机器名称命名的文件。我们可以使用机器主机名或放置一些指示机器角色或任何其他指示的内容：
- en: '[PRE45]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Then, we add the following lines, replacing `host_name` with the client hostname
    replacing the alias value with a short description of the server''s main job,
    and finally replacing address with the server IP address:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们添加以下行，将`host_name`替换为客户端主机名，将别名值替换为服务器主要工作的简短描述，最后将地址替换为服务器IP地址：
- en: '[PRE46]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'With this configuration saved, Nagios will only monitor whether the host is
    up or down. To make it do more, we need to add some services to monitor, such
    as HTTP and SSH. Also, we are adding the option to check whether the server is
    active. We need to open the same file and define a service block for each service
    that we want to monitor:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 保存此配置后，Nagios将仅监视主机是启动还是关闭。要使其更多功能，我们需要添加一些要监视的服务，例如HTTP和SSH。此外，我们正在添加检查服务器是否活动的选项。我们需要打开相同的文件，并为要监视的每个服务定义一个服务块：
- en: '[PRE47]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Then, we save the file and reload the Nagios service:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们保存文件并重新加载Nagios服务：
- en: '[PRE48]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'We will see the new server on the host list and its services on the services
    list. To test whether Nagios is doing its job, we disable the SSH service:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在主机列表上看到新服务器及其服务。为了测试Nagios是否在正常工作，我们禁用SSH服务：
- en: '[PRE49]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: Then, on the web interface, we can see how the service will go down from green
    to red. The red signal means that the test for that service has failed or has
    returned nothing, which means that the service is rather disabled or inaccessible.
    An error notification e-mail will be received by the Nagios administrator.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，在Web界面上，我们可以看到服务将从绿色变为红色。红色信号意味着该服务的测试失败或返回空值，这意味着服务被禁用或无法访问。Nagios管理员将收到错误通知电子邮件。
- en: '![Setting up Nagios as a monitoring server](img/B04674_05_10.jpg)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![设置Nagios作为监控服务器](img/B04674_05_10.jpg)'
- en: 'Source: [https://thenullterminator.wordpress.com/](https://thenullterminator.wordpress.com/)'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[https://thenullterminator.wordpress.com/](https://thenullterminator.wordpress.com/)
- en: 'After that, we try the second test, to start the service:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们尝试第二个测试，启动服务：
- en: '[PRE50]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'To indicate that the service is back, another e-mail is received with the new
    status, where all its information will turn to green, as shown in the following
    screenshot:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 要指示服务已恢复，将收到另一封电子邮件，其中包含新状态，其中所有信息将变为绿色，如下面的屏幕截图所示：
- en: '![Setting up Nagios as a monitoring server](img/B04674_05_11.jpg)'
  id: totrans-195
  prefs: []
  type: TYPE_IMG
  zh: '![设置Nagios作为监控服务器](img/B04674_05_11.jpg)'
- en: 'Source: [https://www.digitalocean.com](https://www.digitalocean.com)/'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 来源：[https://www.digitalocean.com](https://www.digitalocean.com)/
- en: Now, after setting up the first server, we can go ahead and add all the machines,
    including the switches, printers, and workstations that we need to monitor. Also,
    to be more practical, we should add only those services that we care about. So,
    if we have a server that runs a number of services and we will be using only two
    of them, it is pointless to add all of them and overload the server dashboard
    and the mailbox of the administrator with things that we don't care about, which
    are later treated as spam.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在设置第一台服务器之后，我们可以继续添加所有机器，包括我们需要监视的交换机、打印机和工作站。此外，为了更加实用，我们应该只添加我们关心的那些服务。因此，如果我们有一台运行多个服务的服务器，而我们只会使用其中两个，那么添加所有这些服务并使服务器仪表板和管理员的邮箱超载是没有意义的，因为我们不关心的东西后来会被视为垃圾邮件。
- en: 'Now, we will configure the NRPE daemon to receive information from the clients
    about their status. First, at the Nagios server, we edit the Xinetd NRPE configuration
    file to add which IP address the server should listen from:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将配置NRPE守护程序以从客户端接收有关其状态的信息。首先，在Nagios服务器上，我们编辑Xinetd NRPE配置文件以添加服务器应从中侦听的IP地址：
- en: '[PRE51]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'We need to add the IP address after the `only_from` option:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要在`only_from`选项后添加IP地址：
- en: '[PRE52]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Then, we need to add the NRPE service to the system services:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们需要将NRPE服务添加到系统服务中：
- en: '[PRE53]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'We add the following line at the end of the file:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在文件末尾添加以下行：
- en: '[PRE54]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'To have it submitted, we restart the `Xinetd` service:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提交它，我们重新启动`Xinetd`服务：
- en: '[PRE55]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Then, we go to the client and make these modifications:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们转到客户端并进行以下修改：
- en: '[PRE56]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: These three commands are used to activate the Nagios agent to send information
    about server load and disk storage. In our case, our disk is defined as `sda1`.
    We can check the naming of the disk using the `lsblk` command.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 这三个命令用于激活Nagios代理以发送有关服务器负载和磁盘存储的信息。在我们的情况下，我们的磁盘被定义为`sda1`。我们可以使用`lsblk`命令检查磁盘的命名。
- en: Tools to set up a logging server
  id: totrans-211
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置日志服务器的工具
- en: Logging means collecting system and service output information. It can be simple
    information, a warning, or an error for telling the status of the concerned daemon.
    For a system administrator, the daily work load can be really heavy. Thus, they
    have always been adopting the best logging tools to monitor their infrastructure's
    behavior. Also, the relevant information should be readable and quickly understandable.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 日志记录意味着收集系统和服务输出信息。它可以是简单的信息、警告或错误，用于告知相关守护程序的状态。对于系统管理员来说，日常工作负载可能非常沉重。因此，他们一直在采用最佳的日志记录工具来监视其基础设施的行为。此外，相关信息应该是可读的并且能够快速理解。
- en: 'Many system administrators mainly use either of two open source solutions:
    **Syslog-ng** and **Rsyslog**.'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 许多系统管理员主要使用两种开源解决方案：**Syslog-ng**和**Rsyslog**。
- en: Rsyslog
  id: totrans-214
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Rsyslog
- en: Rsyslog is a rocket-fast system for log processing. It offers high performance,
    great security, and a modular design. It has developed quickly and has evolved
    to be considered as a Swiss Army Knife in the logging field. It has a strong enterprise
    focus and also scales down to smaller systems. It supports MySQL, PostgreSQL,
    failover log destinations, syslog/tcp transport, fine-grained output format control,
    high-precision timestamps, queued operations, and the ability to filter parts
    of any message.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: Rsyslog是一个快速的日志处理系统。它具有高性能、良好的安全性和模块化设计。它发展迅速，并已发展成为日志领域中被认为是瑞士军刀的工具。它具有强大的企业重点，也适用于较小的系统。它支持MySQL、PostgreSQL、故障转移日志目的地、syslog/tcp传输、精细粒度的输出格式控制、高精度时间戳、排队操作以及过滤任何消息的部分的能力。
- en: Rsyslog has the ability to listen to TCP/UDP connections, but with a downside
    due to its limitation to the log rate, where it can lose some of the log information
    during an overload. It can load a decent number of modules. It can also discriminate
    log filtering by program, source, message, PID, and so on.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: Rsyslog有监听TCP/UDP连接的能力，但由于其对日志速率的限制，可能会在过载时丢失一些日志信息。它可以加载相当数量的模块。它还可以通过程序、来源、消息、PID等进行日志过滤。
- en: Syslog-ng
  id: totrans-217
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Syslog-ng
- en: 'Syslog-ng is an open source implementation of the syslog protocol for Linux
    and Unix-like systems. It features content-based filtering, rich filtering compatibilities,
    and flexible configuration. It also adds some important features to `syslog`,
    such as these:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: Syslog-ng是Linux和类Unix系统的syslog协议的开源实现。它具有基于内容的过滤、丰富的过滤兼容性和灵活的配置。它还为`syslog`添加了一些重要的功能，例如：
- en: Using TCP for transporting logging information
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用TCP传输日志信息
- en: The ability to format log messages using the Unix-shell-like (bash) variable
    expansion
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用类似Unix shell（bash）变量扩展的能力格式化日志消息
- en: The ability to send log messages to local applications
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将日志消息发送到本地应用程序的能力
- en: The ability to save logging information directly to a database
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将日志信息直接保存到数据库中的能力
- en: Classifying incoming log messages and, at the same time, extracting structured
    information from unstructured syslog messages
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对传入的日志消息进行分类，并同时从非结构化的syslog消息中提取结构化信息
- en: Processing structured message formats transmitted over syslog
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理通过syslog传输的结构化消息格式
- en: The ability to correlate multiple incoming messages to form a more complex,
    correlated event
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将多个传入的消息相关联以形成更复杂的相关事件的能力
- en: Syslog-ng is the next generation successor of syslog. It is one of the best
    tools for managing logs; it treats the log entities as an object (source, destination,
    filter, and so on), and its syntax is easily understandable. It is a highly portable
    application and is available for many more platforms, which makes it very suitable
    for sites with diversity in platforms. It has the capacity to compare the contents
    of log messages to a database of predefined message patterns. Thus, Syslog-ng
    is able to identify the exact type of messages and sort them into message classes.
    Then, it can be used to classify the type of event described in the log messages.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: Syslog-ng是syslog的下一代继任者。它是管理日志的最佳工具之一；它将日志实体视为对象（来源、目的地、过滤器等），其语法易于理解。它是一个高度可移植的应用程序，适用于更多的平台，非常适合平台多样性的站点。它有能力将日志消息的内容与预定义消息模式的数据库进行比较。因此，Syslog-ng能够识别消息的确切类型并将其分类为消息类别。然后，它可以用于分类日志消息中描述的事件类型。
- en: Here, we are going to install and configure Syslog-ng in CentOS 7 to be our
    logging server.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将在CentOS 7中安装和配置Syslog-ng作为我们的日志服务器。
- en: Setting up and configuring Syslog-ng
  id: totrans-228
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置和配置Syslog-ng
- en: 'By default, with the installation of CentOS 7, there will be `Rsyslog` installed
    for storing the log of the system and its applications. Luckily, we will have
    all our system log files stored and organized the way syslog wants. We will be
    using these log files with the installation of `Syslog-ng`, and we will have them
    organized in a more suitable way:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，在安装CentOS 7时，系统和应用程序的日志将安装`Rsyslog`进行存储。幸运的是，我们将按照syslog的要求存储和组织所有系统日志文件。我们将在安装`Syslog-ng`时使用这些日志文件，并以更合适的方式进行组织：
- en: 'First, before starting the installation, we need to set up the EPEL repository:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，在开始安装之前，我们需要设置EPEL存储库：
- en: '[PRE57]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: Tip
  id: totrans-232
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: All of the upcoming package repository checking and application availability
    is optional. We can always proceed with the installation of Syslog-ng.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 所有即将到来的软件包存储库检查和应用程序可用性都是可选的。我们可以随时继续安装Syslog-ng。
- en: 'To verify that the EPEL repository has been added, we can use the following
    command:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 要验证EPEL存储库是否已添加，我们可以使用以下命令：
- en: '[PRE58]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'This command shows the list of repositories available for the YUM package manager
    to download and install the packages from. Now, after having the EPEL repository,
    we need to check whether any change needs to be made after adding it. So, we need
    to type in this command:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令显示了YUM软件包管理器可用于下载和安装软件包的存储库列表。现在，在添加了EPEL存储库后，我们需要检查是否需要进行任何更改。因此，我们需要输入以下命令：
- en: '[PRE59]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: Note
  id: totrans-238
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This command is not necessary; we wanted to use it for additional knowledge
    on how to check the Yum repository update.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令并不是必需的；我们想用它来额外了解如何检查Yum存储库更新。
- en: 'Finally, to check the availability of the `syslog-ng` application in the newly
    added EPEL repository, we need to type the following:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，要检查新添加的EPEL存储库中`syslog-ng`应用程序的可用性，我们需要输入以下内容：
- en: '[PRE60]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Now, we go back to the installation phase. We will be using `yum` since we
    have properly verified the existence of the application package:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们回到安装阶段。我们将使用`yum`，因为我们已经正确验证了应用程序包的存在：
- en: '[PRE61]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: We need to confirm the installation of these packages. Then, we wait until it
    is done.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要确认这些软件包的安装。然后，我们等待直到完成。
- en: 'To activate `syslog-ng` and make it the default logging tool, we need to start
    by disabling rsyslog:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 要激活`syslog-ng`并将其设置为默认日志记录工具，我们需要首先禁用rsyslog：
- en: '[PRE62]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Then, we go to its configuration file to have it working in a proper way. We
    open the file using any text editor:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们转到其配置文件，使其以正确的方式工作。我们可以使用任何文本编辑器打开文件：
- en: '[PRE63]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Next, we make the required change to make it look like the following:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们进行所需的更改，使其看起来像下面这样：
- en: '[PRE64]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'At this point, we can start the `syslog-ng` service and enable it to start
    during system startup:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，我们可以启动`syslog-ng`服务并启用它在系统启动时启动：
- en: '[PRE65]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: With this step, we have configured our logging server using `syslog-ng` to perform
    well-organized and useful logging.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这一步，我们已经使用`syslog-ng`配置了我们的日志服务器，以进行组织良好且有用的日志记录。
- en: References
  id: totrans-254
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考资料
- en: 'Now, let''s look at the references used throughout the chapter:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看一下本章中使用的参考资料：
- en: The Ganglia home page, [http://ganglia.sourceforge.net/](http://ganglia.sourceforge.net/)
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ganglia主页，[http://ganglia.sourceforge.net/](http://ganglia.sourceforge.net/)
- en: The OpenNMS home page, [http://www.opennms.org/](http://www.opennms.org/)
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenNMS主页，[http://www.opennms.org/](http://www.opennms.org/)
- en: The Zabbix home page, [http://www.zabbix.com/](http://www.zabbix.com/)
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Zabbix主页，[http://www.zabbix.com/](http://www.zabbix.com/)
- en: The Zenoss home page, [http://zenoss.com/](http://zenoss.com/)
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Zenoss主页，[http://zenoss.com/](http://zenoss.com/)
- en: The Icinga home page, [https://www.icinga.org/](https://www.icinga.org/)
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Icinga主页，[https://www.icinga.org/](https://www.icinga.org/)
- en: The Nagios home page, [https://www.nagios.org/](https://www.nagios.org/)
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Nagios主页，[https://www.nagios.org/](https://www.nagios.org/)
- en: The Rsyslog home page, [http://www.rsyslog.com/doc/master/index.html](http://www.rsyslog.com/doc/master/index.html)
  id: totrans-262
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Rsyslog主页，[http://www.rsyslog.com/doc/master/index.html](http://www.rsyslog.com/doc/master/index.html)
- en: The Syslog-ng home page, [https://syslog-ng.org/](https://syslog-ng.org/)
  id: totrans-263
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Syslog-ng主页，[https://syslog-ng.org/](https://syslog-ng.org/)
- en: Summary
  id: totrans-264
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: Over the course of this chapter, we introduced a variety of choices of open
    source monitoring and logging tools for CentOS 7 servers. Then, we discussed a
    step-by-step tutorial on how to set up and configure Nagios and Syslog-ng logging
    as our logging server. We also talked about some of these tools' major features
    that help simplify our choice.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了各种选择的开源监控和日志记录工具，用于CentOS 7服务器。然后，我们讨论了如何设置和配置Nagios和Syslog-ng日志记录作为我们的日志服务器的逐步教程。我们还谈到了一些工具的主要特点，这些特点有助于简化我们的选择。
- en: In the next chapter, we will have a brief introduction to a variety of virtualization
    technologies. Also, we will take this opportunity to give you a step-by-step tutorial
    on establishing a small virtual machine.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将简要介绍各种虚拟化技术。此外，我们将借此机会为您提供建立小型虚拟机的逐步教程。
