- en: Chapter 4. Mail Server with Postfix
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第4章。使用Postfix的邮件服务器
- en: Nowadays, many people are already using configured and reliable web-based mail
    services such as Gmail, Yahoo, and so on. Most of those people are questioning
    the need for a local e-mail server installed inside their server environment.
    Well, servers also need to send e-mails, not only humans; and it is useful for
    many other needs, especially when notifying an administrator if a server is in
    a critical state.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 如今，许多人已经在使用配置和可靠的基于Web的邮件服务，如Gmail，Yahoo等。大多数人都在质疑是否需要在他们的服务器环境中安装本地电子邮件服务器。好吧，服务器也需要发送电子邮件，不仅仅是人类；当通知管理员服务器处于临界状态时，它对许多其他需求也是有用的。
- en: '**Postfix** is a high-performance open source **Mail Transfer Agent** (**MTA**)
    for Linux systems. It is fast, easy to administrate, and secure. It helps to route
    and deliver electronic mail. Postfix supports encryption and virtual domains,
    and its configuration files are clear, and easy to understand, and edit.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '**Postfix**是Linux系统的高性能开源**邮件传输代理**（**MTA**）。它快速，易于管理和安全。它有助于路由和传递电子邮件。Postfix支持加密和虚拟域，其配置文件清晰，易于理解和编辑。'
- en: The installation of Postfix will be divided into multiple sections. Since this
    chapter is all about setting up an e-mail server using Postfix and adding some
    tools to make it fully qualified and then securing it, we will do the installation
    step by step, where we are going to stretch it into the different chapter sections
    every time we add a new tool or a new tweak.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: Postfix的安装将分为多个部分。由于本章是关于使用Postfix设置电子邮件服务器并添加一些工具使其完全合格，然后对其进行安全设置，我们将逐步进行安装，每次添加新工具或新调整时，我们将在不同的章节部分中进行拉伸。
- en: 'During this chapter, we are going to learn the following things:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将学习以下内容：
- en: Set up and configure the Postfix e-mail server using CentOS 7 Linux
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用CentOS 7 Linux设置和配置Postfix电子邮件服务器
- en: Configure it to store users and virtual domains on a MySQL database
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将其配置为在MySQL数据库上存储用户和虚拟域
- en: Set up a mail tool (Dovecot) to get e-mail
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置邮件工具（Dovecot）来获取电子邮件
- en: Configure the OpenLDAP active directory
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置OpenLDAP活动目录
- en: Secure both mail services using SSL/TLS
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用SSL/TLS安全两种邮件服务
- en: Setting up and configuring of Postfix mail server
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置和配置Postfix邮件服务器
- en: As we all know, Postfix as an MTA acts, as an SMTP server. It accepts incoming
    mail and passes it to the service responsible for retrieving mails. Then it forwards
    outgoing mails to the next responsible SMTP server. For the SMTP service, we need
    to have the port 25/TCP open in the system's firewall. Postfix is very easy to
    set up and configure. We only need to make sure that some pre-installation steps
    have been done in order to have a clean setup.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 众所周知，作为MTA的Postfix充当SMTP服务器。它接受传入邮件并将其传递给负责检索邮件的服务。然后将出站邮件转发到下一个负责的SMTP服务器。对于SMTP服务，我们需要在系统防火墙中打开端口25/TCP。Postfix非常容易设置和配置。我们只需要确保已完成一些预安装步骤，以便进行清洁设置。
- en: 'First, we need to open the required port at the firewall for all the needed
    services for a mail server, using `Firewalld`. The ports we are going to open
    are from the following services:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要使用`Firewalld`为邮件服务器的所有所需服务打开防火墙所需的端口。我们将要打开的端口来自以下服务：
- en: '**Simple Mail Transfer Protocol (SMTP)**: 25 on TCP'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**简单邮件传输协议（SMTP）**：25 on TCP'
- en: '**Secure SMTP (SMTPS)**: 465 on TCP'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Secure SMTP (SMTPS)**: 465 on TCP'
- en: '**Mail Submission Agent (MSA)**: 587 on TCP'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**邮件提交代理（MSA）**：587 on TCP'
- en: '**Post Office Protocol 3 (POP3)**: 110 on TCP'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**邮局协议3（POP3）**：110 on TCP'
- en: '**Secure POP3**: 995 on TCP'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Secure POP3**: 995 on TCP'
- en: '**Internet Message Access Protocol (IMAP)**: 143 on TCP'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Internet Message Access Protocol (IMAP)**: 143 on TCP'
- en: '**Secure IMAP (IMAP SSL)**: 993 on TCP'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Secure IMAP (IMAP SSL)**: 993 on TCP'
- en: 'This is how to apply the change in the system local firewall using Firewalld:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 这是如何使用Firewalld在系统本地防火墙中应用更改的方法：
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'After that, we need to have an accurate time for the server, so we need to
    install an **NTP** client to synchronize the machine time with one of many worldwide
    available NTP servers. We need to install the NTP client service using the `yum`
    package manager:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们需要为服务器设置准确的时间，因此我们需要安装一个**NTP**客户端，将机器时间与全球范围内的许多可用的NTP服务器之一同步。我们需要使用`yum`软件包管理器安装NTP客户端服务：
- en: '[PRE1]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Usually, an NTP client, when installed, already has some default NTP servers
    configured to synchronize its time with them. But if we have a local NTP server
    and we want to use it, we can always go to the configuration file of NTP and add
    it. As a best practice, it is advised to always have at least three NTP servers:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，安装NTP客户端时，已经配置了一些默认的NTP服务器来与其同步时间。但是，如果我们有一个本地NTP服务器并且想要使用它，我们可以随时转到NTP的配置文件并添加它。作为最佳实践，建议始终至少有三个NTP服务器：
- en: '[PRE2]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'We look for the lines that start with `server` and we comment the unneeded
    servers and add those that we want (shown as `LOCAL_NTP_SERVER_IP_ADDRESS` in
    the following snippet):'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 我们寻找以`server`开头的行，并注释掉不需要的服务器，然后添加我们想要的服务器（在下面的片段中显示为`LOCAL_NTP_SERVER_IP_ADDRESS`）：
- en: '[PRE3]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'We need to start the NTP service and add it to the system startup services:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要启动NTP服务并将其添加到系统启动服务中：
- en: '[PRE4]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'To verify whether the NTP client is synchronizing with the defined servers,
    we need to use the command `ntpq -p`. Let''s have a look at the following output:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 要验证NTP客户端是否与定义的服务器同步，我们需要使用命令`ntpq -p`。让我们看一下以下输出：
- en: '![Setting up and configuring of Postfix mail server](img/B04674_04_01.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![设置和配置Postfix邮件服务器](img/B04674_04_01.jpg)'
- en: 'After making our server time accurate, we need to make sure that our server''s
    hostname is well configured, since a foreign mail server may not accept mail from
    our server due to its suspicious name. We can verify this using the following
    command:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在使服务器时间准确之后，我们需要确保服务器的主机名配置正确，因为外国邮件服务器可能不接受来自我们服务器的邮件，因为其名称可疑。我们可以使用以下命令进行验证：
- en: '[PRE5]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'If we receive a fully-qualified domain name `server.domain` we can proceed,
    where `server` is the host name of our server and `domain` is where it belongs.
    Otherwise, we need to set one by editing the hostname configuration files:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们收到一个完全合格的域名`server.domain`，我们可以继续，其中`server`是我们服务器的主机名，`domain`是它所属的地方。否则，我们需要通过编辑主机名配置文件来设置一个：
- en: '[PRE6]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Or you can also use the following command:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 或者您也可以使用以下命令：
- en: '[PRE7]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: We should ensure we write a well-written domain address. Then we save the files.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该确保编写一个写得很好的域地址。然后我们保存文件。
- en: 'And, finally, we need to check our DNS resolution. Our server should be using
    a fully-qualified DNS, which means that it can resolve addresses from all around
    the Web. We need to check the `/etc/resov.conf` file:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要检查我们的DNS解析。我们的服务器应该使用完全合格的DNS，这意味着它可以解析来自Web的所有地址。我们需要检查`/etc/resov.conf`文件：
- en: '[PRE8]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'If we are not sure that the configured DNS server is well updated to handle
    all our queries, we can edit the file and add some DNS servers that we are sure
    are qualified (Google DNS: `8.8.8.8`, `8.8.4.4`). We can test our DNS server using
    the `nslookup` command:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们不确定配置的DNS服务器是否已经更新以处理我们所有的查询，我们可以编辑文件并添加一些我们确定合格的DNS服务器（Google DNS：`8.8.8.8`，`8.8.4.4`）。我们可以使用`nslookup`命令测试我们的DNS服务器：
- en: '[PRE9]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: We are now ready to install Postfix on our server. As we have mentioned before,
    the installation and the configuration will keep adding and configuring to the
    same server for each section.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在准备在我们的服务器上安装Postfix。正如我们之前提到的，安装和配置将继续为每个部分添加和配置到同一台服务器。
- en: 'In this section, we will start by installing and configuring our Postfix as
    an SMTP server. First, we need to install the `postfix` package using `yum`. We
    need to plan for the coming sections. Since the default version of Postfix in
    the `yum` package manager doesn''t support **MariaDB** (the drop-in replacement
    for MySQL), we need to install Postfix from the **CentOSPlus repository**. Just
    before starting the installation, we need to add an exclusion to some repositories
    to prevent overwriting the Postfix packages update:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将首先安装和配置我们的Postfix作为SMTP服务器。首先，我们需要使用`yum`安装`postfix`软件包。我们需要计划接下来的部分。由于`yum`软件包管理器中的Postfix的默认版本不支持**MariaDB**（MySQL的替代品），我们需要从**CentOSPlus存储库**安装Postfix。在开始安装之前，我们需要在一些存储库中添加排除以防止覆盖Postfix软件包更新：
- en: '[PRE10]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Then we need to make sure to add the line `exclude=postfix` to the end of the
    `[base]` and the `[updates]` repository source to look like this:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要确保在`[base]`和`[updates]`存储库源的末尾添加`exclude=postfix`行，看起来像这样：
- en: '[PRE11]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'After saving the file, we can start the package installation. We will do the
    installation of the essential packages to have a fully-functioning mail server:
    Postfix as an MTA mail server for the SMTP, Dovecot serves for IMAP, and POP daemons
    and some supporting packages for the authentication service:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 保存文件后，我们可以开始安装软件包。我们将安装必要的软件包，以拥有一个完全运行的邮件服务器：Postfix作为SMTP的MTA邮件服务器，Dovecot用于IMAP和POP守护程序，以及一些支持身份验证服务的软件包：
- en: '[PRE12]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Here, we will merge the installation of the tools but the configuration will
    be separated into each section of this chapter.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将合并工具的安装，但配置将分别放在本章的每个部分中。
- en: 'After having the Postfix mail server installed, we can start with the configuration.
    Postfix has almost all of its options as either commented or not fully applicable.
    So to have Postfix fully configured we need to go to its main configuration file
    and make some changes. First, we open the file using any text editor:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 安装了Postfix邮件服务器后，我们可以开始配置。Postfix几乎所有的选项都是作为注释或不完全适用的。因此，为了完全配置Postfix，我们需要转到其主配置文件并进行一些更改。首先，我们使用任何文本编辑器打开文件：
- en: '[PRE13]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Then we start changing uncommented lines and adding information about the desired
    mail server. Since we are going to make many separate changes in a big file, we
    should not add any unnecessary lines because we will be pointing to which line
    we should change at a time. At any point if we are using **nano** as a text editor
    we can always use the search option to look up the desired line using the combination
    of *Ctrl* + *W* and typing in the first part of the line.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们开始更改取消注释的行，并添加关于所需邮件服务器的信息。由于我们将在一个大文件中进行许多单独的更改，因此我们不应添加任何不必要的行，因为我们将一次指向应更改的行。在任何时候，如果我们使用**nano**作为文本编辑器，我们可以始终使用搜索选项使用*Ctrl*
    + *W*的组合，并键入行的第一部分来查找所需的行。
- en: 'Next, we need to define our mail server hostname. We go to the line of the
    option `myhostname` and we uncomment the line and change it with the desired information,
    such as in the following example:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要定义我们的邮件服务器主机名。我们转到选项`myhostname`的行，并取消注释该行，并将其更改为所需的信息，如以下示例所示：
- en: '[PRE14]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Then, we need to set up the domain name at the line of the option `mydomain`,
    as shown in the following example:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们需要在选项`mydomain`的行上设置域名，如下例所示：
- en: '[PRE15]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'This is followed by the origin, which has the same value as the domain, at
    the line of the option `myorigin`:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是源，它与域具有相同的值，在选项`myorigin`的行上：
- en: '[PRE16]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Then we define which network interfaces our server will be providing its services
    (listening) to. In our case we will just use all of them. To set up that, we either
    comment line `116` and uncomment line `113`, or just change line `116` to the
    following code:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们定义我们的服务器将提供其服务（监听）的网络接口。在我们的情况下，我们将使用所有这些接口。为了设置，我们要么注释掉第`116`行并取消注释第`113`行，要么只需将第`116`行更改为以下代码：
- en: '[PRE17]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Then we move to the line of the option `mydestination` to add the domain address
    to the end of the destination domain''s line:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们移动到选项`mydestination`的行，将域地址添加到目标域的行的末尾：
- en: '[PRE18]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Then we make a big jump to the line of the option `mynetworks` to uncomment
    it and add the other networks that we will be using for the network related to
    the server:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们跳到选项`mynetworks`的行，取消注释并添加我们将用于与服务器相关的网络的其他网络：
- en: '[PRE19]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Then we jump to the line of the option `home_mailbox` to uncomment the mailbox
    folder location option and change it to whatever suits our needs:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们跳到选项`home_mailbox`的行，取消注释邮箱文件夹位置选项，并将其更改为适合我们需求的内容：
- en: '[PRE20]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'We end the line counting by going to the line of the option `smtpd_banner`
    and uncomment it and changing it to look like the following code:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 通过转到选项`smtpd_banner`的行并取消注释它并更改它以看起来像以下代码，结束行计数：
- en: '[PRE21]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Then we go to the end of the file and add the following lines and limit the
    e-mail size for the server to handle (10 mega bytes= 10485760):'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们转到文件的末尾，添加以下行并限制服务器处理的电子邮件大小（10兆字节= 10485760）：
- en: '[PRE22]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Also, we need to limit the mailbox folder size (1 giga bytes= 1073741824):'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们需要限制邮箱文件夹的大小（1千兆字节= 1073741824）：
- en: '[PRE23]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'And, finally, we set up the SMTP server authentication configuration option
    lines:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们设置SMTP服务器身份验证配置选项行：
- en: '[PRE24]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'This configuration is considered as the initial one. After having it set, we
    can always use the command `postconf -e` to change an option or set a new one.
    If we ever needed to change the server hostname, we need to write it as follows:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 此配置被视为初始配置。设置完成后，我们可以随时使用命令`postconf -e`来更改选项或设置新选项。如果我们需要更改服务器主机名，我们需要按以下方式编写：
- en: '[PRE25]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'After making sure that all configurations are well set, we can start our Postfix
    service and add it to the system startup services:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 确保所有配置都设置好后，我们可以启动我们的Postfix服务并将其添加到系统启动服务中：
- en: '[PRE26]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Just to verify that everything is ok, we need to do a small test to the Postfix
    services. There are many ways to do this test. We will go with the traditional
    way of sending a mail using the command `mail` and then verifying the mail log
    file located at `/var/log/maillog`:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 只是为了验证一切是否正常，我们需要对Postfix服务进行小测试。有许多方法可以进行此测试。我们将使用使用命令`mail`发送邮件，然后验证位于`/var/log/maillog`的邮件日志文件：
- en: '[PRE27]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Then we should see the following message in the mail log file, which tells
    us the following message to know that the mail has been sent ok and the Postfix
    services are working fine:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们应该在邮件日志文件中看到以下消息，告诉我们以下消息以知道邮件已经发送成功，Postfix服务正常工作：
- en: '[PRE28]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'With this step, we can say that we have successfully configured Postfix as
    an MTA. But this may not be a well set up mail server. We need to add and configure
    a few tools to help make it well qualified and secure. We will start adding and
    configuring the necessary tools during the next sections. This is how our mail
    server will look like after having all it components installed and running:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这一步，我们可以说我们已成功将Postfix配置为MTA。但这可能不是一个设置良好的邮件服务器。我们需要添加和配置一些工具来帮助使其合格和安全。我们将在接下来的部分开始添加和配置必要的工具。这是我们的邮件服务器在安装和运行所有组件后的样子：
- en: '![Setting up and configuring of Postfix mail server](img/B04674_04_02.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![设置和配置Postfix邮件服务器](img/B04674_04_02.jpg)'
- en: Setting up MariaDB for virtual domains and users
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为虚拟域和用户设置MariaDB
- en: 'Since we have already installed **MariaDB** (the drop-in replacement for MySQL)
    during the postfix installation, we can proceed to the configuration. But if we
    ever needed to reinstall the package again, we can always use `yum`:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们在安装Postfix时已经安装了**MariaDB**（MySQL的可替代品），我们可以继续进行配置。但是，如果我们需要再次安装该软件包，我们可以随时使用`yum`：
- en: '[PRE29]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'The first thing to do to start the MariaDB configuration is to start the service.
    Also, we need to add it to the system startup services:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 开始MariaDB配置的第一件事是启动服务。此外，我们需要将其添加到系统启动服务中：
- en: '[PRE30]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Then we start the configuration by setting up the secure installation mode
    where we can set up or change the MariaDB root password, remove anonymous user
    accounts, disable root logins outside of the local host, and so on:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们通过设置安全安装模式来开始配置，我们可以在其中设置或更改MariaDB根密码，删除匿名用户帐户，禁用本地主机以外的根登录等：
- en: '[PRE31]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: We should make sure to answer yes at the end to finish the configuration.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该确保在最后回答是以完成配置。
- en: 'Now we have the MariaDB service well configured and ready to be used. We will
    start setting up the new database to use it with Postfix. To add the new database,
    we need to open the MariaDB shell:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经很好地配置了MariaDB服务，并准备好使用。我们将开始设置新数据库以便与Postfix一起使用。要添加新数据库，我们需要打开MariaDB
    shell：
- en: '[PRE32]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Then we create a new database:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们创建一个新数据库：
- en: '[PRE33]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Next, we switch to that database to start making changes in it:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们切换到该数据库以开始对其进行更改：
- en: '[PRE34]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Then we create a database user to be the mail administrator by granting them
    permissions on the mail database:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们创建一个数据库用户，授予他们对邮件数据库的权限，成为邮件管理员：
- en: '[PRE35]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: The administrator password `mail_admin_password` should be a very strong password
    to better secure the mail server database.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员密码`mail_admin_password`应该是一个非常强大的密码，以更好地保护邮件服务器数据库。
- en: 'Then we submit the change:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们提交更改：
- en: '[PRE36]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Now we start creating the necessary tables inside our database. First, we create
    the virtual domains table:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们开始在我们的数据库中创建必要的表。首先，我们创建虚拟域表：
- en: '[PRE37]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Then we create the table that handles mail forwarding:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们创建处理邮件转发的表：
- en: '[PRE38]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Next, we create the table in which we are going to store the mail server users:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们创建一个表，用于存储邮件服务器用户：
- en: '[PRE39]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Finally, we create the transports table:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们创建传输表：
- en: '[PRE40]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'We have set up our mail server database table''s initial configuration successfully.
    We can now leave the MariaDB shell:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经成功设置了邮件服务器数据库表的初始配置。现在我们可以离开MariaDB shell：
- en: '[PRE41]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'To enable Postfix to communicate with the MariaDB server, we need to set up
    MariaDB to listen to the localhost at IP address `127.0.0.1`. To set this configuration,
    we need to edit `/etc/my.cnf` and add the following section `[mysql]`:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使Postfix能够与MariaDB服务器通信，我们需要设置MariaDB监听IP地址`127.0.0.1`的本地主机。要设置此配置，我们需要编辑`/etc/my.cnf`并添加以下部分`[mysql]`：
- en: '[PRE42]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Then we restart the MariaDB service:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们重新启动MariaDB服务：
- en: '[PRE43]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: We are not yet finished with our mail server database configuration. Now we
    go back to the Postfix configuration to set up communication with the database
    earlier created code within MariaDB. So we need tell Postfix which table of which
    database it should use to store specific information (users, virtual domains,
    and so on).
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的邮件服务器数据库配置还没有完成。现在我们回到Postfix配置，以设置与之前在MariaDB中创建的数据库代码的通信。因此，我们需要告诉Postfix应该使用哪个数据库的哪个表来存储特定信息（用户、虚拟域等）。
- en: 'We start by creating configuration files for each table. For the virtual domains
    configuration, we are creating a file called `/etc/postfix/mysql-virtual_domains.cf`:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先为每个表创建配置文件。对于虚拟域配置，我们创建一个名为`/etc/postfix/mysql-virtual_domains.cf`的文件：
- en: '[PRE44]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Then we put the following code inside it and save it:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在其中放入以下代码并保存：
- en: '[PRE45]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Again, the `mail_admin_password` should be replaced with the strong one that
    we created earlier. This goes for all of the following files that we are going
    to create.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，`mail_admin_password` 应该被我们之前创建的强密码替换。这适用于我们将要创建的所有以下文件。
- en: 'Then we create the configuration file for the virtual forwarding at `/etc/postfix/mysql-virtual_forwardings.cf`:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在`/etc/postfix/mysql-virtual_forwardings.cf`中创建虚拟转发的配置文件：
- en: '[PRE46]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'We add the following code inside it:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在其中添加以下代码：
- en: '[PRE47]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'We create another configuration file for the virtual mailbox called `/etc/postfix/mysql-virtual_mailboxes.cf`:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 我们为虚拟邮箱创建另一个配置文件，名为`/etc/postfix/mysql-virtual_mailboxes.cf`：
- en: '[PRE48]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'And we insert the following code:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们插入以下代码：
- en: '[PRE49]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'And, finally, we do the same for the virtual e-mail mapping by creating the
    file `/etc/postfix/mysql-virtual_email2email.cf`:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们通过创建文件`/etc/postfix/mysql-virtual_email2email.cf`来为虚拟电子邮件映射创建配置文件：
- en: '[PRE50]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Then add the following code inside it and save it:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 然后在其中添加以下代码并保存：
- en: '[PRE51]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Now we set the files'' permissions and ownership to make Postfix able to handle
    the new configuration files:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们设置文件的权限和所有权，以使Postfix能够处理新的配置文件：
- en: '[PRE52]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Then we create a user and group for mail handling. The virtual mailboxes will
    be all stored under this user home directory. We are choosing the group 5000 to
    keep our distance from the ones created by the system for the regular users:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们创建一个用于处理邮件的用户和组。虚拟邮箱将全部存储在此用户的主目录下。我们选择组5000以保持与系统为常规用户创建的组的距离：
- en: '[PRE53]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: To complete the configuration, we need to make some minor changes to the Postfix
    configuration. We will not open the configuration file and edit it, we will only
    add them using the command `postconf -e`.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成配置，我们需要对Postfix配置进行一些微小的更改。我们不会打开配置文件并编辑它，我们只会使用命令`postconf -e`来添加它们。
- en: 'We start by locating the new configuration file created to address the database
    tables:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先找到新创建的配置文件，以解决数据库表的问题：
- en: '[PRE54]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Then we set the location where the mailbox folder will be created:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们设置邮箱文件夹将被创建的位置：
- en: '[PRE55]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Finally, we see the user UID who will take control of the configuration files
    and add the mailbox folder:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们看到将控制配置文件并添加邮箱文件夹的用户UID：
- en: '[PRE56]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'To finish the mail server database configuration, we need to restart the Postfix
    service to submit the change:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成邮件服务器数据库配置，我们需要重新启动Postfix服务以提交更改：
- en: '[PRE57]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'We can say that we have finished our mail server database service. Still, if
    we need to configure Postfix with the virtual domain to use them to send e-mail
    with a domain name different from the system''s default domain name, we need to
    make some minor modifications to the Postfix main configuration file. Also, we
    can always use the command `postconf -e` to make quick changes:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以说我们已经完成了邮件服务器数据库服务。但是，如果我们需要配置Postfix与虚拟域一起使用，以便使用与系统默认域名不同的域名发送电子邮件，我们需要对Postfix主配置文件进行一些微小的修改。此外，我们可以随时使用命令`postconf
    -e`进行快速更改：
- en: '[PRE58]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'Then we add the following code at the end of the file:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在文件末尾添加以下代码：
- en: '[PRE59]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'Then we need to add the new domain to the virtual domain file, `/etc/postfix/virtual`:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要将新域添加到虚拟域文件`/etc/postfix/virtual`中：
- en: '[PRE60]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Then we add the following snippet anywhere:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在任何地方添加以下片段：
- en: '[PRE61]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Then we apply the change by refreshing the Postfix map and restarting the service:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们通过刷新Postfix映射并重新启动服务来应用更改：
- en: '[PRE62]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: Setting up a mail tool (Dovecot) to retrieve mails
  id: totrans-160
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置邮件工具（Dovecot）以检索邮件
- en: 'As we have said earlier, **Dovecot** is an open source **IMAP** and **POP3**
    server. It is fast, easy to set up and configure, and it uses very little RAM
    memory. For this section, we are going to install it to work with Postfix as **MDA**
    (POP/IMAP service) and sieve for sorting mail at the mail server POP/IMAP service.
    As this image shows, Dovocot is positioned between the user mailbox and Postfix:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前所说，**Dovecot** 是一个开源的 **IMAP** 和 **POP3** 服务器。它运行速度快，易于设置和配置，并且使用的内存很少。在本节中，我们将安装它以与Postfix一起工作作为
    **MDA**（POP/IMAP 服务），并使用筛选器在邮件服务器POP/IMAP 服务中对邮件进行分类。正如这个图像所示，Dovocot位于用户邮箱和Postfix之间：
- en: '![Setting up a mail tool (Dovecot) to retrieve mails](img/B04674_04_03.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![设置邮件工具（Dovecot）以检索邮件](img/B04674_04_03.jpg)'
- en: 'Since we have already installed Dovecot, we now only need to configure it to
    work alongside Postfix. If we ever miss the installation, we can always use the
    `yum` package manager to reinstall it:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们已经安装了Dovecot，现在我们只需要配置它与Postfix一起工作。如果我们错过了安装，我们可以随时使用`yum`软件包管理器进行重新安装：
- en: '[PRE63]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Then, we need to add Dovecot support to the Postfix configuration file. Again,
    we will not go and edit the file; we will only use the command `postconf -e`.
    First, we need to enable Dovecot to use the SMTP and enable the service authentication:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们需要向Postfix配置文件添加Dovecot支持。再次强调，我们不会打开配置文件并编辑它，我们只会使用命令`postconf -e`。首先，我们需要启用Dovecot以使用SMTP并启用服务身份验证：
- en: '[PRE64]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'Then we enable Postfix to create and extend the mail directory if needed:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们启用Postfix以根据需要创建和扩展邮件目录：
- en: '[PRE65]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'Finally, we set the mail transport parameters:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们设置邮件传输参数：
- en: '[PRE66]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'For this section, we will use the default security option provided by Dovecot
    so we need to tell Postfix to use the SSL certificate and key provided by Dovecot:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本节，我们将使用Dovecot提供的默认安全选项，因此我们需要告诉Postfix使用Dovecot提供的SSL证书和密钥：
- en: '[PRE67]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Then we move to the service configuration file of Postfix, `/etc/postfix/master.cf`:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们转到Postfix的服务配置文件`/etc/postfix/master.cf`：
- en: '[PRE68]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'Add the Dovecot service to the bottom of the file, then save it and exit:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 将Dovecot服务添加到文件底部，然后保存并退出：
- en: '[PRE69]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'Then we move to the Dovecot service configuration. Before we start the configuration,
    we need to have a copy of the initial configuration file backed up:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们转到Dovecot服务配置。在开始配置之前，我们需要备份初始配置文件的副本：
- en: '[PRE70]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'For this example, we are going to create our own new configuration file where
    we will specify every single parameter one by one. We will create a new file with
    the same name as the original configuration file:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 对于此示例，我们将创建自己的新配置文件，在其中我们将逐个指定每个参数。我们将创建一个与原始配置文件同名的新文件：
- en: '[PRE71]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'Then we add the following code without the description:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们添加以下代码，不包括描述：
- en: '[PRE72]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'We save the file to have the configuration stored. Then we need to create the
    database files already assigned to the Dovecot configuration file:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 我们保存文件以保存配置。然后我们需要创建已分配给Dovecot配置文件的数据库文件：
- en: '[PRE73]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 'Then we add the following code, changing the mail administrator password `mail_admin_password`
    for the one already set in an earlier section where we have setup the MariaDB
    database:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们添加以下代码，将邮件管理员密码`mail_admin_password`更改为在早期设置MariaDB数据库的部分中已设置的密码：
- en: '[PRE74]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'Then we arrange the files permission and ownership to restrict access to the
    files:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们安排文件权限和所有权以限制对文件的访问：
- en: '[PRE75]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'Then we move to configure the Dovecot authentication parameters located in
    its configuration folder, `/etc/dovecot/conf.d/`. We start with the authentication
    process configuration file:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们开始配置Dovecot认证参数，位于其配置文件夹`/etc/dovecot/conf.d/`中。我们从认证过程配置文件开始：
- en: '[PRE76]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'We need to locate the following lines and change them:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要定位以下行并更改它们：
- en: '[PRE77]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'Then we move to the mailbox configuration file:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们转到邮箱配置文件：
- en: '[PRE78]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'Then uncomment the following line and change its end to match with the following
    code:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 然后取消注释以下行，并将其结尾与以下代码匹配：
- en: '[PRE79]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'Similarly, we need to edit the master configuration file to define the Postfix
    user who will use the SMTP authentication:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，我们需要编辑主配置文件以定义将使用SMTP身份验证的Postfix用户：
- en: '[PRE80]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'Then uncomment the `unix_listener /var/spool/postfix/private/auth` section,
    and add it to the user and group lines:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 取消注释`unix_listener /var/spool/postfix/private/auth`部分，并将其添加到用户和组行中：
- en: '[PRE81]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'Finally, we configure the SSL authentication configuration file:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们配置SSL认证配置文件：
- en: '[PRE82]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'And we change the SSL option from `no` to `yes`:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 并将SSL选项从`no`更改为`yes`：
- en: '[PRE83]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 'Before starting the test, we need to make sure that we have defined two variables
    in our `/etc/aliases` configuration file:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始测试之前，我们需要确保在我们的`/etc/aliases`配置文件中定义了两个变量：
- en: '[PRE84]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'Then we check the following code:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们检查以下代码：
- en: '[PRE85]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: 'Then we update the aliases list:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们更新别名列表：
- en: '[PRE86]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: 'And to finish the Dovecot configuration, we need to restart both the Postfix
    and Dovecot services. Also, we need to add Dovecot to the system startup services:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，为了完成Dovecot配置，我们需要重新启动Postfix和Dovecot服务。此外，我们需要将Dovecot添加到系统启动服务中：
- en: '[PRE87]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: 'To verify that the services are running well and there is no problem with the
    configuration files we need to check the mail log file:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 要验证服务是否正常运行，并且配置文件没有问题，我们需要检查邮件日志文件：
- en: '[PRE88]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: 'We should see something like the following code to know that Dovecot is running
    well:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该看到类似以下代码的东西，以知道Dovecot是否正常运行：
- en: '[PRE89]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: Note
  id: totrans-217
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Sometimes, SELinux prevents Dovecot from using the system resource so we need
    to grant Dovecot access to the system resource, or if we have an alternative way
    to secure the server we can either disable SELinux or set it as permissive.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，SELinux会阻止Dovecot使用系统资源，因此我们需要授予Dovecot对系统资源的访问权限，或者如果我们有另一种方式来保护服务器，我们可以禁用SELinux或将其设置为宽松模式。
- en: At this point, our mail server is fully qualified to work as a sender and receiver
    with a well-organized database and a medium security level. We can start testing
    our mail server.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，我们的邮件服务器已经完全具备作为发件人和收件人工作的条件，具有组织良好的数据库和中等安全级别。我们可以开始测试我们的邮件服务器。
- en: 'First, we will use the **Telnet** service to check that **Postfix SMTP-AUTH**
    and **TLS** are working fine. We need to install Telnet and if it doesn''t exist
    on the system, run the following command:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将使用**Telnet**服务来检查**Postfix SMTP-AUTH**和**TLS**是否正常工作。我们需要安装Telnet，如果系统上不存在，运行以下命令：
- en: '[PRE90]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: 'Then we run the test:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们运行测试：
- en: '[PRE91]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: 'Telnet will connect and we will see the Telnet shell, inside which we type
    inside the following command:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: Telnet将连接，我们将看到Telnet shell，在其中我们键入以下命令：
- en: '[PRE92]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: 'To know that our test is positive, we need to see the following message:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 要知道我们的测试是积极的，我们需要看到以下消息：
- en: '[PRE93]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: 'Then we exit the Telnet shell:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们退出Telnet shell：
- en: '[PRE94]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: 'Now we will test the mail service. To do that, we need to first populate our
    database with a test domain and user. First, we enter the MariaDB database shell:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将测试邮件服务。为此，我们需要首先使用测试域和用户填充我们的数据库。首先，我们进入MariaDB数据库shell：
- en: '[PRE95]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: 'Then we switch to our mail database:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们切换到我们的邮件数据库：
- en: '[PRE96]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: 'Then we create a new domain at the domains table:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在域表中创建一个新的域：
- en: '[PRE97]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: 'We add a new user to that domain. We need to enter a good password for the
    real users later:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 我们为该域添加一个新用户。我们需要为真实用户输入一个良好的密码：
- en: '[PRE98]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: Then we exit the MariaDB shell.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们退出MariaDB shell。
- en: 'Now we need to send a test mail to our newly created user. We need to use **Mailx**,
    so if we don''t have it installed we need to do so before the test:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们需要向我们新创建的用户发送一封测试邮件。我们需要使用**Mailx**，因此如果尚未安装，我们需要在测试之前安装它：
- en: '[PRE99]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: 'Then we send our test mail:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们发送我们的测试邮件：
- en: '[PRE100]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE100]'
- en: We need to put the `Subject` and then press *Enter*. If we ever need to insert
    a copied address, we need to write `Cc:` then add the copied address. Then we
    type in the message and press *Enter*, then to send it we need to put `.` at the
    end and press *Enter*.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要输入`Subject`然后按*Enter*。如果我们需要插入一个复制的地址，我们需要输入`Cc:`然后添加复制的地址。然后我们输入消息并按*Enter*，然后发送它，我们需要在末尾输入`.`并按*Enter*。
- en: To check whether the mail has been sent, we go to the mail log file;
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查邮件是否已发送，我们需要查看邮件日志文件；
- en: '[PRE101]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE101]'
- en: 'Then we should see something like the following code to know that it is ok:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们应该看到类似以下代码的内容以确认它是正常的：
- en: '[PRE102]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE102]'
- en: 'Now we check the Dovecot delivery by visualizing the Dovecot delivery log:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们通过可视化Dovecot交付日志来检查Dovecot交付：
- en: '[PRE103]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE103]'
- en: 'And we should see something like the following line to make sure that it is
    working:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该看到类似以下行的内容以确保它正在工作：
- en: '[PRE104]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE104]'
- en: 'Now we can test our mailbox via the mail client. For this example, we are going
    to use **Mutt**, which is a simple mail client. But before using it, we need to
    install it first:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以通过邮件客户端测试我们的邮箱。在这个例子中，我们将使用**Mutt**，这是一个简单的邮件客户端。但在使用之前，我们需要先安装它：
- en: '[PRE105]'
  id: totrans-253
  prefs: []
  type: TYPE_PRE
  zh: '[PRE105]'
- en: 'Then we need to go to the location where the new user mailbox is stored and
    run Mutt:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要进入存储新用户邮箱的位置并运行Mutt：
- en: '[PRE106]'
  id: totrans-255
  prefs: []
  type: TYPE_PRE
  zh: '[PRE106]'
- en: 'And now we run Mutt:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们运行Mutt：
- en: '[PRE107]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE107]'
- en: The message showing that we need to create a root mailbox is not required, so
    we can skip it. And to exit Mutt type `q`.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 显示需要创建根邮箱的消息是不需要的，所以我们可以跳过它。要退出Mutt，输入`q`。
- en: 'Then we will have a pretty clear interface where we can navigate using keyboard
    direction and press *Enter* to see what is inside the mail. To confirm that our
    mail server is well configured and running, we should see the test mail that we
    have sent using Mailx:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们将会有一个相当清晰的界面，我们可以使用键盘方向键进行导航，并按*Enter*键查看邮件内容。为了确认我们的邮件服务器已经配置好并正在运行，我们应该看到我们使用Mailx发送的测试邮件：
- en: '![Setting up a mail tool (Dovecot) to retrieve mails](img/B04674_04_05.jpg)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
  zh: '![设置邮件工具（Dovecot）以检索邮件](img/B04674_04_05.jpg)'
- en: Configuring the OpenLDAP Active Directory with Postfix
  id: totrans-261
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Postfix配置OpenLDAP Active Directory
- en: For this section, we are going to use OpenLDAP as a backend to both our Postfix
    (as an MTA) and Dovecot (as an POP3/IMAP server) users, in order for them to be
    connected to each other, and help with address lookup and aliases.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将使用OpenLDAP作为我们的Postfix（作为MTA）和Dovecot（作为POP3/IMAP服务器）用户的后端，以便它们相互连接，并帮助进行地址查找和别名。
- en: Note
  id: totrans-263
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: OpenLDAP is an open source implementation of the **Lightweight Directory Access
    Protocol** (**LDAP**). This section doesn't cover how to install an OpenLDAP server.
    We will assume that we have one already configured inside our network.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: OpenLDAP是**轻量级目录访问协议**（**LDAP**）的开源实现。本节不涵盖如何安装OpenLDAP服务器。我们假设我们已经在我们的网络中配置了一个。
- en: 'Our OpenLDAP server has the following information as follows:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的OpenLDAP服务器有以下信息如下：
- en: '[PRE108]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE108]'
- en: 'For the configuration of the LDAP settings for both of our services, we need
    to edit and add some options to their configuration files. We will start with
    Dovecot. We will first open the Dovecot main configuration file with a text editor,
    then make the necessary changes:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的两项服务的LDAP设置，我们需要编辑和添加一些选项到它们的配置文件中。我们将从Dovecot开始。首先我们会用文本编辑器打开Dovecot主配置文件，然后进行必要的更改：
- en: '[PRE109]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE109]'
- en: 'Then we check the following options if any change is needed or, if they don''t
    exist, we need to add them:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们检查以下选项是否需要任何更改，或者如果它们不存在，我们需要添加它们：
- en: '[PRE110]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE110]'
- en: 'Then we need to create the LDAP database files and populate them:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要创建LDAP数据库文件并填充它们：
- en: '[PRE111]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE111]'
- en: 'Next, we add the following code with the necessary change, then we save:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们添加以下代码并进行必要的更改，然后保存：
- en: '[PRE112]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE112]'
- en: 'The following image shows, OpenLDAP serves both inbox and outbox mail services:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图片显示，OpenLDAP提供收件箱和发件箱邮件服务：
- en: '![Configuring the OpenLDAP Active Directory with Postfix](img/B04674_04_04.jpg)'
  id: totrans-276
  prefs: []
  type: TYPE_IMG
  zh: '![使用Postfix配置OpenLDAP Active Directory](img/B04674_04_04.jpg)'
- en: 'We do the same thing for the second LDAP database file:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 我们对第二个LDAP数据库文件做同样的操作：
- en: '[PRE113]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE113]'
- en: 'Then we add the following code with the necessary change, save the file, and
    exit:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们添加以下代码并进行必要的更改，保存文件并退出：
- en: '[PRE114]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE114]'
- en: 'With this step, we can say that Dovecote is successfully configured to use
    our LDAP server. We proceed to the Postfix configuration. As usual we can edit
    the main configuration file, `/etc/postfix/main.cf` using a text editor or we
    can just use the fast configuration setup command:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这一步，我们可以说Dovecote已成功配置为使用我们的LDAP服务器。我们继续进行Postfix配置。通常情况下，我们可以使用文本编辑器编辑主配置文件`/etc/postfix/main.cf`，或者我们可以使用快速配置设置命令：
- en: '[PRE115]'
  id: totrans-282
  prefs: []
  type: TYPE_PRE
  zh: '[PRE115]'
- en: 'Then to submit the change, we need to restart both services:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 然后要提交更改，我们需要重新启动两项服务：
- en: '[PRE116]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE116]'
- en: Securing the mail server using SSL/TLS
  id: totrans-285
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用SSL/TLS保护邮件服务器
- en: SSL/TLS encryption for Postfix gives our mail server the capacity to not only
    authenticate remote SMTP servers but also to encrypt the e-mails that we send
    between our server and the receiver's server.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Postfix的SSL/TLS加密，我们的邮件服务器不仅可以验证远程SMTP服务器，还可以加密我们发送的邮件和接收者服务器之间的邮件。
- en: To configure SSL to encrypt connections, we first need to create our own personalized
    and specific SSL certificates.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置SSL以加密连接，我们首先需要创建我们自己的个性化和特定的SSL证书。
- en: 'We need to go the TLS certificates directory to create our new certificate
    there:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要进入TLS证书目录以在那里创建我们的新证书：
- en: '[PRE117]'
  id: totrans-289
  prefs: []
  type: TYPE_PRE
  zh: '[PRE117]'
- en: 'Then we create our first key file:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们创建我们的第一个密钥文件：
- en: '[PRE118]'
  id: totrans-291
  prefs: []
  type: TYPE_PRE
  zh: '[PRE118]'
- en: Then the tool will ask for a passphrase. We should give something strong and
    retype it when the tool asks us to do so.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 然后工具会要求输入密码。我们应该输入一个强密码，并在工具要求重新输入时重新输入。
- en: 'After that we need to start using the OpenSSL tool; so if it is not installed
    we need to install it first:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 之后我们需要开始使用OpenSSL工具；如果没有安装，我们需要先安装它：
- en: '[PRE119]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE119]'
- en: 'Then we use OpenSSL to write the RSA key:'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们使用OpenSSL来编写RSA密钥：
- en: '[PRE120]'
  id: totrans-296
  prefs: []
  type: TYPE_PRE
  zh: '[PRE120]'
- en: Then write in the passphrase that has already defined and carry on to have the
    key generated.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 然后输入已经定义的密码，然后继续生成密钥。
- en: 'Now we move on to certificate creation. In the same folder, we run the following
    command:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们继续进行证书创建。在同一文件夹中，我们运行以下命令：
- en: '[PRE121]'
  id: totrans-299
  prefs: []
  type: TYPE_PRE
  zh: '[PRE121]'
- en: 'Then we fill in the information as each filed asked: **Country Name**, **State
    or Province Name**, **Locality Name**, **Organization Name**, **Organizational
    Unit Name**, **Common Name**, and **Email Address** and for the final two entries
    (A challenge password, and an optional company name) we can skip them.'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们按照每个字段要求填写信息：**国家名称**，**州或省名称**，**地点名称**，**组织名称**，**组织单位名称**，**通用名称**和**电子邮件地址**，对于最后两个条目（挑战密码和可选公司名称），我们可以跳过它们。
- en: 'Then we create a private key using OpenSSL:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们使用OpenSSL创建一个私钥：
- en: '[PRE122]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE122]'
- en: Then we move to the configuring Postfix and Dovecot to use the SSL/TLS encryption.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们转到配置Postfix和Dovecot以使用SSL/TLS加密。
- en: First, we are going to start by setting up Postfix to use SSL/TLS by making
    some modifications at its main configuration file, `/etc/postfix/main.cf`. We
    can always use a text editor to edit the file and change the parameters, or we
    can just use the command `postconf -e` to set them up in a faster way.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将从设置Postfix使用SSL/TLS开始，通过对其主配置文件`/etc/postfix/main.cf`进行一些修改。我们可以使用文本编辑器编辑文件并更改参数，或者我们可以使用命令`postconf
    -e`以更快的方式设置它们。
- en: 'We will add some lines to the Postfix configuration file to protect it from
    some recent attacks against OpenSSL:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将向Postfix配置文件添加一些行，以保护它免受针对OpenSSL的一些最近攻击：
- en: '[PRE123]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE123]'
- en: 'We create the cert file:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 我们创建证书文件：
- en: '[PRE124]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE124]'
- en: 'Then we need to make sure that the TLS is enabled to be used with SMTP:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要确保TLS已启用以用于SMTP：
- en: '[PRE125]'
  id: totrans-310
  prefs: []
  type: TYPE_PRE
  zh: '[PRE125]'
- en: 'Then we need to redefine the certificate and key files position:'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要重新定义证书和密钥文件的位置：
- en: '[PRE126]'
  id: totrans-312
  prefs: []
  type: TYPE_PRE
  zh: '[PRE126]'
- en: 'Then we set the location of the TLS session database cache:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们设置TLS会话数据库缓存的位置：
- en: '[PRE127]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE127]'
- en: 'That is all for the main configuration file. We will now configure `/etc/postfix/master.cf`:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是主配置文件的全部内容。现在我们将配置`/etc/postfix/master.cf`：
- en: '[PRE128]'
  id: totrans-316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE128]'
- en: 'We need to uncomment some options of `Submission` and `SMTPS` between lines
    `16` to `35` of the original file, to look like the following uncommented:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要取消注释原始文件的第16到35行之间的“Submission”和“SMTPS”选项，使其看起来像以下取消注释的内容：
- en: '[PRE129]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE129]'
- en: 'We have finished with the Postfix configuration to use SSL. We can now configure
    SSL for Dovecot. We only need to make a few changes at the `/etc/dovecot/conf.d/10-ssl.conf`
    file:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经完成了Postfix配置以使用SSL。现在我们可以为Dovecot配置SSL。我们只需要在`/etc/dovecot/conf.d/10-ssl.conf`文件中进行一些更改：
- en: '[PRE130]'
  id: totrans-320
  prefs: []
  type: TYPE_PRE
  zh: '[PRE130]'
- en: 'First, we need to make sure that the SSL option is activated:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要确保SSL选项已激活：
- en: '[PRE131]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE131]'
- en: 'Then we change the SSL certificate and key location:'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们更改SSL证书和密钥的位置：
- en: '[PRE132]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE132]'
- en: 'And, finally, we need to restart the services to submit the change:'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要重新启动服务以提交更改：
- en: '[PRE133]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE133]'
- en: References
  id: totrans-327
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考资料
- en: 'Now that we have gone through the chapter, let''s take a look at the references
    used:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经完成了这一章，让我们来看一下使用的参考资料：
- en: 'Postfix home page: [www.postfix.org](http://www.postfix.org)'
  id: totrans-329
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Postfix主页：[www.postfix.org](http://www.postfix.org)
- en: 'Postfix MySQL support: [http://www.postfix.org/MYSQL_README.html](http://www.postfix.org/MYSQL_README.html)'
  id: totrans-330
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Postfix MySQL支持：[http://www.postfix.org/MYSQL_README.html](http://www.postfix.org/MYSQL_README.html)
- en: 'Dovecot home page overview: [http://www.dovecot.org](http://www.dovecot.org)'
  id: totrans-331
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Dovecot主页概述：[http://www.dovecot.org](http://www.dovecot.org)
- en: 'Postfix virtual hosts overview: [http://www.akadia.com/services/postfix_separate_mailboxes.html](http://www.akadia.com/services/postfix_separate_mailboxes.html)'
  id: totrans-332
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Postfix虚拟主机概述：[http://www.akadia.com/services/postfix_separate_mailboxes.html](http://www.akadia.com/services/postfix_separate_mailboxes.html)
- en: 'Dovecot configuration file: [http://wiki.dovecot.org/MainConfig](http://wiki.dovecot.org/MainConfig)'
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Dovecot配置文件：[http://wiki.dovecot.org/MainConfig](http://wiki.dovecot.org/MainConfig)
- en: 'LDAP support in Postfix: [http://www.postfix.org/LDAP_README.html](http://www.postfix.org/LDAP_README.html)'
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Postfix中的LDAP支持：[http://www.postfix.org/LDAP_README.html](http://www.postfix.org/LDAP_README.html)
- en: 'Postfix TLS support: [http://www.postfix.org/TLS_README.html](http://www.postfix.org/TLS_README.html)'
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Postfix TLS支持：[http://www.postfix.org/TLS_README.html](http://www.postfix.org/TLS_README.html)
- en: Summary
  id: totrans-336
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: This chapter describes in a step-by-step tutorial how to set up a fully-qualified
    mail server starting from sending a service SMTP using Postfix. We then started
    organizing the mail server, focusing on sending/receiving mail and virtual domains
    management via a secure database service MariaDB. Next, we learned about the mail
    reception service using POP3/IMAP using the MDA Dovecot with a medium level of
    security provided by the service itself. Then to start the extension part, which
    shows when the server can connect to an LDAP server and can gather useful information
    about the users and use them to send and receive mail. Finally, we finished off
    with a customized security level using OpenSSL to generate new certificate and
    keys to secure the service's authentication and encryption of the e-mails to be
    sent.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 本章以逐步教程的形式描述了如何从使用Postfix发送服务SMTP开始设置一个完全合格的邮件服务器。然后，我们开始组织邮件服务器，重点是通过安全数据库服务MariaDB发送/接收邮件和虚拟域管理。接下来，我们了解了使用MDA
    Dovecot进行邮件接收服务，该服务本身提供了中等级别的安全性。然后开始扩展部分，当服务器可以连接到LDAP服务器并收集有关用户的有用信息并用于发送和接收邮件时，这一部分就会显示出来。最后，我们通过使用OpenSSL生成新证书和密钥来完成自定义安全级别，以确保邮件的身份验证和加密的安全性。
- en: In the next chapter, we will learn how to set up and configure tools such as
    Nagios and syslog-ng on CentOS to monitor different services, and collect and
    process logs.
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习如何在CentOS上设置和配置诸如Nagios和syslog-ng之类的工具，以监视不同的服务，并收集和处理日志。
