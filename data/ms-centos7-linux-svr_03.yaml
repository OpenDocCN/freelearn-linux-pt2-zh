- en: Chapter 3. Linux for Different Purposes
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第3章。不同用途的Linux
- en: The plans we make to set up a server infrastructure or a data center are generally
    the same. We always try to organize services between the servers that we are running,
    respecting our needs. Servers operating on a Linux system can be used to run multiple
    services at once or just one depending on how much processing power that service
    will need and its position inside the network. Following the needs of the users,
    system administrators should always be ready to set up or to take down services
    in their infrastructure. Usually, for a basic system installation, there will
    be a number of services already installed but not well configured.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 我们制定的设置服务器基础设施或数据中心的计划通常是相同的。我们总是尝试在运行的服务器之间组织服务，以满足我们的需求。在Linux系统上运行的服务器可以同时运行多个服务，也可以根据服务所需的处理能力和其在网络中的位置而选择只运行一个服务。根据用户的需求，系统管理员应始终准备好在其基础设施中设置或关闭服务。通常，对于基本系统安装，已经安装了一些服务，但配置不佳。
- en: This chapter will cover some of the main Linux services that most users are
    in need of, and also how to set up, configure, and operate them. Then we are going
    to explore some of those service's aspects, how to secure them, and how to operate
    them in the best way possible.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖大多数用户需要的一些主要Linux服务，以及如何设置、配置和操作它们。然后，我们将探讨这些服务的一些方面，如何保护它们，以及如何以最佳方式操作它们。
- en: 'In this chapter, we are going to learn to:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将学习：
- en: Configure a Gateway server using iptables and IP masquerading
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用iptables和IP伪装配置网关服务器
- en: Install a VPN server
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装VPN服务器
- en: Implement BIND as a DNS server
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实施BIND作为DNS服务器
- en: Set up and use a web server using Apache-MySQL-PHP with ModSecurity
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Apache-MySQL-PHP和ModSecurity设置和使用Web服务器
- en: Install an FTP server
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装FTP服务器
- en: Implement OpenSSL in Apache and FTP
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Apache和FTP中实施OpenSSL
- en: Configuring a gateway server
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置网关服务器
- en: 'In many network infrastructures, system administrators need to separate their
    servers and workstation inside multiple subnetworks. Others use private network
    addresses that can be associated with public addresses using the **Network Address
    Translation** (**NAT**) technology. A Linux gateway server is one of the common
    solutions that can help set up this kind of configuration. The following screenshot
    is a presentation of an example of an architecture where the Gateway server serves
    to pass through both local and external networks:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多网络基础设施中，系统管理员需要将他们的服务器和工作站分隔在多个子网络中。其他人使用可以使用**网络地址转换**（**NAT**）技术将私有网络地址与公共地址关联起来。Linux网关服务器是可以帮助设置这种配置的常见解决方案之一。以下屏幕截图是一个架构示例，其中网关服务器用于通过本地和外部网络：
- en: '![Configuring a gateway server](img/B04674_03_01.jpg)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![配置网关服务器](img/B04674_03_01.jpg)'
- en: As per the requirement, we are in need of a Linux server with at least two network
    interfaces (as a best practice). We then need to make a bridge between the two
    networks associated with them. During this section, we will be working on setting
    up a gateway between public (external) and private (local) addresses using IP
    forwarding and NAT rules to route the traffic from the private network to the
    public network. We will call the external network **Wide Area Network** (**WAN**)
    and the local network **Local Area Network** (**LAN**).
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 根据要求，我们需要至少两个网络接口的Linux服务器（作为最佳实践）。然后我们需要在它们之间建立一个桥接。在本节中，我们将设置在公共（外部）和私有（本地）地址之间建立网关，使用IP转发和NAT规则将流量从私有网络路由到公共网络。我们将称外部网络为**广域网**（**WAN**），本地网络为**局域网**（**LAN**）。
- en: Note
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The traffic generated from the local network will appear to originate from the
    Gateway server to the external network. In this example, we will need another
    machine to present a server inside the LAN network.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 从本地网络生成的流量将看起来是从网关服务器到外部网络发出的。在这个例子中，我们将需要另一台机器在LAN网络中提供服务器。
- en: 'First, we will set up the network configuration of the `WAN` interface. To
    do so, there will be two options: either the interface will take its IP configuration
    via DHCP (automatic) or we set it ourselves manually (static). In our case, we
    will do the automatic configuration since our WAN network is provided by a router
    that serves DHCP configuration.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将设置`WAN`接口的网络配置。为此，有两个选项：要么接口将通过DHCP（自动）获取其IP配置，要么我们手动设置它（静态）。在我们的情况下，我们将进行自动配置，因为我们的WAN网络由提供DHCP配置的路由器提供。
- en: 'We will start by editing the configuration file of the designated interface
    `eth0`:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先编辑指定接口`eth0`的配置文件：
- en: '[PRE0]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The file will contain the following lines:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 文件将包含以下行：
- en: '[PRE1]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: We should focus on the line where `BOOTPROTO` is written, which is the protocol
    to use for the network configuration, and we need to make sure that it is set
    on `dhcp`.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该关注`BOOTPROTO`所写的行，这是用于网络配置的协议，我们需要确保它设置为`dhcp`。
- en: The default installation sets all the interfaces to the DHCP configuration unless
    they have been modified during the installation or later.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 默认安装将所有接口设置为DHCP配置，除非它们在安装期间或以后已被修改。
- en: Also, we need to make sure that the `DEVICE` is set to the interface name that
    we are going to use to serve the DHCP server and as named in our server (for our
    case it is `eth0`). Then the option `ONBOOT` is set to `yes`.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们需要确保`DEVICE`设置为我们将用于提供DHCP服务器的接口名称，并且与我们服务器中的命名相同（对于我们的情况，它是`eth0`）。然后，选项`ONBOOT`设置为`yes`。
- en: Note
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: After editing the file, if needed, make sure to save the modifications before
    leaving the text editor.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑文件后，如有需要，请确保在离开文本编辑器之前保存修改。
- en: 'After making sure that all changes are successfully set, we need to restart
    the network manager so the machine can take the DHCP configuration:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 确保所有更改都已成功设置后，我们需要重新启动网络管理器，以便机器可以接受DHCP配置：
- en: '[PRE2]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: During the execution of this step, the network connection may be lost. We need
    to make sure that we do not need it in the meantime.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行此步骤期间，可能会丢失网络连接。我们需要确保在此期间不需要它。
- en: Now we can move to the configuration of the second network interface of the
    gateway server connected to the LAN. For this configuration, we need to use a
    static IP address.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以继续配置连接到LAN的网关服务器的第二个网络接口。对于此配置，我们需要使用静态IP地址。
- en: 'In a similar way to the first interface, we are going to edit the configuration
    file of this interface `eth1`:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 与第一个接口类似，我们将编辑此接口“eth1”的配置文件：
- en: '[PRE3]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Also, this file will contain some configuration files, but we will be interested
    in only some of them:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 此文件还将包含一些配置文件，但我们只对其中的一些感兴趣：
- en: '[PRE4]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This is the default configuration, so we need to change it from a dynamic configuration
    to a static one.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 这是默认配置，因此我们需要将其从动态配置更改为静态配置。
- en: The modification will consist of modifying some lines and adding others.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 修改将包括修改一些行和添加其他行。
- en: 'We start by changing the configuration protocol from `dhcp` to `static` to
    look like this:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先将配置协议从“dhcp”更改为“static”，看起来像这样：
- en: '`BOOTPROTO="static"`'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: “BOOTPROTO="static"”
- en: 'Then we add the static IP address with this line: `IPADDR="10.0.1.1"`.'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们添加静态IP地址这一行：“IPADDR="10.0.1.1"”。
- en: Then the network mask, `NETMASK="255.255.255.0"`.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 然后网络掩码，“NETMASK="255.255.255.0"”。
- en: And, finally, we make sure that the option `DEVICE` is set to `eth1` and the
    option `ONBOOT` is set to `yes`.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们确保选项“DEVICE”设置为“eth1”，选项“ONBOOT”设置为“yes”。
- en: 'Again, to make sure that this configuration is successfully applied, we need
    to restart the network service:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，为了确保此配置成功应用，我们需要重新启动网络服务：
- en: '[PRE5]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Note
  id: totrans-43
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'If the configuration does not take effect when typing `ifconfig`, to check
    the interfaces'' configuration we need to run this command:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在输入“ifconfig”时配置没有生效，要检查接口的配置，我们需要运行此命令：
- en: '[PRE6]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Now we move on to the configuration of a client, the machine that will be using
    the gateway server. So we need to configure its interface for the LAN network.
    Since we are not limited to one specific client, if we have a graphical interface
    we can just go to the connected interface and enter these configurations:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们继续配置客户端，即将使用网关服务器的机器。因此，我们需要为其LAN网络配置接口。由于我们不限于一个特定的客户端，如果我们有图形界面，我们可以直接转到连接的接口并输入这些配置：
- en: '**IP address**: `10.0.1.2`'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '**IP地址**：“10.0.1.2”'
- en: '**Network Mask**: `255.255.255.0`'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '**网络掩码**：“255.255.255.0”'
- en: '**Gateway**: `10.0.1.1`'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**网关**：“10.0.1.1”'
- en: 'For the DNS server, we will go with Google DNS, which is very reliable:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 对于DNS服务器，我们将选择非常可靠的Google DNS。
- en: '**DNS server**: `8.8.8.8`'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '**DNS服务器**：“8.8.8.8”'
- en: Note
  id: totrans-52
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: It is not an obligation to enter the Google DNS server address. Some sites may
    be blocking it, others may be using their local DNS server. Depending on the need
    and if we don't have any, Google DNS will be fine.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 输入Google DNS服务器地址并不是义务。有些网站可能会阻止它，其他网站可能会使用他们的本地DNS服务器。根据需要，如果我们没有任何需求，Google
    DNS就可以了。
- en: If we need to use another CentOS 7 server, we may need to do the same steps
    during the static server configuration.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们需要使用另一台CentOS 7服务器，可能需要在静态服务器配置期间执行相同的步骤。
- en: 'We edit the configuration file of the interface:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们编辑接口的配置文件：
- en: '[PRE7]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'By changing the configuration protocol to `static` and add these two lines:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 通过将配置协议更改为“static”并添加这两行：
- en: '[PRE8]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: We also sure that `ONBOOT=yes` and `DEVICE=eth0`.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还确保“ONBOOT=yes”和“DEVICE=eth0”。
- en: 'To use the Google DNS server, we can edit the `/etc/resolv.conf` file:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用Google DNS服务器，我们可以编辑“/etc/resolv.conf”文件：
- en: '[PRE9]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'To add these two lines:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 添加这两行：
- en: '[PRE10]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Then restart the network service:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 然后重新启动网络服务：
- en: '[PRE11]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'We go back to our Gateway server, then start doing the configuration of the
    IP forwarding. First, we need to enable it for the IPv4 packet forwarding:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 我们回到我们的网关服务器，然后开始进行IP转发的配置。首先，我们需要启用IPv4数据包转发：
- en: '[PRE12]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'To hold maintain configuration on every system restart we need to make a modification
    to the IP forwarding configuration file:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在每次系统重启时保持配置，我们需要对IP转发配置文件进行修改：
- en: '[PRE13]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Then add this line and save:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 然后添加这一行并保存：
- en: '[PRE14]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'To reload the configuration made to the file, we need to run this command:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 要重新加载对文件所做的配置，我们需要运行此命令：
- en: '[PRE15]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The current configuration can be visualized via this command:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过此命令可视化当前配置：
- en: '[PRE16]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Now we go to enabling NAT configuration. Using `iptables`, we need to enable
    the IP masquerading. `firewalld` is a service that allows easy configuration of
    `iptables` easily. To use `firewalld` we will rely on the command `firewalld-cmd`,
    then we enter the required configuration.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们开始启用NAT配置。使用“iptables”，我们需要启用IP伪装。 “firewalld”是一个允许轻松配置“iptables”的服务。要使用“firewalld”，我们将依赖于命令“firewalld-cmd”，然后输入所需的配置。
- en: 'We start by configuring the NAT in `firewalld`. First, we will set the LAN
    network as a trusted zone:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先在“firewalld”中配置NAT。首先，我们将LAN网络设置为受信任的区域：
- en: '[PRE17]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Then we integrate the LAN interface `eth1` to a zone called `internal`:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们将LAN接口“eth1”集成到一个名为“internal”的区域中：
- en: '[PRE18]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'We do the same for the WAN interface `eth0` to a zone called `external`:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也对WAN接口“eth0”进行相似的操作，将其设置为名为“external”的区域：
- en: '[PRE19]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Then we configure the `masquerade` option for the external WAN:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们为外部WAN配置“masquerade”选项：
- en: '[PRE20]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'For an optional DNS configuration, we can make it pass through the `internal`
    zone:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 对于可选的DNS配置，我们可以通过“internal”区域进行传递：
- en: '[PRE21]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Before we finish, we make sure that the NAT is configured to pass through traffic
    from the LAN to the WAN interface:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在完成之前，我们确保NAT已配置为将LAN上的流量传递到WAN接口：
- en: '[PRE22]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Finally, we need to reload the firewall service so that the configuration takes
    effect:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要重新加载防火墙服务，以使配置生效：
- en: '[PRE23]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'After this point, the Gateway server should be running well. To test the configuration,
    we need to ping any website from any machine located on the LAN network:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在此点之后，网关服务器应该正常运行。要测试配置，我们需要从LAN网络上的任何机器上ping任何网站：
- en: '[PRE24]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Then we need to see the following kind of output to know that our Gateway server
    is working correctly:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要查看以下类型的输出，以知道我们的网关服务器是否正常工作：
- en: '[PRE25]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: We would recommend the use of a DHCP server to set up the configuration for
    all the clients if we are using a desktop machine and are not in need of static
    configuration. Even for a more advanced DHCP configuration we can associate specific
    IP addresses to the servers via their interfaces' MAC address.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们使用台式机并且不需要静态配置，我们建议使用DHCP服务器为所有客户端设置配置。即使对于更高级的DHCP配置，我们也可以通过它们的接口MAC地址将特定IP地址与服务器关联起来。
- en: Setting up a VPN server
  id: totrans-96
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置VPN服务器
- en: OpenVPN is an opensource software application that implements **virtual private
    network** (**VPN**) techniques for creating secure point-to-point or site-to-site
    connections in routed or bridged configurations and remote access facilities.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: OpenVPN是一种开源软件应用程序，实现了**虚拟专用网络**（**VPN**）技术，用于创建路由或桥接配置和远程访问设施中的安全点对点或站点到站点连接。
- en: As a requirement for this section, we are in need for a CentOS 7 server with
    the capacity to install some packages and make some changes to the network configuration
    files (internet and root access). At a later stage, we may need to create some
    authentication certificates. We will cover how to do that too.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 作为本节的要求，我们需要一个CentOS 7服务器，具有安装一些软件包和对网络配置文件（Internet和root访问）进行一些更改的能力。在以后的阶段，我们可能需要创建一些身份验证证书。我们也将介绍如何执行此操作。
- en: 'First, we will start with the installation of the required packages. And before
    we do that, OpenVPN isn''t available in the default CentOS standard repository,
    so we need to add the EPEL repository that contains the popular additional packages:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将开始安装所需的软件包。在执行此操作之前，OpenVPN不在默认的CentOS标准存储库中，因此我们需要添加包含流行附加软件包的EPEL存储库：
- en: '[PRE26]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'After this command is done, we can start OpenVPN. We also need to install an
    RSA generator to generate the SSL key pairs that we will use to secure the VPN
    connection:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此命令后，我们可以启动OpenVPN。我们还需要安装RSA生成器来生成我们将用于保护VPN连接的SSL密钥对：
- en: '[PRE27]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: By the end of the execution of the command, the OpenVPN and the easy-rsa are
    successfully installed on the system.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行该命令结束时，OpenVPN和easy-rsa已成功安装在系统上。
- en: 'Now we move to the configuration part of the OpenVPN. Since OpenVPN has an
    example of a configuration file in its documentation directory, we are going to
    use the `server.conf` file as our initial configuration and build on that. To
    do so, we need to copy it to the `/etc` directory:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们转移到OpenVPN的配置部分。由于OpenVPN在其文档目录中有一个配置文件的示例，我们将使用`server.conf`文件作为我们的初始配置并在此基础上构建。为此，我们需要将其复制到`/etc`目录：
- en: '[PRE28]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Then we can edit it to suit our needs:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们可以编辑它以满足我们的需求：
- en: '[PRE29]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: After opening the file, we need to remove some commented lines and make some
    little changes as follows (using `nano` to look for the lines to change, we should
    use *Ctrl* + *w*, then type the word we are looking for).
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 打开文件后，我们需要删除一些注释行并进行一些小的更改，如下所示（使用`nano`查找要更改的行，我们应该使用*Ctrl* + *w*，然后输入我们要查找的单词）。
- en: First, we need to set the RSA encryption length to be 2048 bytes, so we need
    to make sure that the option line that indicates the filename is going to be used
    like this.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要将RSA加密长度设置为2048字节，因此我们需要确保指示文件名的选项行将以以下方式使用。
- en: '[PRE30]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Note
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Some articles suggest that a DH key with 1024 bytes is vulnerable, so we recommend
    using a DH key with 2048 bytes or more for better security. The vulnerability
    is called Logjam and for more details, you can read more about it at: [http://sourceforge.net/p/openvpn/mailman/message/34132515/](http://sourceforge.net/p/openvpn/mailman/message/34132515/)'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 一些文章建议使用1024字节的DH密钥是有漏洞的，因此我们建议使用2048字节或更多的DH密钥以获得更好的安全性。这种漏洞称为Logjam，有关更多详细信息，您可以在以下网址阅读更多内容：[http://sourceforge.net/p/openvpn/mailman/message/34132515/](http://sourceforge.net/p/openvpn/mailman/message/34132515/)
- en: Then we need to uncomment the line `push redirect-gateway def1 bypass-dhcp"",`
    which tells the client to redirect all traffic to OpenVPN.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要取消注释`push redirect-gateway def1 bypass-dhcp""`这一行，告诉客户端将所有流量重定向到OpenVPN。
- en: 'Next we need to set a DNS server to the client, since it will not be able to
    use the one provided by the ISP. Again, I will go with the Google DNS `8.8.8.8`
    and `8.8.4.4`:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要为客户端设置DNS服务器，因为它将无法使用ISP提供的DNS。同样，我将使用Google DNS `8.8.8.8`和`8.8.4.4`：
- en: '[PRE31]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Finally, to lead a smooth run for the OpenVPN, we need to run it through no
    privileges first. To do so we need to run it through a user and group called `nobody`:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，为了使OpenVPN顺利运行，我们需要首先以无特权运行它。为此，我们需要通过名为`nobody`的用户和组运行它：
- en: '[PRE32]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Then save the file and exit.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 然后保存文件并退出。
- en: 'By now, the configuration part of the OpenVPN service is done. We''ll move
    on to the certificate and key generation part, where we need to create some script
    using Easy RSA. We start by creating a directory of Easy RSA in the configuration
    folder of the OpenVPN:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，OpenVPN服务的配置部分已经完成。我们将继续进行证书和密钥生成部分，需要使用Easy RSA创建一些脚本。我们首先需要在OpenVPN的配置文件夹中创建一个Easy
    RSA的目录：
- en: '[PRE33]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Then we need to populate the folder with the predefined scripts of Easy RSA
    that generate keys and certificates:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要使用Easy RSA的预定义脚本填充文件夹，以生成密钥和证书：
- en: '[PRE34]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'To perform an easy VPN setup, we will start by typing our information once
    and for all in the `vars` file:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 为了执行简单的VPN设置，我们将首先在`vars`文件中输入我们的信息一次并永久保存：
- en: '[PRE35]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'We are basically changing the lines that start with `export KEY_` to update
    their values to match the ones of the organization desired, and at some point
    we may need to uncomment them:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 我们基本上正在更改以`export KEY_`开头的行，以更新它们的值以匹配所需组织的值，并且在某些时候我们可能需要取消注释它们：
- en: '[PRE36]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Then save the file and exit.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 然后保存文件并退出。
- en: The field `KEY_NAME` represents the name of the files `.key` and `.crt`.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '`KEY_NAME`字段代表文件`.key`和`.crt`的名称。'
- en: The field `KEY_CN` is where we should put the domain or the sub-domain that
    leads to our VPN server.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '`KEY_CN`字段是我们应该放置指向VPN服务器的域或子域的地方。'
- en: 'To make sure that no issues arise during our use of the OpenSSL configuration
    file due to a version update, we will remove the version from the filename:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保在使用OpenSSL配置文件时不会出现由于版本更新而引起的问题，我们将从文件名中删除版本：
- en: '[PRE37]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Now we move to the creation of certificate and keys creation. We need to be
    in the `/etc/openvpn/easy-ras` folder to run the scripts:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们转到证书和密钥的创建。我们需要在`/etc/openvpn/easy-ras`文件夹中运行脚本：
- en: '[PRE38]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Then we start the source in the variables:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在变量中启动源：
- en: '[PRE39]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'After that we clean any old generated keys and certificates:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，清除任何旧生成的密钥和证书：
- en: '[PRE40]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Then we build the certification authority, which has its information already
    defined as default options:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们构建认证机构，其信息已经定义为默认选项：
- en: '[PRE41]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Now we create the keys and certificates for our VPN server. We skip the challenge
    password phase by pressing *Enter*. Then we make sure to validate by typing `Y`
    for the last step:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们为VPN服务器创建密钥和证书。我们通过按*Enter*跳过挑战密码阶段。然后我们确保通过在最后一步输入`Y`来验证：
- en: '[PRE42]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'When running this command, we should see the following message if it is running
    correctly:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此命令时，如果它运行正确，我们应该看到以下消息：
- en: '[PRE43]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Also, we need to generate the Diffie-Hellman (`dh`) key exchange. This may
    take a while longer, as compared to the other commands:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们需要生成Diffie-Hellman（`dh`）密钥交换。与其他命令相比，这可能需要更长的时间：
- en: '[PRE44]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'After finishing this step, we will have all our keys and certificates ready.
    We need to copy them so they can be used by our OpenVPN service:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此步骤后，我们将准备好所有的密钥和证书。我们需要复制它们，以便它们可以被我们的OpenVPN服务使用：
- en: '[PRE45]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: All the clients of this VPN server need certificates to get authenticated. So
    we need to share those keys and certificates with the desired clients. It is best
    to generate separate keys for each client that needs to connect.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 这个VPN服务器的所有客户端都需要证书进行身份验证。因此，我们需要与所需的客户端共享这些密钥和证书。最好为需要连接的每个客户端生成单独的密钥。
- en: 'For this example, we will only generate keys for one client:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们只为一个客户端生成密钥：
- en: '[PRE46]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: With this step, we can say that we are done with the certificates.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这一步，我们可以说我们已经完成了证书。
- en: Now for the routing step. We will do the routing configuration using `iptables`
    directly without the need of using `firewalld`.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是路由步骤。我们将使用`iptables`直接进行路由配置，而无需使用`firewalld`。
- en: 'If we want to only use the `iptables` configuration, we will first make sure
    that its services are installed:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们只想使用`iptables`配置，我们首先要确保其服务已安装：
- en: '[PRE47]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Then disable the `firewalld` service:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 然后禁用`firewalld`服务：
- en: '[PRE48]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Then we add the rule to `iptables` that does the forwarding of the routing
    to the OpenVPN subnet:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们添加规则到`iptables`，进行路由到OpenVPN子网的转发：
- en: '[PRE49]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Then we need to enable IP forwarding in `sysctl` by editing the file `sysctl.conf`:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要通过编辑文件`sysctl.conf`在`sysctl`中启用IP转发：
- en: '[PRE50]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Then add the following line:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 然后添加以下行：
- en: '[PRE51]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Finally, restart the network service so this configuration can take effect:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，重新启动网络服务，使此配置生效：
- en: '[PRE52]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'We can now start the OpenVPN service, but before we do this, we need to add
    it to `systemctl`:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以启动OpenVPN服务，但在这之前，我们需要将其添加到`systemctl`：
- en: '[PRE53]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Then we can start the service:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们可以启动服务：
- en: '[PRE54]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'If we want to check whether the service is running, we can use the command
    `systemctl`:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要检查服务是否正在运行，可以使用命令`systemctl`：
- en: '[PRE55]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'We should see this message with the activity status `active (running)`:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该看到这条消息的活动状态为`active (running)`：
- en: '[PRE56]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'After this check, we can say that our VPN server configuration is done. We
    can now go to the client configuration regardless of the operating system. We
    need to copy the certificates and the keys from the server. We need to copy these
    three files:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 经过这个检查，我们可以说我们的VPN服务器配置已经完成。现在我们可以去客户端配置，不论操作系统如何。我们需要从服务器复制证书和密钥。我们需要复制这三个文件：
- en: '[PRE57]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: There are a variety of tools to copy these files from the server to any client.
    The easiest one is `scp`, the shell copy command between two Unix machines. For
    Windows machines we can use folder sharing tools such as Samba, or we can use
    another tool equivalent to SCP called **WinSCP**.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 有各种工具可以将这些文件从服务器复制到任何客户端。最简单的是`scp`，这是两台Unix机器之间的shell复制命令。对于Windows机器，我们可以使用文件夹共享工具，如Samba，或者我们可以使用另一个等效于SCP的工具**WinSCP**。
- en: 'From the client machine, we start by copying the desired files:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 从客户端机器开始，我们首先复制所需的文件：
- en: '[PRE58]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'After the copying is done we should create a file, `client.ovpn`, which is
    a configuration file for the OpenVPN client that helps set up the client to get
    connected to the VPN network provided by the server. The file should contain the
    following:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 复制完成后，我们应该创建一个名为`client.ovpn`的文件，这是OpenVPN客户端的配置文件，可以帮助设置客户端连接到服务器提供的VPN网络。文件应包含以下内容：
- en: '[PRE59]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: We need to make sure that the first line contains the name of the client typed
    in the keys and certificate. After this, remote should be the public IP address
    of the server or its domain address. In the end, the correct location of the three
    client files should be copied from the server.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要确保第一行包含在密钥和证书中输入的客户端名称。之后，远程应该是服务器的公共IP地址或其域地址。最后，应该从服务器复制三个客户端文件的正确位置。
- en: The file `client.ovpn` could be used with multiple VPN clients (OpenVPN client
    for Linux, Tunnelblick for MAC OS X, OpenVPN Community Edition Binaries for Windows)
    to get them configured to connect to the VPN.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 文件`client.ovpn`可以与多个VPN客户端（Linux的OpenVPN客户端，MAC OS X的Tunnelblick，Windows的OpenVPN
    Community Edition Binaries）一起使用，以便配置它们连接到VPN。
- en: 'On a CentOS 7 server we will use the OpenVPN client. To use this configuration,
    we use the command `openvpn --config`:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在CentOS 7服务器上，我们将使用OpenVPN客户端。要使用此配置，我们使用命令`openvpn --config`：
- en: '[PRE60]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: By getting the client connected to the VPN server, we can confirm that our VPN
    service is working well.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 通过将客户端连接到VPN服务器，我们可以确认我们的VPN服务运行良好。
- en: Implementing BIND as a DNS server
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实施BIND作为DNS服务器
- en: BIND is the most widely used open source name server application. It helps implement
    the **Domain Name System** (**DNS**) protocols for the Internet. It provides a
    robust and stable platform on which to build a distributed computing system, with
    knowledge that those systems are fully compliant with published DNS standards.
    It helps resolve queries about names by sending those questions to the appropriate
    servers and responding appropriately to the servers' replies.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: BIND是最广泛使用的开源名称服务器应用程序。它帮助实现互联网的**域名系统**（**DNS**）协议。它提供了一个强大而稳定的平台，用于构建分布式计算系统，确保这些系统完全符合已发布的DNS标准。它通过将这些问题发送到适当的服务器并对服务器的回复做出适当的响应来帮助解决有关名称的查询。
- en: As an example of the implementation of BIND, we will set up an internal DNS
    server to resolve some public IP addresses inside the network to simplify the
    mapping inside a large environment.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 作为BIND实现的示例，我们将设置一个内部DNS服务器来解析网络内部的一些公共IP地址，以简化大型环境中的映射。
- en: 'We need the following prerequisites to implement BIND:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要以下先决条件来实现BIND：
- en: One server to have BIND installed and configured on it
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个服务器上安装和配置BIND
- en: Two machines, either servers or simple workstations, to test the DNS service
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 两台机器，可以是服务器也可以是简单的工作站，用来测试DNS服务
- en: Root privilege to be able to set up BIND and configure the network to resolve
    from our internal DNS server
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 需要root权限才能设置BIND并配置网络以从我们的内部DNS服务器解析
- en: 'First, we will start by installing BIND on our DNS server:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将在我们的DNS服务器上安装BIND：
- en: '[PRE61]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: After getting BIND installed, we start configuring our DNS server.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完BIND后，我们开始配置我们的DNS服务器。
- en: 'The BIND service has a bunch of configuration files that get included from
    its main configuration file, `named.conf`, which is associated with the process
    that BIND runs:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: BIND服务有一堆配置文件，这些文件从它的主配置文件`named.conf`中包含，这个文件与BIND运行的进程相关联：
- en: '[PRE62]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'At the beginning of the file we need to add a block just before the `options`
    block, the `acl "trusted"` block, where we are going to define the list of clients
    allowed to do recursive DNS queries. Since our server will be serving two subnets
    we will add its two addresses:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 在文件的开头，我们需要在`options`块之前添加一个块，名为`acl "trusted"`，在这里我们将定义允许进行递归DNS查询的客户端列表。由于我们的服务器将为两个子网提供服务，我们将添加它的两个地址：
- en: '[PRE63]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'We need to make some modifications inside the `options`. Since we are using
    IPv4 only, we need to comment the IPv6 line:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要在`options`内进行一些修改。由于我们只使用IPv4，我们需要注释掉IPv6行：
- en: '[PRE64]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'And to make sure that the DNS server will listen in both subnets, we will add
    the following two addresses:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保DNS服务器将在两个子网中监听，我们将添加以下两个地址：
- en: '[PRE65]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: With the IP address `192.168.8.12` as the IP address of the DNS server.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 使用IP地址`192.168.8.12`作为DNS服务器的IP地址。
- en: 'Then we change the line `allow-query` from pointing to the `localhost` to point
    to the `trusted` clients ACL:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们将`allow-query`行从指向`localhost`改为指向`trusted`客户端ACL：
- en: '[PRE66]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: Note
  id: totrans-206
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'If we don''t fully rely on our DNS server to respond to all queries, we can
    use a secondary DNS server by typing this command inside the `options`:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们不完全依赖我们的DNS服务器来响应所有查询，我们可以通过在`options`中输入以下命令来使用辅助DNS服务器：
- en: '[PRE67]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'And finally, at the end of the file we need to add the line that includes the
    local file configuration:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，在文件的末尾，我们需要添加包含本地文件配置的行：
- en: '[PRE68]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'Then we save the file and move to the local file configuration to set the DNS
    zones:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们保存文件，转到本地文件配置以设置DNS区域：
- en: '[PRE69]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: The file will be empty since we are the ones who created it, so we need to fill
    it with the necessary zones.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们是创建它的人，所以文件将是空的，因此我们需要用必要的区域填充它。
- en: 'First, we will add the forward zone. To do so we need to enter the following
    lines:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将添加正向区域。为此，我们需要输入以下行：
- en: '[PRE70]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'Now we will add the Reverse zone. Since our first LAN is at `192.168.8.0`/`24`
    we start with the Reverse zone name, which will be `8.168.192`, the reverse of
    `192.168.8`:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将添加反向区域。由于我们的第一个LAN在`192.168.8.0/24`，我们从反向区域名称开始，它将是`8.168.192`，即`192.168.8`的反向：
- en: '[PRE71]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'Now we do same with our second LAN on `10.0.1.0/24`, so its reverse zone name
    `1.0.10`:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们对`10.0.1.0/24`上的第二个LAN做同样的操作，所以它的反向区域名称是`1.0.10`：
- en: '[PRE72]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: We need to do the same thing for all the subnets in the network, then we save
    the file.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要对网络中的所有子网做同样的操作，然后保存文件。
- en: After finishing with setting the zones and the Reverse zones, we move on to
    create and fill up their corresponding files.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 完成设置区域和反向区域后，我们继续创建并填写它们对应的文件。
- en: 'We start by creating the forwarding file, which is where we define DNS records
    for forward DNS lookups. We create the folder in which we are going to put all
    the zone files. Then we start creating our zone files inside it:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先创建转发文件，这是我们为正向DNS查找定义DNS记录的地方。我们创建一个文件夹，用来放置所有区域文件。然后我们开始在其中创建我们的区域文件：
- en: '[PRE73]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 'Then we create the Forward zone file and fill it up:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们创建正向区域文件并填写它：
- en: '[PRE74]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'We need to add the following lines. Starting with the SOA record by adding
    the domain of the DNS server, we need to increment the serial value every time
    we edit the zone file so the change can take effect after restarting the service:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要添加以下行。首先是SOA记录，通过添加DNS服务器的域名，我们需要每次编辑区域文件时增加序列值，以便在重新启动服务后生效：
- en: '[PRE75]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'For the serial, we can make it more understandable by making it look like a
    `date: {yyyymmmdddss} yyyy = year`, `mm = month`, `dd = day`, `ss = a` sequence
    number.'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 对于序列号，我们可以通过使其看起来像一个`日期：{yyyymmmdddss} yyyy = 年`，`mm = 月`，`dd = 日`，`ss = 一个`序列号来使其更易理解。
- en: 'Then we add the name server records:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们添加名称服务器记录：
- en: '[PRE76]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'Then we add the `A records` for the hosts that belong to this zone, which will
    include every machine, either a server or a workstation, which we want to address
    with our DNS server:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们为属于该区域的主机添加`A记录`，其中将包括我们希望使用我们的DNS服务器寻址的每台机器，无论是服务器还是工作站：
- en: '[PRE77]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: Now we create the Reverse zone files. It is where we define DNS PTR records
    for reverse DNS lookups.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们创建反向区域文件。这是我们为反向DNS查找定义DNS PTR记录的地方。
- en: 'We start with the first Reverse zone `db.1.0.10`:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从第一个反向区域`db.1.0.10`开始：
- en: '[PRE78]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'As we have done for the first zone file, we need to define the SOA domain:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 与第一个区域文件一样，我们需要定义SOA域：
- en: '[PRE79]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'Then the name-server records:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 然后是名称服务器记录：
- en: '[PRE80]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'Finally, we add the PTR records that list all the machines with IP addresses
    that are on the subnet of the zone file:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们添加列出子网区域上具有IP地址的所有机器的PTR记录：
- en: '[PRE81]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'Then we do the second Reverse zone file `db.8.168.192`:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们做第二个反向区域文件`db.8.168.192`：
- en: '[PRE82]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'We add the SOA domain:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 我们添加SOA域：
- en: '[PRE83]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 'Then we add the name-server records:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们添加名称服务器记录：
- en: '[PRE84]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'And we finish with the PTR records:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 最后我们完成PTR记录：
- en: '[PRE85]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: 'We save all files. And we check the BIND configuration by checking the syntax
    of the files `named.conf*`:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 我们保存所有文件。然后通过检查文件`named.conf*`的语法来检查BIND配置：
- en: '[PRE86]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: If no errors are shown, it means that all configuration files are well written
    with no syntax mistakes. Otherwise, try to track the errors and fix them using
    the error message.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有显示错误，这意味着所有配置文件都写得很好，没有语法错误。否则，请尝试跟踪错误并使用错误消息进行修复。
- en: 'Then check the zone files using the command `named-checkzone` in each zone
    if we have many:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 然后使用命令`named-checkzone`在每个区域中检查区域文件（如果有多个）：
- en: '[PRE87]'
  id: totrans-254
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: 'If the zone is successfully set we should see this kind of message:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 如果区域成功设置，我们应该看到这种消息：
- en: '[PRE88]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: 'We should see the same thing for the Reverse zones:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该看到反向区域的相同内容：
- en: '[PRE89]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: 'We should also see the same message if everything is well configured. Otherwise,
    we need to troubleshoot the following error message:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切配置正确，我们也应该看到相同的消息。否则，我们需要排除以下错误消息：
- en: '[PRE90]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: After checking all configurations, we are now ready to start the BIND service.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 在检查所有配置后，我们现在准备启动BIND服务。
- en: 'And just before that we need to make sure that our firewall allows us to do
    so. We need to open port 53 using the `Firewalld` service:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 在此之前，我们需要确保我们的防火墙允许我们这样做。我们需要使用`Firewalld`服务打开端口53：
- en: '[PRE91]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: 'After reloading the Firewall, the change will take effect and now we can start
    the DNS service:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 重新加载防火墙后，更改将生效，现在我们可以启动DNS服务：
- en: '[PRE92]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: 'Then we enable it so it can start at the system boot:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 然后启用它，以便它可以在系统启动时启动：
- en: '[PRE93]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: With this step the DNS server is now ready to receive and respond to DNS queries.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这一步，DNS服务器现在已准备好接收和响应DNS查询。
- en: 'Let''s now do a client configuration to test the DNS server. On a Linux server,
    we only need to modify the `resolv.conf` file by adding the name-server IP address
    and the search domain:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们进行客户端配置以测试DNS服务器。在Linux服务器上，我们只需要通过添加名称服务器IP地址和搜索域来修改`resolv.conf`文件：
- en: '[PRE94]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: 'By adding the following lines, then saving:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 通过添加以下行，然后保存：
- en: '[PRE95]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: 'Now we can start the test. We will use a simple ping and the command `nslookup`.
    The ping will only test whether we can reach the machine giving its domain name:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以开始测试。我们将使用简单的ping和命令`nslookup`。ping只会测试我们是否能够通过其域名到达该机器：
- en: '[PRE96]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: 'There are also other tools that can give more detailed results when testing
    the DNS service such as `dig` and `nslookup` to do a simple DNS lookup:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 还有其他工具可以在测试DNS服务时提供更详细的结果，例如`dig`和`nslookup`进行简单的DNS查找：
- en: '[PRE97]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: 'After running the DNS lookup, we will try a reverse DNS lookup:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 运行DNS查找后，我们将尝试进行反向DNS查找：
- en: '[PRE98]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: After running all these tests, we should check whether all the values are `true`,
    to confirm that we have a fully-working DNS server.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行所有这些测试后，我们应该检查所有值是否为`true`，以确认我们拥有一个完全正常工作的DNS服务器。
- en: Setting up a web server using Apache-MySQL-PHP
  id: totrans-280
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Apache-MySQL-PHP设置Web服务器
- en: 'One of the common services that a Linux server offers is being a web server,
    to give its user the capacity to host their web content in a secure, fast, and
    reliable location, browsable from all over the world. In this section, we are
    going to show you how to set up a reliable web server on a CentOS 7 server with
    some security modules that will secure the website, and we will do an implementation
    of a **Content Management System** (**CMS**): Joomla.'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: Linux服务器提供的常见服务之一是作为Web服务器，使其用户能够在安全、快速和可靠的位置托管其Web内容，可从世界各地浏览。在本节中，我们将向您展示如何在CentOS
    7服务器上设置可靠的Web服务器，并使用一些安全模块来保护网站，并实施**内容管理系统**（**CMS**）：Joomla。
- en: Our web server will host dynamic websites and web applications. So we will install
    a LAMP (Stack) server, represent a Linux operating system with the Apache web
    server, where the site data will be stored in MySQL databases (using MariaDB,
    which is a community-developed fork of the MySQL relational database management
    system intended to remain free under the GNU GPL), and dynamic content processed
    by PHP.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的Web服务器将托管动态网站和Web应用程序。因此，我们将安装一个LAMP（堆栈）服务器，代表一个具有Apache Web服务器的Linux操作系统，其中站点数据将存储在MySQL数据库中（使用MariaDB，这是MySQL关系数据库管理系统的社区开发分支，旨在在GNU
    GPL下保持免费），并且动态内容由PHP处理。
- en: 'We will start with the installation of the Apache web server, which is the
    most popular web server in the world:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从安装Apache Web服务器开始，这是世界上最流行的Web服务器：
- en: '[PRE99]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: 'By the end of the command, the Apache web server is successfully installed.
    We can start it using the command `systemctl`:'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 在命令结束时，Apache Web服务器已成功安装。我们可以使用`systemctl`命令启动它：
- en: '[PRE100]'
  id: totrans-286
  prefs: []
  type: TYPE_PRE
  zh: '[PRE100]'
- en: 'Before testing the service, we need to make sure that the server firewall allows
    web access. So, we need to open the ports that Apache is serving from, HTTP (80)
    and HTTPS (443):'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 在测试服务之前，我们需要确保服务器防火墙允许Web访问。因此，我们需要打开Apache正在提供的端口，HTTP（80）和HTTPS（443）：
- en: '[PRE101]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE101]'
- en: 'We can now test the web server by typing in any other machine web browser inside
    the same network IP address of the server (`http://Server_IP_Address`). We should
    see something like this:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以通过在同一网络内的任何其他机器的Web浏览器中键入服务器的IP地址（`http://Server_IP_Address`）来测试Web服务器。我们应该看到类似于这样的东西：
- en: '![Setting up a web server using Apache-MySQL-PHP](img/B04674_03_02.jpg)'
  id: totrans-290
  prefs: []
  type: TYPE_IMG
  zh: '![使用Apache-MySQL-PHP设置Web服务器](img/B04674_03_02.jpg)'
- en: 'After making sure that the service is working fine, we need to add it to the
    system startup services:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 确认服务正常运行后，我们需要将其添加到系统启动服务中：
- en: '[PRE102]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE102]'
- en: Now we will set up two virtual hosts on Apache to show Apache's capacity to
    support multiple websites.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将在Apache上设置两个虚拟主机，以展示Apache支持多个网站的能力。
- en: 'For the next part, we will make a number of changes to the Apache configuration
    file, so we will create a backup file:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将对Apache配置文件进行一些更改，因此我们将创建一个备份文件：
- en: '[PRE103]'
  id: totrans-295
  prefs: []
  type: TYPE_PRE
  zh: '[PRE103]'
- en: Apache has the capacity to separate its functionality and components into units
    that can be customized and configured independently. These units are called **virtual
    hosts**. Virtual hosts allow us to host multiple domains. Each configured domain
    will direct the visitors to a specific folder specified to the website, which
    holds its information. This technique is extendable as long as the server can
    handle the traffic attracted by the websites stored inside it.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: Apache有能力将其功能和组件分离为可以独立定制和配置的单元。这些单元称为**虚拟主机**。虚拟主机允许我们托管多个域。每个配置的域将访问者引导到指定给网站的特定文件夹，其中包含其信息。只要服务器能够处理吸引网站的流量，这种技术就是可扩展的。
- en: 'First, we need to make the folders where we are going to store our websites.
    The directory `/var/www/` is our web server root directory:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要创建我们将存储网站的文件夹。目录`/var/www/`是我们的Web服务器根目录：
- en: '[PRE104]'
  id: totrans-298
  prefs: []
  type: TYPE_PRE
  zh: '[PRE104]'
- en: 'Then we grant these folders permission to be accessible by changing the ownership
    from the root (the user who just created them) to the `$USER` (the user that is
    currently logged in):'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们授予这些文件夹权限，通过将所有权从根用户（刚刚创建它们的用户）更改为`$USER`（当前登录的用户）：
- en: '[PRE105]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE105]'
- en: 'To fully test the virtual hosts, we need to create an example HTML page to
    be opened at the client web browser:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 为了完全测试虚拟主机，我们需要创建一个示例HTML页面，以在客户端Web浏览器中打开：
- en: '[PRE106]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE106]'
- en: 'Then we add some HTML code to populate the page:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们添加一些HTML代码来填充页面：
- en: '[PRE107]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE107]'
- en: 'Similarly, for the second host, we need to create the same file with different
    content to tell the difference:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 同样地，对于第二个主机，我们需要创建相同的文件，但内容不同以区分：
- en: '[PRE108]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE108]'
- en: 'And then we put in the following HTML code:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们放入以下HTML代码：
- en: '[PRE109]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE109]'
- en: 'Now we need to create the virtual host files in the Apache configuration folder.
    We start by creating the folders where we need to put our files:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们需要在Apache配置文件夹中创建虚拟主机文件。我们首先创建需要放置文件的文件夹：
- en: '[PRE110]'
  id: totrans-310
  prefs: []
  type: TYPE_PRE
  zh: '[PRE110]'
- en: Then we need to tell the Apache service to use the configuration provided at
    the `sites-enabled` directory by editing the Apache main configuration file. This
    configuration can also be obtained as the configuration directory `/etc/httpd/conf.d`.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要告诉Apache服务使用`sites-enabled`目录中提供的配置，方法是编辑Apache主配置文件。此配置也可以作为配置目录`/etc/httpd/conf.d`获得。
- en: '[PRE111]'
  id: totrans-312
  prefs: []
  type: TYPE_PRE
  zh: '[PRE111]'
- en: 'Then we add the following line to the end of the file:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在文件末尾添加以下行：
- en: '[PRE112]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE112]'
- en: 'We save the file, then we move to the virtual host file creation in the folder
    `sites-available`. The file should always end with `.conf` so the Apache service
    can use it:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 我们保存文件，然后移动到`sites-available`文件夹中创建虚拟主机文件。文件名应该以`.conf`结尾，这样Apache服务才能使用它：
- en: '[PRE113]'
  id: totrans-316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE113]'
- en: 'Then we put the following configuration inside it:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在其中放入以下配置：
- en: '[PRE114]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE114]'
- en: 'We save the file, and then do the same thing for the second virtual host:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 我们保存文件，然后对第二个虚拟主机做同样的操作：
- en: '[PRE115]'
  id: totrans-320
  prefs: []
  type: TYPE_PRE
  zh: '[PRE115]'
- en: 'And we put the following commands inside it:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在其中放入以下命令：
- en: '[PRE116]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE116]'
- en: 'After configuring both sites, we can now activate the Virtual Hosts to be usable:'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置两个站点之后，我们现在可以激活虚拟主机以供使用：
- en: '[PRE117]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE117]'
- en: 'To make sure that all the configurations we have done will be effected, we
    need to restart the Apache service by using either of these commands:'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保我们所做的所有配置都会生效，我们需要使用以下命令之一重新启动Apache服务：
- en: '[PRE118]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE118]'
- en: Note
  id: totrans-327
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'If we ever get any error related to our server host name, try to use this command
    to change it and get rid of the error:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们遇到与服务器主机名相关的任何错误，请尝试使用此命令进行更改并消除错误：
- en: '[PRE119]'
  id: totrans-329
  prefs: []
  type: TYPE_PRE
  zh: '[PRE119]'
- en: 'In our case, those domains are not public and they are not defined by any DNS
    server. So we can either add them to our local DNS server or we can just add them
    to the `/etc/hosts` file in our client machine (the machine where we are going
    to open the web browser). This step is only to do the test. Usually we should
    define them with the DNS server of the ISP or at the local DNS server:'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的情况下，这些域名不是公共的，也没有被任何DNS服务器定义。因此，我们可以将它们添加到我们的本地DNS服务器，或者只需将它们添加到我们客户端机器（我们将在其中打开Web浏览器的机器）的`/etc/hosts`文件中。此步骤仅用于测试。通常，我们应该在ISP的DNS服务器或本地DNS服务器上定义它们：
- en: '[PRE120]'
  id: totrans-331
  prefs: []
  type: TYPE_PRE
  zh: '[PRE120]'
- en: 'Then we add the two lines that associate our web server IP address to the two
    domains that we have created:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们添加两行，将我们的Web服务器IP地址与我们创建的两个域关联起来：
- en: '[PRE121]'
  id: totrans-333
  prefs: []
  type: TYPE_PRE
  zh: '[PRE121]'
- en: 'Then we go to the client web browser and we type the domain in the address
    bar:'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们转到客户端Web浏览器，输入域名到地址栏中：
- en: '[PRE122]'
  id: totrans-335
  prefs: []
  type: TYPE_PRE
  zh: '[PRE122]'
- en: We should see the page associated with the first domain. We do the same thing
    for the second domain. If the test is valid, we confirm that our virtual hosts
    have been created properly.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该看到与第一个域关联的页面。我们对第二个域做同样的操作。如果测试有效，我们确认我们的虚拟主机已正确创建。
- en: 'Now we can move to secure Apache against one of the most common attacks that
    is affect the world''s websites. A brute-force attack or **Distributed Denial
    of Service** (**DDoS**) attack is a kind of attack that sends multiple requests
    to the same web server to overload it and make it unreachable. Now we are going
    to set up modules that help secure our web server from the kinds of attack. `Mod_Security`
    and `Mod_evasive` are the basic modules that will help detect and prevent intrusions,
    and help reinforce the web server protection against brute-force or DDoS attacks.
    First, we need to install the modules using the package manager. We require that
    the system already has the EPEL repository installed:'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以开始保护Apache免受影响世界网站的最常见攻击之一。暴力攻击或**分布式拒绝服务**（**DDoS**）攻击是一种向同一Web服务器发送多个请求以使其超载并使其无法访问的攻击。现在我们将设置模块来帮助保护我们的Web服务器免受此类攻击。`Mod_Security`和`Mod_evasive`是基本模块，将帮助检测和防止入侵，并帮助加强Web服务器对暴力或DDoS攻击的保护。首先，我们需要使用软件包管理器安装这些模块。我们要求系统已经安装了EPEL存储库：
- en: '[PRE123]'
  id: totrans-338
  prefs: []
  type: TYPE_PRE
  zh: '[PRE123]'
- en: 'So to verify that the installation is complete we need to see whether there
    are two files that have been created in the `/etc/httpd/conf.d/` folder:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，为了验证安装是否完成，我们需要查看`/etc/httpd/conf.d/`文件夹中是否创建了两个文件：
- en: '[PRE124]'
  id: totrans-340
  prefs: []
  type: TYPE_PRE
  zh: '[PRE124]'
- en: 'To make sure that Apache loads these two modules when it starts, we need to
    add some configuration options to the two configuration files, which have been
    created after the installation:'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保Apache在启动时加载这两个模块，我们需要向两个配置文件添加一些配置选项，这些选项在安装后已经创建：
- en: '[PRE125]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE125]'
- en: 'And we add the following lines respectively or we make sure that they are uncommented:'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们分别添加以下行，或者确保它们是取消注释的：
- en: '[PRE126]'
  id: totrans-344
  prefs: []
  type: TYPE_PRE
  zh: '[PRE126]'
- en: 'Now we can restart Apache so the configuration can take effect:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以重新启动Apache，以便配置生效：
- en: '[PRE127]'
  id: totrans-346
  prefs: []
  type: TYPE_PRE
  zh: '[PRE127]'
- en: 'We start by configuring the `Mod_Security` module. So we need to set up a **Core
    Rule Set** (**CRS**). We will download a free CRS (OWASP) to have it configured
    for our web server. We need to create a directory to put the rules inside before
    downloading its package:'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先要配置`Mod_Security`模块。因此，我们需要设置一个**核心规则集**（**CRS**）。我们将下载一个免费的CRS（OWASP）来为我们的Web服务器配置它。在下载其包之前，我们需要创建一个目录来放置规则：
- en: '[PRE128]'
  id: totrans-348
  prefs: []
  type: TYPE_PRE
  zh: '[PRE128]'
- en: 'After that we can extract the package there and we can change its name to an
    appropriate one:'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们可以在那里提取包，并将其名称更改为合适的名称：
- en: '[PRE129]'
  id: totrans-350
  prefs: []
  type: TYPE_PRE
  zh: '[PRE129]'
- en: 'Now we can start configuring the `Mod_Security` module. We need to copy the
    sample file configuration into another file without the .`example` extension:'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以开始配置`Mod_Security`模块。我们需要将示例文件配置复制到另一个没有`.example`扩展名的文件中：
- en: '[PRE130]'
  id: totrans-352
  prefs: []
  type: TYPE_PRE
  zh: '[PRE130]'
- en: 'Then tell Apache to use this module by inserting the following line into the
    Apache main configuration file:'
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 然后告诉Apache使用这个模块，通过将以下行插入到Apache主配置文件中：
- en: '[PRE131]'
  id: totrans-354
  prefs: []
  type: TYPE_PRE
  zh: '[PRE131]'
- en: 'Now we need to create a configuration file in the `/etc/httpd/modsecurity.d/`
    directory to make it easier to upgrade the CRSs if there are newer versions:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们需要在`/etc/httpd/modsecurity.d/`目录中创建一个配置文件，以便在有新版本时更容易升级CRSs：
- en: '[PRE132]'
  id: totrans-356
  prefs: []
  type: TYPE_PRE
  zh: '[PRE132]'
- en: 'After creating the new file, we need to add the following line and save the
    file:'
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 创建新文件后，我们需要添加以下行并保存文件：
- en: '[PRE133]'
  id: totrans-358
  prefs: []
  type: TYPE_PRE
  zh: '[PRE133]'
- en: 'With this step we can say that the `Mod_Security` module is successfully installed
    and configured. We can now move to the next module, `Mod_Evasive`. To configure
    this module, we need to make sure that some lines are not commented in the main
    configuration file:'
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这一步，我们可以说`Mod_Security`模块已经成功安装和配置。现在我们可以转移到下一个模块`Mod_Evasive`。要配置这个模块，我们需要确保主配置文件中的一些行没有被注释掉：
- en: '[PRE134]'
  id: totrans-360
  prefs: []
  type: TYPE_PRE
  zh: '[PRE134]'
- en: 'And then check the `IfModule` options are successfully set:'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 然后检查`IfModule`选项是否成功设置：
- en: '[PRE135]'
  id: totrans-362
  prefs: []
  type: TYPE_PRE
  zh: '[PRE135]'
- en: 'Let''s go through the previous code in some detail:'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们详细了解一下之前的代码：
- en: '`DOSHashTableSize`: This option specifies the size of the hash table used to
    keep track of the IP''s activities'
  id: totrans-364
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DOSHashTableSize`：此选项指定用于跟踪IP活动的哈希表的大小'
- en: '`DOSPageCount`: The legitimate number of identical requests to one resource
    from one IP address'
  id: totrans-365
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DOSPageCount`：来自一个IP地址对一个资源的相同请求的合法数量'
- en: '`DOSSiteCount`: The same as the `DOSPageCount`, but for all the requests that
    can be made'
  id: totrans-366
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DOSSiteCount`：与`DOSPageCount`相同，但适用于所有可能发生的请求'
- en: '`DOSBlockingPeriod`: The blacklisting period for an IP that excludes the options
    on top'
  id: totrans-367
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DOSBlockingPeriod`：排除顶部选项的IP的黑名单期限'
- en: Those numbers are an example of configuration. We can change them as per our
    need.
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 这些数字是配置的示例。我们可以根据需要进行更改。
- en: An extra option that can be useful is `DOSSystemCommand`, which helps to run
    some script that can block IP addresses. To do so we need to add it to the configuration
    file.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 一个额外的有用选项是`DOSSystemCommand`，它有助于运行一些可以阻止IP地址的脚本。为此，我们需要将其添加到配置文件中。
- en: '[PRE136]'
  id: totrans-370
  prefs: []
  type: TYPE_PRE
  zh: '[PRE136]'
- en: 'And we need to create the script at an appropriate location:'
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 并且我们需要在适当的位置创建脚本：
- en: '[PRE137]'
  id: totrans-372
  prefs: []
  type: TYPE_PRE
  zh: '[PRE137]'
- en: 'And we should add the following code inside it:'
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该在其中添加以下代码：
- en: '[PRE138]'
  id: totrans-374
  prefs: []
  type: TYPE_PRE
  zh: '[PRE138]'
- en: 'This script requires some system modifications to run properly. Let''s make
    it executable:'
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 这个脚本需要一些系统修改才能正常运行。让我们将其设置为可执行：
- en: '[PRE139]'
  id: totrans-376
  prefs: []
  type: TYPE_PRE
  zh: '[PRE139]'
- en: 'We need to add a line to the `Sudoers` rule file:'
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要在`Sudoers`规则文件中添加一行：
- en: '[PRE140]'
  id: totrans-378
  prefs: []
  type: TYPE_PRE
  zh: '[PRE140]'
- en: 'For security reasons, editing the file directly may be harmful. We recommend
    using the following command:'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 出于安全原因，直接编辑文件可能会有害。我们建议使用以下命令：
- en: '[PRE141]'
  id: totrans-380
  prefs: []
  type: TYPE_PRE
  zh: '[PRE141]'
- en: 'Second, this script works with `iptables` so we need to deactivate `Firewalld`
    and `install` and activate `iptables`:'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，这个脚本与`iptables`一起工作，所以我们需要停用`Firewalld`并安装并激活`iptables`：
- en: '[PRE142]'
  id: totrans-382
  prefs: []
  type: TYPE_PRE
  zh: '[PRE142]'
- en: 'Then apply the new configuration we need to restart the Apache service:'
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 然后应用新配置，我们需要重新启动Apache服务：
- en: '[PRE143]'
  id: totrans-384
  prefs: []
  type: TYPE_PRE
  zh: '[PRE143]'
- en: Finally, our web server is well secured and configured.
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们的Web服务器已经得到了很好的安全和配置。
- en: 'As a small tip, the Apache server by default shows what operating system and
    version it has been running on. Sometimes it shows what modules are installed.
    That information can be very valuable for attackers to use as a vulnerability,
    so we need to disable the display of that information:'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一个小提示，默认情况下，Apache服务器显示它所运行的操作系统和版本。有时它会显示安装的模块。这些信息对攻击者来说可能非常有价值，因此我们需要禁用显示这些信息：
- en: '[PRE144]'
  id: totrans-387
  prefs: []
  type: TYPE_PRE
  zh: '[PRE144]'
- en: 'And then we change the following two lines to look like this:'
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们将以下两行更改为如下所示：
- en: '[PRE145]'
  id: totrans-389
  prefs: []
  type: TYPE_PRE
  zh: '[PRE145]'
- en: 'We can now move to database installation. The database in a server is essential
    for the execution of a dynamic website to be used as a medium to store its data.
    Usually, on old Linux versions, we install MySQL as our default database server
    but recently most Linux distros have migrated to the MariaDB database server.
    To do so, we need to use the package manager to install it:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以开始数据库安装。服务器中的数据库对于执行动态网站并用作存储其数据的媒介是至关重要的。通常，在旧的Linux版本上，我们将MySQL安装为默认数据库服务器，但最近大多数Linux发行版已经迁移到了MariaDB数据库服务器。为此，我们需要使用软件包管理器进行安装：
- en: '[PRE146]'
  id: totrans-391
  prefs: []
  type: TYPE_PRE
  zh: '[PRE146]'
- en: 'We are going to install some modules that are not available in the default
    repository. So we need to install the EPEL repository to make sure that we are
    covered for this part:'
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将安装一些默认存储库中不可用的模块。因此，我们需要安装EPEL存储库，以确保我们在这一部分得到覆盖：
- en: '[PRE147]'
  id: totrans-393
  prefs: []
  type: TYPE_PRE
  zh: '[PRE147]'
- en: 'Then we start the service and enable it for the next startup:'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们启动服务并启用它以便下次启动：
- en: '[PRE148]'
  id: totrans-395
  prefs: []
  type: TYPE_PRE
  zh: '[PRE148]'
- en: 'To have a well-secured database server, we need to use the MariaDB secure installation
    command. This command is very useful to customize the level of security of the
    database server with a variety of options:'
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 为了拥有一个良好安全的数据库服务器，我们需要使用MariaDB安全安装命令。这个命令非常有用，可以通过各种选项自定义数据库服务器的安全级别：
- en: '[PRE149]'
  id: totrans-397
  prefs: []
  type: TYPE_PRE
  zh: '[PRE149]'
- en: Note
  id: totrans-398
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: We should make sure to specify a powerful root password for the database during
    the execution of the command.
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行命令时，我们应该确保为数据库指定一个强大的根密码。
- en: 'To make sure that our database server is working correctly we can just run
    the CLI interface and run some basic SQL commands:'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保我们的数据库服务器正常工作，我们可以运行CLI界面并运行一些基本的SQL命令：
- en: '[PRE150]'
  id: totrans-401
  prefs: []
  type: TYPE_PRE
  zh: '[PRE150]'
- en: We type the password already set during the secure installation and we will
    have the MariaDB CLI. To quit it just type `quit`.
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 我们输入已在安全安装期间设置的密码，然后就可以进入MariaDB CLI了。要退出，只需输入`quit`。
- en: 'In order not to type the password each time, we can write the password in a
    file located in our home directory `~/.my.cnf` and add the following line:'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 为了不必每次输入密码，我们可以将密码写入位于我们的主目录`~/.my.cnf`中的文件，并添加以下行：
- en: '[PRE151]'
  id: totrans-404
  prefs: []
  type: TYPE_PRE
  zh: '[PRE151]'
- en: 'We can now move to the PHP5 installation. In the future, we will add `phpmyadmin`,
    which is a program that allows the management of the MariaDB database via a graphical
    interface accessible via the web browser. First, we start by installing PHP5 and
    the library that supports MySQL for PHP:'
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以开始安装PHP5。将来，我们将添加`phpmyadmin`，这是一个允许通过网页浏览器访问的图形界面管理MariaDB数据库的程序。首先，我们开始安装PHP5和支持MySQL的库：
- en: '[PRE152]'
  id: totrans-406
  prefs: []
  type: TYPE_PRE
  zh: '[PRE152]'
- en: We can edit `/etc/php/php.ini` to configure where to put error messages, the
    maximum size to upload a file to the website (very useful for dynamic websites
    that handle files), and so on.
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以编辑`/etc/php/php.ini`以配置错误消息的放置位置，上传文件到网站的最大大小（对于处理文件的动态网站非常有用），等等。
- en: 'We can do some minor configuration to make PHP more secure. First, we can remove
    the information and errors message and log them to a log file. Then turn off remote
    code execution. Also, if we are not in need of a file upload in the website, we
    can disable it. We need to use a safe SQL mode. Finally, we disable dangerous
    PGP functions:'
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以进行一些小的配置，使PHP更安全。首先，我们可以删除信息和错误消息，并将它们记录到日志文件中。然后关闭远程代码执行。此外，如果我们不需要在网站上上传文件，我们可以禁用它。我们需要使用安全的SQL模式。最后，我们禁用危险的PGP函数：
- en: '[PRE153]'
  id: totrans-409
  prefs: []
  type: TYPE_PRE
  zh: '[PRE153]'
- en: 'Then, change the following lines:'
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: 然后更改以下行：
- en: '[PRE154]'
  id: totrans-411
  prefs: []
  type: TYPE_PRE
  zh: '[PRE154]'
- en: 'To protect PHP from known and unknown flows, we consider installing the Suhosin
    advanced protection system:'
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保护PHP免受已知和未知的漏洞，我们考虑安装Suhosin高级保护系统：
- en: '[PRE155]'
  id: totrans-413
  prefs: []
  type: TYPE_PRE
  zh: '[PRE155]'
- en: 'Now we configure it so Apache starts using it:'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们配置Apache以使用它：
- en: '[PRE156]'
  id: totrans-415
  prefs: []
  type: TYPE_PRE
  zh: '[PRE156]'
- en: 'Then we restart Apache:'
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们重新启动Apache：
- en: '[PRE157]'
  id: totrans-417
  prefs: []
  type: TYPE_PRE
  zh: '[PRE157]'
- en: 'Now, we move to the installation of the packages required for the `phpmyadmin`
    installation:'
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们开始安装`phpmyadmin`所需的软件包：
- en: '[PRE158]'
  id: totrans-419
  prefs: []
  type: TYPE_PRE
  zh: '[PRE158]'
- en: 'After installing them, we install the `phpmyadmin` package:'
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 安装它们后，我们安装`phpmyadmin`软件包：
- en: '[PRE159]'
  id: totrans-421
  prefs: []
  type: TYPE_PRE
  zh: '[PRE159]'
- en: 'We need to do a little configuration to enable outside access to the interface
    of `phpmyadmin` other than from the server itself. We need to edit its configuration
    file:'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要进行一些配置，以便在服务器之外启用对`phpmyadmin`界面的访问。我们需要编辑它的配置文件：
- en: '[PRE160]'
  id: totrans-423
  prefs: []
  type: TYPE_PRE
  zh: '[PRE160]'
- en: 'Then we need to comment the old configuration:'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要注释掉旧的配置：
- en: '[PRE161]'
  id: totrans-425
  prefs: []
  type: TYPE_PRE
  zh: '[PRE161]'
- en: 'And add the new configuration that grants access:'
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 并添加授予访问权限的新配置：
- en: '[PRE162]'
  id: totrans-427
  prefs: []
  type: TYPE_PRE
  zh: '[PRE162]'
- en: 'Finally, we need to change the authentication from `cookie` to `http`:'
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要将身份验证从`cookie`更改为`http`：
- en: '[PRE163]'
  id: totrans-429
  prefs: []
  type: TYPE_PRE
  zh: '[PRE163]'
- en: 'And change this line to look like this:'
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 并将此行更改为以下内容：
- en: '[PRE164]'
  id: totrans-431
  prefs: []
  type: TYPE_PRE
  zh: '[PRE164]'
- en: 'So that the change can take effect, we need to restart Apache:'
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使更改生效，我们需要重新启动Apache：
- en: '[PRE165]'
  id: totrans-433
  prefs: []
  type: TYPE_PRE
  zh: '[PRE165]'
- en: To test whether it worked, we only need to type in any web browser located on
    the same network as the web server `http://Server_IP_Addr` `ess/phpmyadmin`. Then
    we need to provide the database root user and its password to log in. We can secure
    `phpMyAdmin` by editing its configuration file such as restricting the source
    IP address that can access the service.
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: 要测试它是否起作用，我们只需要在与Web服务器位于同一网络的任何Web浏览器中输入`http://Server_IP_Addr` `ess/phpmyadmin`。然后我们需要提供数据库根用户及其密码以登录。我们可以通过编辑其配置文件来保护`phpMyAdmin`，例如限制可以访问该服务的源IP地址。
- en: 'To be able to install a **Content Management System** (**CMS**) such as Wordpress,
    Joomla, or Drupal, we need to install some PHP modules:'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 为了能够安装**内容管理系统**（**CMS**）如Wordpress、Joomla或Drupal，我们需要安装一些PHP模块：
- en: '[PRE166]'
  id: totrans-436
  prefs: []
  type: TYPE_PRE
  zh: '[PRE166]'
- en: 'After installing those modules, we can proceed with our CMS installation. In
    our case, we will be installing Joomla. First, we need to go to the Joomla website
    and download the latest version into `/var/www` or any `Virtual Host` folder.
    Using Wget we will download the Joomla package:'
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 安装这些模块后，我们可以继续进行CMS安装。在我们的情况下，我们将安装Joomla。首先，我们需要访问Joomla网站并将最新版本下载到`/var/www`或任何`虚拟主机`文件夹中。使用Wget我们将下载Joomla软件包：
- en: '[PRE167]'
  id: totrans-438
  prefs: []
  type: TYPE_PRE
  zh: '[PRE167]'
- en: 'Then we need to extract the package using the `unzip` command:'
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要使用`unzip`命令提取软件包：
- en: '[PRE168]'
  id: totrans-440
  prefs: []
  type: TYPE_PRE
  zh: '[PRE168]'
- en: Note
  id: totrans-441
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: We need to make sure that the folder where we are going to extract the package
    is empty to have a safe installation with no errors.
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要确保我们将要提取软件包的文件夹是空的，以确保安装过程中没有错误。
- en: 'After that we can go and open, in any client web browser, the domain where
    we extracted the CMS package:'
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们可以在任何客户端Web浏览器中打开我们提取CMS软件包的域：
- en: '[PRE169]'
  id: totrans-444
  prefs: []
  type: TYPE_PRE
  zh: '[PRE169]'
- en: 'Then we need to follow the steps of the installation provided on the website.
    Here is a brief description of what we should provide to finish the installation:'
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们需要按照网站上提供的安装步骤进行操作。以下是我们应该提供以完成安装的简要描述：
- en: We need to provide the website name and some of the site administrator information
    (mail, name, password):![Setting up a web server using Apache-MySQL-PHP](img/B04674_03_03.jpg)
  id: totrans-446
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们需要提供网站名称和一些站点管理员信息（邮件、姓名、密码）：![使用Apache-MySQL-PHP设置Web服务器](img/B04674_03_03.jpg)
- en: In the database part, we need to provide which database we are using (`MySQL`),
    then the server host name (`localhost`), and the user and password of the database
    (`root`), and finally a name of the database in which to store the site information:![Setting
    up a web server using Apache-MySQL-PHP](img/B04674_03_04.jpg)
  id: totrans-447
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在数据库部分，我们需要提供我们正在使用的数据库（`MySQL`），然后是服务器主机名（`localhost`），以及数据库的用户和密码（`root`），最后是用于存储站点信息的数据库名称：![使用Apache-MySQL-PHP设置Web服务器](img/B04674_03_04.jpg)
- en: If needed, we can enable the FTP server by providing the FTP user and its password,
    and verify the service to check whether it is running.
  id: totrans-448
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果需要，我们可以通过提供FTP用户及其密码来启用FTP服务器，并验证服务以检查它是否正在运行。
- en: Then we will have an overview where we can check the configuration that we have
    entered and we can have it sent to the administrator via e-mail.
  id: totrans-449
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后我们将有一个概述，我们可以检查我们输入的配置，并可以通过电子邮件发送给管理员。
- en: Finally, we click install to have the website installed and configured.
  id: totrans-450
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们点击安装，让网站安装和配置。
- en: 'As this screenshot shows, we can determine the status of the pre-requirement
    of our CMS:'
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: 正如这个屏幕截图所显示的，我们可以确定我们的CMS的先决条件的状态：
- en: '![Setting up a web server using Apache-MySQL-PHP](img/B04674_03_05.jpg)'
  id: totrans-452
  prefs: []
  type: TYPE_IMG
  zh: '![使用Apache-MySQL-PHP设置Web服务器](img/B04674_03_05.jpg)'
- en: 'The installation site will remind us to remove the installation folder since
    it can present a vulnerability to the website. So to reinforce the security we
    need to remove it manually:'
  id: totrans-453
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装站点会提醒我们删除安装文件夹，因为它可能对网站造成漏洞。因此，为了加强安全性，我们需要手动删除它：
- en: '[PRE170]'
  id: totrans-454
  prefs: []
  type: TYPE_PRE
  zh: '[PRE170]'
- en: 'Then we need to copy the configuration provided on the site and put it inside
    a file that we create in the site folder and then save it:'
  id: totrans-455
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后我们需要复制网站上提供的配置，并将其放入我们在站点文件夹中创建的文件中，然后保存它：
- en: '[PRE171]'
  id: totrans-456
  prefs: []
  type: TYPE_PRE
  zh: '[PRE171]'
- en: 'We can access the site and navigate to it or we can open the administration
    panel to make some tweaks to the site or manage the settings:'
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以访问网站并导航到它，或者我们可以打开管理面板对网站进行一些调整或管理设置：
- en: '[PRE172]'
  id: totrans-458
  prefs: []
  type: TYPE_PRE
  zh: '[PRE172]'
- en: Now we can say that we have installed and secured our web server and it is ready
    for use.
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以说我们已经安装并保护了我们的Web服务器，它已经可以使用了。
- en: Setting up an FTP server
  id: totrans-460
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置FTP服务器
- en: As we know, multiple clients need a file exchange, and one of the common services
    that allows an easy and fast file exchange is the FTP technologies. In this section,
    we will talk about how to set up an FTP server to help transfer data between two
    machines in the same network or from different networks.
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 众所周知，多个客户端需要文件交换，其中一个常见的服务是FTP技术，它允许轻松快速地进行文件交换。在本节中，我们将讨论如何设置FTP服务器，以帮助在同一网络中的两台计算机或来自不同网络的计算机之间传输数据。
- en: 'First, we need to install an FTP server using the default package manager:'
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要使用默认的软件包管理器安装FTP服务器：
- en: '[PRE173]'
  id: totrans-463
  prefs: []
  type: TYPE_PRE
  zh: '[PRE173]'
- en: 'After having the server installed, we can start the configuration by editing
    the `VSFTPD` configuration file:'
  id: totrans-464
  prefs: []
  type: TYPE_NORMAL
  zh: 安装服务器后，我们可以通过编辑`VSFTPD`配置文件开始配置服务：
- en: '[PRE174]'
  id: totrans-465
  prefs: []
  type: TYPE_PRE
  zh: '[PRE174]'
- en: 'We need to find the following lines and change them as shown:'
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要找到以下行并按照所示更改它们：
- en: '[PRE175]'
  id: totrans-467
  prefs: []
  type: TYPE_PRE
  zh: '[PRE175]'
- en: 'Then we should restart the service and add it to the system startup to auto-start
    at the next boot:'
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们应该重新启动服务，并将其添加到系统启动项，以在下次启动时自动启动：
- en: '[PRE176]'
  id: totrans-469
  prefs: []
  type: TYPE_PRE
  zh: '[PRE176]'
- en: Note
  id: totrans-470
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意：
- en: Basically, most of the errors that won't let the service start are related to
    typos in the configuration file. If we ever get any, we should first check that
    file for any miswritten options.
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: 基本上，大多数导致服务无法启动的错误都与配置文件中的拼写错误有关。如果我们遇到任何错误，我们应该首先检查文件中是否有任何拼写错误的选项。
- en: 'After that, to make sure that the service is accessible from other machines
    other than the machine itself, we need to open the FTP port in the firewall:'
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，为了确保服务可以从除本机之外的其他机器访问，我们需要在防火墙中打开FTP端口：
- en: '[PRE177]'
  id: totrans-473
  prefs: []
  type: TYPE_PRE
  zh: '[PRE177]'
- en: 'Then update the SELinux Boolean values for FTP service:'
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: 然后更新FTP服务的SELinux布尔值：
- en: '[PRE178]'
  id: totrans-475
  prefs: []
  type: TYPE_PRE
  zh: '[PRE178]'
- en: 'And, finally, we should make some FTP users so clients can use them to log
    in:'
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们应该创建一些FTP用户，以便客户端可以使用它们进行登录：
- en: '[PRE179]'
  id: totrans-477
  prefs: []
  type: TYPE_PRE
  zh: '[PRE179]'
- en: 'Now we can start testing the service by going to one of the clients either
    on the same network or outside, and do as follows:'
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以开始测试服务，方法是转到同一网络或外部的客户端之一，然后执行以下操作：
- en: '[PRE180]'
  id: totrans-479
  prefs: []
  type: TYPE_PRE
  zh: '[PRE180]'
- en: 'Or:'
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: 或者：
- en: '[PRE181]'
  id: totrans-481
  prefs: []
  type: TYPE_PRE
  zh: '[PRE181]'
- en: And then we type in the user and its password which we have already defined.
    If we get access to the FTP service that means that our FTP server is successfully
    set up.
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们输入我们已经定义的用户及其密码。如果我们能访问FTP服务，那就意味着我们的FTP服务器已经成功设置好了。
- en: Securing Apache and FTP with OpenSSL
  id: totrans-483
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用OpenSSL保护Apache和FTP
- en: Most services provided around the world are very attractive to hackers to attack
    and steal valuable information or to block its activity. In this section we are
    going to present a solution that helps secure two of the most commonly used services
    (`HTTPFTP`). This solution is OpenSSL as an open source toolkit implementing the
    **Secure Sockets Layer** (**SSL**) and **Transport Layer Security** (**TLS**)
    protocols as well as a robust cryptography library.
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: 全球提供的大多数服务都非常吸引黑客攻击和窃取有价值的信息，或者阻止其活动。在本节中，我们将提出一个解决方案，帮助保护两个最常用的服务（`HTTPFTP`）。这个解决方案是OpenSSL，它是一个实现**安全套接字层**（**SSL**）和**传输层安全**（**TLS**）协议以及强大的加密库的开源工具包。
- en: 'We will start with the implementation of OpenSSL for FTP file transfer to make
    it more secure. First, we need to ensure OpenSSL is installed on our system:'
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从实施OpenSSL开始进行FTP文件传输，以使其更加安全。首先，我们需要确保OpenSSL已安装在我们的系统上：
- en: '[PRE182]'
  id: totrans-486
  prefs: []
  type: TYPE_PRE
  zh: '[PRE182]'
- en: 'Then we start configuring the service to work with our FTP server VSFTPD. So
    we need to create an SSL certificate to use with TLS since it the latest most
    secure technology created. To do so we need to create a folder to store the files
    to be generated using SSL:'
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们开始配置服务以与我们的FTP服务器VSFTPD一起工作。因此，我们需要创建一个SSL证书以与TLS一起使用，因为它是最新的最安全的技术。为此，我们需要创建一个文件夹来存储使用SSL生成的文件：
- en: '[PRE183]'
  id: totrans-488
  prefs: []
  type: TYPE_PRE
  zh: '[PRE183]'
- en: 'Then we create the certificate with the keys:'
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们使用密钥创建证书：
- en: '[PRE184]'
  id: totrans-490
  prefs: []
  type: TYPE_PRE
  zh: '[PRE184]'
- en: 'We need to fill in the details required during the execution of the command:'
  id: totrans-491
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行命令时，我们需要填写所需的详细信息：
- en: '`openssl`: The basic SSL command to manage SSL certificates and keys'
  id: totrans-492
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`openssl`：管理SSL证书和密钥的基本SSL命令'
- en: '`req –x509`: To specify the public key infrastructure standards for SSL and
    TLS'
  id: totrans-493
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`req –x509`：指定SSL和TLS的公钥基础设施标准'
- en: '`-node`: To tell OpenSSL to skip the passphrase security option'
  id: totrans-494
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-node`：告诉OpenSSL跳过密码安全选项'
- en: '`-days 365`: To set the time of the validity of this certificate'
  id: totrans-495
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-days 365`：设置此证书的有效时间'
- en: '`-newkey rsa:1024`: To create a new RSA key 1024 bits long'
  id: totrans-496
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-newkey rsa:1024`：创建一个新的1024位长的RSA密钥'
- en: '`-keyout`: To tell OpenSSL where to generate the private key file'
  id: totrans-497
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-keyout`：告诉OpenSSL在哪里生成私钥文件'
- en: '`-out`: To tell OpenSSL where to generate the certificate file'
  id: totrans-498
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-out`：告诉OpenSSL在哪里生成证书文件'
- en: 'Then we add the SSL details to our FTP server main configuration file:'
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们将SSL详细信息添加到我们的FTP服务器主配置文件中：
- en: '[PRE185]'
  id: totrans-500
  prefs: []
  type: TYPE_PRE
  zh: '[PRE185]'
- en: 'We specify the location of the certificate and the key files:'
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
  zh: 我们指定证书和密钥文件的位置：
- en: '[PRE186]'
  id: totrans-502
  prefs: []
  type: TYPE_PRE
  zh: '[PRE186]'
- en: 'Then we enable the use of SSL:'
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们启用SSL的使用：
- en: '[PRE187]'
  id: totrans-504
  prefs: []
  type: TYPE_PRE
  zh: '[PRE187]'
- en: 'Then we restrict the connections to TLS:'
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们限制连接到TLS：
- en: '[PRE188]'
  id: totrans-506
  prefs: []
  type: TYPE_PRE
  zh: '[PRE188]'
- en: 'Then we add some optional configuration to reinforce the site security:'
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们添加一些可选的配置来加强站点安全性：
- en: '[PRE189]'
  id: totrans-508
  prefs: []
  type: TYPE_PRE
  zh: '[PRE189]'
- en: 'Then we restart the FTP service to enable the change:'
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们重新启动FTP服务以启用更改：
- en: '[PRE190]'
  id: totrans-510
  prefs: []
  type: TYPE_PRE
  zh: '[PRE190]'
- en: Then we can test it via an FTP client (Filezilla) that has the capacity to connect
    via FTPS to see that the connection/transfer is now secured.
  id: totrans-511
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们可以通过具有连接到FTPS的能力的FTP客户端（Filezilla）进行测试，以查看连接/传输是否已经安全。
- en: We now move on to the second part of this section where we are going to secure
    our web server Apache. We will be installing the OpenSSL module for Apache then
    we will configure it to secure Apache.
  id: totrans-512
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们进入本节的第二部分，我们将保护我们的Web服务器Apache。我们将安装Apache的OpenSSL模块，然后配置它来保护Apache。
- en: 'First, we need to make sure that Apache is successfully installed and the same
    thing can also be started for OpenSSL. Then we can start the installation of the
    module `Mod_ssl`:'
  id: totrans-513
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要确保Apache已成功安装，同样的事情也适用于OpenSSL。然后我们可以开始安装`Mod_ssl`模块：
- en: '[PRE191]'
  id: totrans-514
  prefs: []
  type: TYPE_PRE
  zh: '[PRE191]'
- en: 'After installing it, we move to the configuration part. We need to create a
    folder in which we are going to store our keys and certificate files:'
  id: totrans-515
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，我们进入配置部分。我们需要创建一个文件夹，用于存储我们的密钥和证书文件：
- en: '[PRE192]'
  id: totrans-516
  prefs: []
  type: TYPE_PRE
  zh: '[PRE192]'
- en: 'Then we create our keys and certificates using OpenSSL:'
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们使用OpenSSL创建我们的密钥和证书：
- en: '[PRE193]'
  id: totrans-518
  prefs: []
  type: TYPE_PRE
  zh: '[PRE193]'
- en: We need to fill in all the required details to finish the files' creation.
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要填写所有必需的细节来完成文件的创建。
- en: Note
  id: totrans-520
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The SSL key in Apache must be without password less to not cause a manual reconfiguration
    every time the server restart.
  id: totrans-521
  prefs: []
  type: TYPE_NORMAL
  zh: Apache中的SSL密钥必须没有密码，以免在每次服务器重新启动时引起手动重新配置。
- en: 'After creating all our files, we need to set up a virtual host to use with
    the new certificate. To do so we need to start by editing Apache''s SSL configuration
    file:'
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: 创建所有文件后，我们需要设置一个虚拟主机以与新证书一起使用。为此，我们需要首先编辑Apache的SSL配置文件：
- en: '[PRE194]'
  id: totrans-523
  prefs: []
  type: TYPE_PRE
  zh: '[PRE194]'
- en: We need to find the section that begins with `<VirtualHost _default_:443>`,
    to make some changes to it to make sure that the SSL certificate is correctly
    set.
  id: totrans-524
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要找到以`<VirtualHost _default_:443>`开头的部分，对其进行一些更改，以确保SSL证书设置正确。
- en: 'First, we need to uncomment the `DocumentRoot` line and change the location
    to the desired site that we need to secure:'
  id: totrans-525
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要取消注释`DocumentRoot`行，并将位置更改为需要保护的站点所需的位置：
- en: '[PRE195]'
  id: totrans-526
  prefs: []
  type: TYPE_PRE
  zh: '[PRE195]'
- en: 'We do the same thing for the line `ServerName` and we need to change the domain
    to the desired one:'
  id: totrans-527
  prefs: []
  type: TYPE_NORMAL
  zh: 我们对`ServerName`行执行相同的操作，并将域更改为所需的域：
- en: '[PRE196]'
  id: totrans-528
  prefs: []
  type: TYPE_PRE
  zh: '[PRE196]'
- en: 'And finally, we need to find the `SSLCertificateFile` and the `SSLCertificateKeyFile`
    lines and change them to point to where we have created the SSL certificate and
    key:'
  id: totrans-529
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要找到`SSLCertificateFile`和`SSLCertificateKeyFile`行，并将它们更改为指向我们创建SSL证书和密钥的位置：
- en: '[PRE197]'
  id: totrans-530
  prefs: []
  type: TYPE_PRE
  zh: '[PRE197]'
- en: 'Then we save the file and restart Apache to enable the change:'
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们保存文件并重新启动Apache以启用更改：
- en: '[PRE198]'
  id: totrans-532
  prefs: []
  type: TYPE_PRE
  zh: '[PRE198]'
- en: To test this configuration, we need to use a web browser of a client machine
    and type in [https://www.packtpub.com/](https://www.packtpub.com/) `uk`. Then
    accept the certificate and access the site.
  id: totrans-533
  prefs: []
  type: TYPE_NORMAL
  zh: 为了测试这个配置，我们需要使用客户机的Web浏览器，并输入[https://www.packtpub.com/](https://www.packtpub.com/)
    `uk`。然后接受证书并访问该站点。
- en: References
  id: totrans-534
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考资料
- en: 'Now that we have gone through the chapter, let''s take a look at the references
    used:'
  id: totrans-535
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成了本章，让我们来看一下使用的参考资料：
- en: 'Firewalld configuration guide: [https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7)'
  id: totrans-536
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Firewalld配置指南：[https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7)
- en: 'OpenVPN server overview: [https://openvpn.net/index.php/access-server/overview.html](https://openvpn.net/index.php/access-server/overview.html)'
  id: totrans-537
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenVPN服务器概述：[https://openvpn.net/index.php/access-server/overview.html](https://openvpn.net/index.php/access-server/overview.html)
- en: 'BIND DNS server page: [https://www.isc.org/downloads/bind/](https://www.isc.org/downloads/bind/)'
  id: totrans-538
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BIND DNS服务器页面：[https://www.isc.org/downloads/bind/](https://www.isc.org/downloads/bind/)
- en: 'Web server (LAMP) wiki page: [https://en.wikipedia.org/wiki/LAMP_(software_bundle)](https://en.wikipedia.org/wiki/LAMP_(software_bundle))'
  id: totrans-539
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Web服务器（LAMP）维基页面：[https://en.wikipedia.org/wiki/LAMP_(software_bundle)](https://en.wikipedia.org/wiki/LAMP_(software_bundle))
- en: 'FTP server Wiki page: [https://en.wikipedia.org/wiki/File_Transfer_Protocol](https://en.wikipedia.org/wiki/File_Transfer_Protocol)'
  id: totrans-540
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FTP服务器维基页面：[https://en.wikipedia.org/wiki/File_Transfer_Protocol](https://en.wikipedia.org/wiki/File_Transfer_Protocol)
- en: 'FTPS vs SFTP: [https://www.eldos.com/security/articles/4672.php?page=all](https://www.eldos.com/security/articles/4672.php?page=all)'
  id: totrans-541
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'FTPS vs SFTP: [https://www.eldos.com/security/articles/4672.php?page=all](https://www.eldos.com/security/articles/4672.php?page=all)'
- en: '`Mod_SSL` for Apache documentation: [http://www.modssl.org/docs/](http://www.modssl.org/docs/)'
  id: totrans-542
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Apache的`Mod_SSL`文档：[http://www.modssl.org/docs/](http://www.modssl.org/docs/)
- en: 'OpenSSL webpage: [https://www.openssl.org/](https://www.openssl.org/)'
  id: totrans-543
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenSSL网页：[https://www.openssl.org/](https://www.openssl.org/)
- en: Summary
  id: totrans-544
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: This chapter is a description of a list of services that the CentOS Linux system
    offers to its users. This description is a step-by-step explanation of how those
    services can be installed on CentOS 7 and how to configure them for best practice.
    We have talked about implementing a Gateway server, using Firewalld, inside a
    local network. Then we have established a VPN server, using OpenVPN, to have clients
    access the network from all around the world. After that, we have set up a DNS
    server using the BIND service. Then we have installed the essential packages to
    set up a fully running web server that can support a dynamic website with some
    tweaking to make it more secure, easy to manage, and extensible, using Apache
    and its modules, MariaDB and PHP. We moved to set up an FTP server to have clients
    access it to transfer data. And we have finished with securing both our web server
    and our FTP server using the OpenSSL self-signed certificates and keys.
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
  zh: 本章是对CentOS Linux系统为用户提供的一系列服务的描述。这一描述是对如何在CentOS 7上安装这些服务以及如何配置它们以实现最佳实践的逐步解释。我们已经讨论了在本地网络中使用Firewalld实现网关服务器。然后我们建立了一个使用OpenVPN的VPN服务器，以便客户端可以从世界各地访问网络。之后，我们使用BIND服务设置了一个DNS服务器。然后我们安装了必要的软件包，建立了一个完全运行的Web服务器，可以支持动态网站，并进行了一些调整以使其更安全、易于管理和可扩展，使用Apache及其模块、MariaDB和PHP。我们继续设置了一个FTP服务器，以便客户端可以访问并传输数据。最后，我们使用OpenSSL自签名证书和密钥对我们的Web服务器和FTP服务器进行了安全保护。
- en: We are not done yet with what CentOS 7 can offer. Check out our next [Chapter
    4](ch04.html "Chapter 4. Mail Server with Postfix"), *Mail server using PostFix*,
    which explores in depth how to set up, configure, and secure a mail server using
    Postfix.
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还没有完成 CentOS 7 可以提供的功能。查看我们接下来的[第四章](ch04.html "第四章。使用Postfix的邮件服务器")，*使用PostFix的邮件服务器*，深入探讨如何设置、配置和保护使用Postfix的邮件服务器。
