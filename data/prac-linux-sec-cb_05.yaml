- en: Chapter 5. Remote Authentication
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章。远程身份验证
- en: 'In this chapter, we will discuss the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论以下主题：
- en: Remote server/host access using SSH
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用SSH进行远程服务器/主机访问
- en: Disabling or enabling SSH root login
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 禁用或启用SSH root登录
- en: Restricting remote access with key-based login into SSH
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过基于密钥的登录限制远程访问到SSH
- en: Copying files remotely
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 远程复制文件
- en: Setting up a Kerberos server with Ubuntu
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Ubuntu上设置Kerberos服务器
- en: Remote server/host access using SSH
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用SSH进行远程服务器/主机访问
- en: '**SSH,** or **Secure Shell,** is a protocol which is used to log on to remote
    systems securely and is the most commonly used method for accessing remote Linux
    systems.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '**SSH**，或**安全外壳**，是一种协议，用于安全地登录到远程系统，是访问远程Linux系统的最常用方法。'
- en: Getting ready
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To see how to use SSH, we need two Ubuntu systems. One will be used as a server
    and the other as a client.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解如何使用SSH，我们需要两个Ubuntu系统。一个将用作服务器，另一个将用作客户端。
- en: How to do it…
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作步骤…
- en: 'To use SSH, we can use freely available software called **OpenSSH**. Once the
    software is installed, it can be used by the command `ssh` on the Linux system.
    We will see how to use this tool in detail:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用SSH，我们可以使用名为**OpenSSH**的免费软件。安装软件后，可以在Linux系统上使用`ssh`命令。我们将详细了解如何使用这个工具：
- en: If the software to use SSH is not already installed, we have to install it on
    both the server and the client system.
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果要使用SSH的软件尚未安装，我们必须在服务器和客户端系统上都安装它。
- en: 'The command to install the tool on the server system is:'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在服务器系统上安装该工具的命令是：
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The output obtained will be as follows:'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得的输出将如下所示：
- en: '![How to do it…](img/B04234_05_01.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![操作步骤…](img/B04234_05_01.jpg)'
- en: 'Next, we need to install the client version of the software:'
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要安装软件的客户端版本：
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The output obtained will be as follows:'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得的输出将如下所示：
- en: '![How to do it…](img/B04234_05_02.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![操作步骤…](img/B04234_05_02.jpg)'
- en: 'For the latest versions, the SSH service starts running as soon as the software
    is installed. If it is not running by default, we can start the service by using
    this command:'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于最新版本，安装软件后SSH服务将立即开始运行。如果默认情况下未运行，我们可以使用以下命令启动服务：
- en: '[PRE2]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The output obtained will be as follows:'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得的输出将如下所示：
- en: '![How to do it…](img/B04234_05_03.jpg)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![操作步骤…](img/B04234_05_03.jpg)'
- en: 'Now if we want to log in from the client system to the server system, the command
    will be as follows:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，如果我们想从客户端系统登录到服务器系统，命令将如下所示：
- en: '[PRE3]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Here, `remote_ip_address` refers to the IP address of the server system. The
    command also assumes that the username on the client machine is the same as that
    on the server machine:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，`remote_ip_address`指的是服务器系统的IP地址。该命令还假定客户端机器上的用户名与服务器机器上的用户名相同：
- en: '![How to do it…](img/B04234_05_04.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![操作步骤…](img/B04234_05_04.jpg)'
- en: 'If we want to log in with a different user, the command will be as follows:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想使用不同的用户登录，命令将如下所示：
- en: '[PRE4]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The output obtained will be as follows:'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得的输出将如下所示：
- en: '![How to do it…](img/B04234_05_05.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![操作步骤…](img/B04234_05_05.jpg)'
- en: 'Next, we need to configure SSH so we can use it as per our requirements. The
    main configuration file for `sshd` in Ubuntu is located at `/etc/ssh/sshd_config`.
    Before making any changes to the original version of this file, create a backup
    using this command:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要配置SSH，以便根据我们的要求使用它。Ubuntu中`sshd`的主要配置文件位于`/etc/ssh/sshd_config`。在对此文件的原始版本进行任何更改之前，使用以下命令创建备份：
- en: '[PRE5]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The configuration file defines the default settings for SSH on the server system.
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置文件定义了服务器系统上SSH的默认设置。
- en: 'When we open the file in any editor, we can see that the default port declaration
    on which the SSHD server listens for the incoming connections is `22`. We can
    change this to any non-standard port to secure the server from random port scans,
    hence making it more secure. Suppose we change the port to `888`, then the next
    time the client wants to connect to the SSH server, the command will be as follows:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当我们在任何编辑器中打开文件时，我们可以看到SSH服务器监听传入连接的默认端口声明为`22`。我们可以将其更改为任何非标准端口以保护服务器免受随机端口扫描，从而使其更安全。假设我们将端口更改为`888`，那么下次客户端想要连接到SSH服务器时，命令将如下所示：
- en: '[PRE6]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The output obtained will be as follows:'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得的输出将如下所示：
- en: '![How to do it…](img/B04234_05_06.jpg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![操作步骤…](img/B04234_05_06.jpg)'
- en: As we can see, when we run the command without specifying the port number, the
    connection is refused. Next, when we mention the correct port number, the connection
    is established.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们所看到的，当我们在不指定端口号的情况下运行命令时，连接会被拒绝。接下来，当我们提到正确的端口号时，连接将建立。
- en: How it works…
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: SSH is used to connect a client program to an SSH server. On one system, we
    install the `openssh-server` package to make it the SSH server, and on the other
    system we install the `openssh-client` package to use it as a client.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: SSH用于将客户端程序连接到SSH服务器。在一个系统上，我们安装`openssh-server`软件包使其成为SSH服务器，在另一个系统上，我们安装`openssh-client`软件包以将其用作客户端。
- en: Now, keeping the SSH service running on the server system, we try to connect
    to it through the client.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，保持服务器系统上的SSH服务运行，我们尝试通过客户端连接到它。
- en: We use the configuration file of SSH to change the settings, like the default
    port for connecting.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用SSH的配置文件来更改设置，比如连接的默认端口。
- en: Disabling or enabling SSH root login
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 禁用或启用SSH root登录
- en: The Linux systems have a root account by default, which is enabled by default.
    If unauthorized users get SSH root access to the system, it is not a good idea
    because this will give an attacker complete access to the system.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: Linux系统默认具有一个启用的root帐户。如果未经授权的用户获得SSH root访问权限，这不是一个好主意，因为这将使攻击者完全访问系统。
- en: We can disable or enable the root login for SSH as per our requirements to prevent
    the chances of an attacker getting access to the system.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以根据需要禁用或启用SSH的root登录，以防止攻击者获取对系统的访问权限。
- en: Getting ready
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We need two Linux systems to be used as a server and client. On the server system,
    install the package `openssh-server`, as shown in the preceding recipe.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要两个Linux系统，一个用作服务器，一个用作客户端。在服务器系统上，安装`openssh-server`软件包，如前面的示例所示。
- en: How to do it…
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作步骤…
- en: 'First, we will see how to disable SSH root login, and then we will also see
    how to enable it again:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将看到如何禁用SSH root登录，然后我们还将看到如何再次启用它：
- en: Firstly, open the main configuration file of SSH, `/etc/ssh/sshd_config`, in
    any editor.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，在任何编辑器中打开SSH的主配置文件`/etc/ssh/sshd_config`。
- en: '[PRE7]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Now look for the line that reads as follows:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在寻找以下内容的行：
- en: '[PRE8]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Change the value from `yes` to `no`. Then, save and close the file:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将值从`yes`更改为`no`。然后，保存并关闭文件：
- en: '[PRE9]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The output obtained will be as follows:'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得的输出将如下所示：
- en: '![How to do it…](img/B04234_05_07.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作…](img/B04234_05_07.jpg)'
- en: Once done, restart the SSH daemon service using the command shown here:![How
    to do it…](img/B04234_05_08.jpg)
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，使用以下命令重新启动SSH守护程序服务：![如何操作…](img/B04234_05_08.jpg)
- en: Now, let's try to log in as root. We should get an error, `Permission Denied`,
    as the root login has been disabled:![How to do it…](img/B04234_05_09.jpg)
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们尝试以root身份登录。我们应该收到一个“权限被拒绝”的错误，因为root登录已被禁用：![如何操作…](img/B04234_05_09.jpg)
- en: Now whenever we want to log in as root, first we will have to log in as a normal
    user. After that, we can use the `su` command and switch to the root user. So,
    the user accounts which are not listed in the `/etc/sudoers` file will not be
    able to switch to the root user and the system will be more secure:![How to do
    it…](img/B04234_05_10.jpg)
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在每当我们想要以root身份登录时，首先我们必须以普通用户身份登录。之后，我们可以使用`su`命令切换到root用户。因此，未在`/etc/sudoers`文件中列出的用户帐户将无法切换到root用户，系统将更加安全：![如何操作…](img/B04234_05_10.jpg)
- en: 'Now, if we want to again enable SSH root login, we just need to edit the`/etc/ssh/sshd_config`
    file again and change the option from `no` to `yes` again:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，如果我们想要再次启用SSH root登录，我们只需要再次编辑`/etc/ssh/sshd_config`文件，并将选项从`no`更改为`yes`：
- en: '[PRE10]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The output obtained will be as follows:'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得的输出将如下所示：
- en: '![How to do it…](img/B04234_05_11.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作…](img/B04234_05_11.jpg)'
- en: Then, restart the service again by using the following command:![How to do it…](img/B04234_05_12.jpg)
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，再次使用以下命令重新启动服务：![如何操作…](img/B04234_05_12.jpg)
- en: Now if we try to log in as root again, it will work:![How to do it…](img/B04234_05_13.jpg)
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，如果我们再次尝试以root身份登录，它将起作用：![如何操作…](img/B04234_05_13.jpg)
- en: How it works…
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: When we try to connect to a remote system using SSH, the remote system checks
    its configuration file at `/etc/ssh/sshd_config` and according to the details
    mentioned in this file, it decides whether the connection should be allowed or
    refused.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们尝试使用SSH连接到远程系统时，远程系统会检查其在`/etc/ssh/sshd_config`中的配置文件，并根据该文件中提到的详细信息决定是否允许或拒绝连接。
- en: When we change the value of `PermitRootLogin` accordingly, the working also
    changes.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们相应地更改`PermitRootLogin`的值时，工作也会发生变化。
- en: There's more…
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: Suppose we have many user accounts on the system and we need to edit the `/etc/ssh/sshd_config`
    file in such a way that remote access is allowed only for a few mentioned users.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们在系统上有许多用户帐户，并且我们需要以这样的方式编辑`/etc/ssh/sshd_config`文件，即仅允许少数指定用户进行远程访问。
- en: '[PRE11]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Add the following line:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 添加以下行：
- en: '[PRE12]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Now restart the `ssh` service:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 现在重新启动`ssh`服务：
- en: '[PRE13]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Now, when we try to log in with `user1`, the login is successful. However,
    when we try to log in with `user2`, which has not been added to `/etc/ssh/sshd_config`
    file, the login fails and we get the error `Permission denied`, as shown here:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当我们尝试使用`user1`登录时，登录是成功的。但是，当我们尝试使用未添加到`/etc/ssh/sshd_config`文件中的`user2`登录时，登录失败，并且我们收到“权限被拒绝”的错误，如下所示：
- en: '![There''s more…](img/B04234_05_14.jpg)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![还有更多…](img/B04234_05_14.jpg)'
- en: Restricting remote access with key-based login into SSH
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过基于密钥的登录限制远程访问SSH
- en: Even though SSH login is protected by using passwords for the user account,
    we can make it more secure by using key-based authentication into SSH.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 即使使用用户帐户的密码保护了SSH登录，我们也可以通过在SSH中使用基于密钥的身份验证来使其更加安全。
- en: Getting ready
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To see how key-based authentication works, we will need two Linux systems (in
    our example, both our Ubuntu systems). One should have the OpenSSH server package
    installed on it.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解基于密钥的身份验证的工作原理，我们将需要两个Linux系统（在我们的示例中，都是Ubuntu系统）。其中一个应该安装了OpenSSH服务器软件包。
- en: How to do it...
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: To use key-based authentication, we need to create a pair of keys­—a private
    key and a public key.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用基于密钥的身份验证，我们需要创建一对密钥——私钥和公钥。
- en: 'On the client or local system, we will execute the following command to generate
    the SSH key-pair:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在客户端或本地系统上，我们将执行以下命令生成SSH密钥对：
- en: '[PRE14]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The output obtained will be as follows:'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得的输出将如下所示：
- en: '![How to do it...](img/B04234_05_15.jpg)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作…](img/B04234_05_15.jpg)'
- en: While creating the key, we can accept the default values or change them as per
    our wishes. It will also ask for a passphrase, which you can set as anything or
    else leave it blank.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在创建密钥时，我们可以接受默认值或根据我们的意愿进行更改。它还会要求输入一个密码，您可以设置为任何内容，或者留空。
- en: The key-pair will be created in the location—`~./ssh/`. Change to this directory
    and then use the command—`ls –l` to see the details of the key files:![How to
    do it...](img/B04234_05_16.jpg)
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 密钥对将在位置`~./ssh/`中创建。切换到此目录，然后使用命令`ls –l`查看密钥文件的详细信息：![如何操作…](img/B04234_05_16.jpg)
- en: We can see that the `id_rsa` file can be read and written only by the owner.
    This permission ensures that the file is kept secure.
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以看到`id_rsa`文件只能被所有者读取和写入。此权限确保文件的安全性。
- en: 'Now we need to copy the public key file to the remote SSH server. To do so
    we run the following command:'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们需要将公钥文件复制到远程SSH服务器。为此，我们运行以下命令：
- en: '[PRE15]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The output obtained will be as follows:'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得的输出将如下所示：
- en: '![How to do it...](img/B04234_05_17.jpg)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作…](img/B04234_05_17.jpg)'
- en: An SSH session will be started and will prompt you to enter the password for
    the user account. Once the correct password has been entered, the key will get
    copied to the remote server.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将启动一个SSH会话，并提示您输入用户帐户的密码。一旦输入了正确的密码，密钥将被复制到远程服务器。
- en: Once the public key has been successfully copied to the remote server, try to
    log in to the server again using the `ssh 192.168.1.101` command:![How to do it...](img/B04234_05_18.jpg)
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦公钥成功复制到远程服务器，尝试使用`ssh 192.168.1.101`命令再次登录到服务器：![如何做...](img/B04234_05_18.jpg)
- en: We can see that now we are not prompted for the user account's password. Since
    we had configured the passphrase for the SSH key, it has been asked. Otherwise,
    we would have been logged into the system without being asked for the passphrase.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到现在不需要提示输入用户帐户的密码。因为我们已经为SSH密钥配置了密码，所以它已经被要求。否则，我们将被要求输入密码而不需要输入密码。
- en: How it works...
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: When we create the SSH key-pair and move the public key to the remote system,
    it works as an authentication method for connecting to the remote system. If the
    public key present in the remote system matches the public key generated by the
    local system, and if the local system has the private key to complete the key-pair,
    login happens. Otherwise, if any key file is missing, login is not allowed.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们创建SSH密钥对并将公钥移动到远程系统时，它可以作为连接到远程系统的身份验证方法。如果远程系统中存在的公钥与本地系统生成的公钥匹配，并且本地系统具有私钥以完成密钥对，就可以登录。否则，如果任何密钥文件丢失，将不允许登录。
- en: Copying files remotely
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 远程复制文件
- en: Managing a system remotely is great using SSH. However, many would not know
    that SSH can also help in uploading and downloading files remotely.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 使用SSH远程管理系统非常方便。然而，许多人可能不知道SSH也可以帮助远程上传和下载文件。
- en: Getting ready
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To try the file transfer tools, we only need two Linux systems which can ping
    each other. On one system, the OpenSSH package should be installed and the SSH
    server should be running.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试文件传输工具，我们只需要两个可以相互ping通的Linux系统。在一个系统上，应安装OpenSSH软件包并运行SSH服务器。
- en: How to do it...
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'Linux has a collection of tools which can help to transfer data between networked
    computers. We will see how a few of them work in this section:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: Linux有一系列工具，可以帮助在网络计算机之间传输数据。我们将在本节中看到其中一些工作原理：
- en: 'Suppose we have a file, `myfile.txt`, on the local system, which we want to
    copy to the remote system. The command to do so is given here:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 假设我们在本地系统上有一个名为`myfile.txt`的文件，我们想要将其复制到远程系统。执行此操作的命令如下：
- en: '[PRE16]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: The output is shown in the following screenshot:![How to do it...](img/B04234_05_20.jpg)
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输出显示在以下截图中：![如何做...](img/B04234_05_20.jpg)
- en: Here, the remote location where the file will be copied to is the `Desktop`
    directory of the user account being used to connect.
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在这里，文件将被复制到的远程位置是连接使用的用户帐户的`Desktop`目录。
- en: When we check on the remote SSH system, we can see that the file `myfile.txt`
    has been copied successfully:![How to do it...](img/B04234_05_21.jpg)
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当我们检查远程SSH系统时，可以看到文件`myfile.txt`已成功复制：![如何做...](img/B04234_05_21.jpg)
- en: 'Now, let''s suppose we have a `mydata` directory in the local system, which
    we want to copy to the remote system. This can be done by using the `-r` option
    in the command, as shown here:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，假设我们在本地系统上有一个名为`mydata`的目录，我们想要将其复制到远程系统。可以使用命令中的`-r`选项来执行此操作，如下所示：
- en: '[PRE17]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'The output is shown in the following screenshot:'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输出显示在以下截图中：
- en: '![How to do it...](img/B04234_05_22.jpg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/B04234_05_22.jpg)'
- en: Again, we check on the remote server and see that the `mydata` directory has
    been copied with all its files:![How to do it...](img/B04234_05_23.jpg)
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次检查远程服务器，可以看到`mydata`目录已成功复制并包含所有文件：![如何做...](img/B04234_05_23.jpg)
- en: Now we will see how to copy a file from the remote system back to the local
    system.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们将看到如何将文件从远程系统复制回本地系统。
- en: 'First, create a file on the remote server. Our file is `newfile.txt`:'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 首先，在远程服务器上创建一个文件。我们的文件是`newfile.txt`：
- en: '![How to do it...](img/B04234_05_24.jpg)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/B04234_05_24.jpg)'
- en: 'Now, on the local system, move to the directory where you wish to copy the
    file. Then, run the command as shown to copy the file from the remote system to
    the local system in the current directory:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，在本地系统上，转到希望复制文件的目录。然后，按照所示的命令从远程系统复制文件到本地系统的当前目录中：
- en: '[PRE18]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The output is shown in the following screenshot:'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输出显示在以下截图中：
- en: '![How to do it...](img/B04234_05_25.jpg)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/B04234_05_25.jpg)'
- en: We can also use `sftp` to interactively copy the files from the remote system,
    using FTP commands.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们还可以使用`sftp`以交互方式从远程系统复制文件，使用FTP命令。
- en: 'To do this, we first start the connection, using this command:'
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要做到这一点，我们首先使用以下命令开始连接：
- en: '[PRE19]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Have a look at the execution of the command:'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看命令的执行情况：
- en: '![How to do it...](img/B04234_05_26.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/B04234_05_26.jpg)'
- en: 'Next, we can run any FTP command. In our example, we try to get the file from
    the remote system using the `get` command, as shown:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们可以运行任何FTP命令。在我们的示例中，我们尝试使用`get`命令从远程系统获取文件，如下所示：
- en: '[PRE20]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![How to do it...](img/B04234_05_27.jpg)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/B04234_05_27.jpg)'
- en: In the local system, we can now check if the file has been copied successfully
    or not.![How to do it...](img/B04234_05_28.jpg)
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在本地系统上，现在可以检查文件是否已成功复制。![如何做...](img/B04234_05_28.jpg)
- en: SSH also works through GNOME. So, instead of using the command line, we can
    use the GNOME File Explorer to start a SSH connection with the remote system.
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: SSH也可以通过GNOME工作。因此，我们可以使用GNOME文件浏览器与远程系统建立SSH连接，而不是使用命令行。
- en: In the GNOME File Explorer, go to **File** -> **Connect to Server...**.![How
    to do it...](img/B04234_05_29.jpg)
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在GNOME文件浏览器中，转到**文件** -> **连接到服务器...**。![如何做...](img/B04234_05_29.jpg)
- en: In the next window, enter the details as required and click on **Connect**.![How
    to do it...](img/B04234_05_30.jpg)
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个窗口中，按要求输入详细信息，然后单击**连接**。![如何做...](img/B04234_05_30.jpg)
- en: Now we can copy the files graphically from the remote system to the local system,
    or vice-versa.![How to do it...](img/B04234_05_31.jpg)
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们可以以图形方式从远程系统复制文件到本地系统，或者反之。![如何做...](img/B04234_05_31.jpg)
- en: How it works...
  id: totrans-140
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: To copy files remotely over SSH, we use the tool `scp`. This helps with copying
    a single file or a complete directory from the client system to a defined location
    on the server system. For copying directory with all its content we use the `-r`
    option with the command.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 要通过SSH远程复制文件，我们使用`scp`工具。这有助于从客户系统复制单个文件或完整目录到服务器系统上的指定位置。要复制带有所有内容的目录，我们使用命令的`-r`选项。
- en: We use the same tool to copy files from the remote SSH server to the client
    machine. However to do this we need to know the exact location of the file on
    the server.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用相同的工具从远程SSH服务器复制文件到客户机。但是，为此我们需要知道服务器上文件的确切位置。
- en: Like `scp`, we have `sftp` tool, which is used to copy files over `ftp` from
    server to client. **SFTP** (**Secure File Transfer Protocol**) is better than
    FTP and ensures that data is transferred securely.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 与`scp`一样，我们有`sftp`工具，它用于从服务器到客户端复制文件。**SFTP**（**安全文件传输协议**）比FTP更好，并确保数据安全传输。
- en: Lastly we use the GNOME File Explorer to graphically connect and transfer files
    from server to client and vice versa.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们使用GNOME文件浏览器以图形方式连接并在服务器和客户端之间传输文件。
- en: Setting up a Kerberos server with Ubuntu
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Ubuntu设置Kerberos服务器
- en: Kerberos is an authentication protocol for allowing secure authentication over
    untrusted networks by using secret-key cryptography and trusted third parties.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: Kerberos是一种身份验证协议，用于通过使用秘密密钥加密和受信任的第三方在不受信任的网络上进行安全身份验证。
- en: Getting ready
  id: totrans-147
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: To get Kerberos set up and running, we need three Linux systems (in our example,
    we have used Ubuntu). They should be able to communicate with each other and they
    should also have accurate system clocks.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置和运行Kerberos，我们需要三个Linux系统（在我们的示例中，我们使用了Ubuntu）。它们应该能够相互通信，而且它们的系统时钟也应该准确。
- en: 'We have given the hostname to each system as mentioned here:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经为每个系统分配了主机名，如此处所述：
- en: 'Kerberos system: `mykerberos.com`'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kerberos系统：`mykerberos.com`
- en: 'SSH Server system: `sshserver.com`'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSH服务器系统：`sshserver.com`
- en: 'Client system: `sshclient.com`'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端系统：`sshclient.com`
- en: 'After doing this, edit the `/etc/hosts` file in each system and add the following
    details:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 这样做之后，编辑每个系统的`/etc/hosts`文件并添加以下细节：
- en: '![Getting ready](img/B04234_05_32.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![准备就绪](img/B04234_05_32.jpg)'
- en: The IP address and the hostname can be different for your systems. Just make
    sure that after doing these changes they can still ping with each other.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 您的系统的IP地址和主机名可能不同。只需确保在进行这些更改后，它们仍然可以相互ping通。
- en: How to do it...
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Now, let's see how to complete the setup of the Kerberos server and the other
    systems for our example.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看看如何完成Kerberos服务器和其他系统的设置，以供我们的示例使用。
- en: 'The first step is to install the Kerberos server. To do this, we will run the
    given command on the `mykerberos.com` system:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一步是安装Kerberos服务器。为此，我们将在`mykerberos.com`系统上运行给定的命令：
- en: '[PRE21]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The output is shown in the following screenshot:'
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输出如下截图所示：
- en: '![How to do it...](img/B04234_05_33.jpg)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/B04234_05_33.jpg)'
- en: 'During the installation process, a few details will be asked for. Enter the
    details as mentioned here:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在安装过程中，将会询问一些细节。按照这里提到的细节输入：
- en: For the question `Default Kerberos version 5 realm`, the answer in our case
    is `MYKERBEROS.COM`:![How to do it...](img/B04234_05_34.jpg)
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于问题“默认的Kerberos版本5领域”，在我们的情况下答案是“MYKERBEROS.COM”：![如何操作...](img/B04234_05_34.jpg)
- en: For the next question, `Kerberos servers for your realm:` the answer is `mykerberos.com`:![How
    to do it...](img/B04234_05_35.jpg)
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于下一个问题，“您领域的Kerberos服务器：”，答案是“mykerberos.com”：![如何操作...](img/B04234_05_35.jpg)
- en: In the next screen, the question is `Administrative server for your realm:,`
    and its answer is `mykerberos.com`:![How to do it...](img/B04234_05_36.jpg)
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个屏幕上，问题是“您领域的管理服务器：”，答案是“mykerberos.com”：![如何操作...](img/B04234_05_36.jpg)
- en: 'Once we have answered all the questions, the installation process will be resolved.
    The next step is to create a new realm. To do so, we use this command:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦我们回答了所有问题，安装过程将完成。下一步是创建一个新的领域。为此，我们使用这个命令：
- en: '[PRE22]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The output is as shown in the following screenshot:![How to do it...](img/B04234_05_37.jpg)
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输出如下截图所示：![如何操作...](img/B04234_05_37.jpg)
- en: During this process, we will be asked to create a password for the Kerberos
    database. We can choose any password.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在此过程中，我们将被要求为Kerberos数据库创建一个密码。我们可以选择任何密码。
- en: Next, we need to edit the `/etc/krb5.confand` file and modify the details as
    shown in the following screenshot. If any line does not already exist in the file,
    we also need to enter those. Go to the `libdefaults` section in the file and modify
    the value as shown here:![How to do it...](img/B04234_05_38.jpg)
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要编辑`/etc/krb5.confand`文件，并修改如下截图所示的细节。如果文件中不存在任何行，我们还需要输入这些行。转到文件中的`libdefaults`部分，并修改如下所示的值：![如何操作...](img/B04234_05_38.jpg)
- en: Move down to the `realms` section and modify the details as shown here:![How
    to do it...](img/B04234_05_39.jpg)
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到`realms`部分，并修改如下截图所示的细节：![如何操作...](img/B04234_05_39.jpg)
- en: 'Next, go to `domain_realm` section and enter the lines as shown here:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，转到`domain_realm`部分，并输入如下所示的行：
- en: '[PRE23]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'This is shown in the following screenshot:'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如下截图所示：
- en: '![How to do it...](img/B04234_05_40.jpg)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/B04234_05_40.jpg)'
- en: Next, we need to add principles or entries to the Kerberos database which will
    represent users or services on the network. Doing so, we will use the tool `kadmin.local`.
    The principle must be defined for every user that participates in Kerberos authentication.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要向Kerberos数据库添加代表网络上的用户或服务的原则或条目。为此，我们将使用`kadmin.local`工具。必须为参与Kerberos身份验证的每个用户定义原则。
- en: 'Run the tool by typing the following command:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 通过输入以下命令来运行工具：
- en: '[PRE24]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'This will start the `kadmin.local` prompt, as shown here:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 这将启动`kadmin.local`提示，如下所示：
- en: '![How to do it...](img/B04234_05_41.jpg)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/B04234_05_41.jpg)'
- en: 'To see the existing principles, we can type this command:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要查看现有的原则，我们可以输入以下命令：
- en: '[PRE25]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Now to add a principle for a user, we use the `addprinc` command. To add the
    `tajinder` account, we have used the command as shown here:![How to do it...](img/B04234_05_42.jpg)
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，要为用户添加一个原则，我们使用`addprinc`命令。要添加`tajinder`帐户，我们使用如下命令：![如何操作...](img/B04234_05_42.jpg)
- en: To add the `admin` role to the account being added, the command is shown in
    the following screenshot:![How to do it...](img/B04234_05_43.jpg)
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要向正在添加的帐户添加`admin`角色，命令如下所示：![如何操作...](img/B04234_05_43.jpg)
- en: If we give the admin role to any user, then uncomment the `*/admin` line in
    `/etc/krb5kdc/kadm.acl` file.
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们给任何用户分配管理员角色，则取消注释`/etc/krb5kdc/kadm.acl`文件中的`*/admin`行。
- en: 'To check if the principle has been applied correctly, use the following command:'
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要检查原则是否已正确应用，使用以下命令：
- en: '[PRE26]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Once done with the setup of Kerberos system, we now move to the client system.
    First, we need to install the client package for Kerberos by using the command
    shown in the following screenshot:![How to do it...](img/B04234_05_44.jpg)
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成Kerberos系统的设置后，我们现在转移到客户端系统。首先，我们需要使用以下屏幕截图中显示的命令安装Kerberos的客户端软件包：![如何操作...](img/B04234_05_44.jpg)
- en: During the installation process, the same questions will be asked, which were
    asked during the installation of the Kerberos server. Enter the same details here
    as we entered earlier.
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在安装过程中，将会询问与安装Kerberos服务器时相同的问题。在这里输入与之前相同的细节。
- en: After completing installation, check if we are still able to ping `mykerberos.com`
    from the `sshclient.com` system.
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，检查我们是否仍然能够从`sshclient.com`系统ping通`mykerberos.com`。
- en: Now to get the ticket for the client machine, depending on the principle that
    we created in `mykerberos.com`, the command to be used is shown here:![How to
    do it...](img/B04234_05_45.jpg)
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，根据我们在`mykerberos.com`中创建的原则，获取客户端机器的票证所使用的命令如下所示：![如何操作...](img/B04234_05_45.jpg)
- en: If the command runs perfectly, it means it is working fine.
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果命令运行正常，表示它正常工作。
- en: 'Once done with the previous command, we move to the third system which we are
    using as SSH server. We need to install the SSH server and `krb5-config` package
    on this system. To do so, we run the command as shown here:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 完成上一个命令后，我们转移到第三个系统，即我们正在使用的SSH服务器。我们需要在该系统上安装SSH服务器和`krb5-config`软件包。为此，我们运行以下命令：
- en: '![How to do it...](img/B04234_05_46.jpg)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/B04234_05_46.jpg)'
- en: Again, we will be asked the same questions which were asked during the installation
    of the Kerberos server. Enter the same details here as previously.
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同样，我们将被问及在安装Kerberos服务器时提出的相同问题。在这里输入与之前相同的细节。
- en: Now edit the `/etc/ssh/sshd_config` file to enable the following lines:![How
    to do it...](img/B04234_05_47.jpg)
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在编辑`/etc/ssh/sshd_config`文件以启用以下行：![如何操作...](img/B04234_05_47.jpg)
- en: 'Remove the `#` and also change the value to `yes` if it is not already. After
    making the changes, restart the SSH server using the following command:'
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 删除`#`，如果尚未更改，则将值更改为`yes`。进行更改后，使用以下命令重新启动SSH服务器：
- en: '[PRE27]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Next, we will configure Kerberos server so that it works with the SSH server.
    To do so, we run the `kadmin.local` tool and then run the following commands:![How
    to do it...](img/B04234_05_48.jpg)
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将配置Kerberos服务器，使其与SSH服务器配合工作。为此，我们运行`kadmin.local`工具，然后运行以下命令：![如何操作...](img/B04234_05_48.jpg)
- en: The above command in the image adds the principle for the SSH server. Next,
    we run the command shown in the following screenshot to create the key file:![How
    to do it...](img/B04234_05_49.jpg)
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 图像中的上述命令为SSH服务器添加了原则。接下来，我们运行以下屏幕截图中显示的命令以创建密钥文件：![如何操作...](img/B04234_05_49.jpg)
- en: Now we shall copy the key file from the Kerberos server system to the SSH server
    system using this command:![How to do it...](img/B04234_05_50.jpg)
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们将使用以下命令将密钥文件从Kerberos服务器系统复制到SSH服务器系统：![如何操作...](img/B04234_05_50.jpg)
- en: We have copied the file to `/tmp/` directory of the SSH server system. Once
    the copy completes, move the file to the `/etc/` directory.
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们已将文件复制到SSH服务器系统的`/tmp/`目录。复制完成后，将文件移动到`/etc/`目录。
- en: 'Now on the client system, edit the `/etc/ssh/ssh_config` file and modify the
    lines as shown:'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在在客户端系统上，编辑`/etc/ssh/ssh_config`文件，并修改如下行：
- en: '[PRE28]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Now on the client system, get the ticket by running this command:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在在客户端系统上，通过运行以下命令获取票证：
- en: '[PRE29]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Once the above command works, try to log in into the SSH server system from
    the client system using `ssh`:![How to do it...](img/B04234_05_51.jpg)
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦上述命令生效，尝试使用`ssh`从客户端系统登录到SSH服务器系统：![如何操作...](img/B04234_05_51.jpg)
- en: We should get authenticated without being asked for the password.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该在不被要求输入密码的情况下得到认证。
- en: How it works...
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: First, we install the required packages on the first system to create a Kerberos
    server. After installation, a realm is created for server configuration. To complete
    the configuration, we perform the changes as mentioned in the `/etc/krb5.conf`
    file.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，在第一个系统上安装所需的软件包以创建Kerberos服务器。安装完成后，为服务器配置创建一个领域。为了完成配置，我们执行`/etc/krb5.conf`文件中提到的更改。
- en: Then, we add a principle to the Kerberos database to add the user account to
    be used.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们向Kerberos数据库添加一个原则，以添加要使用的用户帐户。
- en: Once this is done, we move to the next system and install the Kerberos user
    package to create the client system. Then, we get a ticket from the Kerberos server
    system for the user account to be used on the client.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，我们转移到下一个系统，并安装Kerberos用户软件包以创建客户端系统。然后，我们从Kerberos服务器系统获取用户帐户的票证，以在客户端上使用。
- en: Next, we proceed to the third system where we install the `Openssh-server` package
    to create a SSH server. Then, we edit the configuration file of SSH to enable
    authentication.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们继续到第三个系统，在那里我们安装`Openssh-server`软件包以创建SSH服务器。然后，我们编辑SSH的配置文件以启用身份验证。
- en: We now come back to the Kerberos server system and add a principle for the SSH
    server. We create a key for the SSH server and then transfer this key file from
    the Kerberos server to the SSH server using the `scp` command.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们回到Kerberos服务器系统，并为SSH服务器添加一个原则。我们为SSH服务器创建一个密钥，然后使用`scp`命令将该密钥文件从Kerberos服务器传输到SSH服务器。
- en: Now if we try to log in to the SSH server system from the client system, we
    get logged in without being asked for the password, as the key we generated earlier
    is being used for authentication.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果我们尝试从客户端系统登录到SSH服务器系统，我们会在不需要输入密码的情况下登录，因为我们之前生成的密钥被用于身份验证。
