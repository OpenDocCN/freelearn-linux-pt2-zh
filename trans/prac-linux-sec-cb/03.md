# 本地文件系统安全性

在本章中，我们将讨论以下内容:

*   使用`ls`查看文件和目录详情
*   使用`chmod`设置文件和目录的权限
*   使用`chown`更改文件和目录的所有权
*   使用 ACL 访问文件
*   用 SELinux 实现强制访问控制
*   使用扩展文件属性保护敏感文件
*   使用`mv`命令进行文件处理(移动和重命名)
*   在 Ubuntu 上安装和配置基本的 LDAP 服务器

# 使用 ls 查看文件和目录详细信息

`ls`命令用于列出目录中的文件，类似于 DOS 中的`dir`命令。该命令可以与各种参数一起使用，以给出不同的结果。

# 准备好

由于`ls`命令是 Linux 中的内置命令，我们不需要安装其他任何东西来使用它。

# 怎么做…

现在，让我们看看我们如何通过以下步骤以不同的方式使用`ls`来获得各种结果:

1.  要查看当前目录中文件的简单列表，请键入`ls`:

![](assets/1eaf670a-653b-45f1-8d70-51fbe6b05096.png)

2.  要获得使用`ls`命令列出的文件和目录的更多信息，请添加类型标识符，如下所示:

![](assets/5855e3e6-8059-4cbc-8c07-57d3f0a25fa6.png)

3.  当使用前面的标识符时，可执行文件在名称的末尾有一个星号，而目录有一个斜杠，以此类推。要查看文件的详细信息，如创建日期、所有者和权限，请运行带有`l`标识符的命令，如下所示:

![](assets/32345510-763f-4056-9dd9-e8b69833c823.png)

4.  要查找当前目录中所有隐藏文件的列表，请使用`a`标识符，如下所示:

![](assets/065e6007-4fb9-4a1e-8427-8d2b5b59fb12.png)

5.  以句点开头的文件(也称为点文件)是隐藏文件，如果不使用`–an`选项，则不会显示。

要以可读形式打印文件大小，如 MB、GB、TB 等，而不是以字节为单位打印，我们可以将`-h`标识符与`-l`标识符一起使用，如下所示:

![](assets/54f34c79-25a1-4961-a3f9-feedbafbb064.png)

6.  如果您希望排除所有文件并只显示它们的子目录，那么您可以使用如下的`-d`选项:

![](assets/0629a12f-7765-4e32-a39e-eddc42988b30.png)

7.  当与`-R`选项一起使用时，`ls`命令也将显示子目录的内容:

![](assets/89c1aa34-8c3c-4050-87f9-7d35914493f9.png)

# 它是如何工作的…

当我们对`ls`命令使用不同的选项时，它在列出目录方面会给我们不同的结果。根据我们的要求，我们可以使用任何选项。

建议你养成使用`ls –lah`的习惯，这样你总能找到可读大小的列表。

# 使用 chmod 设置文件和目录的权限

**chmod** ，或 **Change Mode** ，是一个用于修改文件和目录访问权限的 Linux 命令。每个人都希望保持他们的数据安全和适当的组织。因此，Linux 有一个概念，即将所有者和组与每个文件和目录相关联。这些所有者和组拥有不同的权限来访问特定的文件。

# 准备好了

在我们看到`chmod`命令的使用之前，我们需要知道，对于不同类型的用户，所使用的符号表示如下:

*   `u`用于用户/所有者
*   `g`用于分组
*   `o`用于他人

现在，让我们创建一个名为`file1.txt`的文件来检查 chmod 的不同命令。

# 怎么做...

现在，我们将看到如何以不同的方式使用 chmod 来设置不同的权限:

1.  我们首先检查文件的当前权限及其创建时间:

![](assets/2ff419a0-d906-4059-ba18-c7e47235094b.png)

我们可以看到，目前只有用户/所有者拥有读写权限，而组和其他用户只有读取权限。

2.  现在，让我们使用`+`符号为所有者更改单个权限，该符号用于添加权限:

```
chmod u+x file1.txt
```

![](assets/58ffd21c-9947-4c11-b88d-69709a9158a8.png)

此命令将为文件所有者添加执行权限。

3.  要添加多个权限，我们可以在一个命令中完成同样的操作。我们只需要用逗号分隔不同的权限，如下所示:

```
chmod g+x,o+x file1.txt
```

![](assets/03134130-a54e-44e6-b319-b3436b67cecf.png)

此命令将为该文件的组和其他用户添加执行权限。

4.  如果我们希望删除权限，只需使用`-`符号代替`+`，如下图所示:

```
chmod o-x file1.txt
```

![](assets/74c3e6ea-f854-42df-a4a9-b0c9ce35e396.png)

这将删除特定文件的其他用户的执行权限。

5.  如果我们希望为所有用户(所有者、组和其他人)添加或删除权限，这可以通过使用`a`选项的单个命令来完成，该选项表示所有用户。

要为所有用户添加读取权限，请使用以下命令:

```
chmod a+r file1.txt
```

要删除所有用户的读取权限，请使用以下命令:

```
chmod a-r file1.txt
```

![](assets/3ffcb4fc-07d5-4703-8dcc-874e17efd5bd.png)

6.  假设我们想给目录中的所有文件添加一个特定的权限。一种方法是我们已经看到的，对所有文件单独运行命令。相反，我们可以使用`-R`选项，这意味着给定的操作是递归的。因此，要为目录中的所有文件添加其他用户的执行权限，命令将是这样的:

```
chmod o+x -R /dir1
```

![](assets/142056ae-55c5-4c9d-aaa3-117b6cd4d28b.png)

7.  我们还可以使用`reference`选项将特定文件的权限复制到另一个文件中:

```
chmod --reference=file2 file1
```

![](assets/13611a95-3019-465c-99ce-e78aa10d34ed.png)

在这里，我们已经将`file2`的权限应用到了另一个名为`file1`的文件中。同一命令可用于将一个目录的权限应用于另一个目录。

# 它是如何工作的...

当 chmod 与符号表示一起使用时，我们知道以下内容:

*   `u`用于用户/所有者
*   `g`用于分组
*   `o`用于他人

此外，不同的权限如下:

*   r:阅读
*   女:写
*   x:执行

因此，使用这些命令，我们可以根据我们的要求更改用户、组或其他人的权限。

# 还有更多...

使用 chmod 可以使用数字设置权限，也称为八进制表示。我们可以使用此方法同时编辑所有者、组和其他人的权限。该命令的语法如下:

```
chmod xxx file/directory
```

这里，xxx 指的是 1-7 之间的三位数。第一位数字表示所有者的权限，第二位代表组，第三位数字表示其他人的权限。

当我们使用八进制表示时，r、w 和 x 权限具有特定的数值:

*   r = 4
*   w = 2
*   x = 1

因此，如果我们想添加读取和执行权限，它将按如下方式计算:

*   r-x = 4+0+1 = 5

同样，读取、写入和执行的权限计算如下:

*   rwx = 4+2+1 = 7

如果我们希望只给予读权限，它将是这样的:

*   r - = 4+0+0 = 4

因此，现在，如果我们运行给定的命令，它将按计算给出权限:

```
chmod 754 file1.txt
```

![](assets/4ad69d19-527c-48f6-8185-40f7fe3cb1fb.png)

# 使用 chown 更改文件和目录的所有权

文件所有权是 Linux 的基础。由于每个文件都与一个所有者和一个组相关联，因此我们可以使用`chown`命令来更改文件或目录的所有者。

# 怎么做...

要了解`chown`的用法，我们按照以下步骤操作:

1.  为了理解`chown`命令的用法，让我们创建一个名为`file1.txt`的文件和一个名为`user1`的用户:

![](assets/814962fe-0a6e-470e-b0b8-ab7b04bcd718.png)

用于更改密码信息的前一个命令是可选的。如果你愿意，你可以忽略它。

2.  现在，我们来看看`file1.txt`的当前所有者。

我们可以看到这两个文件的当前所有者都是 root，并且属于 root 组。

3.  让我们将`file1.txt`的所有权变更为`user1`:

![](assets/ef69031f-109a-410f-8f93-45ebd96cecc9.png)

如这里所见，`file1.txt`的拥有者现在已经变成了`user1`。

4.  如果我们想改变一个文件的组，我们也可以使用`chown`来实现:

![](assets/f3035b26-7ed1-4b31-839d-ef0d53c9c5c8.png)

5.  我们可以在一个命令中更改文件的所有者和组，如下所示:

![](assets/5bd5d7b2-8712-4fff-9b0f-80663635a5fa.png)

我们可以看到`file2.txt`的拥有者和群体都发生了变化。

6.  如果我们希望递归地更改目录及其内容的所有权，我们可以这样做，如下所示:

![](assets/0f141356-75e2-4fdd-a8c7-66b4fabc5ea8.png)

7.  Chown 还可用于将所有者/组权限从一个文件复制到另一个文件:

![](assets/59a26040-d415-4f1c-99c6-df12c5a1ca72.png)

# 还有更多...

如果我们希望详细列出`chown`命令所做的更改，我们可以使用以下命令:

![](assets/699840b0-e58f-41dd-888d-27452c1abfcc.png)

# 使用 ACL 访问文件

使用`chmod`实现基本的文件权限是不够的，我们可以使用 ACL，或者*访问控制列表*。除了为特定文件的所有者和组提供权限之外，我们还可以使用 ACL 为任何用户、任何用户组或不在特定用户组中的一组所有用户设置权限。

# 准备好了

在使用 ACL 之前，我们检查它是否已启用:

1.  为此，我们尝试查看任何文件的 ACL，如下所示:

![](assets/7829684c-7691-4c4d-9041-9be4092d6785.png)

如果启用了 ACL，此命令将显示如下输出。在我们的例子中，它们没有为`/dev/sda1`启用，因为它没有在挂载选项中列出。

2.  要启用 ACL，我们将使用以下命令将其添加到文件系统中:

![](assets/a17a5e94-8078-426b-86d6-d21bfd0c91dc.png)

3.  现在，再次运行`tune2fs`命令，确认 ACL 已启用:

![](assets/1a55be24-69f1-4da7-98dc-058ad9063382.png)

现在，我们可以在`/dev/sda1`分区中看到 ACL 选项。

# 怎么做...

为了理解 ACL 的工作原理，让我们遵循以下步骤:

1.  我们将首先检查任何文件或目录的默认 ACL 值。为此，我们使用`getfacl`命令:

![](assets/7c59a5c8-ba8e-417b-90b6-7b70ab08b0bf.png)

2.  现在，要在`file1.txt`上设置 ACL，我们将使用以下命令:

![](assets/e8d79916-7432-49b7-8d88-846e6b4b9285.png)

在前面的命令中，我们已经给了根用户`file1.txt`文件的`rwx`访问权限。

当我们使用`getfacl`再次检查时，我们可以看到新的 ACL 值。

3.  运行给定命令，确认`file1.txt`上的 ACL 设置:

![](assets/7ba86c7e-c85d-40c2-b71a-6180433b9ddb.png)

文件权限后的(`+`)号确认设置了 ACL。

4.  我们也可以使用`setfacl`命令递归地在文件夹上设置一个 ACL。首先，我们将使用`getfacl`检查`dir1`目录的默认 ACL:

![](assets/b073351e-c63d-4117-9082-92de4864bcb0.png)

5.  现在，让我们使用`setfacl`添加对`dir1`目录的`rwx`访问:

![](assets/82f8563b-98a6-4d4c-b921-a1c6a5aaddbd.png)

6.  现在，我们可以使用给定的命令确认 ACL 已在目录中设置:

![](assets/739e3c85-4fc0-4cc7-b341-b90795cefb1c.png)

7.  现在，让我们检查一下`file1.txt`上`user1`组的 ACL:

![](assets/d19453dc-c648-4c44-ad71-40d60c1c31b0.png)

8.  让我们在`file1.txt`上设置`rwx`访问群组`user1`:

![](assets/4d91341e-c770-4dab-8981-66ddb303a8b5.png)

# 还有更多...

每当我们处理文件权限时，如果您的文件很重要，最好备份一下权限。

在这里，我们假设我们有一个包含一些重要文件的`dir1`目录。然后，我们首先导航到`dir1`目录，并使用以下命令备份权限:

```
getfacl -R * > permissions.acl
```

![](assets/e1f95cd0-e827-4252-815a-2f947b7b6ee1.png)

该命令创建权限的备份并将其存储在`permissions.acl`中。

现在，如果我们想恢复权限，命令如下:

```
setfacl --restore=permissions.acl
```

![](assets/ab45ee42-99e4-423f-8683-83d7c3a08411.png)

这将把所有权限恢复到创建备份时的位置。

# 使用 mv 命令处理文件(移动和重命名)

`mv`或`move`命令用于将文件从一个目录移动到另一个目录，而不会创建任何副本，这与`cp`或复制命令不同。

# 准备好

由于`mv`是 Linux 上的内置命令，我们不需要配置其他任何东西来了解它的工作原理。

# 它是如何工作的...

让我们通过不同的例子来看看如何使用`mv`命令:

1.  要将`testfile1.txt`从当前目录移动到任何其他目录，如`- home/practical` / `example`，命令如下:

```
    mv testfile1.txt /home/practical/example
```

![](assets/1a1fb844-c8bd-4478-8fb8-91d84ca24b8e.png)

只有当源文件的位置不同于目标位置时，此命令才有效。

当我们使用前面的命令移动文件时，文件将从原始位置被删除。

2.  要使用单个命令移动多个文件，我们可以使用以下命令:

```
mv testfile2.txt testfile3.txt testfile4.txt /home/practical/example
```

使用前面的命令时，我们要移动的所有文件都应该在同一个源位置。

3.  要移动目录，该命令与用于移动文件的命令相同。假设我们在当前工作目录中有一个`directory1`目录，我们想把它移动到`/home/practical/example`位置；命令如下:

```
    mv directory1 /home/practical/example
```

![](assets/d68088f2-b8ac-49c5-8dc2-0c59a52598d9.png)

4.  `mv`命令也用于重命名文件和目录。假设我们有一个文件，`example_1.txt`，我们希望将其重命名为`example_2.txt`。执行此操作的命令如下:

```
    mv example_1.txtexample_2.txt 
```

此命令仅在源和目标相同时有效:

![](assets/58d9bbe7-c96a-4bfa-a47c-e93a40c1409c.png)

5.  重命名目录的工作方式与重命名文件相同。假设我们有一个目录，`test­­_directory_1`，我们想把它改名为`test­­_directory_2`；命令如下:

```
    mv test­­_directory_1/ test­­_directory_2/
```

![](assets/82ec9116-5d4b-423a-b02d-12f01b645979.png)

6.  当我们使用`mv`命令移动或重命名大量文件或目录时，我们可以在使用该命令时通过使用`-v`选项来检查该命令是否成功工作。

假设我们想把所有的文本文件从当前目录移到`/home/practical/example`，我们想保证它能正常工作；命令如下:

```
    mv -v *.txt /home/practical/example
```

![](assets/59dc98e6-fdc6-4870-b144-0c6b71a93174.png)

移动或重命名目录时也是如此，如下所示:

![](assets/c918ffce-71c6-4ec1-a8f5-942db34e1305.png)

7.  当我们使用`mv`命令将一个文件移动到另一个位置，并且同名文件已经存在时，那么当使用默认命令时，现有文件将被覆盖。但是，如果我们希望在覆盖文件之前显示弹出通知，那么我们必须使用`-i`选项，如下所示:

```
mv -i testfile1.txt /home/practical/example
```

![](assets/2d2f215f-732a-4af9-ae4c-0df22369c231.png)

当前面的命令运行时，它将通知我们目标位置已经存在同名文件。只有当我们按下 *Y* 时，命令才会完成，否则会被取消。

8.  当使用`mv`命令将文件移动到已经存在同名文件的另一个位置时，如果我们使用`-u`选项，只有当源文件比目标文件新时，它才会更新目标位置的文件。

我们在源位置有两个文件，`file_1.txt`和`file_2.txt`。首先，使用`ls`命令检查文件的详细信息:

```
    ls -l *.txt
```

现在，让我们检查目标位置的文件的详细信息:

```
    ls -l /home/practical/example/*.txt
```

现在，使用给定的命令移动文件:

```
    mv -uv *.txt /home/practical/example/
```

![](assets/f9b21aff-cfe3-4500-9676-f732d1c8570a.png)

我们看到`file1.txt`和`file2.txt`已经移动到目的地位置，由于源文件的时间戳较新，更新了较早的文件。

9.  我们在源位置有两个文件，`file_1.txt`和`file_2.txt`。首先，使用以下命令检查文件的详细信息:

```
    ls -l *.txt  
```

现在，使用以下命令移动文件:

```
    mv -vn *.txt /home/practical/example/
```

现在，让我们检查目标位置的文件的详细信息:

```
    ls -l /home/practical/example/*.txt
```

我们看到同名文件没有被移动，这可以通过观察时间戳来检查:

![](assets/c6e7038e-5b33-4aa7-b2c9-5b6ddc445777.png)

10.  移动文件时，如果目标位置已经有一个同名文件，那么我们也可以在新文件覆盖目标文件之前创建一个备份。为此，我们使用`-b`选项:

```
    mv -bv *.txt /home/practical/example
```

现在，让我们检查目标位置的文件的详细信息。

我们在细节中看到我们有名为`file1.txt~`和`file2.txt~`的文件。这些文件是备份文件，可以通过时间戳来验证，比`file1.txt`和`file2.txt`的都要老；

![](assets/5ab6454a-a1c1-4845-ae90-4cb65cf7a60e.png)

# 用 SELinux 实现强制访问控制

**SELinux** (简称**安全增强 Linux** )，是一款灵活的强制访问控制(MAC)，旨在克服标准 ugo/rwx 权限和 ACL 的限制。

# 准备好

在大多数 Linux 发行版中，如 CentOS 和 Redhat，SELinux 默认情况下被合并到内核中。但是，如果我们正在处理任何其他发行版，例如 Debian，我们可能必须在系统上安装和配置 SELinux:

1.  首先，我们必须通过运行以下命令来获得 SELinux 实用程序和默认策略的基本集合:

![](assets/0c1ab45b-2d7c-4582-816b-dcda933fc4e6.png)

2.  安装完成后，运行以下命令配置 GRUB 和 PAM，并创建`/autorelabel`:

![](assets/d4e98939-f819-4207-9f1c-790d5039209b.png)

此后，您必须重新启动系统，以便在启动时标记文件系统。

3.  重新启动后，当系统启动时，您可能会收到以下警告:

![](assets/986440c4-666a-402e-b7fb-c4f217985eb1.png)

现在，我们有了一个运行良好的 SELinux 系统。

# 怎么做...

一旦我们有了一个可以运行的 SELinux 系统，我们就可以选择如何使用它:

1.  SELinux 可以以两种不同的方式运行:强制和许可。
2.  让我们使用`getenforce`命令检查当前模式:

![](assets/7a0dd6ac-ad1f-4ad8-ae10-76bd5f46ce09.png)

正如我们所看到的，SELinux 目前正在许可模式下工作。

3.  现在，如果我们希望切换模式，我们可以使用`setenforce`命令:

![](assets/3d5b6919-defa-436f-9680-30a8fa681ebf.png)

当我们使用选项 1 运行前面的命令时，模式变为强制执行。

4.  如果我们想切换回许可模式，我们可以再次使用带有选项 0 的`setenforce`命令:

![](assets/a9a61390-a532-482c-8e1b-cef70e98f2c8.png)

现在，模式已经变回许可模式。

5.  此更改不会在系统重新启动后继续存在。如果我们想永久改变模式，我们必须编辑`/etc/selinux/config`文件，并将 SELinux 变量更改为我们想要的:强制、许可或禁用。
6.  每当应用程序运行不正常或不能按预期工作时，作为故障排除的一部分，我们应该尝试在 SELinux 模式之间切换(从强制到许可，反之亦然)。这将有助于我们了解应用程序在更改为许可模式后是否工作。如果是，那么我们知道这是一个 SElinux 权限问题。

# 它是如何工作的...

SELinux 以两种模式运行，强制和许可。在强制模式下工作时，SELinux 根据 SELinux 策略规则的定义方式拒绝访问。这些规则是控制安全引擎的指南的一部分。

当 SELinux 在许可模式下工作时，它不会拒绝访问，但会记录在强制模式下被拒绝的任何操作。

可以修改 SELinux 规则，以允许在强制模式下被拒绝的任何应用程序或服务。

# 还有更多...

您可以通过键入`man mv`或`mv --help`来了解更多关于`mv`命令的信息。这将显示它的手动页面，我们可以在其中探索关于该命令的更多细节。

# 使用扩展文件属性保护敏感文件

扩展属性是一种在文件中存储元数据的可扩展方式。这些是与文件和目录相关联的名称-值对。几个文件系统支持扩展的文件属性，可以进一步定制允许的文件操作。

# 准备好

目前，在 Linux 中，扩展文件属性有四种不同的名称空间:

*   `user`
*   `trusted`
*   `security`
*   `system`

许多工具可用于操作扩展属性，这些通常包含在大多数 Linux 发行版附带的`attr`包中。

如果您的系统中没有安装`attr`，只需执行以下命令进行安装:

```
sudo apt-get install attr
```

要检查这个包是否安装在我们的系统上，只需在终端中运行`attr`。如果出现如下所示的输出，它将确认软件包已安装:

![](assets/f8d07d86-6ec1-4938-a97a-84d5bff2f236.png)

下一步是检查内核是否支持该属性。可以使用以下命令进行检查:

![](assets/9dbf665e-68de-4b5c-a0b5-7247b50b807c.png)

输出确认内核有属性支持。

我们还需要确认文件系统是用`user_xattr`选项挂载的。为了确认这一点，我们运行以下命令:

![](assets/8266c8ab-4daa-4be0-8fd0-7c3911471488.png)

# 怎么做...

一旦我们确认了上一节中提到的所有要求，我们就可以继续了解如何使用扩展属性:

1.  首先，我们将创建一个测试文件，其中包含一些虚拟数据:

![](assets/c742473c-b857-47ea-acfb-041c98cf0f0b.png)

2.  现在，我们将使用`setfattr`命令向该文件添加一个扩展属性:

![](assets/06ea09dd-fa24-4d49-b418-b86ebafd1f8a.png)

3.  现在，让我们使用`getfattr`命令来确定文件的属性:

![](assets/7bf1b227-c31a-4ecf-bbf2-d26ef0e842bb.png)

4.  如果我们想检查属性值，可以使用以下命令:

![](assets/4f8782dd-d136-4810-a670-496ecef33ff8.png)

5.  在任何时候，如果我们想要移除任何属性，我们可以使用`setfattr`命令来做同样的事情，但是使用`-x`选项。

# 在 Ubuntu 上安装和配置基本的 LDAP 服务器

**轻量级目录访问协议** ( **LDAP** )是一种用于管理从某个集中位置对文件和目录层次结构的访问的协议。LDAP 主要用于集中认证。

LDAP 服务器有助于控制谁有权读取和更新目录中的信息。

# 准备好

要安装和配置 LDAP，我们需要首先创建一个 Ubuntu 服务器。Ubuntu 服务器安装介质的当前版本可以在这里找到:[http://www.ubuntu.com/download/server](http://www.ubuntu.com/download/server)。

下载后，按照提供的步骤安装 Ubuntu 服务器。

我们需要第二个安装了 Ubuntu 桌面版本的系统。这将用于通过网络界面访问您的 LDAP 服务器。

完成后，我们就可以继续安装 LDAP 了。

# 怎么做...

我们现在将开始在 Ubuntu 服务器上安装和配置 LDAP:

1.  我们将首先从 Ubuntu 的存储库中更新服务器上的包列表，以获取所有包的最新版本及其依赖关系的信息:

```
sudo apt-get update
```

2.  现在，运行命令安装`slapd`包和一些相关的实用程序，运行`ldap-utils`安装 LDAP 服务器:

![](assets/c7947761-3708-4b04-bc8c-65cfab4ba829.png)

3.  在安装过程中，当出现提示时，输入并确认管理员密码，该密码将用于 LDAP 的管理员帐户。配置您选择的密码并继续安装过程。
4.  一旦软件包安装完毕，我们将根据我们的要求重新配置 LDAP 软件包。为此，请键入以下命令:

```
Sudo dpkg-reconfigure slapd
```

这将引发一系列关于软件配置的问题。我们需要根据我们的要求逐一选择选项。

5.  问的第一个问题是省略 OpenLDAP 服务器配置？选择否并继续:

![](assets/f5c3a78d-5865-45d9-ba5f-3a96845741da.png)

6.  接下来，输入域名。可以使用服务器上已经存在的域名，也可以创建新的域名。我们将在这里使用`example.com`:

![](assets/e6fff28c-2373-4748-a587-f157b719c7bf.png)

7.  接下来，进入`Organization name`:

![](assets/2e09a4df-f3d5-4d4a-9ae0-c5ec7f328f28.png) -

8.  接下来，配置 LDAP 的管理员密码。请使用安装过程中配置的相同内容，或者在此步骤中将其更改为其他内容。
9.  接下来，设置要使用的数据库后端。选择`MDB`并继续:

![](assets/e612be60-1c9d-468c-a5c8-6e8411b92197.png)

10.  现在，系统将询问您是否希望在 slapd 被清除时删除数据库。在此选择**否**。
11.  接下来，选择是移动旧数据库并允许配置过程创建新数据库:

![](assets/c2e74dfc-97cf-4d11-a0cd-eba83e31d1ad.png)

12.  当被问及`Allow LDAPv2 protocol?`选择`No`时，由于最新版本是 LDAPv3，现在 LDAPv2 已经过时:

![](assets/8b37381d-0e75-42cf-bf7d-79a542a97c39.png)

13.  此时，配置过程已经完成，LDAP 正在运行:

![](assets/15b5c75f-7edb-4ff5-9d70-72c0ba66c778.png)

14.  现在让我们打开 LDAP 的防火墙端口，以便外部用户可以使用它:

![](assets/5e5ffd54-7219-4012-89cf-a55d40157f2e.png)

15.  我们现在将安装 PHPldapadmin 包，这将有助于通过网络界面管理 LDAP:

```
sudo apt-get install phpldapadmin
```

![](assets/fe6225ff-64d3-47fd-b102-7eaa8b2518dc.png)

安装完成后，编辑 PHPldapadmin 的配置文件以配置一些值:

```
Sudo nano /etc/phpldapadmin/config.php
```

16.  现在，搜索给定的部分并修改它以反映 Ubuntu 服务器的域名或 IP 地址:

```
$servers->setValue('server','host','domain_name_or_IP_address');
```

17.  接下来，编辑以下条目并插入我们在重新配置`slapd`时给出的域名:

```
$servers->setValue('server','base',array('dc=example,dc=com'));
```

将域名作为值赋予上一行中的`dc`属性。由于我们的域名是`example.com`，上一行的值将被输入为`dc=example, dc=com`。

18.  接下来，找到下面一行，再次输入域名作为`dc`属性。对于`cn`属性，该值仅为`admin`:

```
$servers->setValue('login','bind_id','cn=admin,dc=example,dc=com');
```

19.  现在，搜索内容如下的部分，首先取消对该行的注释，然后将该值设置为`true`:

```
$config->custom->appearance['hide_template_warning'] = true;
```

完成所有这些更改后，保存并关闭文件。

20.  当 PHPldapadmin 的配置完成后，在另一个系统中打开一个浏览器，它有 Ubuntu 的桌面版本。在浏览器的地址栏中，输入域名或服务器的 IP 地址，后跟`/phpldapadmin`:

```
domain_name_or_IP_address/phpldapadmin
```

21.  一旦打开 PHPldapadmin 页面，在左侧我们会看到登录链接。点击它，你会得到一个登录提示:

![](assets/1010e3d9-a24a-4e50-8a3e-34521a27068d.png)

如果 PHPldapadmin 配置正确，登录屏幕将显示正确的登录域名详细信息:

![](assets/995949ad-6294-4c58-800c-0250856c5d7b.png)

在我们的情况下，这是`cn=admin,dc=example,dc=com`。

22.  正确输入管理员密码后，将显示管理界面:

![](assets/d51ceec9-28dd-4085-80f8-aa0c8baa0d1e.png)

23.  在管理界面上，在您看到域组件(`dc=example,dc=co`)的左侧，单击它旁边的加号。它将显示正在使用的管理员登录:

![](assets/e4220f48-1d92-4616-9fc7-60e0f0956757.png)

24.  我们的基本 LDAP 服务器现在已经设置并运行。

# 它是如何工作的...

我们首先创建一个 Ubuntu 服务器，然后在它上面安装`slapd`包来安装 LDAP。一旦安装完成，我们将安装所需的附加软件包。然后，我们根据我们的要求重新配置 LDAP。

一旦重新配置完成，我们将安装 PHPldapadmin 包，这将有助于我们使用浏览器通过 web 界面管理 LDPA 服务器。