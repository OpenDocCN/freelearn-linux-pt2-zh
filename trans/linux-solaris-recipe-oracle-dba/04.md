# 四、创建和编辑文件

如果您想在 Linux 或 Solaris 环境中生存，您必须至少精通一种命令行文本编辑器。DBA 每天都使用文本编辑器来操作数据库初始化文件，创建脚本来自动化任务，修改 OS 调度程序作业，等等。在这些环境中，除非您精通文本编辑器，否则您不会成为高效的数据库管理员。

有几十个文本编辑器可用。为此，已经有整本书写在可用的文本编辑器上。三个最常用的命令行文本编辑器是`vi`、`vim`和`emacs`。本章重点介绍`vi`文本编辑器(读作“vee-eye”或有时读作“vie”)。我们选择专注于这个编辑器，原因如下:

*   在所有的 Linux/Solaris 系统上，编辑器都是通用的。
*   Linux/Solaris 技术专家倾向于使用`vi`多于其他任何编辑器。
*   你不能认为自己是一个真正的极客，除非你知道`vi`。

本章的目标是给你足够的信息来有效地使用`vi`编辑器。我们没有涵盖`vi`的每一个方面；相反，我们将重点放在您执行日常编辑任务最常用的功能上。当你第一次使用`vi`时，你可能想知道为什么有人会使用这样一个令人困惑的文本编辑工具。对于新手来说，`vi`的许多方面最初看起来是违反直觉的。

不用担心；通过一些解释、示例和实践，您将学习如何使用这个编辑工具有效地创建和操作文本文件。这一章包含的内容足够让你从`vi`开始。所描述的问题是最常遇到的编辑任务。

如果您是第一次接触`vi`，我们强烈建议您不仅阅读本章中的解决方案，还要实际启动一个`vi`会话，练习输入示例中显示的命令。就像骑自行车一样；除非你骑上自行车并试图向前，否则你无法学会如何骑车。`vi`也是一样。你不能只是阅读如何使用这个工具；在学习开始之前，你必须输入命令。

Note

本章中的所有解决方案和示例也几乎同样适用于`vim`编辑器。改进的(`vim`)编辑器为`vi`提供了许多增强。在许多系统上，你可能正在使用`vim`，却没有意识到。可以将`vi`编辑器自动定义为别名或指向`vim`可执行文件的软链接。

## 4-1.创建文件

### 问题

您需要创建一个文本文件。

### 解决办法

要创建名为`foo.txt`的文件，请从命令行运行`vi`实用程序，如下所示:

`$ vi foo.txt`

您现在应该会看到一个空白屏幕，在屏幕的最左边一列显示了几个波浪号(`∼`)字素。在由`vi`编辑的文件中，`∼`字符表示其中没有文本的一行。根据您的`vi`版本，您可能会在左下角看到您的文件名:

`"foo.txt" [New file]`

要输入文本，首先键入`i`。小写的 I 将编辑器置于插入模式。现在，您可以在文件中输入文本。要保存您的更改并退出`vi`，首先按 Escape 退出插入模式并进入命令模式，然后键入`:wq`表示写入并退出:

`:wq`

现在，您应该回到操作系统命令提示符下。您可以使用`ls`命令验证新文件是否已经创建:

`$ ls foo.txt`

`foo.txt`

Note

参见配方 4-2，了解如何在文件内移动光标。

### 它是如何工作的

启动`vi`最常见的方式是为它提供一个要操作的文件名:

`$ vi <filename>`

首次调用`vi`时，有几个选项可用。表 [4-1](#Tab1) 列出了一些更常用的命令行选项。

表 4-1。

Some Helpful `vi` Command-Line Startup Options

<colgroup><col> <col></colgroup> 
| [计]选项 | 行动 |
| --- | --- |
| `vi` | 开始在内存中编辑会话。 |
| `vi <file>` | 启动会话并打开指定的文件。 |
| `vi <file>*` | 打开第一个匹配通配符模式的文件。使用`:n`导航到下一个匹配的文件。 |
| `view <file>` | 以只读模式打开文件。 |
| `vi -R <file>` | 以只读模式打开文件。 |
| `vi -r <file>` | 从编辑会话异常中止(如系统崩溃)后恢复文件和最近的编辑。 |
| `vi +n <file>` | 在指定的行号`n`处打开文件。 |
| `vi + <file>` | 在最后一行打开文件。 |
| `vi +/<pattern> <file>` | 在指定的字符串模式第一次出现时打开文件。 |

一旦开始一个`vi`会话，了解有两种不同的操作模式是很重要的:

*   命令模式
*   插入模式

根据不同的模式，`vi`编辑器的行为非常不同。第一次进入`vi`时，默认处于命令模式。在这种模式下，你可以输入命令来控制`vi`的行为。例如，您可以发出命令来执行以下操作:

*   保存文件
*   进入插入模式
*   退出`vi`

在命令模式下，您输入的所有内容都会被`vi`解释为命令。在命令模式下，您不能在文件中输入文本；在开始输入文本之前，您必须将`vi`置于插入模式。表 [4-2](#Tab2) 列出了几种将`vi`置于插入模式的方法。请记住，这些命令区分大小写。例如，`A`命令包括同时按下 Shift 和 A 键。

表 4-2。

Common Techniques to Enter `vi` Insert Mode

<colgroup><col> <col></colgroup> 
| 输入插入命令 | 行动 |
| --- | --- |
| `i` | 在光标右侧插入文本。 |
| `a` | 在光标右侧的单词末尾插入文本(追加)。 |
| `I` | 在行首插入文本。 |
| `A` | 在行尾插入文本。 |
| `o` | 在当前行下方插入文本。 |
| `O` | 在当前行上方插入文本。 |

从命令模式切换到插入模式最简单的方法是按键盘上的`i`。然后，您可以在屏幕上光标当前所在的位置开始输入文本。在`vi`插入模式下，您可以执行两项活动:

*   输入文本
*   退出插入模式

在插入模式下，您应该会在屏幕底部看到文本，表明您处于正确的模式(这可能会因您使用的是`vi`还是`vim`而异):

`-- INSERT --`

您现在可以开始键入文本。

要退出插入模式(并返回命令模式)，请按 Escape。多次按 Escape 也没什么问题(除了浪费精力)。如果您已经处于命令模式并按下 Escape，您可能会听到铃声或嘟嘟声。

进入命令模式后，您可以从`vi`(返回到操作系统提示符)退出。要保存文件并退出，请键入`:wq` (write quit):

`:wq`

如果您对文件进行了更改，并希望不保存就退出，请键入`:q!`，如下所示:

`:q!`

表 [4-3](#Tab3) 详细介绍了一些更常见的退出方法。请记住，在键入`vi`退出命令之前，您必须处于命令模式。如果您不知道自己处于什么模式，请按下 Escape 键以确保您处于命令模式。请注意，这些命令区分大小写。例如，通过同时按下 Shift 和 Z 键两次来执行`ZZ`命令。

表 4-3。

Useful `vi` Exit Commands

<colgroup><col> <col></colgroup> 
| 退出命令 | 行动 |
| --- | --- |
| `:wq` | 保存并退出。 |
| `ZZ` | 保存并退出。 |
| `:x` | 保存并退出。 |
| `:w` | 保存当前编辑而不退出。 |
| `:w!` | 覆盖文件保护并保存。 |
| `:q` | 退出文件。 |
| `:q!` | 不保存就退出。 |
| `:n` | 编辑下一个文件。 |
| `:e!` | 返回到以前保存的版本。 |

## 4-2.在文件中操作

### 问题

当使用`vi`编辑时，您想要在文本文件中有效地导航。

### 解决办法

最直观的移动方式是使用上/下/右/左箭头。无论您处于命令模式还是插入模式，这些键都将工作。但是，您可能会遇到一些键盘上的上/下/左/右箭头不起作用。在这些情况下，你必须使用 J、K、H 和 L 键来分别向下、向上、向左和向右移动。您必须处于命令模式才能使用这些键进行导航。如果你处于插入模式并尝试使用这些键，你会在屏幕上看到一串`jjj kkkkk hhh llll`字母。

起初使用这些键似乎很麻烦。但是，过一段时间后，您会注意到您可以使用这些键快速导航，因为您不必将手指从自然的键入位置移开。

### 它是如何工作的

您可以使用无数的命令在文本文件中移动。尽管其中一些命令可能看起来令人困惑，但只要稍加练习，导航命令将很快成为您的第二天性。请记住,`vi`编辑器的设计目的是让你无需将手从标准键盘位置移开就可以执行大多数任务。

表 [4-4](#Tab4) 包含在`vi`内导航的常用命令。请记住，您必须处于命令模式，这些按键才能工作。请注意，这些命令区分大小写。例如，要导航到页面顶部，请使用`1G`命令，该命令包括首先按下 1 键，然后同时按下 Shift 和 G 键。

表 4-4。

Common Navigation Commands

<colgroup><col> <col></colgroup> 
| 命令 | 行动 |
| --- | --- |
| `j`(或向下箭头) | 下移一行。 |
| `k`(或向上箭头) | 上移一行。 |
| `h`(或向左箭头) | 向左移动一个字符。 |
| `l`(或右箭头) | 向右移动一个字符。 |
| `Ctrl+f`(或向下翻页) | 向下滚动一屏。 |
| `Ctrl+b`(或向上翻页) | 向上滚动一屏。 |
| `1G` | 转到文件的第一行。 |
| `:1` | 转到文件的第一行。 |
| `G` | 转到文件的最后一行。 |
| `nG` | 转到`n`行号。 |
| `H` | 转到屏幕顶部。 |
| `L` | 转到屏幕底部。 |
| `w` | 向前移动一个单词。 |
| `b` | 向后移动一个单词。 |
| `0` | 转到行首。 |
| `$` | 转到行尾。 |

## 4-3.复制和粘贴

### 问题

您希望将文本从文件的一部分复制并粘贴到另一部分。

### 解决办法

使用`yy`命令拉出(复制)文本行。使用`p`命令将文本行放置(粘贴)到文件的其他地方。和所有的`vi`命令一样，在使用命令之前，确保你处于命令模式(按下 Escape)。以下示例从光标所在的当前行和当前行下方的四行复制五行文本(总共五行):

`5yy`

您应该会在屏幕底部看到一条信息行，指示复制的行是否成功放入复制缓冲区:

`5 lines yanked`

使用`p`命令粘贴已复制的行。要将这些行放在光标所在的当前行下面，请确保您处于命令模式，并发出`p`命令:

`p`

您应该会在底部看到一条信息线，指示这些行粘贴在光标所在行的下方:

`5 more lines`

### 它是如何工作的

复制和粘贴是编辑文件的两个最常见的任务。有时你可能想剪切和粘贴。该任务类似于本配方“解决方案”部分中的复制和粘贴示例。不使用`yy`命令，而是使用`dd`(删除)命令。例如，要剪切五行文本(包括光标当前所在的行)，发出`dd`命令:

`5dd`

您应该会在屏幕底部看到一条消息，指示这些行已被剪切(删除):

`5 fewer lines`

这些行现在在缓冲区中，可以粘贴到文件中的任何位置。导航到您想要放置先前切割线的线，并按下`p`命令:

`p`

您应该会在底部看到一条信息行，指示这些行粘贴在光标所在的行之后:

`5 more lines`

有许多剪切和粘贴文本的命令。表 [4-5](#Tab5) 描述了复制、剪切和粘贴命令。请注意，这些命令区分大小写。例如，使用`X`命令删除光标左侧的一个字符，这意味着同时按下 Shift 和 X 键。

表 4-5。

Common Options for Copying, Deleting, and Pasting Text

<colgroup><col> <col></colgroup> 
| [计]选项 | 行动 |
| --- | --- |
| `yy` | 强拉(复制)当前行 |
| `nyy` | `n`美国佬(份数)行数 |
| `p` | 将拉动的线放在光标下方 |
| `P` | 将拉动的线放在光标上方 |
| `x` | 删除光标所在的字符 |
| `X` | 删除光标左侧的字符 |
| `dw` | 删除光标所在的单词 |
| `dd` | 删除当前文本行 |
| `ndd` | 删除`n`行文本 |
| `D` | 删除到当前行的末尾 |

## 4-4.操纵文本

### 问题

您想知道是否有一些命令可以修改您正在处理的文本，例如将一个字符从小写改为大写。

### 解决办法

使用`∼`(波浪号)命令改变字符的大小写。例如，假设在一个文件中有一个文本为`oracle`的字符串，你想把它改成`Oracle`。将光标放在`o`字符上。按下 Escape 键以确保您处于命令模式。键入`∼`字符(要求您同时按下 Shift 键和`∼`键)。你应该会看到角色从`o`变成`O`的情况。

### 它是如何工作的

有几个命令可用于处理文本。表 [4-6](#Tab6) 列出了用于更改文本的常用选项。请注意，这些命令区分大小写。例如，通过同时按下 Shift 和 C 键来执行`C`命令。

表 4-6。

Common Options for Changing Text

<colgroup><col> <col></colgroup> 
| [计]选项 | 行动 |
| --- | --- |
| `r` | 用您键入的下一个字符替换光标所在的字符 |
| `∼` | 更改字符的大小写 |
| `cc` | 删除当前行并插入文本 |
| `C` | 删除到行尾并插入文本 |
| `c$` | 删除到行尾并插入文本 |
| `cw` | 删除到单词末尾并插入文本 |
| `R` | 在当前行的字符上键入 |
| `s` | 删除当前字符并插入文本 |
| `S` | 删除当前行并插入文本 |

## 4-5.搜索和替换文本

### 问题

您希望搜索某个字符串的所有匹配项，并用另一个字符串替换它。

### 解决办法

如果您只想搜索一个字符串，使用`/`命令。以下示例在文件中搜索字符串`ora01`:

`/ora01`

要搜索下一个出现的字符串，使用`n` (next)命令:

`n`

要向后搜索字符串的前一个匹配项，使用`N`命令:

`N`

如果您想搜索文本并替换它，使用`s`选项来搜索文本并用替换字符串替换它。以下示例搜索字符串`ora01`,并在文件中的任何地方用`ora02`替换它:

`:%s/ora001/ora02/g`

所有出现的`ora01`现在应该显示为`ora02`。

### 它是如何工作的

搜索字符串是编辑数据库初始化文件时最常见的任务之一。表 [4-7](#Tab7) 列出了一些更常用的文本搜索选项。

表 4-7。

Common Options for Text Searching

<colgroup><col> <col></colgroup> 
| [计]选项 | 行动 |
| --- | --- |
| `/<pattern>` | 向前搜索字符串 |
| `?<pattern>` | 向后搜索字符串 |
| `n` | 向前重复搜索 |
| `N` | 向后重复搜索 |
| `f<character>` | 向前搜索当前行中的字符 |
| `F<character>` | 向后搜索当前行中的字符 |

## 4-6.将一个文件插入另一个文件

### 问题

在`vi`中，您想要复制当前工作目录中存在的另一个文件。

### 解决办法

使用`:r`命令读入文件。这具有从当前光标位置开始复制并粘贴文件的效果。该示例将名为`tnsnames.ora`的文件读入当前文件:

`:r tnsnames.ora`

前面的例子假设`tnsnames.ora`文件在您当前的工作目录中。如果您想要引入的文件不在您当前的工作目录中，您需要指定一个路径名。此示例从非当前工作目录的目录中读入文件:

`:r /oracle/product/11.1/network/admin/tnsnames.ora`

如果您有一个包含路径的 OS 变量，您可以直接使用它。此示例将包含在由变量指定的路径中的文件复制到:

`:r $TNS_ADMIN/tnsnames.ora`

### 它是如何工作的

您经常需要将文件的内容插入到正在编辑的当前文件中。这样做是将文本添加到当前文件的一种快速简便的方法，您知道这些文本正确地存储在一个单独的文件中。

你还有其他一些有趣的方法来读取文件。本示例复制一个文件，并将其放在当前文件的开头:

`:0r tnsnames.ora`

以下代码在当前文件的末尾读入文件:

`:$r tnsnames.ora`

## 4-7.连接线条

### 问题

您正在编辑的当前行之后有一行文本。您希望将当前行之后的文本连接到当前行的末尾。

### 解决办法

首先，通过按 Escape 键确保您处于命令模式。将光标放在要与其后的行连接的第一行上。键入`J`(大写 J)命令将当前行的结尾连接到下一行的开头。

一个例子有助于说明这个概念。假设你在一个文件里有这两句话:

`select table_name`

`from dba_tables;`

如果要将第一行与第二行连接起来，请将光标放在第一行的任意位置，然后键入以下内容:

`J`

现在，您应该会看到两条线连接在一起:

`select table_name from dba_tables;`

### 它是如何工作的

您经常会使用`J`命令将两行代码连接到一个文本文件中。您还可以连接任意数量的连续线条。例如，假设文件中有以下三行:

`Select`

`username`

`from dba_users;`

你希望这三条线在一条线上连在一起。首先，将光标放在第一行的任意位置，然后在命令模式下键入以下内容:

`3J`

现在，您应该会看到这三行连接在一起，如下所示:

`select username from dba_users;`

## 4-8.运行操作系统命令

### 问题

在`vi`中编辑文本时，您想要运行操作系统命令。

### 解决办法

首先确保你是在命令模式下输入退出。使用`:!`命令运行操作系统命令。例如，以下代码在不退出`vi`的情况下运行 OS `date`命令:

`:!date`

以下是该示例的输出:

`Sat Feb 10 14:22:45 MST 2008`

`∼`

`Hit ENTER or type command to continue`

按回车键或回车键回到`vi`命令模式。要将`date`的输出直接读入正在编辑的文件，请使用以下语法:

`:r !date`

### 它是如何工作的

从`vi`中运行操作系统命令可以省去退出实用程序、运行操作系统命令，然后重新进入实用程序的麻烦。DBA 通常使用这种技术来执行任务，比如列出目录中的文件、打印日期或复制文件。

以下示例从`vi`中运行`ls` (list)命令来查看当前工作目录中的文件:

`:!ls`

一旦确定了感兴趣的文件，就可以用`:r`语法读取它。本例将`script1.sql`文件读入当前正在编辑的文件:

`:r script1.sql`

如果您想暂时进入 shell 提示符并运行几个操作系统命令，请使用`:!`语法键入您最喜欢的 shell。以下示例进入 Bash shell:

`:!bash`

要返回到`vi`，使用`exit`命令退出 shell。此时，需要按回车键或回车键返回到`vi`命令模式:

`Hit ENTER or type command to continue`

## 4-9.重复命令

### 问题

你一遍又一遍地输入命令。您想知道是否有办法重复先前输入的命令。

### 解决办法

使用`.`(句点)命令重复之前输入的命令。例如，假设您删除了一大段代码，但想一次只删除 10 行。为此，首先确保您处于命令模式(通过按 Escape 键)，然后输入以下内容:

`10dd`

要重复前面的命令，请键入句点:

`.`

您应该会看到又删除了 10 行。这项技术允许您快速重复之前运行的命令。

### 它是如何工作的

您可以使用`.`命令来重复任何先前键入的命令，并且在使用它时您将节省大量的时间和打字。如果你经常重新输入冗长的命令，考虑创建一个按键的快捷方式(详情见方法 4-13)。

## 4-10.撤消命令

### 问题

您想要撤消您键入的最后一个命令。

### 解决办法

要撤销上一次输入的命令或文本，使用`u`命令。确保您处于命令模式，然后键入`u`，如下所示:

`u`

您应该会看到之前在`u`命令中输入的命令被撤销的效果。

### 它是如何工作的

`u`命令可以方便地撤销之前的命令。如果您想撤销在一行中输入的所有命令，使用`U`命令。光标必须位于您更改的最后一行，此命令才能生效。

如果要撤消自上次保存文件以来所做的更改，请键入以下内容:

`:e!`

有时，如果您想要撤消对文件的所有编辑并重新开始，前面的命令会很方便。这比用`:q!`(不保存退出)命令退出文件并重新打开文件要快。

Note

根据您的`vi`版本的不同，`u`和`U`的行为会略有不同。例如，使用`vim`，您可以使用`u`命令撤销之前的几次编辑。

## 4-11.显示行号

### 问题

您希望在文本文件中显示行号。

### 解决办法

使用`set number`命令。以下命令将屏幕更改为在每行的左侧显示行号:

`:set number`

现在，您应该会在屏幕左侧看到行号。以下是启用了设置编号选项的`init.ora`文件的片段:

`1 db_name=RMDB1`

`2 db_block_size=8192`

`3 compatible=10.2.0.1.0`

`4 pga_aggregate_target=200M`

`5 workarea_size_policy=AUTO`

`6 sga_max_size=400M`

`7 sga_target=400M`

`8 processes=200`

### 它是如何工作的

当您处理文件时，很高兴看到一个行号来帮助调试。使用`set number`和`set nonumber`命令切换数字显示。

Tip

按 Ctrl+G(同时按 Ctrl 和 G 键)显示当前行号。

## 4-12.自动配置设置

### 问题

您想要配置`vi`以特定设置启动。例如，您希望`vi`总是在显示行号的模式下启动。

### 解决办法

如果您想定制`vi`来自动显示行号，在您的主目录中创建一个名为`.exrc`的文件，并在其中放置所需的设置。以下示例在主目录中创建了一个名为`.exrc`的文件:

`$ vi $HOME/.exrc`

在`.exrc`文件中输入以下文本:

`set number`

从现在开始，每次启动`vi`时，都会读取`.exrc`文件，其中的设置会反映在正在编辑的文件中。

### 它是如何工作的

将行号设置为自动出现只是您可以在`.exrc`文件中配置的一个方面。要查看环境中所有可设置的属性，在`vi`中发出以下命令:

`:set all`

以下是输出的一小部分:

`--- Options ---`

`ambiwidth=single   joinspaces            softtabstop=0`

`noautoindent       keywordprg=man -s     startofline`

`noautoread         nolazyredraw          swapfile`

`noautowrite        lines=30              swapsync=fsync`

`noautowriteall     nolist                switchbuf=`

`background=light   listchars=eol:$       tabstop=8`

需要值的选项在输出中包含一个等号(`=`)。要查看功能的当前设置，使用`set`和选项名称。本例显示了`term`设置:

`:set term`

`term=cygwin`

要查看哪些选项不同于默认选项，使用不带选项的`set`命令:

`:set`

如果您使用`vim`，您可以将命令放在`vim .vimrc`启动文件中。`vim`编辑器还会执行`.exrc`文件的内容(如果有的话)。

Tip

您也可以将命令的快捷方式放在您的`.exrc`文件中。配方 4-13 描述了如何创建命令快捷方式(也称为命令映射)。

## 4-13.为命令创建快捷方式

### 问题

您正在反复使用某个命令，并且您想知道是否有办法为该命令创建快捷方式。

### 解决办法

使用`map`命令创建一系列击键的快捷方式。经常输入的一组击键是`xp`，它调换了两个字符(它先执行删除，然后执行上传)。本例为`xp`命令创建一个宏:

`:map t xp`

您现在可以使用`t`命令执行与`xp`命令相同的功能。

### 它是如何工作的

映射命令是为常用的击键序列创建快捷方式的一种有用方式。如果您想要为每个`vi`会话定义映射，将映射放入您的`.exrc`文件中(详情见方法 4-12)。

要查看所有已定义的映射，请键入不带任何参数的`:map`:

`:map`

以下是一些示例输出:

`up      ^[OA    k`

`down    ^[OB    j`

`left    ^[OD    h`

`right   ^[OC    l`

`t       t       xp`

要禁用映射，使用`:unmap`命令。以下示例禁用了`t`映射:

`:unmap t`

## 4-14.设置 Shell 默认文本编辑器

### 问题

您正在新的数据库服务器上编辑`cron`表。用于`cron`的默认编辑器是`emacs`，但是你想设置你的默认编辑器为`vi`。

### 解决办法

使用`export`命令设置默认编辑器。下面的例子假设您正在使用 Bash shell，并将默认编辑器设置为`vi`实用程序:

`$ export EDITOR=vi`

您可以验证该变量已按如下方式设置:

`$ echo $EDITOR`

`vi`

如果您正在使用 C shell，您可以如下设置`EDITOR`变量:

`$ setenv EDITOR vi`

### 它是如何工作的

一些实用程序如`cron`检查 OS `EDITOR`变量来决定使用哪个编辑器(一些旧系统也使用`VISUAL`变量)。以下几行可以放在`HOME/.bashrc`启动文件中，以确保登录时自动设置编辑器:

`export EDITOR=vi`

`export VISUAL=$EDITOR`

我们建议您同时设置`EDITOR`和`VISUAL`变量，因为有些实用程序(如 SQL*Plus)会引用其中一个。

## 4-15.设置 SQL*Plus 文本编辑器

### 问题

您启动了一个 SQL*Plus 会话，并想使用`vi`编辑器编辑一个文件。然而，当您发出`EDIT`命令时，您会注意到您被置于一个不熟悉的编辑器中:

`$ sqlplus / as sysdba`

`SQL> edit test`

`test.sql: No such file or directory`

`?`

`q`

在这种情况下，您应该将默认的 SQL*Plus 文本编辑器设置为`vi`。

### 解决办法

您可以通过以下两种方式之一指定 SQL*Plus 使用的默认文本编辑器:

*   设置 OS `EDITOR`变量(详情见配方 4-14)。默认情况下，SQL*Plus 将使用在`EDITOR`变量中指定的编辑器。
*   定义 SQL*Plus `_EDITOR`变量。设置此变量会覆盖 OS `EDITOR`变量中的任何设置。

此示例设置 SQL*Plus 会话使用的默认编辑器:

`SQL> define _EDITOR=vi`

现在，当您随后编辑文件时，默认情况下会调用`vi`编辑器:

`SQL> edit test`

`∼`

`"test.sql" [New File]`

您可以通过使用`DEFINE`命令并仅指定您感兴趣查看的变量的名称来验证编辑器已被设置:

`SQL> DEFINE _EDITOR`

`DEFINE _EDITOR         = "vi" (CHAR)`

如果您只是单独输入`DEFINE`，所有已定义的变量将显示:

`SQL> DEFINE`

`DEFINE _DATE           = "18-APR-15" (CHAR)`

`DEFINE _USER           = "SYS" (CHAR)`

`...`

`DEFINE _EDITOR         = "vi" (CHAR)`

### 它是如何工作的

解决方案部分演示了如何为 SQL*Plus 会话设置默认编辑器。您很可能希望自动定义默认编辑器，这样就不必在每个会话中手动设置编辑器。要自动设置`_EDITOR`变量，请在`glogin.sql`服务器配置文件或`login.sql`用户配置文件中定义`_EDITOR`变量。例如，下面一行可以放在`glogin.sql`或`login.sql`文件中:

`define _EDITOR=vi`

`glogin.sql`文件位于`ORACLE_HOME/sqlplus/admin`目录中。在 Linux 或 Solaris 中，如果`login.sql`文件存在于包含在`SQLPATH` OS 变量中的目录中，则执行该文件。如果还没有定义`SQLPATH`变量，SQL*Plus 将在当前工作目录中寻找`login.sql`，SQL*Plus 就是从这个目录中被调用的。

如果没有设置`_EDITOR` SQL*Plus 变量，OS `EDITOR`变量将用于设置 SQL*Plus 编辑器。如果没有设置`EDITOR`变量，将使用`VISUAL`变量设置。如果既没有设置`EDITOR`也没有设置`VISUAL`变量，那么`ed`编辑器将被用作 SQL*Plus 中的默认编辑器。

## 4-16.切换语法文本颜色

### 问题

您正在使用`vim`或`vi`编辑文件，文本显示为多色。您在阅读文本时遇到困难，想要关闭着色功能。

### 解决办法

在命令模式下的编辑器中，同时按下 Shift 键和:。这个动作应该会把你的提示放在屏幕的左下方。您应该会在 a:符号的右边看到提示。要关闭语法着色，请键入`syntax off`并按 Return 键:

`:syntax off`

现在，您应该看到文本字体颜色显示为白色。如果要重新打开语法着色，请按如下方式操作:

`:syntax on`

如果您想自动禁用语法着色，您可以将`syntax off`命令放在`vim .vimrc`启动文件或`vi .exrc`启动文件中(详细信息见方法 4-12)。

### 它是如何工作的

根据您的环境，当您编辑文件时，它的一些文本可能会以各种颜色显示。例如，以`#`符号开头的行将被解释为注释行，因此将显示为深蓝色文本。这就是所谓的语法着色。有时，根据终端的不同，这种语法颜色的文本可能很难阅读(例如，在黑色终端背景下很难看到深蓝色)。在这些情况下，解决这个问题最简单的方法是关闭语法着色。

如果您希望启用语法着色，但在查看特定颜色的文本时遇到困难，您可以调整特定的语法着色方案。这行代码将注释行的字体颜色设置为深灰色:

`highlight Comment ctermbg=DarkGray`

还有各种其他颜色你可以控制；例如:

`highlight Constant ctermbg=Blue`

`highlight Cursor ctermbg=Green`

`highlight Normal ctermbg=Black`

`highlight Special ctermbg=DarkMagenta`

`highlight NonText ctermbg=Black`

您可能希望根据您的终端类型或您查看特定颜色的能力来调整这些颜色。对于 DBA 编辑的大多数文件来说，语法着色可能会分散注意力，而不是有所帮助。然而，如果您正在编辑一个编程语言源代码文件(例如 Java ),您很可能会发现语法着色对于识别代码段(例如注释、常量、变量等)非常有帮助。