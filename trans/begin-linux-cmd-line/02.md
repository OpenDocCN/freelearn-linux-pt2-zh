第二章

![image](img/frontdot.jpg)

执行基本的命令行任务

此时，您已经了解了一些基本知识。你在第 1 章中学到的一个非常重要的话题是如何获得帮助。现在是时候通过探索一些基本的 Linux 命令来扩展您的命令行技能了。在本章中，您将了解以下主题:

*   更改您的密码
*   使用虚拟控制台
*   成为另一个用户
*   获取其他用户的信息
*   与其他用户交流
*   探索 Linux 文件系统
*   使用文件和目录
*   使用一些更酷的命令

更改您的密码

作为用户，您有一个密码来保护您的帐户。该帐户包含您所有的个人设置和文件，因此需要严格保护。因此，定期更改您的密码是一个好主意，这样可以最大限度地降低其他人知道您的密码并使用您的凭据进行身份验证的风险。更改密码时，请确保它满足以下最低要求:

*   密码应该很长:至少六个字符，不过八个或更多更好。
*   使用复杂性；混合字母、数字和其他字符，使密码尽可能难以猜测。
*   使用大小写字母。
*   确保您的密码不像字典中的任何单词。攻击者使用“字典攻击”，他们将字典的全部内容提供给强力密码破解程序，如果你的密码在字典中，他们就会破解它。

更改您的密码并不太难——只需使用`passwd`命令来更改您自己的密码。然后，你首先要输入你的旧密码。这是为了防止他人更改您的密码。接下来，输入新密码两次。另外，确保您的密码符合复杂性规则；否则不会改变。在[清单 2-1](#FPar1) 中，您可以看到更改密码后会发生什么。

[***清单 2-1***](#_FPar1) 。更改您的密码

```sh
sander@nuuk:~> passwd
Changing password for sander.
Old Password:
New Password:
Reenter New Password:
Password changed.
```

如果您以 root 用户身份登录，您还可以更改其他用户的密码。如果您只想更改密码，那很简单:键入 **passwd** ，后跟您需要更改密码的用户名。它不会先问你旧密码。因为您是 root 用户，所以应该能够在不知道旧密码的情况下修改用户密码。在更改用户密码时，您还可以使用一些选项。以下是这些选项中最有用的:

*   `-d:`删除指定用户帐户的密码。
*   `-l:`锁定账户。如果您知道该帐户在给定的时间内不会被使用，这将非常有用。
*   `-u:`解锁已被`-l`锁定的账户。
*   `-e:`强制用户在下次登录时更改其密码。

在练习 2-1 中，您将更改用户的口令。您将学习如何使用 **passwd - stdin** 在没有提示的情况下做到这一点，如果您想通过使用 shell 脚本自动更改密码，这是很方便的。

练习 2-1:更改口令

1.  以 root 用户身份登录。
2.  键入 **grep florence /etc/passwd** 。该命令应该显示以/etc/passwd 中的文本 florence 开头的一行，这是当前现有用户的数据库。
3.  键入**echo secret | passwd-stdin Florence**。这会将用户 florence 的密码更改为 secret，而不会提示您输入两次。在接下来的练习中，您将测试口令修改是否成功。

使用虚拟控制台

在您的 Linux 系统上，您从控制台工作。这是一个基于图形或文本的控制台。默认情况下，所有发行版都不仅仅提供这一个控制台。他们通过使用虚拟控制台来做到这一点。你可以考虑一个类似于 80 年代相当流行的哑终端的虚拟控制台。这是一个多屏幕/键盘组合连接到一台中央计算机完成所有工作的系统。虚拟控制台做的或多或少是一样的，它们提供给你不止一个登录环境，这在非图形环境中特别有用。不过，所有虚拟控制台都可以从同一个屏幕访问。

对于现代 Linux 用户来说，虚拟控制台也非常实用。假设一个系统管理员想要测试一个新的设置，并验证它对用户帐户有效。他或她可以作为系统管理员使用一个虚拟控制台来更改设置，同时通过在另一个虚拟控制台作为普通用户登录来测试设置。或者想象一个开发人员在一个虚拟控制台上调整新程序的源代码，同时在另一个虚拟控制台上调试相同的程序。请注意，在纯文本环境中工作时，虚拟控制台特别有用。如果你的服务器显示一个完整的图形环境，你可以打开一个新的终端窗口。

默认情况下，大多数 Linux 发行版都提供了六个虚拟控制台。这些控制台的名称是 tty1 到 tty6。您可以使用 Ctrl+Alt+ *功能键*激活它们。所以，要访问虚拟控制台号码 tty4，你需要按 Ctrl+Alt+F4。如果您的系统也启动了图形环境，您可以使用 Ctrl+Alt+F7 或 Ctrl-Alt-F1 返回图形环境。由 Linux 发行版的描述来决定哪个键序列用于切换回图形环境。

![Image](img/sq.jpg) **注意**在非图形环境中，你可以跳过 Ctrl 键。所以，要在 tty1 和 tty2 之间切换，按 Alt+F2 也可以。在图形环境中，这些键通常被分配给其他功能。

您可能会注意到，有些发行版还使用一些编号较高的虚拟控制台(比如 Ctrl+Alt+F10)来记录日志。因此，您至少应该检查编号较高的虚拟控制台上发生了什么。例如，SUSE Linux 将内核日志消息写入 tty10，这在排除故障时非常有用。

成为另一个用户

基本上有两种方式来验证您的 Linux 系统:作为根用户或者作为非根用户。默认情况下不使用 root 是一个好习惯。由于 root 可以做任何事情，所以一个小错误可能会导致大的后果。作为 root 用户，您可能会意外地破坏系统上的所有内容，在清除硬盘上的所有内容(或者您将要犯的任何错误)之前，Linux 不会询问您是否确定要执行此操作。因此，作为普通用户登录并仅在真正需要时获得 root 权限是一个好主意。要编写文本文档，不需要 root 权限(除非是配置文件)。但是，要更改您的 IP 地址，您需要 root 权限。

在 Ubuntu 上，默认情况下 root 帐号无法登录。安装 Ubuntu 后，您将创建一个属于管理员组的用户。所有的根任务都必须由那个用户执行，它们从 **sudo** 开始。因此 Ubuntu 用户可以输入 **sudo passwd florence** 来重置用户 florence 的密码。

要临时改变你的身份，你可以使用`su`(替代用户)命令。(Ubuntu 用户:阅读即将到来的提示！)它的用途并不难；只需发出`su`,后跟您希望通过其身份工作的用户的名称。例如:

```sh
su linda
```

会将您当前的用户帐户切换到 linda 用户帐户。如果您是普通用户，接下来您必须输入密码。如果你是 root，这个就没必要了(root 是万能的，记得吗？).如果您省略了您想要`su`到的用户的名称，该命令假定您想要成为超级用户。接下来，它会提示您输入密码，在本例中是 root 用户的密码。

![Image](img/sq.jpg) **提示**如果你在 Ubuntu 上，就不能就这么用`su` 。Ubuntu 反而使用了`sudo`机制，本书第 6 章的[中有介绍。这里有一个快速简单的方法可以帮助你使用`su`，即使是在 Ubuntu 上。它将使你从现在开始执行特权命令。首先，使用命令`sudo su`。当要求输入密码时，请输入分配给您的用户帐户的密码。接下来，使用命令`passwd`给用户 root 一个密码。从这一刻开始，你也可以在 Ubuntu 上以 root 身份登录。如果出于安全原因，您不喜欢这样做，请阅读第 6 章](06.html)了解如何禁用此功能。在此之前，我们的目标是帮助您在命令行上工作，为此，您有时需要 root 权限。

使用`su`时，最好始终使用选项`-`。这个选项会给你一个登录外壳而不是子外壳。这意味着使用-作为选项将确保应用/etc/profile 设置。如果你不使用-，这个文件不会被处理，这可能会弄乱你的变量。如果您不使用`-`选项，您仍然可以使用属于旧用户帐户的一些设置。为了防止这种情况，请始终使用`su -`。这可以确保您在切换到的用户的完整环境中工作。在[清单 2-2](#FPar5) 中，您可以看到当一个普通用户使用`su -`获取用户 root 的身份时会发生什么。

[***清单 2-2***](#_FPar5) 。与`su -`交换身份

```sh
sander@nuuk:~> su -
Password:
nuuk:~ #
```

当作为其他用户完成工作后，您可以发出`exit`。这将使您回到最初的用户环境。

![Image](img/sq.jpg) **提示！** Linux 管理员通常在基于 Linux 的图形桌面上工作。为了完成他们的工作，他们将作为普通用户登录到图形桌面，并使用 **su -** 命令打开一个根 shell。这使他们扎根于他们需要工作的终端，同时仍然是他们默认工作环境中的普通用户。

获取其他用户的信息

如果您在家里的个人计算机上使用 Linux，那么您可能是唯一登录到它的用户。但是，如果您是公司 Linux 服务器上的 Linux 用户，那么也可能有其他用户。在后一种情况下，最好知道有几个命令可以帮助您获取当前连接到同一台机器的用户的信息。开始，有`users`命令 。此命令显示当前已通过身份验证的所有用户的简短列表，没有进一步的详细信息:

```sh
nuuk:~ # users
linda root root sander
```

如果您想要更多关于已登录用户的信息，`who`是一个更好的选择。默认情况下，它不仅显示当前登录的用户，还显示他们从哪里登录以及登录的时间。[清单 2-3](#FPar7) 显示了没有附加选项时`who`的输出。

[***清单 2-3***](#_FPar7) 。`who`给出更多关于用户正在做什么的详细信息

```sh
nuuk:~ # who
root     tty1   Dec 10 09:11
sander   pts/0  Dec 10 09:31 (192.168.139.1)
root     pts/1  Dec 10 12:20 (192.168.139.1)
linda    pts/2  Dec 10 12:21 (192.168.139.1)
```

`who`显示远程用户的 IP 地址这一事实特别有用。例如，如果某个用户行为不端，管理员就知道该用户使用的是哪个 IP 地址，从而更容易采取纠正措施。

如果你想知道用户在做什么，那么`w`命令会很有帮助。这个命令显示用户的名字，他们在什么时间从哪里登录，当前的使用统计，以及他们当前正在使用的程序(或者作为最后一个程序使用)。[清单 2-4](#FPar8) 给出了`w`输出的概述。

[***清单 2-4***](#_FPar8) 。如果你想知道用户在做什么，使用`w`

```sh
nuuk:~ # w
 13:17:23 up 4:31,  4 users,   load average: 0.00, 0.00, 0.00
USER    TTY   LOGIN@  IDLE    JCPU   PCPU   WHAT
root    tty1  09:11   4:05m   0.07s  0.07s  -bash
sander  pts/0 09:31   1:41m   0.13s  0.05s  sshd: sander [priv]
root    pts/1 12:20   0.00s   0.08s  0.00s  w
linda   pts/2 12:21   55:43   0.04s  0.04s  -bash
```

如果你想尽可能多地了解其他用户，试试`finger (notice that not all distributions install this tool by default)`。此命令提供用户帐户当前状态的摘要。这包括了很多，包括用户有多少未读邮件信息！默认情况下，finger 只适用于本地系统。对于根用户来说，这是一个很有用的命令，可以找出用户最近的活动。清单 2-5 显示了其输出的一个例子。

[***清单 2-5***](#_FPar9) 。手指命令 可以用来显示关于用户的更多细节

```sh
sander@nuuk:~> finger linda
Login: linda                          Name:
Directory: /home/linda          Shell: /bin/bash
On since Wed Dec 10 12:21 (CET) on pts/2, idle 1:00, from 192.168.139.1
Mail last read Wed Dec 10 13:21 2015 (CET)
No Plan.
```

练习 3-2:虚拟控制台和用户信息

1.  使用 Ctrl+Alt+F2 键序列打开虚拟控制台。
2.  使用密码“secret”登录用户 florence。
3.  键入 **w** 查看当前还有谁登录了该系统。
4.  将该命令的输出与 **who** 命令的输出进行比较。
5.  键入 **lastlog** 。请注意，即使您不是 root 用户，您也会看到该系统上所有用户的上次登录时间信息。
6.  仍然以 florence 的身份，键入 **finger root** 以获取关于 root 帐户的信息。您将看到为什么许多管理员不太喜欢在他们的服务器上使用这个命令。
7.  键入 **su -** 打开一个根。
8.  键入 **exit** 再次关闭根 shell。

与其他用户交流

在 Linux 命令行中，您也有一些通信选项。一些命令允许您实时通信，提供聊天功能，而其他命令则允许您发送电子邮件。

实时通讯

在 Linux 上，有两个选项可以与其他用户实时通信。您可以使用`write`与个人用户交谈。如果想给所有用户发送消息，可以使用`wall`。如果您不想接收其他用户的消息，使用`mesg`命令 来关闭或打开消息接收。

与`write`的单独聊天会话

如果您想与系统上的另一个用户实时聊天，您可以使用`write` 。该命令用于两个用户之间的通信。它的使用相当简单:通过使用`write`命令，后跟您想与之对话的用户名，发起一个与另一个用户的`write`会话。例如，以下命令将启动从当前用户到用户 linda 的会话:

```sh
write linda
```

接下来，`write`打开一个提示，之后用户可以输入文本。该文本在其他用户的终端上逐行显示。无论用户在做什么，只要用户有一个打开的终端会话，文本就会显示。如果一个用户收到另一个用户的`write`消息，他或她可以通过打开自己的`write`会话来回复。作为一个例子，下面的过程演示了 root 和 linda 如何发起和终止一个`write`会话:

1.  用户 linda 使用命令`write root`打开到 root 的`write`会话。这将打开`write`提示符，琳达可以在这里键入她的文本:

    ```sh
    linda@nuuk:~> write root
    write: root is logged in more than once; writing to pts/1
    hi root, I’m having a problem.
    ```

2.  这时，root 在他的控制台上收到了 linda 的消息。要回复，他必须先按回车键收起 linda 的消息，然后输入命令`write linda`。接下来，他可以键入他的消息，从而建立与 linda 的活动聊天会话:

    ```sh
    nuuk:~ #
    Message from linda@nuuk on pts/2 at 13:35 ...
    hi root, I’m having a problem.

    nuuk:~ # write linda
    hi linda, how can I help you
    We’ll, my mouse doesn’t react anymore
    ```

3.  在会话结束时，参与的双方都必须使用 Ctrl+C 键序列来终止会话。这将把他们带回他们的提示，在那里他们可以继续他们的正常工作。

写给所有用户

另一个实时交流的工具是`wall`。这代表 write all，你大概可以猜到这个工具是用来给所有用户写消息的。它的工作方式和`write`差不多:进入`wall`后，调用`wall`的用户写一条消息，使用 Ctrl+D 键序列终止。该消息将显示在当前登录的所有用户的控制台上。不需要解释你应该小心使用这个工具，因为用户经常收到`wall`消息是非常烦人的。在清单 2-6 中，您可以看到一个`wall`会话的例子。

[***清单 2-6***](#_FPar11) 。用 wall 向所有用户发送消息

```sh
nuuk:~ # wall
I’ll shut down the system in 5 minutes

Broadcast Message from root@nuuk
        (/dev/pts/1) at 15:27 ...

I’ll shut down the system in 5 minutes
```

使用`wall`，您还可以将文本文件的内容发送给其他用户。例如，`wall /tmp/mymessage.txt`会将`mymessage.txt`的内容发送给当前连接的所有用户。该功能对于希望向所有用户发送较长消息的系统管理员非常有用。

禁用实时消息

如果您不想接收来自其他用户的任何消息，请使用`mesg`命令。该命令仅适用于两个参数。`mesg n`确保没有人可以在您的控制台上写消息。如果您想再次打开控制台接收来自其他用户的消息，请使用`mesg y`。

从命令行发送邮件

你可能认为，为了发送邮件，你需要一个全面的邮件客户端，如雷鸟，进化，或 Windows Mail。然而，Linux 命令行也有一个邮件客户端，您可以通过使用`mail`命令从命令行调用它。我不建议用`mail`代替普通的邮件客户端，但是如果你想给互联网或本地用户发送消息，或者如果你想阅读系统邮件，`mail`命令提供了一个很好的解决方案。

![Image](img/sq.jpg) **注意**您可以使用`mail`命令向互联网用户发送邮件，但这需要在您的 Linux 机器上正确设置 DNS 并运行 SMTP 进程。注意 Ubuntu 默认不安装 smtp，如果想在 Ubuntu 上使用 **mail** ，先用 **apt-get install dhcpclient** 安装。

要向另一个用户发送邮件消息，您可以作为`mail` *用户*调用该命令，其中*用户*是本地用户(例如`mail root`)或互联网用户(例如`mail someone@example.com`)的名称。接下来，`mail`程序打开一个界面，首先输入邮件主题，然后输入邮件正文。写完邮件正文后，在单独的一行上键入一个点，然后按回车键。这将告诉邮件客户端您已经完成了，并将邮件消息提供给机器上的 SMTP 进程，该进程将负责将邮件消息传递给正确的用户。在清单 2-7 中，您可以看到从命令行使用`mail`命令会发生什么。

[***清单 2-7***](#_FPar13) 。使用`mail`实用程序发送消息

```sh
nuuk:~ # mail linda
Subject: 4 PM meeting
Hi Linda, can we meet at 4 PM?

Thanks,
root
.
EOT
```

您也可以完全从命令行运行`mail`实用程序，而不需要打开让您输入文本的界面。例如，如果您希望 shell 脚本或计划作业在发生特定错误时自动发送消息，这将非常有用。在这些情况下，邮件消息的正文不是很重要；您可能只想向用户发送一封带有特定主题的邮件。下一个命令向您展示了如何做到这一点:它向用户 root 发送一条带有文本“something is wrong”的消息。另外，请注意`< .`的结构。通常情况下，`mail`命令会期望一行上有一个点来表示消息是完整的。通过使用带有`< .`的输入重定向，在命令行上提供点号。

```sh
mail -s "something is wrong" root < .
```

对于发送邮件，`mail`命令还有一些其他有用的选项:

*   `-a filename`:允许您将文件作为附件添加到邮件中。
*   `-c cc-addr`:指定要向其发送消息副本的用户的名称。
*   `-b bcc-addr`:向用户发送密件。邮件的收件人看不到您也向该用户发送了副本。
*   `-R reply-addr`:允许您指定回复地址。对该邮件的回复会自动发送到该回复地址。

除了发送邮件，您还可以使用`mail`实用程序阅读邮件信息。然而，该实用程序是用来读取系统邮件的，并不是从您的互联网提供商的邮件服务器上读取 POP 或 IMAP 邮件的好选择。当调用邮件来阅读你的系统信息时，你只需要输入**邮件**。作为回复，邮件客户端显示一个等待你的邮件列表(见[清单 2-8](#FPar14) )。

[***清单 2-8***](#_FPar14) 。只需键入 mail 即可显示等待您的所有邮件列表

```sh
nuuk:~ # mail
mailx version nail 11.25 7/29/05.  Type ? for help.
"/var/mail/root": 5 messages 5 unread
>U  1 root@nuuk.sander.gSPI_AMP#160;  Wed  Nov 19 15:13   20/661   Meeting at 10 AM
 U  2 root@nuuk.sander.gSPI_AMP#160;  Fri  Nov 21 09:48   20/661   10 AM meeting  cancelled
 U  3 root@nuuk.sander.gSPI_AMP#160;  Fri  Dec  5 10:44   20/661   Nice day for Dutch users
 U  4 root@nuuk.sander.gSPI_AMP#160;  Fri  Dec  5 12:28   19/568   hello
 U  5 root@nuuk.sander.gSPI_AMP#160;  Wed  Dec 10 08:48   20/661   Wanna go for coffee?
?
```

要阅读信息，只需输入信息编号，您将看到其文本。阅读完消息后，按`q`退出。在关闭你阅读过的邮件后，你可以在邮件界面中键入`reply`命令，给发送邮件的用户发送回复，或者键入`delete`，后跟邮件号码，将邮件从你的系统中删除。接下来，键入`quit`退出邮件界面。

在文件系统中寻找出路

现在您已经知道如何登录到您的服务器，是时候更熟悉 Linux 文件系统用默认文件和目录组织的方式了。即使在今天，了解文件系统仍然是非常重要的；这是因为 Linux 仍然是一个以文件系统为中心的操作系统。即使您只想在图形环境中工作，您也必须知道在服务器上哪里可以找到所有重要的文件。知道在哪里可以找到文件和目录绝对会使在 Linux 命令行上工作更容易。

默认目录

所有 Linux 发行版在组织系统上的目录结构时或多或少都使用相同的方法。这意味着某些目录将会一直存在，无论您使用的是什么发行版。不过，您可能会遇到发行版之间的细微差别。在本节中，您将了解存在哪些默认目录，以及在这些目录中可以找到哪些类型的文件。

![Image](img/sq.jpg) **提示！**所有默认目录都记录在 **man hier** 中。请阅读此手册页，了解缺省目录及其用法的完整和实际的描述。

在大多数 Linux 系统上，您会发现下面的缺省目录(注意发行版之间可能存在微小的差异):

*   `/`:根目录是你的 Linux 文件系统的起点。系统上的所有其他目录都存在于根目录中。
*   `/` `bin` :这是所有用户都可以访问的程序文件(二进制文件)的位置。这些是必须随时可用的基本二进制文件，即使系统的其他部分有问题。出于这个原因，目录`/bin`总是在根分区上。在其中，你会发现基本的实用程序和命令，如`/bin/bash`(外壳)、`cp`(用于复制文件)，等等。
*   `/` `sbin` :在这个目录下你会发现给系统管理员的二进制文件。这些是关键的二进制文件，必须随时可用，以防您需要修复系统。在这个目录中，你会发现一些你不希望在用户手中看到的命令和实用程序，比如通用系统管理工具`yast2`，或者分区工具`fdisk`。
*   `/` `boot` :这个目录包含了引导你的服务器所需的一切。在这个目录中你会发现最重要的东西之一是内核；这是名为`vmlinuz`的文件。(在某些发行版中，版本号会附加到文件名中。)其他重要组件也存在，所有这些组件的共同点是您的服务器需要它们来启动。
*   `/` `dev` :在 Linux 系统上，你使用的所有硬件都对应着你系统上的一个文件。如果你想寻址硬件，你必须寻址相应的文件。请注意，您需要 root 权限才能这样做。你可以在`/dev`目录中找到所有这些设备文件。例如，您会发现一个名为`/dev/cdrom`的设备，它指的是您的系统中可能存在的光驱。其他重要的设备文件是`/dev/sda`，它通常指的是你的硬盘，或者是`/dev/null`，你可以用它来重定向错误信息。
*   `/` `etc` :大多数运行在 Linux 上的服务使用一个 ASCII 文本文件来存储所有必要的配置。这些文本文件保存在目录`/etc`中。在这个目录中，你会发现一些像`/etc/passwd`一样的重要配置文件，其中包含了本地 Linux 用户的数据库。
*   `/` `home` :用户的个人文件存储在他或她的主目录中，无论您是在 Linux 服务器上工作还是在个人桌面上工作。目录`/home`用于存储每个用户的主目录。在安装 Linux 系统时，明智的做法是将这个目录单独放在一个分区上，以便将用户数据文件与操作系统组件分开。这样可以最大限度地降低操作系统安装出现问题时丢失所有个人文件的风险。
*   `/` `lib` :在 Linux 环境中使用的许多程序共享它们的一些代码。这些共享代码存储在不同的库文件中。文件系统根目录下的二进制文件所需的所有库都在目录`/lib`中。您还可以在这个目录中找到其他一些重要的模块，比如服务器内核使用的驱动程序模块。对于 64 位库文件，存在一个名为/lib64 的目录。
*   `/` `media` :在 Linux 系统上，要访问不在你电脑硬盘上的文件，你需要让介质可访问。你可以通过安装来实现(安装装置在第 3 章的[中有更详细的解释)。例如，当您挂载一个 CD-ROM 时，您将它连接到文件系统上的一个目录。在开始挂载任何东西之前，这个目录必须已经存在。大多数发行版中用于常规挂载的默认目录是`/media`。在此目录中，当检测到新的可移动设备时，会自动创建一个子目录。CD 和 USB 记忆棒将会出现在这里(以及图形桌面上),一旦它们被安装，设备的标签将被用作安装设备的目录的名称。](03.html)
*   `/` `mnt` :在旧的 Linux 系统上，`/mnt`是挂载设备的默认目录。在较新的系统上，这已经被`/media`目录所取代。然而，`/mnt`仍然有一个用途:它用于不经常发生的和手动创建的挂载，比如只需要访问一次的服务器的挂载。/mnt 目录是测试目的的理想选择。
*   这个目录可能是你系统中最大的目录。在这里你可以找到几乎所有用户可访问的文件。有些人喜欢把它比作 Windows 系统上的`Program Files`目录。因为这个目录中有如此多的文件，在其中你会发现一个完整的子目录结构，包括`/usr/bin`，其中存储了大多数程序，以及`/usr/src`，在这里你可以放置你所使用的开源程序和内核的源文件。因为`/usr`目录 下的文件太多了，所以把它放在自己的分区是很平常的。

![Image](img/sq.jpg) **提示**你一直想知道一个目录在你的硬盘上占了多少空间吗？在控制台环境中使用`du –hs`。它会显示指定目录的磁盘使用情况。该命令的正常输出是以块为单位的；参数`–h`以人类可读的形式呈现输出。选项`-s`确保你只看到所选目录的摘要，而不是每个文件使用了多少磁盘空间。例如，使用`du –hs /usr`找出`/usr`占用了多少空间。在[清单 2-9](#FPar17) 中，你可以看到`du -h /usr`命令的结果。

[***清单 2-9***](#_FPar17) 。使用`du -hs`找出一个目录及其内容占用了多少磁盘空间

```sh
nuuk:/ # du -hs /usr
1.8G    /usr
```

*   `/` `opt` :在`/usr`你会发现很多二进制。其中许多都是小型软件包。通常情况下，大型软件安装，如办公套件和其他大型程序，都存储在`/opt`中。例如，Gnome 图形界面、OpenOffice 套件或 Oracle 数据库(如果安装的话)可以是该目录的子目录。关于这个目录的使用似乎没有很好的共识，所以你也可以在/usr 中找到其中的一些包。
*   `/` `proc` :这是一个奇怪的目录，因为它并不真正存在于你的电脑硬盘上。`/proc`是你电脑内存的一个接口。高级管理员可以使用它来调整计算机的工作，并获得有关其当前状态的信息。你可以在这个目录的文件中找到许多关于你的计算机的信息。例如，尝试命令`cat /proc/cpuinfo`来显示文本文件`/proc/cpuinfo`的内容(您必须是 root 用户才能这样做)。这个命令将显示你计算机中处理器的大量信息，如清单 2-10 所示。

[***清单 2-10***](#_FPar18) 。使用`cat /proc/` `cpuinfo` 获取电脑 CPU 正在使用的功能信息

```sh
nuuk:/ # cat /proc/cpuinfo
processor       : 0
vendor_id       : GenuineIntel
cpu family      : 6
model           : 15
model name      : Intel(R) Core(TM)2 Duo CPU T7500 @ 2.20GHz
stepping        : 8
cpu MHz         : 2201.481
cache size      : 4096 KB
fdiv_bug        : no
hlt_bug         : no
f00f_bug        : no
coma_bug        : no
fpu             : yes
fpu_exception   : yes
cpuid level     : 10
wp              : yes
flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
                  cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss nx
                  constant_tsc pni ds_cpl ida
bogomips        : 4417.91
```

*   `/root` :普通用户在`/home`有自己的主目录。系统管理员不是普通用户；在 UNIX 环境中，系统管理员因此被尊称为“超级用户”因为这个用户可能在他或她的主目录中有一些重要的工具，这个目录不在其他用户的`/home`中。相反，用户 root 使用`/root`作为他或她的主目录。有一个很好的理由:在许多服务器上，目录`/home`在一个单独的分区上。如果出于某种原因，您不能再访问这个分区，root 用户至少仍然可以访问他或她的主目录，其中可能存储了一些重要的文件。
*   `/run`:该目录用于运行时配置。在这个目录中，可以为不同的用户和进程创建单独的子目录，每个用户和进程都可以在这些子目录中创建文件。/run 中的文件通常会在不再需要时自动删除。
*   在一些发行版中，你会在这个目录中找到一些重要服务的所有文件。例如，它用于在 SUSE Linux 上存储整个 web 服务器和 FTP 服务器文件结构。有些发行版，比如 Red Hat 和 derivatives，不使用/srv ，而是将这类信息存储在/var 中。
*   `/sys`:这个目录可以用来存储你系统的状态信息。它的使用类似于`/proc`的使用，不同的是`/sys`中的信息保存在你服务器的硬盘上，所以在你重启后它仍然可用。`/sys` 中的信息与您在服务器上使用的硬件更直接相关，而`/proc`用于存储关于内核当前状态的信息。
*   `/tmp`:顾名思义，`/tmp`用于临时文件。这是整个系统中每个用户都可以写入的唯一目录。然而，这不是一个好主意，因为这个目录的内容可以被任何进程或用户自动清除，而在此之前不会发出任何警告。通常对/tmp 目录 使用 RAM 文件系统，以确保它很快，并在重启时自动清理。
*   `/var` :这是你在任何一台 Linux 电脑上都能找到的最后一个目录。这个目录主要包含由您的系统创建的文件，这些文件的内容增长非常快。例如，考虑打印作业的假脱机—这些都可以在这个目录中找到。另一个非常常见的是/var/log，rsyslog 使用这个目录来编写关于 Linux 计算机上发生的事件的日志文件。

使用 Linux 文件系统

在 Linux 系统上，一切都被视为一个文件。甚至像你的硬盘这样的设备也是通过指向一个文件来寻址的(为了让你知道，在大多数情况下这个文件的名字是`/dev/sda`)。因此，要处理好 Linux，重要的是你能在 Linux 文件系统中找到自己的路。在这一节，你将学习使用文件系统的基础知识(更多细节在[第 3 章](03.html))。涵盖了以下主题:

*   使用目录
*   使用文件

使用目录

在 Linux 上，目录的使用与 Windows 上的文件夹一样。因为文件通常组织在目录中，所以知道如何处理它们是很重要的。这涉及几个命令:

*   使用这个来显示你当前的目录。它将显示完整的目录路径参考，总是从根目录开始:

    ```sh
    nuuk:~ # pwd
    /root
    ```

*   `cd`:一旦你知道你当前的目录，你可以使用`cd`命令切换到另一个目录。使用`cd`时，您应该了解 Linux 文件系统的一些特性:
    *   Linux 文件名和目录名区分大小写。因此，`bin`和`BIN`是不一样的！
    *   如果您想转到根目录下的一个目录，请确保在目录名前面加上一个`/`。如果没有斜杠，该命令将尝试在当前目录中查找作为子目录的目录。
*   `cd`命令只有一个参数:您想去的目录的名称。例如，下面的命令将您带到目录`/usr/bin`，它直接位于文件系统的根目录下:

    ```sh
    cd /usr/bin
    ```

![Image](img/sq.jpg) **提示**目录间切换？使用`cd -`返回到您所在的最后一个目录。另外值得一提的是:如果您只是键入 **cd** ，那么`cd`命令会将您带到您的主目录。

*   `mkdir` :如果需要新建一个目录，使用`mkdir`。例如，下面将在目录`/tmp` :

    ```sh
    mkdir /tmp/files
    ```

    中创建一个名为`files`的目录
*   使用`mkdir`你也可以在一个命令中创建一个完整的目录结构，这在其他操作系统上是做不到的。例如，如果`/some`不存在，命令`mkdir /some/directory`将会失败。在这种情况下，您也可以强制`mkdir`创建`/some`:通过使用`mkdir -p /some/directory`命令来实现。
*   `rmdir`:`rmdir`命令用于删除目录。然而，这不是最有用的命令，因为它只对已经为空的目录有效。如果目录中仍然有文件和/或子目录，使用`rm –r`，或者更好的是`rm –rf`，这可以确保您永远不会得到确认提示。使用此选项时，最好确定您在做什么

使用文件

命令行的一项重要任务是管理目录中的文件。为此，使用了四个重要的命令:

*   `ls`列出文件。
*   `rm`删除文件。
*   `cp`复制文件。
*   `mv`移动文件。

用`ls`列出文件

`ls` 的通用语法并不太难:

```sh
ls [*options*] *filename*
```

例如，下面将显示目录`/usr`中的所有文件，同时显示它们的属性:

```sh
ls -l /usr
```

参见[清单 2-11](#FPar20) 中的示例。在本例中，您可以看到不同的列用于显示文件的属性:

*   *文件类型*:第一个字母表示文件类型。如果显示一个`-`，它是一个常规文件。在这个例子中，您可以看到一个类型为`d`的文件。这不是一个常规文件，而是一个目录。
*   *权限*:直接在文件类型后，可以看到分配给该文件的权限。有九个位置向您显示文件权限。在第七章中，你会学到更多关于他们的知识。
*   *所有权*:在 Linux 上，每个文件都有一个用户所有者和一个组所有者。在下面的示例中，它们被设置为所有文件的用户根和组根。
*   *文件大小*:在群主旁边，显示文件的大小。
*   *创建日期和时间*:对于每个文件，也显示创建日期和时间。
*   *文件名*:在`ls -l`输出的最后一列，可以看到文件的名称。

[***清单 2-11***](#_FPar20) 。`ls -l`的输出示例

```sh
root@RNA:/boot# ls -l
total 10032
-rw-r--r-- 1       root root    414210 2007-04-15 02:19 abi-2.6.20-15-server
-rw-r--r-- 1       root root     83298 2007-04-15 00:33 config-2.6.20-15-server
drwxr-xr-x 2       root root      4096 2007-07-29 02:51 grub
-rw-r--r-- 1       root root   6805645 2007-06-05 04:15 initrd.img-2.6.20-15-server
-rw-r--r-- 1       root root     94600 2006-10-20 05:44 memtest86+.bin
-rw-r--r-- 1       root root    812139 2007-04-15 02:20 System.map-2.6.20-15-server
-rw-r--r-- 1       root root   1763308 2007-04-15 02:19 vmlinuz-2.6.20-15-server
-rw-r--r-- 1       root root    240567 2007-03-24 10:03 xen-3.0-i386.gz
```

除了选项`-l, ls`还有很多其他选项。一个特别有用的选项是`-d`选项，下面的例子说明了原因。当使用`ls`命令时，可以使用通配符。因此，`ls *`将显示当前目录中所有文件的列表，`ls /etc/*a.*`将显示目录中文件名中带有“a”后跟点的所有文件的列表，`ls [abc]*`将显示当前目录中文件名以“a”、“b”或“c”开头的所有文件的列表。但是没有选项`-d`会发生一些奇怪的事情。如果某个目录与通配符模式匹配，那么该目录的全部内容也会显示出来。这实际上没有任何有用的应用，所以在使用通配符时，应该总是将`-d`选项与`ls`一起使用。下面列出了一些可以和`ls`一起使用的最有用的选项:

*   `-a`:也显示文件名以点号开头的文件。默认情况下，普通用户看不到这些文件，因为文件名以点号开头的文件是隐藏文件。
*   提供一份长长的清单。这也显示了文件的属性，而不仅仅是文件名。
*   `-d`:显示目录名，而不是目录内容。
*   `-R`:也显示子目录的内容。
*   `-t`:按访问时间对文件进行排序。
*   `-h`:表示人可读。这提到了以千字节、兆字节或千兆字节为单位的文件大小，而不仅仅是默认设置的字节。仅将该选项与`-l`选项一起使用。
*   `-S`:按文件大小分类。该选项仅在与选项`-l`一起使用时有用。

![Image](img/sq.jpg) **注**隐藏文件是文件名以句号打头的文件。存储在用户主目录中的大多数配置文件都被创建为隐藏文件，以防止用户意外删除该文件。

使用`rm`移除文件

清理文件系统是另一项需要定期执行的任务，为此您将使用`rm`命令 。例如，`rm /tmp/somefile`从`/tmp`目录中删除`somefile`。如果您是 root 用户或者您对该文件拥有所有适当的权限，您将会成功，不会有任何问题。(有关权限的更多信息，请参见第 7 章。)删除文件可能是一个微妙的操作(想象删除了错误的文件)，所以可能需要稍微推动一下`rm`命令，让它相信它真的必须删除所有内容。你可以通过使用`-f`(强制)开关来做到这一点(但前提是你真的*非常*确定你想这么做)。例如，如果命令抱怨由于某种原因无法删除`somefile`，则使用`rm -f somefile`。相反，为了安全起见，您也可以使用`-i`选项到`rm`，这使得命令是交互式的。使用此选项时，`rm`会询问您是否真的想要删除它将要删除的每个文件。

`rm`命令也可以用来擦除整个目录结构；在这种情况下，必须使用`-r`选项。如果这个选项与`-f`选项结合，这个命令将变得非常强大，甚至是危险的。例如，使用`rm -rf /somedir`清除`/somedir`的全部内容，包括目录`/somedir`本身。

显然，当以这种方式使用`rm`时，你应该非常小心，尤其是因为一个小的输入错误可能会导致严重的后果。例如，想象一下，你输入的是`rm -rf / somedir`(在`/`和`somedir`之间有一个空格)而不是`rm -rf /somedir`。`rm`命令将首先删除文件系统根目录中的所有内容，由目录`/`表示，当它完成时，它也将删除`somedir`。希望您明白，一旦命令的第一部分完成，就不再需要命令的第二部分了。

`rm`命令也有一些有用的选项:

*   `-r`:递归，也从所有子目录中删除文件
*   `-f` : Force，什么都不问，只移除用户要求移除的
*   `-i`:交互式，删除文件前询问
*   详细，显示正在发生的事情

在[清单 2-12](#FPar22) 中，你可以看到当用选项`-ivR`删除一个目录及其所有子目录的内容时会发生什么。正如你所看到的，这不是一个非常实用的删除所有文件的方法，但至少你可以确保不会意外删除任何文件。

[***清单 2-12***](#_FPar22) 。使用`rm -ivR *`移除文件

```sh
nuuk:/test # rm -ivR *
rm: descend into directory `etc'? y
rm: remove regular file `etc/fstab'? y
removed `etc/fstab'
rm: descend into directory `etc/udev'? y
rm: descend into directory `etc/udev/rules.d'? y
rm: remove regular file `etc/udev/rules.d/65-cdrom.rules'? y
removed `etc/udev/rules.d/65-cdrom.rules'
rm: remove regular file `etc/udev/rules.d/31-network.rules'? y
removed `etc/udev/rules.d/31-network.rules'
rm: remove regular file `etc/udev/rules.d/56-idedma.rules'?
```

![Image](img/sq.jpg) **小心**非常*小心使用类似`rm`的潜在破坏性命令。Linux 命令行没有很好的取消删除机制，而且，如果您要求 Linux 做一些事情，它不会询问您是否确认(除非您使用`-i`选项)。*

用`cp`复制文件

如果你需要将文件 从文件系统的一个位置复制到另一个位置，使用`cp`命令。这个命令简单易用；该命令的基本结构如下:

```sh
cp *source destination*
```

作为*源*，您通常指定目录、文件或文件模式的名称(就像`*`指所有文件)。例如，使用`cp ~/* /tmp`将所有文件从您的主目录复制到`/tmp`目录。如您所见，在这个例子中，我引入了一个新项目:波浪号(`~`)。shell 将这个符号解释为引用当前用户主目录的一种方式(通常对于普通用户来说是`/home/` *用户名*，对于根用户来说是`/root`)。如果子目录及其内容也需要包含在`cp`命令中，使用选项`-r`。

`cp`命令有一些有用的选项，下面列出了其中一些:

*   `-a`:存档；使用此选项可确保您复制的文件的所有属性也被复制。如果要确保正确复制权限和其他文件属性，请使用此选项。
*   `-b`:备份；如果您的`cp`命令将覆盖现有的目标文件，该选项确保首先创建该目标文件的备份。
*   `-f`:力；如果目标位置的文件禁止您复制文件，此选项将强制复制。这意味着目标文件被覆盖，`cp`再次尝试。
*   `-i`:互动；使用此选项时，`cp`会在覆盖目标位置的现有文件之前询问。
*   `-p`:保存；使用该选项时，`cp`确保文件的属性，如所有者和权限，也被复制。
*   `-r`:递归；该选项确保目录被递归复制。
*   `-u`:更新；这个非常有用的选项只在目标文件比源文件旧或者目标文件不存在时才进行复制。

你应该知道，默认情况下， **cp** 命令不会复制隐藏文件。它只是复制普通文件。要复制隐藏文件，您需要具体引用隐藏文件。指挥 **cp。* ~** 会复制所有隐藏的文件，因为第一个参数指的是所有以点号开头的文件。在练习 2.3 中，你还将学习一种复制隐藏文件的便捷方法。

使用`mv`移动文件

有时你需要复制你的文件，有时你需要将 移动到一个新的位置。这意味着文件将从其源位置移除，并放置在目标位置。用于此目的的`mv`命令的语法与`cp`的语法类似:

```sh
mv *source destination*
```

例如，使用`mv ~/somefile /tmp/otherfile`将`somefile`文件移动到`/tmp`。如果在`/tmp`目录下已经有一个名为`otherfile`的子目录，那么在这个子目录下会创建`somefile`。如果`/tmp`没有该名称的目录，该命令会将原来`somefile`的内容以新名称`otherfile`保存在`/tmp`目录中。

`mv`命令不仅仅是移动文件。您可以使用它来重命名文件和目录，而不管这些目录中是否有任何文件。例如，如果您需要将目录`/somedir`重命名为`/somethingelse`，请使用`mv /somedir /somethingelse`。

练习 2-3:使用文件

1.  打开一个根壳。
2.  键入 **mkdir /data/files** 。它会给你一个错误消息，因为/data 目录还不存在。
3.  要创建作为参数指定给 **mkdir** 的完整路径，使用 **mkdir -p /data/files** 。这将创建目录/数据及其子目录/文件。
4.  类型 **pwd** 。这显示了您当前的目录，应该是 **/root** 。
5.  键入 **ls** 并将其输出与 **ls -a** 进行比较。后一个命令还显示所有隐藏的文件。
6.  键入 **cp /root /data/files** 。
7.  使用 **ls -al /data/files/*** 。(不要在命令中包含点号)您将会看到没有复制任何内容。
8.  使用 **cp -R /root /data/files** 并再次检查/data/files 的内容。您将看到只有非隐藏文件被复制。
9.  使用 **rm -f /data/files/*** 删除/data/files 的内容
10.  键入 **cp -R /root/。/data/files** 并再次检查/data/files 的内容。现在你会看到隐藏的文件也被复制了。

酷命令

有些命令并不适合某个特定的主题，只是很酷很有用。在最后一部分，您将了解这些命令。我将对以下命令进行简短描述:

*   `cal`
*   `clear`
*   `uname`
*   `wc`
*   `date`

显示带有`cal` 的日历

想知道 2018 年圣诞节是不是在一个周末？Linux 有一个很酷的工具可以帮你做到这一点:`cal`。如果你只是输入 **cal** ，这个工具会显示你当月的日历。但是，您也可以包含一年或一个月和一年作为其参数，以显示给定月份或特定年份的日历。例如，命令`cal 12 2018`显示 2018 年 12 月的日历(参见[清单 2-13](#FPar25) )。

[***清单 2-13***](#_FPar25) 。使用`cal`,您可以显示特定月份或年份的日历

```sh
nuuk:/test # cal 12 2018
   December 2018
Su  Mo  Tu  We  Th  Fr  Sa
                         1
 2   3   4   5   6   7   8
 9  10  11  12  13  14  15
16  17  18  19  20  21  22
23  24  25  26  27  28  29
30  31
```

用`clear` 清空屏幕

想清空你的屏幕，这样你可以更好地看到你在做什么？使用`clear`来完成。这个命令没有参数——只需输入 **clear** 就可以了。您也可能更喜欢使用 Ctrl+L 组合键，它的作用完全相同。

用`uname`和`hostname` 和显示系统信息

在某些情况下，你需要更多地了解你的系统。为此，您可以使用`uname`命令。当不带任何参数使用它时，它会显示你正在使用哪种内核。这通常是一个 Linux 内核，这些信息可能不是很有用，因为您可能已经知道使用 Linux 了。但是，您也可以使用`uname`来显示您使用的是什么内核版本`(uname -r)`，或者您使用的是什么类型的 CPU`(uname -p)`。如果你只是想看看你的电脑，使用`uname -a`。该命令的一个例子如清单 2-14 中的[所示。](#FPar26)

[***清单 2-14***](#_FPar26) 。使用 uname -a 显示系统信息

```sh
[root@server1 files]# uname -a
Linux server1.example.com 3.10.0-123.el7.x86_64 #1 SMP Mon Jun 30 12:09:22 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux
```

你可能注意到了，`uname`显示了很多信息，但是它并没有告诉你你的电脑叫什么名字。为此，最好使用`hostname`命令。如果您不带参数地使用它，它只显示短主机名，这可能与您已经在计算机的 shell 提示符下看到的相同。如果您还想查看您的电脑所在的 DNS 域名，请使用`hostname -f`。

用`wc` 计数字、行和字符

在某些情况下，知道一个文件中有多少单词是很有用的。为此，Linux 有`wc` (wordcount)命令。它不仅会显示单词，还会显示目标文件中的字符和行。它的使用很简单:

```sh
wc *filename*
```

结果就像你在清单 2-15 中看到的一样。它首先显示行数，然后显示文件中的字数和字符数。 **wc** 命令在管道中也很有用。一些 Linux 命令会生成大量输出。在开始向上滚动之前，您可能希望检查实际产生了多少输出。您可以通过将该命令的输出管道化到 **wc** 来找出答案，您将会看到该命令到底生成了多少行、多少个单词和多少个字符。

[***清单 2-15***](#_FPar27) 。用`wc`对文件中的行、词和字符进行计数

```sh
nuuk:/ # wc /etc/hosts
 23 77 683 /etc/hosts
```

用`date` 改变和显示日期和时间

在一天工作结束时，你可能想知道什么时候该回家。`date`命令可以帮助你做到这一点。当不带参数使用时，该命令显示当前日期和时间，但您也可以使用参数来更改时间或日期。例如，`date -s 14:48`将时间设置为下午 2:48。您还可以使用`mmddhhmm`参数来更改月份、日期、小时和分钟。例如，命令`date 12111449`将当前日期和时间设置为 12 月 11 日 2:49。

摘要

在这一章中，你已经掌握了在命令行上使用 Linux 的一些重要的基本技能。首先，您已经在 Linux 计算机上学习了关于您的会话的所有知识。这包括登录和注销、使用虚拟控制台以及作为另一个用户工作。接下来，您学习了如何与其他用户一起工作。您已经了解了如何找出哪些用户连接到系统，以及如何与这些用户通信。接下来，您已经了解了如何使用文件和目录。最后，在本章的结尾，你已经学习了一些其他有用的命令。本章介绍了以下命令:

*   `passwd`:更改密码。
*   `su`:成为另一个用户。
*   `users`:看谁接的。
*   `who`:看谁接的。
*   `w`:看谁接的。
*   `finger`:获取用户信息。
*   `write`:向一个用户发送实时消息。
*   `wall`:向所有用户发送实时消息。
*   `mesg`:禁止或允许接收实时消息。
*   `mail`:向其他用户发送电子邮件。
*   `du`:查看一个目录占用多少磁盘空间。
*   `cat`:显示文本文件的内容。
*   `pwd`:打印工作目录。
*   `cd`:切换到另一个目录。
*   `mkdir`:做一个目录。
*   `rmdir`:删除一个目录。
*   `ls`:列表文件。
*   `rm`:删除文件。
*   `cp`:复制文件。
*   `mv`:移动文件。
*   `cal`:显示日历。
*   `clear`:清除屏幕。
*   `uname`:显示系统信息。
*   `wc`:统计文本文件中的字数、行数和字符数。
*   `date`:显示和更改当前日期和时间。

在下一章，你将会得到更多关于使用 Linux 文件系统的细节。