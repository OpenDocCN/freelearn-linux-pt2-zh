第一章

![image](images/frontdot.jpg)

启动 Linux 命令行管理

为了释放 Linux 的全部能力，作为一名 Linux 管理员，您将花费大部分时间在 Linux 命令行上键入命令，即所谓的 shell 提示符 。对于不熟悉命令行的人来说，高级用户在那里做的事情可能看起来很神奇。在本章中，您将了解以下主题:

*   Linux 操作系统的历史
*   什么是开源？
*   什么是发行版？
*   登录到 linux
*   命令基础:使用命令、选项和参数
*   使用管道和重定向
*   通过`--help` 和`man`获得帮助
*   使用外壳

Linux 发行版

对于刚接触 Linux 的人来说，这个操作系统可能会显得有点陌生。由于它的开源特性，Linux 有不同的版本(所谓的发行版)。在了解了一些 Linux 的历史之后，本章将告诉你这些发行版之间的区别和相似之处，这样你就可以选择最适合你需要的 Linux 发行版。

Linux 历史

Linux 开始于 1991 年左右，这一切都是因为芬兰学生 Linus Torvalds 对 Minix 不太满意，Minix 是 UNIX 操作系统的教育版本，他必须在赫尔辛基大学使用它。特别是这个 Minix 发行版的内核(它是操作系统的心脏)的能力并没有让他很满意。他决定创建一个更好的内核，并将其命名为 Linux。

也许托沃兹在开始他的计划时所做的最聪明的事情就是决定不独自去做。为了找到其他想和他一起工作的人，他在新闻组上发布了一条消息，这是当时一个主要的社交媒体平台，可以用来与其他人交换信息并获得他人的帮助。

托瓦尔兹的倡议并不是独立的。许多其他软件开发商已经开始为 UNIX 操作系统开发自由软件。当时唯一真正缺少的是一个足够稳定的内核，它可以投入生产，并为昂贵的 UNIX 操作系统提供一个完全免费的替代品。

开放源码

从一开始，托瓦尔兹就把他的软件作为开源软件——也就是说，任何人都可以免费获得其源代码的软件。这带来了一个主要的好处:其他程序员可以访问源代码，因此修复代码中的问题变得更加容易，结果是获得了更加稳定和可靠的代码。这个开源项目很好地融入了 GNU 项目中的许多其他开源项目。缩写 GNU 代表 GNU is Not UNIX，这意味着这是为 UNIX 平台编写的软件，但不使用 UNIX 许可。这个 GNU 倡议是自由软件基金会(FSF)的一部分，该基金会希望创造自由软件以获得更好的操作系统体验。

当涉及到许可时，托瓦尔兹在 GPL 下发布了他的软件。当年，GPL 代表 GNU 公共许可证，但现在它意味着通用公共许可证。这个许可证的细节相当复杂，但本质上它意味着任何人都可以使用和修改在 GPL 下发布的软件，只要修改这个软件的人确保他或她的修改也将在 GPL 下发布。简而言之:一旦软件有了 GPL，它将永远是 GPL 软件。这防止了公司进行小的修改，然后把软件从 GPL 中拿出来卖个大价钱。

在当前的 Linux 版本中，GPL 仍然非常重要。大多数发行版认为它是操作系统的一个基本属性，会拒绝不符合 GPL 许可条件的软件。由于对许可如此严格，Linux 发行版确保了作为开源软件发布的软件将永远是开源软件。一些发行版也允许包含非开源软件，比如特定固件的二进制代码。你会注意到在不同的发行版中有不同的哲学方法。

第一次分配

除了 Linux 内核之外，GPL 下还有很多其他程序。在早期，想开始使用 Linux 的人不得不上网，自己下载这些软件程序。通常，下载后，他们甚至不得不自己编译。这个编译过程是将程序文件(仅作为源代码文件发布)转换成用户可以在计算机上执行的可执行程序所必需的。

软件编译不是很容易做到的，因此，不同的人开始创建由 Linux 内核和其他一些有用的程序组成的集合。第一个这样做的人是帕特里克·沃尔克丁，他于 1993 年开始发行休闲服。在那些日子里，这个发行版由不同的软件类别组成，全部放在不少于 43 张软盘上。Volkerding 可能是第一个成功发布 Linux 发行版并开始在世界各地的服务器上使用的人，他的 Slackware 发行版仍然存在，尽管新的发行版并不经常发布。

Linux 成为主流

1993 年到 1998 年标志着 Linux 操作系统的兴起。它迅速流行的一个最重要的原因是，它为许多关键任务服务器系统上使用的昂贵的 UNIX 操作系统提供了一个非常经济的替代方案。在 Linux 的早期，没有可用的支持，但这并不妨碍全球不同机构的科学家开始使用它。Linux 也在教育环境中迅速获得了巨大的普及。由于这种流行，在此期间最重要的 Linux 发行版被创建。

尽管 Slackware 只是一个带有安装程序的软件程序集合，使得使用 Linux 变得容易，但其他 Linux 发行版很快开始为开源软件增加价值。一些人通过在他们的软件集合中添加商业支持来做到这一点，另一些人通过创建程序并将其添加到他们的发行版中，还有一些人雇佣开发人员来优化开源程序。结果是，现在有几十个 Linux 发行版可供新的 Linux 用户使用。在所有这些 Linux 发行版中，只有一些真正重要。在本书中，我重点介绍了三个最重要的发行版:Red Hat、SUSE 和 Ubuntu。通过只关注这三个，我并不是在对其他发行版的质量发表声明；然而，关注这三者是有意义的，因为它们占据了 Linux 市场的 90%以上。以下是对这三个发行版的简短描述。

Red Hat

位于北卡罗来纳州的 Linux 发行版 Red Hat 在将 Linux 引入许多公司的数据中心方面发挥了重要作用。红帽成功的原因是这个发行商增加了对 Linux 的支持。在一个层面上，这是对不同硬件和软件程序的支持，这意味着被支持的硬件和软件程序的用户被保证可以在 Linux 上工作。Red Hat 还为 Linux 用户增加了帮助，作为 Linux 的商业附加值。

因为 Red Hat 提供了对 Linux 的支持，公司开始抛弃他们的旧版本的 UNIX，用便宜得多的 Linux 代替它们。这使得 Red Hat 成为这个星球上最成功的 Linux 发行版。即使 Ubuntu 在人们不想为支持的 Linux 发行版付费的环境中被广泛采用，Red Hat 仍然是商业 Linux 发行版的领导者。

目前，有三个与红帽相关的产品线。其中最重要的是红帽企业 Linux (RHEL) ，它由两个服务器版本和一个桌面版本组成。RHEL 是一个商业产品，所以它不能免费下载。然而，它是开源软件，但你不能免费下载它的唯一原因是因为 Red Hat 在 RHEL 软件中添加了 Red Hat 标志，而这是用户必须付费的。

红帽还创立了 Fedora 开源项目。基本上，你可以把这看作是 RHEL 的发展环境。大多数新的软件组件首先在 Fedora 中使用和测试，如果它们在那里成功，它们也将进入 RHEL。Fedora Linux 可以在`www.redhat.com/fedora` `.`免费下载

由于 Red Hat Enterprise Linux 中唯一不免费的是 Red Hat 徽标，因此 CentOS(社区企业操作系统)发行版提供了去掉了 Red Hat 徽标的 Red Hat Enterprise Linux 软件。这听起来不合法，但事实并非如此，因为 Red Hat 是完全开源的软件。事实上，Red Hat 已经在 Red Hat business 中集成了 CentOS 社区，因此他们可以向那些还没有准备好为他们的 Linux 支持付费的个人和公司提供免费的具有 Red Hat Enterprise Linux 质量的 Linux 发行版。所以如果你想要 Red Hat Enterprise Linux 的稳定性，但又不想为此付费，CentOS 提供了一个很好的替代方案。可以在`www.centos.org`下载 CentOS。

SuSE〔t0〕〔t1〕

SUSE Linux 发行版在德国成立。它很快变得流行起来，因为从一开始 SUSE Linux 就有许多软件包，装在一个大盒子里的 DVD 上，里面有安装手册，甚至还有一个文件夹。SUSE 是第一批发行版中的一员，他们只出售他们的发行版，并且只提供一个演示系统作为免费软件，因此试图从中赚钱。

2004 年，总部位于犹他州的网络软件公司 Novell 收购了 SUSE，并将其开发成一个企业级的 Linux 发行版，可以与当时仍主导市场的 Red Hat 竞争。目前，SUSE 再次成为独立品牌。

目前 SUSE Linux 有两个方向。SUSE Linux Enterprise 是提供支持的商业软件，它有两种不同的版本:SUSE Linux Enterprise Server 和 SUSE Linux Enterprise Desktop。通过 SUSE Linux 企业桌面，SUSE 在将 Linux 引入企业桌面方面取得了一些成功，而 Red Hat 仍然专注于服务器版本。有趣的是，SUSE Linux Enterprise 产品可以在 downloads.suse.com 网站上免费下载，但是为了下载更新和补丁，需要订阅。因此，即使你可以免费下载并安装它，如果你想继续使用它，你也需要订阅。

除了 SUSE Linux 企业级产品，还有 OpenSUSE ，这是一款完全开源的产品。这个版本还提供了一个稳定的 Linux 发行版，但同时也用作新软件的开发平台。你可以在`www.opensuse.org` `. All versions of SUSE Linux Enterprise Server are based on OpenSUSE.`下载 OpenSUSE

人的本质

Ubuntu 已经变得相当成功，因为它的创始人，南非百万富翁马克·舒托沃尔斯，使它成为一个非常用户友好的发行版，在 Ubuntu 的早期，甚至免费赠送带有 Ubuntu 桌面的光盘。

除了 Ubuntu 桌面版，Ubuntu 还有一个服务器版，由于桌面版的成功，它变得相当。两个版本的 Ubuntu Linux 都是免费的；有兴趣获得支持的客户可以从 Canonical 购买，该公司由 Ubuntu 创始人马克·舒托沃尔斯创建，旨在提供 Ubuntu 的专业支持服务。

Ubuntu Linux 的不同寻常之处在于每 6 个月就有一个新的软件发布。通过查看发行版的名称，可以看出它是什么时候发布的；例如，Ubuntu 15.04 于 2015 年 4 月发布。由于企业用户通常不喜欢每 6 个月升级一次操作系统，因此目前每 2 年发布一次长期支持(LTS)版本。这个版本的特别之处在于提供了延长的支持期。对于台式机和服务器，这是 7 年。对于设置基于 Ubuntu Linux 的服务器，强烈建议使用 LTS 版本。

![Image](images/sq.jpg) **注**本书重点介绍红帽，SUSE，和 Ubuntu Linux。但是，您会注意到，本书中 98%的命令和配置文件也可以在其他 Linux 发行版中找到。这意味着无论您使用什么 Linux 发行版，本书中的信息都会对您有用。

登录和注销

现在，您已经对 Linux 有了总体的了解，并且更具体地了解了 Linux 发行版，是时候继续学习并熟悉使用 Linux 时的基本任务了。在你能在 Linux 计算机上做任何事情之前，你必须登录。在这一节中，您将学习用户名和不同的方式来让您的 Linux 计算机了解您自己。

不同的登录界面

在开始在你的 Linux 计算机上工作之前，你需要告诉它你是谁。安装您的 Linux 版本的人已经创建了一个用户帐户，您必须使用这个帐户和相关的密码来表明您的身份。为此，Linux 提供了一个登录提示。这可以是图形或非图形提示。如果您在 Linux 桌面上工作，您可能会看到一个图形环境。然而，如果您使用的是一个服务器，那么您只会看到一个 shell 登录提示。

在 Linux 中，通常需要在不同的解决方案之间进行选择。这意味着不只有一个统一的图形登录提示，而是很多，这取决于您使用的发行版和您安装的图形环境。您会注意到，由于这个原因，不同发行版之间的图形登录屏幕会有所不同。在[图 1-1](#Fig1) 中，你可以看到它在 CentOS Linux 上的样子。

![9781430268307_Fig01-01.jpg](images/9781430268307_Fig01-01.jpg)

[图 1-1](#_Fig1) 。CentOS 上的图形登录屏幕

使用图形环境时，是图形环境为您提供了登录屏幕。更具体地说，启动图形化登录屏幕的是`gdm`进程。所以你在[图 1-1](#Fig1) 中看到的确实是这个`xdm`过程的结果。在特定的图形桌面环境中，可以使用替代方法，比如 gdm 进程，这是 GNOME 图形桌面的默认设置。

注意:历史上，Linux 上提供了不同的图形桌面。目前，GNOME 桌面被用作大多数 Linux 发行版的默认桌面。它运行在 X 窗口系统之上，X 窗口系统是提供图形屏幕的通用系统，但是具有非常基本的功能。GNOME 在屏幕上增加了菜单等功能。KDE 是一个替代的图形桌面。

如果您在服务器上工作，图形环境并不重要，默认情况下通常不会启动。这是因为图形环境消耗资源，而服务器系统上的这些资源最好保留用于其他目的。因此，服务器通常只提供基于文本的登录提示。在[图 1-2](#Fig2) 中，你可以看到这种登录提示的样子。

![9781430268307_Fig01-02.jpg](images/9781430268307_Fig01-02.jpg)

[图 1-2](#_Fig2) 。基于文本的登录提示

还有其他连接到 Linux 机器的方法。如果你是一个服务器管理员，你的服务器很可能会被安装在一个空调和寒冷的服务器机房，你只有在真正必要的时候才进入。或者，您的 Linux 服务器可能被远程托管在云中的某个地方，或者作为虚拟专用服务器(VPS)托管在某个托管提供商处。不管它是如何运行的，通常你的服务器是不可访问的。因此，作为服务器管理员，您可以使用像 Windows 实用程序 PuTTY 这样的远程访问工具来获得对服务器的 shell 访问。在[图 1-3](#Fig3) 中，你可以看到 PuTTY 登录界面的样子。

![9781430268307_Fig01-03.jpg](images/9781430268307_Fig01-03.jpg)

[图 1-3](#_Fig3) 。PuTTY 是从 Windows 工作站远程访问 Linux 控制台的事实标准

![Image](images/sq.jpg) **注意** PuTTY 是从 Windows 桌面访问 Linux 机器的事实标准。从`www.putty.org`开始可以免费下载 PuTTY。要使用它，您还需要一个运行在 Linux 计算机上的 SSH 服务器。宋承宪在[第 11 章](11.html)中有详细介绍。在 Linux 工作站和苹果电脑上，本地 SSH 客户端集成在操作系统中，您不需要 PuTTY 来建立与 Linux 服务器的远程会话。

如您所见，有许多方法可以连接到 Linux 机器。在所有情况下，您都需要提供用户凭证。下一节将给出更多相关信息。

使用用户帐户

要登录 Linux 机器，您需要一个用户帐户名和密码。如果您自己安装了机器，您应该已经知道使用什么用户名了。如果是别人帮你安装了机器，问问他或她你应该用什么用户名。这个用户名也有一个密码。在登录提示符下，您需要提供用户名和密码，以便让机器知道您的身份。这个程序也称为*认证*T3】。

![Image](images/sq.jpg) **注意**认证密码还有其他选择。例如，您可以使用智能卡在您的机器上进行身份验证。然而，这需要额外的硬件，因此，在本书中，我将重点介绍密码认证。

第一次进行身份验证时，您必须决定使用什么用户帐户。您可以作为普通用户进行身份验证，但也可以使用系统管理员的帐户进行身份验证。该帐户的用户名是 root。在每台 Linux 计算机上，都有一个名为 root 的用户，这个用户帐户没有任何限制。root 用户真的是全能的。如果您连接到 Linux 来执行系统管理任务，那么以 root 身份进行身份验证是有意义的；毕竟，您需要进行系统管理，为此您需要所有的权限。然而，如果你是一个普通用户，你不应该养成默认以 root 用户身份登录的习惯。只需使用您的普通用户帐户登录，并在需要时使用`su`或`sudo`成为 root 即可。在[第二章](02.html)中，你将学习如何做到这一点。这个时候，只要确定你是经过认证的就可以了。

命令行基础

命令行很重要，因为系统管理员可以通过它做任何事情。即使您的 Linux 安装也运行图形界面，您也需要命令行访问来释放 Linux 的全部能力和潜力。许多管理员在 Linux 上使用图形界面的唯一原因是因为它允许他们同时运行许多终端窗口，这使得在一个窗口中阅读文档、在另一个窗口中配置和在第三个窗口中测试配置变得容易。

Linux 有很多很多的命令，比你知道的还要多，而且新的命令会定期添加进来。但是，所有这些命令都有一个共同的工作方式。在这一节中，您将了解在任何 Linux 命令中都会遇到的常见元素。首先，您将了解每个 Linux 命令的通用结构。接下来，我们将讨论在 Linux 命令中可以使用和不可以使用的字符。图 1-4 显示了从图形环境中作为终端启动时命令行的样子。

![9781430268307_Fig01-04.jpg](images/9781430268307_Fig01-04.jpg)

[图 1-4](#_Fig4) 。从终端窗口看到的命令行

命令行为您提供由不同部分组成的提示。如图 1-4 中的[所示，提示的第一部分是你正在使用的计算机的名称。在这种情况下，计算机名为`server1`。接下来，提示符指向文件系统中用户当前所在的目录。在](#Fig4)[图 1-4](#Fig4) 中，你可以看到一个~符号，而不是一个目录名。这个符号指的是主目录，它是文件系统中用户可以存储个人文件的文件夹。最后，该提示中的#号表示当前用户是 *root* ，强大的系统管理员。如果您看到除#之外的任何内容，则当前用户不是 root，而是具有普通权限的普通用户。请注意，如果是这种情况，有些命令的用途是有限的。例如，在 Linux 上，普通用户不能格式化硬盘，许多其他任务也不能由非 root 用户完成。

![Image](images/sq.jpg) **注意**因为在开放源码中没有对每个人都严格执行的规则，开发者可以做他或她喜欢的事情。因此，像“always”和“every”这样的词在 Linux 中并不适用，因为在 Linux 中使用的规则通常有例外。然而，为了保持这本书的可读性，我还是会使用这些词。请记住，当你看到“每”和“总是”这两个词时，应该是“几乎每”和“几乎总是”。

Bash :命令解释器

在命令行上工作时，作为管理员，您将处理 shell。shell 是命令解释器 :它负责把你在命令行上输入的东西转化成某种东西。如何使用命令很大程度上取决于 shell 的能力。shell 本身是一个程序，在您登录到您的服务器后，您的服务器会自动启动该程序，无论您是直接在服务器控制台上登录，还是通过在 Windows 工作站上从 PuTTY 启动的远程会话登录。两种 shells 经常使用:Bash 和 Dash。Bash 是当前 SUSE 和 Red Hat 版本上的默认 shell，Dash 在 Ubuntu 上可用。好消息是，作为一名初级命令行管理员，您并不真正关心使用哪个 shell 两者都以相同的方式工作。在本章后面的“使用 Shell”一节中，您将了解到它的一些最重要和最有用的特性。

命令、选项和参数

Linux 命令通常由三部分组成:命令本身、命令选项和它的参数。例如，以下示例显示了 Linux 命令的样子:

```sh
useradd -m -G sales linda
```

这个例子由三部分组成，`useradd`，这是命令；`-m`和`-G`销售，这两个都是选项；和`linda`，这是一个通用参数。注意-G 后面的单词“sales”也是一个特殊的项，它是选项-G 的一个参数。在本节的后面，我将更详细地解释这些组件。

命令本身是您键入的字符串，用于激活某个任务。例如，命令`ls`(见[清单 1-1](#FPar5) )列出文件。在[清单 1-1](#FPar5) 中，您可以看到在用户 root(Linux 系统管理员)的主目录中使用该命令的结果。为此命令定义了某些功能。如前所述，Linux 有许多命令；在本章后面的“使用`man`获得帮助”一节中，您将学习如何通过使用`man`命令获得关于它们的详细使用信息。

[***清单 1-1***](#_FPar5) 。使用不带选项的`ls`命令显示当前目录中的文件

```sh
nuuk:~ # ls
.ICEauthority  .exrc   .gnome2_                private         .metacity
.Xauthority    .fvwm   .gnupg                  .nautilus       .wapi
.bash_history  .gconf  .gstreamer-0.10         .qt             .xsession-errors
.config        .gconfd .gtkrc                  .recently-used  Desktop
.dmrc          .gnome  .gtkrc-1.2-gnome2       .skel           Documents
.esd_auth      .gnome2 .kbd                    .suse_          register.log bin
```

选项

大多数命令都有选项作为第二部分。通过使用这些选项，您可以修改命令的行为。选项是程序代码的一部分，它们是固定的，创建程序的软件程序员已经提供了可用的选项。例如，`ls`命令只显示当前目录中文件的名称，正如您在[清单 1-1](#FPar5) 中看到的。如果您想查看细节，比如文件大小、为它设置的权限以及关于创建日期的信息，您可以添加选项- `l`。在[清单 1-2](#FPar6) 中，您可以看到这个选项是如何修改`ls`命令的行为的。

[***清单 1-2***](#_FPar6) 。通过向命令添加选项，可以修改其行为

```sh
nuuk:~ # ls    -l
total 120
-rw-------    1    root    root    777    Dec    5    10:43    .ICEauthority
-rw-------    1    root    root    115    Dec    5    10:43    .Xauthority
-rw-------    1    root    root    2558   Nov    24   13:39    .bash_history
drwx------    3    root    root    4096   Nov    7    11:04    .config
-rw-------    1    root    root    24     Nov    7    11:03    .dmrc
-rw-------    1    root    root    16     Nov    7    11:03    .esd_auth
-rw-r--r--    1    root    root    1332   Nov    23    2005    .exrc
drwxr-xr-x    2    root    root    4096   Nov    7    10:47    .fvwm
drwx------    5    root    root    4096   Dec    5    10:43    .gconf
drwx------    2    root    root    4096   Dec    5    11:03    .gconfd
drwxr-xr-x    3    root    root    4096   Nov    7    11:04    .gnome
drwx------    6    root    root    4096   Nov    7    11:04    .gnome2
drwx------    2    root    root    4096   Nov    7    11:03    .gnome2_private
drwx------    3    root    root    4096   Nov    7    11:03    .gnupg
drwxr-xr-x    2    root    root    4096   Dec    5    10:43    .gstreamer-0.10
-rw-r--r--    1    root    root    123    Nov    7    11:03    .gtkrc
-rw-r--r--    1    root    root    134    Nov    7    11:03    .gtkrc-1.2-gnome2
drwxr-xr-x    2    root    root    4096   Nov    7    10:47    .kbd
drwx------    3    root    root    4096   Nov    7    11:03    .metacity
drwxr-xr-x    3    root    root    4096   Nov    7    11:04    .nautilus
drwxr-xr-x    2    root    root    4096   Nov    19   15:03    .qt
-rw-------    1    root    root    325    Dec    5    10:43    .recently-used
drwxr-xr-x    2    root    root    4096   Nov    7    11:03    .skel

-rw-r--r--    1    root    root    795    Dec    5    10:44    .suse_register.log
drwx------    3    root    root    4096   Nov    7    11:04    .thumbnails
drwxr-xr-x    2    root    root    4096   Dec    1    05:27    .wapi
-rw-r--r--    1    root    root    1238   Dec    5    10:43    .xsession-errors
drwxr-xr-x    2    root    root    4096   Nov    7    11:04     Desktop
drwx------    2    root    root    4096   Nov    7    11:04     Documents
drwxr-xr-x    2    root    root    4096   May    3    2007      bin
```

选项提供了一种在命令代码中定义的方法来修改命令的行为。这意味着作为用户或管理员，您不能自己添加选项。唯一的方法是更改命令的源代码并重新编译命令，这不是 Linux 用户或管理员想要做的事情。选项对于您使用的命令来说是非常特定的。有些命令没有任何选项，而其他命令可以有 50 多个选项。`man`命令通常会给出所有可用选项的完整列表。或者，许多命令支持选项- help，它将显示所有可用选项的摘要。

许多命令提供了两种不同的选项处理方法:短选项和长选项。例如，您可以使用命令`ls -lh`，通过显示千字节、兆字节和千兆字节而不仅仅是字节，使`ls`命令以人类可读的方式显示其输出。你也可以用长选项`-h`的短选项，写成`--human-readable`。在[清单 1-3](#FPar7) 中，您可以看到这个选项在工作，与选项`-l`相结合，确保`ls`的输出作为一个长清单给出。(可惜短选项没有长的替代- `l`。)请注意，如果使用了多个选项，则可以一起指定所有选项，每个选项前面不加“-”。所以命令 **ls -lh** 有效，命令 **ls -l -h.** 也有效

[***清单 1-3***](#_FPar7) 。大多数 Linux 命令使用短选项和长选项

```sh
nuuk:/somedir # ls -l -h
total 4.0M
-rwxr-xr-x 1 root root 1.5M Dec 5 11:32 vmlinux-2.6.16.60-0.21-default.gz
-rw-r--r-- 1 root root 1.3M Dec 5 11:32 vmlinuz
-rw-r--r-- 1 root root 1.3M Dec 5 11:32 vmlinuz-2.6.16.60-0.21-default
nuuk:/somedir # ls -l --human-readable
total 4.0M
-rwxr-xr-x 1 root root 1.5M Dec 5 11:32 vmlinux-2.6.16.60-0.21-default.gz
-rw-r--r-- 1 root root 1.3M Dec 5 11:32 vmlinuz
-rw-r--r-- 1 root root 1.3M Dec 5 11:32 vmlinuz-2.6.16.60-0.21-default
```

短选项前面有一个符号，您可以在符号后面添加多个短选项。例如，您可以将[清单 1-4](#FPar9) 中的选项`-l`和`-h`组合成`ls -lh`。长选项前面有`--`符号。例如，`ls --human-readable`执行`ls`命令时只有一个选项，即`Is --human-readable`。如果你不小心在一个长选项前面加了一个，长选项就不会被解释为长选项，而是一组短选项。这意味着`ls -human-readable`将被解释为`ls -h -u -m -a -n -- -r -e -a -d -a -b -l -e`。

参数

除了选项，许多 Linux 命令都有参数。这些是您可以添加到命令中的附加规范，以更准确地告诉它要做什么，但是参数通常不在命令代码本身中定义。例如，考虑命令`ls -l /etc/hosts:`

```sh
nuuk:/somedir # ls -l /etc/hosts
-rw-r--r-- 1 root root 683 Nov 7 10:53 /etc/hosts
```

在本例中，`/etc/hosts`是自变量。可以想象，您可以使用任何其他文件名来代替`/etc/hosts`，这对于参数来说是典型的。它们不是固定的，您可以使用任何您喜欢的参数，只要它与命令的上下文相关。在本书中，我将非常清楚地区分选项和论点。

您应该知道，不仅命令有参数，选项也有参数。例如，考虑以下命令:

```sh
mail -s hello root
```

该命令由四个不同部分组成:

*   `mail:`命令本身
*   `-s`:告诉`mail`命令应该使用什么主题的选项
*   `hello:`选项`-s`的参数，它指定了你到底想用选项`-s`做什么
*   命令的参数，在这种情况下，它明确了向谁发送邮件消息

根据经验，命令末尾的参数通常是命令参数，选项的参数放在选项的右边。您现在可能想知道如何找出命令参数和选项参数之间的区别，但是在本章后面的“获取帮助”一节中，您将会看到区分这两种参数类型是相当简单的。

管道和重定向

为了释放 Linux 众多命令的全部能力，您可以使用管道和重定向。通过管道，您可以将一个命令的结果发送给另一个命令，通过使用重定向，您可以确定该命令应该将其结果发送到哪里。

平静的

管道 在 Linux 环境中为您提供了巨大的好处。通过使用管道，您可以将两个或更多命令的功能结合起来，创建一种提供更多功能的超级命令。通过创建正确的管道，你真的可以做令人惊奇的事情。对于一个高级 Linux 管理员来说，类似下面的命令是很常见的(在阅读了本书的所有章节之后，您应该能够理解这个命令在做什么):

```sh
kill `ps aux | grep y2 | grep -v grep | awk '{ print $2 }'`
```

作为一名 Linux 管理员，您绝对需要了解管道，所以让我们从一个简单的例子开始。如果你尝试一个类似于`ls -R /`的命令，你会看到它给出了很多在屏幕上不停滚动的输出。在 Linux 上，有一个非常有用的命令，名为`less`，可以用来查看文本文件。比如试试`less /etc/hosts`(见[清单 1-4](#FPar9))；这将打开`less`中的`/etc/hosts`文件，显示文件内容(使用`q`退出`less`)。

![Image](images/sq.jpg) **注意**`/etc/hosts`文件包含一个 IP 地址列表 和匹配的主机名。在小型网络中，您可以使用它作为使用 DNS 解析主机名的替代方法。

[***清单 1-4***](#_FPar9) 。您可以使用`less`作为查看器来阅读文本文件

```sh
nuuk:/ # less /etc/hosts
#
# hosts         This file describes a number of hostname-to-address
#               mappings for the TCP/IP subsystem. It is mostly
#               used at boot time, when no name servers are running.
#               On small systems, this file can be used instead of a
#               "named" name server.
# Syntax:
#
# IP-Address     Full-Qualified-Hostname Short-Hostname
#

127.0.0.1        localhost

# special IPv6 addresses
::1             localhost ipv6-localhost ipv6-loopback

fe00::0         ipv6-localnet

ff00::0         ipv6-mcastprefix
ff02::1         ipv6-allnodes
ff02::2         ipv6-allrouters
ff02::3         ipv6-allhosts
127.0.0.2       nuuk.sander.gl nuuk
/etc/hosts lines 1-23/23 (END)
```

`less`命令在管道中也非常有用。通过使用管道，您可以将第一个命令的结果发送给第二个命令。因此，如果您使用`ls -R / | less`,`ls -R /`命令执行并将其结果发送给`less`命令。在这种情况下，`less`将起到分页器的作用，一屏一屏地向您显示第一个命令的输出(参见[清单 1-5](#FPar10) )。它还会显示你当前所处的位置；这由`lines 1-23`表示，您可以在示例文件的末尾看到它。按空格键进入下一个输出屏幕。

[***清单 1-5***](#_FPar10) 。通过管道连接到`less`，您可以逐屏显示一个命令的结果，该命令给出了大量的输出

```sh
nuuk:/ # ls -R / | less
/:
.rnd
bin
boot
dev
etc
home
lib
lost+found
media
mnt
opt
proc
root
sbin
somedir
srv
sys
tmp
usr
var

/bin:
lines 1-23
```

重定向

Linux 命令 shell 中另一个非常有用的操作符是重定向操作符>。默认情况下，命令会在计算机显示器上显示其结果。在 Linux 俚语中，您还可以说 shell 将命令的结果发送到标准输出，缩写为 STDOUT，这通常是您的计算机监视器(但也可以是其他东西。很久以前，打印机经常被用作 STDOUT，而不是监视器)。使用重定向，您可以将它发送到任何其他地方。

![Image](images/sq.jpg) **提示**如果可能的话，在阅读完本节中描述的所有命令后，立即尝试它们。如果不亲自尝试，可能很难理解他们在做什么。

让我们再次使用命令`ls -l`作为例子。如果您只是键入命令，您将在 STDOUT 上看到它的结果。然而，如果您键入`ls -l > somewhere`，您将告诉命令将它的输出发送到其他地方，在本例中是一个名为`somewhere`的文件。如果该文件不存在，将在当前目录中创建。如果同名文件已经存在，您可以使用此命令覆盖它。如果您想添加到现有文件而不是覆盖它，请使用`ls -l >> somewhere`。双重重定向器告诉命令附加到文件的内容，而不是覆盖它。如果该文件不存在，该命令将创建它。因此，如果你想确保在使用重定向时不会意外覆盖现有文件，请始终使用`>>`而不是`>`。

除了输出之外，有些命令还会给出错误消息。好的一面是，您还可以重定向这些错误消息。为此，请使用`2>`而不是`>`。因此，如果`ls -l`也给你很多错误消息(这不太可能，但是你永远不知道)，你可以把它们全部发送到文件`errors`，如果你使用`ls -l 2> errors`，这个文件将在当前目录下创建。甚至有可能将命令的标准输出重定向到一个方向，而将错误输出发送到其他地方。例如，命令`ls -l > output 2> errors`将创建两个文件，文件`output`用于常规输出，文件`errors`用于错误输出。

您也可以重定向到一些 Linux 特殊设备，而不是将命令的结果发送到文件。Linux 中的每一个硬件都可以通过使用设备文件来寻址。例如，有一个设备文件`/dev/null`，可以用作数字垃圾箱。你发送到`/dev/null`的所有东西都会立刻消失得无影无踪。因此，如果您根本不想看到任何错误消息，您可以将错误消息重定向到`/dev/null`设备，而不是保存在系统的某个地方。以下示例显示了如何实现这一点:

```sh
ls -l 2> /dev/null
```

在这个例子中，常规输出仍然被写入当前的终端，但是您不会再看到错误消息。

除了输出，您还可以对命令的输入使用重定向。这并不常用，但对于打开交互式提示的命令非常有用，在该提示中，您需要为命令提供输入。可以在命令行上使用的 Linux `mail`命令就是一个例子。

![Image](images/sq.jpg) **提示**你可以在终端屏幕上使用`mail`命令进行一些简单的邮件处理，但是如果你的服务器配置正确，你甚至可以用它向互联网上的其他用户发送邮件。你唯一需要做的就是在你的服务器上设置 DNS。

考虑命令`mail -s hello root.`这个命令打开一个命令提示符，允许您向用户 root(其名称作为命令的参数提供)撰写邮件消息。选项`-s hello`指定了主题，在这里是`hello`。在[清单 1-6](#FPar13) 中，你可以看到这个命令的结果。

[***清单 1-6***](#_FPar13) 。用 Mail 撰写邮件信息

```sh
nuuk:/ # mail -s hello root
Hi root, how are you.
.
EOT
```

现在,`mail`命令的问题是，当以这种方式使用时，它会打开一个交互式提示，您可以在其中键入消息正文。当输入完消息正文后，您必须在单独的一行上提供一个点，然后按 Enter 键。通过使用输入重定向，您可以立即将点输入到命令中，这允许您在没有任何来自命令行的中断的情况下运行命令。

```sh
mail -s hello root < .
```

[清单 1-6](#FPar13) ，其中`mail`打开一个命令提示符，与前面使用输入重定向的例子的区别在于，在使用输入重定向的例子中，您不能在邮件正文中输入消息。要发送邮件，只有一条线可以使用，仅此而已。

练习 1-1:使用 LINUX 命令

1.  以 root 用户身份登录到您的 Linux 机器，打开一个 shell。
2.  键入 **useradd lisa** 创建一个名为 lisa 的用户。
3.  键入**密码 lisa** 。该命令将提示您输入想要使用的密码。输入密码“password ”,当要求确认时，再次输入。请注意，该命令会给出一个关于密码太简单的警告，您可以安全地忽略它。
4.  使用 **Ctrl-D** 关闭您当前登录的 shell。如果它是一个非图形化的 shell，您现在会看到一个登录提示。如果您在图形环境中工作，请找到将您从当前会话中注销的选项。
5.  再次登录，这一次作为用户 lisa 并打开一个 shell。
6.  类型 **ls -l iwehig** 。这应该会给你一个错误信息。
7.  类型**ls il iwe hig 2>~/错误**。该命令将所有错误重定向到在您的主目录中创建的名为 errors 的文件中。
8.  键入 **cat ~/errors** 查看该文件的内容。
9.  键入 **ls - help** 查看可用于 **ls** 命令的选项列表。您会注意到列表太长，屏幕上放不下。
10.  键入 **ls - help | less** 将 **ls** 命令的输出传送给 **less** 。现在，您可以使用箭头键在输出中上下移动。
11.  按下 **q** 退出 less viewer。

获得帮助

Linux 提供了很多获得帮助 的方法。让我们从一个简短的概述开始:

*   `man`命令提供了系统上大多数可用命令的文档。
*   几乎所有命令都接受`--help`选项。使用它将显示可与命令一起使用的可用选项的简短概述。
*   与每个 shell 一样，Bash shell 也有内部命令。这些命令不能作为程序文件在磁盘上找到，但是它们构建在 Bash shell 中，一旦装入 Bash shell，就可以在内存中使用。对于这些 Bash 内部命令，您可以使用`help`命令找到更多关于它们的信息。例如，使用`help for`获得更多关于 Bash 内部命令`for`的信息。

![Image](images/sq.jpg) **注意**想知道一个命令是否是内部命令？使用`type`。比如试试`type cd`；结果将显示出`cd`是什么类型的命令，在本例中是 Bash 内部命令。

利用`man` 来获得帮助

关于 Linux 系统上的命令的最重要的信息来源是`man`，它是系统程序员手册的缩写。使用`man`的基本结构是键入`man`,后跟您想要了解的命令。例如，键入`man passwd`以获得关于`passwd`项目的更多信息。然后你会看到一个由`less`分页器显示的页面，如[清单 1-7](#FPar16) 所示。

[***清单 1-7***](#_FPar16) 。手册页的示例

```sh
PASSWD(1)                     User Commands                PASSWD(1)

NAME
        passwd - change user password

SYNOPSIS
        passwd [options] [LOGIN] 

DESCRIPTION
        passwd changes passwords for user accounts. A normal user
        may only change the password for his/her own account, while
        the super user may change the password for any account.
        passwd also changes account information, such as the full
        name of the user, the user’s login shell, or his/her
        password expiry date and interval.

    Password Changes
Manual page passwd(1) line 1
```

每个`man`页面包含以下元素。

*   *名称*:这是命令的名称。它还包括对该命令用途的简短描述。
*   *简介*:在这里你可以找到关于该命令的简短用法信息。它将显示所有可用选项，并指示某个选项是可选的(显示在方括号中)还是必需的(不在方括号中)。
*   *描述*:描述命令正在做什么。请阅读该命令，以清楚完整地了解该命令的目的。
*   选项:这是所有可用选项的完整列表，并记录了所有选项的用法。
*   *Files* :如果存在的话，这个部分提供了与您想要了解更多信息的命令相关的文件的简要列表。
*   *参见*:这是相关命令的列表。
*   *作者*:这表示作者，也提供了写`man`页面的人的邮件地址。

`man`章节

在早期，九个不同的`man`卷记录了 UNIX 操作系统的各个方面。这种独立书籍的结构(现在称为章节)仍然存在于`man`命令中。[表 1-1](#Tab1) 列出了可用的部分以及您可以在其中找到的帮助类型。

[表 1-1](#_Tab1) 。man Sections 及其涵盖的内容

| 

部分

 | 

主题

 | 

描述

 |
| --- | --- | --- |
| Zero | 头文件 | 这些文件通常位于`/usr/include`中，包含您的程序可以使用的通用代码。 |
| one | 可执行程序或外壳命令 | 对于用户来说，这是最重要的部分，因为它通常记录了所有可以使用的命令。 |
| Two | 系统调用 | 作为管理员，您不会经常使用此部分。系统调用是由内核提供的功能。如果您是内核调试器，这将非常有趣，但是普通管理员不需要这些信息。 |
| three | 图书馆呼叫 | 库是一段可以被几个不同的程序使用的共享代码。通常，第 3 节中记录的页面与程序员有关，而与 Linux 用户和系统管理员关系不大。 |
| four | 特殊文件 | 在这里，记录了目录`/dev`中的设备文件。这些文件是访问计算机设备所必需的。本节对于了解特定设备的工作方式以及如何使用设备文件解决这些问题非常有用。 |
| five | 配置文件 | 在这里，您可以找到适用于服务器上大多数配置文件的格式。例如，如果您想了解更多关于`/etc/passwd`的组织方式，使用命令`man 5 passwd.`使用本节中的 passwd 条目 |
| six | 比赛 | 在现代 Linux 系统上，这个部分几乎不包含任何信息。 |
| seven | 多方面的 | 本节包含有关服务器上使用的宏包的一些信息。 |
| eight | 系统管理命令 | 这一节包含了一些重要的信息，这些信息是关于在 Linux 机器上经常使用的更改设置的命令的。 |
| nine | 内核例程 | 这是一些文档，它们甚至不是标准安装的一部分，并且可以选择包含关于内核例程的信息。 |

因此，作为系统管理员，对您来说重要的信息在第 1、5 和 8 部分。大多数情况下，您不需要了解其他部分的任何信息，但有时可以在多个部分找到一个条目。例如，关于名为`passwd`的项目的信息可以在第 1 节和第 5 节中找到。如果你只输入`man passwd`，你会看到`man`找到的第一个条目的内容。如果您想确保显示您需要的所有信息，请使用`man -a <yourcommand>`。这确保了 man 浏览所有部分，看是否能找到任何关于`<yourcommand>`的信息。如果您知道要查看哪个部分，请指定部分编号，如在`man 5 passwd`中，这将直接打开第 5 部分的`passwd`项。

现在`man`是一个非常有用的工具，可以获得更多关于如何使用给定命令的信息。然而，就其本身而言，只有当您知道想要阅读的命令的名称时，它才是有用的。如果您没有这些信息，并且需要找到正确的命令，您会喜欢`man -k`。`-k`选项允许你通过查看关键词来定位你需要的命令。

![Image](images/sq.jpg) **注意** `man -k`很有用。代替使用`man -k`，你也可以使用`apropos`命令，它做完全相同的事情。

`man -k`经常从`man`页面的所有部分生成一个很长的命令列表，在大多数情况下，你不需要看到所有的信息；与系统管理员相关的命令在第 1 节和第 8 节中。有时，当您在寻找一个配置文件时，也应该浏览第 5 节。因此，最好通过`grep`实用程序来传输`man -k`的输出，它可用于过滤。只需将您要查找的文本作为参数添加到 grep 命令中，它将只显示包含该特定文本的那些行。例如，使用`man -k time | grep 1`只显示`man`部分 1 中描述中带有单词“时间”的行。

![Image](images/sq.jpg) **提示**可能发生的情况是`man -k`只提供一条消息，说明没有什么是合适的。如果是这种情况，运行`mandb`命令(在某些 Linux 发行版上是 **makewhatis** )。这将创建搜索`man`索引所必需的数据库。

使用`--help`选项

`--help`选项 非常简单。大多数命令都接受此选项，尽管并非所有命令都识别它。但是好的一面是，如果你的命令不能识别这个选项，它会给你一个简短的总结，告诉你如何使用这个命令，因为它不理解你想让它做什么。尽管该命令的目的是提供其使用方式的简要概述，但您应该意识到信息通常太长，无法在一个屏幕上显示。如果是这种情况，通过`less`管道一页一页查看信息。在[清单 1-8](#FPar19) 中，你会看到当你这么做时会发生什么。

[***清单 1-8***](#_FPar19) 。通过`less`管道逐屏显示信息

```sh
nuuk:/ # ls --help | less
Usage: /bin/ls [OPTION]… [FILE]…
List information about the FILEs (the current directory by default). Sort entries alphabetically if none of -cftuSUX nor --sort.

Mandatory arguments to long options are mandatory for short options too.

-a,    --all                do not ignore entries starting with .
-A,    --almost-all         do not list implied . and ..
       --author             with -l, print the author of each file
-b,    --escape             print octal escapes for nongraphic characters
       --block-size=SIZE    use SIZE-byte blocks
-B,    --ignore-backups     do not list implied entries ending with ~
-c                          with -lt: sort by, and show, ctime (time of
                            modification of file status information)
                            with -l: show ctime and sort by name
                            otherwise: sort by ctime
-C                          list entries by columns
         --color[=WHEN]     control whether color is used to distinguish file
                            types. WHEN may be `never', `always', or
                            `auto'
-d,      --directory        list directory entries instead of contents,
                            and do not dereference symbolic links
-D,      --dired            generate output designed for Emacs' dired mode
-f                          do not sort, enable -aU, disable -lst
-F,      --classify         append indicator (one of */=>@|) to entries
lines 1-23
```

获取已安装软件包的信息

另一个经常被忽略的信息来源是目录`/usr/share/doc/`中许多软件包自动安装的文档。在这个目录下，您会发现一个很长的子目录列表，其中都包含一些使用信息。在许多情况下，信息确实很短，不是很好，但在其他情况下，可以获得全面而有帮助的信息。这些信息通常以 ASCII 文本格式提供，可以用`less`或任何其他能够处理明文的工具查看。

在某些情况下，`/usr/share/doc`中的信息以压缩格式存储。您可以通过扩展名识别这种格式。`gz`。要读取这种格式的文件，您可以使用`zcat`并将输出传输到`less`，这允许您一页一页地浏览。例如，如果您看到一个名为`changelog.gz`的文件，使用`zcat changelog.gz | less`来读取它。

注意:在很多发行版上， **less** 已经被修改，可以直接读取压缩文件。因此，经常没有理由再使用 **zcat** 或其他以字母 z 开头的实用程序

在其他情况下，您会发现 HTML 格式的文档，只有使用浏览器才能正确显示。如果是这种情况，最好知道您不一定需要启动一个图形环境来查看 HTML 文件的内容，因为许多发行版都附带了`w3m text`浏览器，它是为从非图形环境中运行而设计的。在`w3m`中，您可以使用箭头键浏览超链接。要退出`w3m`实用程序，请使用`q`命令。或者， **elinks** 浏览器可以用作文本浏览器。

练习 1-2:获得帮助

1.  Type **man 3 intro** 。手册页中的每一节都有一个介绍页，描述了该节的目的。
2.  键入 **man lvcreate** 。使用 **/examples** 查找单词 examples。许多手册页的末尾都有一个示例部分。在本节中，您通常可以找到有用的用法信息。
3.  类型 **man -k 打磨机**。它会告诉你“没有合适的”。如果这发生在您希望在您的计算机上可用的命令上，那么使用 **mandb** 来生成新的手册页索引文件是一个好主意。

使用外壳

Linux 使用内核来寻址和控制机器的硬件。内核可以被认为是 Linux 操作系统的心脏。在这个内核之上，如[图 1-5](#Fig5) 所示，Linux 给用户一个外壳接口，告诉这个内核和运行在其上的服务它们应该做什么。这个接口解释用户输入的命令，并把它们翻译成机器代码。

![9781430268307_Fig01-05.jpg](images/9781430268307_Fig01-05.jpg)

[图 1-5](#_Fig5) 。内核与外壳关系概述

有几个 shells 可用于 Linux，但是 bash 是默认的。早在 20 世纪 70 年代，为 UNIX 创建的第一个 shell 是 Bourne shell。它在 Linux 中仍然可以作为程序文件`/bin/sh`使用。另一个流行的 shell 是 Bash(Bourne Again Shell 的缩写)。Bash shell 与最初的 Bourne shell 完全兼容，但是它有许多增强。在大多数 Linux 发行版中，Bash 被用作所有用户的默认 shell。SUSE 和 Red Hat 使用 Bash，而 Ubuntu 也提供了另一个 shell，名为 Dash。对于常规的服务器管理任务，Bash 和 Dash 之间没有重要的区别。您应该知道其他 shells 也是可用的。有些人更喜欢使用其他的 shells，这里我只提到其中的三种:

*   tcsh:一个带有脚本语言的 shell，其工作方式类似于 C 编程语言(因此相当受 C 程序员的欢迎)。
*   zsh :一个与 Bash 兼容的 shell，但是提供了更多的特性。
*   *sash* :独立外壳。这是一个非常小的 shell，几乎可以在所有环境中运行。因此，它非常适合于排除系统故障。

使用外壳达到最佳效果

基本上，在 shell 环境中，管理员使用命令来执行他或她想要执行的任务。此类命令的一个例子是`ls`，它可以用来显示目录中的文件列表。Bash 有一些有用的特性，使得使用这些行命令变得尽可能容易。

一些 shells 提供了自动完成命令的选项。Bash 有这个特性，但是它不仅仅完成命令。Bash 几乎可以完成*一切*:不仅仅是命令，还有文件名和 shell 变量。

使用文件和目录

您会发现，在 shell 中工作时，您经常会操作文件和目录。目录是存储彼此相关的文件的文件夹；例如，在目录`/bin`中，您会找到二进制文件。有些目录是默认创建的，但您也可以自己创建目录。为此，使用`mkdir`。例如，下面的命令将在文件系统的根目录下创建一个名为`groups`的目录:

```sh
mkdir /groups
```

在一个目录中，你会找到文件。这些可以是文本配置文件、程序文件和文档；存储在 Linux 机器上的所有内容都存储在某个目录下的一个文件中。在某些情况下，创建一个允许您测试功能的虚拟文本文件会很有用。为此，使用`touch`命令。以下命令显示了如何使用`touch`在当前目录下创建一个空文本文件:

```sh
touch somefile
```

这只是对使用文件和目录的一个非常简短的介绍。这本书的第 2 章给出了更多关于这个主题的细节。

使用自动命令完成

使用此功能就像按 Tab 键一样简单。例如，`cat` line 命令用于显示 ASCII 文本文件的内容。这个文件在当前目录中的名称是`thisisafile`。因此，要打开这个文件，用户可以键入 **cat thi** ，然后按 Tab 键。如果目录中只有一个以字母“thi”开头的文件，Bash 会自动完成文件名。如果目录中有其他以相同字母开头的文件，Bash 将尽可能完成文件名。例如，假设当前目录中有一个名为`thisisatextfile`的文件和另一个名为`thisAlsoIsAFile`的文件。因为这两个文件都以文本`this`开始，Bash 将只完成到`this`，不会更久。要显示可能性列表，请再次按 Tab 键。这允许您手动输入更多信息。当然，您可以再次按 Tab 键来再次使用补全功能。

Bash 命令行完成已经发展成为一个非常丰富的解决方案。如果你想以最好的方式使用它，确保安装了 **bash-completion** 软件包。在这个包中，有一些信息可以帮助您针对许多不同命令以一种非常丰富的方式使用 bash 完成。

![Image](images/sq.jpg) **提示**使用 Tab 键确实让命令行界面变得更加容易。假设您需要管理服务器上的逻辑卷，您只记得该命令以`lv`开头。这种情况下，可以键入 **lv** ，按两下 Tab 键。结果将是一个以`lv`开头的所有命令的良好列表，从中您可能会认出您需要的命令。

使用变量

变量只是 shell 经常使用的一个普通值，它以一个名称存储。许多系统变量在系统启动时就可用，但是您也可以自己设置变量。例如，当您在命令行上使用命令`SWEET=good`时，您已经临时定义了一个稍后可以使用的变量(如果您关闭当前的 shell 或打开一个新的 shell，它将会消失)。自己设置变量主要是写 shell 脚本的时候比较有趣；你会在第 12 章中读到更多关于这个主题的内容。

除了您自己定义的变量之外，还有系统变量。这些系统变量存储在用户的环境中，有助于简化从 shell 中工作的过程。此类变量的一个例子是`PATH`，它存储了用户输入命令时应该搜索的目录列表。要引用变量的内容，请在变量名称前加上一个`$`符号。例如，命令`echo $PATH`显示 Bash 正在使用的当前搜索路径的内容。

在任何 Linux 系统上，登录时都会自动获得相当多的变量。对于所有这些的概述，您可以使用`env`(*环境*的简称)命令。[清单 1-9](#FPar22) 显示了这个命令的结果。

[***清单 1-9***](#_FPar22) 。`env`命令显示了您的 Shell 环境中定义的所有变量

```sh
root@RNA:~# env
TERM=xterm
SHELL=/bin/bash
SSH_CLIENT=192.168.1.71 1625 22
SSH_TTY=/dev/pts/1
USER=root
MAIL=/var/mail/root
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games
PWD=/root
LANG=en_US.UTF-8
SHLVL=1
HOME=/root
LOGNAME=root
VISUAL=vi
```

当从命令行工作时，在某些情况下你需要改变一些变量。下面列出了几个最相关的变量:

*   系统将在其中查找手册页的目录列表。
*   系统将搜索可执行文件的目录列表。
*   您电脑的名称。引导时，您的计算机从/etc/HOSTNAME 文件中读取这个变量。
*   `PS1:`您的电脑使用的当前提示布局。
*   当前用户正在使用的 shell 的名称。
*   `TERM:`使用的终端类型。这是一个重要的变量，因为它定义了文本在控制台上的显示方式。
*   `USER:`当前用户的名字。
*   `LANG:`当前的语言设置以及使用何种语言显示类似于`man`页面的项目。这个变量对国际用户很重要。`POSIX`是美国英语的背景。例如，如果您想使用法语，将此设置更改为`fr_FR.UTF` - `8`。

通常，作为一个用户，你会在登录系统时自动获得你的变量。新变量最重要的来源是`/etc/profile`文件，这是为每个登录系统的用户处理的脚本。想要为系统中的所有用户添加一个新变量吗？将它添加到`/etc/profile`文件的底部，以确保它对所有用户都可用。然而，如果你想这样做，如果你有一些代码想应用到`/etc/profile`，你必须以系统管理员 root 登录。还要注意，您对`/etc/profile`所做的更改只有在您注销并重新登录系统后才会生效。

如果您想确保您的变量实验不会对系统上的所有用户造成伤害，请使用命令`cd ~`切换到您的主目录，并在该目录中创建一个名为`.profile`的文件。所有用户都可以在他们的主目录中拥有这样一个文件，它将被视为对`/etc/profile`的添加。因此，如果您在这个文件中放入一个新变量，它将只为您在主目录中插入这个文件的用户执行。

/etc/profile 文件的替代文件是/etc/bashrc。当用户打开一个新的 shell 时，这个文件被处理。例如，如果您从图形控制台打开一个新的终端窗口，就会发生这种情况。这个文件在用户主目录中也有它的对应文件，名为. bashrc。一些 Linux 发行版将所有变量和其他 shell 设置都存储在 bashrc 文件中，并从/etc/profile 中读取这个文件，以确保在用户登录到系统时执行这些设置。

使用 Bash 历史记录

Bash shell 的另一个有用特性是历史特性，它允许您重用最近使用过的命令。许多发行版会记住用户使用的最后 1000 个命令；事实上，shell 记住的命令数量是在变量本身中定义的。这个变量的名字是`HISTSIZE`。历史记录功能对于当前会话之外的会话都很有用。名为的文件。`bash_history`在每个用户的主目录中创建，该文件记录了用户输入的最后 1000 条命令。您可以通过在 Bash 提示符下输入`history`来查看这些命令的概述。清单 1-10 是这个列表的一个例子。

![Image](images/sq.jpg) **注意**除了`history`命令，还可以使用上/下箭头键、上/下翻页键、Ctrl+P/Ctrl+N 来浏览历史。

[***清单 1-10***](#_FPar24) 。`history`命令显示您最近使用的所有命令的列表

```sh
sander@RNA:~$ history
....
  182   ls -l -h
  183   ls -l --human-readable
  184   clear
  185   ls -l /etc/hosts
  186   ls -R / | less
  187   ls -R
  188   ls -R /
  189   clear
  190   ls -R /
  191   clear
  192   cd /
  193   clear
  194   less /etc/hosts
  195   clear
  196   ls -R / | less
  197   clear
  198   mail -s hello root
  199   type ls
  200   type cd
  201   man ls
  202   clear
  203   ls --help | less
  204   history
```

历史记录功能特别有用，因为您可以重新发出该列表中的任何命令，而无需重新输入。如果您想再次运行任何列出的(和编号的)命令，只需键入前面带有感叹号的命令编号。在这个例子中，输入**！第 198 章**又要跑了`mail -s hello root`。

用户也可以通过使用`history`命令删除他或她的历史记录。这个 Bash 内部命令提供的最重要的选项是`-c`，它为该用户清除历史列表。这尤其有用，因为用户在命令行输入的所有内容(如密码)都会被记录下来。所以，如果你不想让别人知道你的所作所为，使用`history -c`来确保你的历史被清除。但是，一旦使用了该选项，就不能使用向上箭头键来访问以前的命令，因为那些命令都被抹掉了。

当用户在当前 shell 会话中工作时，历史记录仅保存在内存中。当 shell 正常退出时，历史文件得到更新。如果一个 shell 以非常规的方式关闭，历史文件将不会得到更新。作为用户，您可以使用 **history -w** 命令手动强制更新历史文件。如果你想确保你永远不会丢失你的历史，使用这个命令是一个好主意。

因为您从命令行输入的所有内容都保存在文件中。在你的个人目录中，我建议你首先不要输入纯文本密码，即使你定期清除历史记录。不要忘记历史文件也是 Linux 系统上的默认键盘记录程序！

用键序列管理 Bash】

有时，您会从 Bash 命令行输入一个命令，要么什么也没发生，要么发生了完全意想不到的事情。在这种情况下，知道一些键序列可用于执行基本的 Bash 管理任务是有好处的。以下是一些最有用的按键序列:

*   *Ctrl+C* :使用这个按键序列来退出一个没有响应的命令(或者只是需要太长时间来完成)。这个键序列在大多数情况下都有效，在这些情况下，命令是可操作的，并向屏幕产生输出。一般来说，如果您完全不知道发生了什么，并且只想终止 shell 中正在运行的命令，Ctrl+C 也是一个不错的选择。如果在外壳本身中使用，它也会关闭外壳。
*   *Ctrl+D* :该按键序列用于向命令发送“文件结束”(EOF)信号。当命令等待更多输入时，使用此选项，这由二级提示符(>)指示。您也可以使用这个键序列来关闭 shell 会话。
*   *Ctrl+R* :这是反向搜索功能。它将打开“反向搜索”提示，这有助于您找到您以前使用的命令。Ctrl+R 键序列搜索 Bash 历史，该特性在处理较长的命令时特别有用。像以前一样，键入命令的前几个字符，您将看到您使用的最后一个命令也是以相同的字符开始的。
*   *Ctrl+Z* :有些人使用 Ctrl+Z 来停止控制台上交互运行的命令(在前台)。虽然它确实停止了命令，但它没有*终止*它。用 Ctrl+Z 停止的命令只是暂停，所以你可以在后台用`bg`命令轻松启动它，或者在前台用`fg`命令再次启动它。要再次启动该命令，您需要引用该程序正在使用的作业号。您可以使用`jobs`命令查看这些工号的列表。你将在第 7 章中了解更多关于在后台运行命令的信息。目前，只要记住*永远不要*使用这个键序列，如果你想停止一个命令！

练习 1-3:使用壳

1.  以 root 身份登录。
2.  类型**回声朗**。这将文本 LANG 回显到 STDOUT。
3.  类型 **echo $LANG** 。这将语言变量的当前内容回显到 STDOUT。
4.  Type **LANG=fr_FR。UTF-8** 。现在，您已经将语言变量设置为法语。
5.  键入 **ls - help** 。您会注意到该命令的输出以法语显示。请注意，在一些发行版中，语言包不是默认安装的，因此在这样做之后，您不会看到语言的变化。
6.  使用命令 **useradd -m florence** 创建一个用户 florence。使用 **passwd florence** 设置用户 florence 的密码。将其设置为“密码”
7.  以用户 florence 的身份登录，并键入 **echo LANG=fr_FR。UTF-8>~/T3。bashrc** 。这会将 LANG 变量及其新值追加到。用户主目录中的 bashrc 文件。
8.  仍然作为佛罗伦萨，键入 **ls - help** 。您将看到输出仍然是英文的。
9.  注销，然后以用户 Florence 的身份重新登录。再次键入 **ls - help** 。您现在应该会看到法语输出。
10.  键入 **echo** 并按回车键。当命令未完成时，它会显示一个 **>** 表示它正在等待额外的输入。
11.  使用 **Ctrl-C** 停止正在等待的命令。

摘要

在这一章中，你已经学习了使用 Linux 需要知道的基本知识。涵盖了以下主题:

*   Linux 操作系统的历史
*   什么是开源？
*   分布之间的差异
*   登录到 linux
*   命令的结构，包括选项和参数
*   管道和重定向
*   获得关于`man`和`--help`的帮助
*   使用外壳

根据本章中的信息，您现在已经具备了开始使用一些命令所需的基本技能。在下一章，你将学习一些有用的命令和它们的工作方式。