# 前言

Linux 系统编程就是为 Linux 操作系统开发系统程序。Linux 是世界上最受欢迎的开源操作系统，运行在从大型服务器到小型**物联网** ( **IoT** )设备的所有设备上。知道如何为 Linux 编写系统程序将使您能够扩展操作系统，并将其与其他程序和系统连接起来。

我们将从学习如何使我们的程序易于编写脚本并易于与其他程序交互开始。当我们为 Linux 编写系统程序时，我们应该总是努力使它们变小，只做一件事——并且做得很好。这是 Linux 中的关键概念之一:创建能够以简单方式相互交换数据的小程序。

随着我们的前进，我们将深入研究 C 语言，看看编译器如何工作，链接器做什么，如何编写 Makefiles，等等。

然后，我们将学习所有关于分叉和守护进程的知识。我们还将创建自己的守护进程。然后我们将把我们的守护进程置于 systemd 的控制之下。这将使我们能够使用内置的 Linux 工具启动、停止和重启守护进程。

我们还将学习如何使用不同类型的**进程间通信** ( **IPC** )使我们的进程交换信息。我们还将了解如何编写线程程序。

在本书的最后，我们将介绍如何使用 **GNU 调试器** ( **GDB** )和 Valgrind 调试我们的程序。

到本书结束时，您将能够为 Linux 编写各种各样的系统程序——从过滤器到守护程序。

# 这本书是给谁的

这本书是为任何想为 Linux 开发系统程序并想对 Linux 系统有深入了解的人准备的。任何面临与 Linux 系统编程的特定部分相关的任何问题并寻找一些特定方法或解决方案的人都可以利用这本书。

# 这本书涵盖了什么

[*第 1 章*](01.html#_idTextAnchor020)*获取必要的工具并编写我们的第一个 Linux 程序*，向您展示了如何在整本书中安装我们需要的工具。我们也在这一章写了我们的第一个程序。

[*第二章*](02.html#_idTextAnchor050)*让你的程序更容易编写脚本*，涵盖了我们应该如何——以及为什么——让我们的程序更容易编写脚本，并且更容易被系统上的其他程序使用。

[*第三章*](03.html#_idTextAnchor097)*深入探究 Linux 中的 C 语言*，带我们踏上一段深入探究 Linux 中 C 语言编程内部运作的旅程。我们学习如何使用系统调用，编译器如何工作，如何使用 Make 工具，如何指定不同的 C 标准，等等。

[*第四章*](04.html#_idTextAnchor147)*处理你程序中的错误*，教我们如何优雅地处理错误。

[*第 5 章*](05.html#_idTextAnchor182)*使用文件输入/输出和文件系统操作*，介绍了如何使用文件描述符和流读写文件。本章还介绍了如何使用系统调用创建和删除文件以及读取文件权限。

[*第 6 章*](06.html#_idTextAnchor245)*生成进程和使用作业控制*，讲述了分叉是如何工作的，如何创建守护进程，什么是父进程，以及如何将作业发送到后台和前台。

[*第七章*](07.html#_idTextAnchor299)*使用 systemd 来处理你的守护进程*，向我们展示了如何将上一章的守护进程置于 systemd 的控制之下。本章还教我们如何将日志写入 systemd 的日志，以及如何读取这些日志。

[*第八章*](08.html#_idTextAnchor330)*创建共享库*，教会我们什么是共享库，为什么共享库重要，如何打造自己的共享库。

[*第 9 章*](09.html#_idTextAnchor365)*终端 I/O 和改变终端行为*，讲述了如何以不同的方式修改终端——例如，如何禁用密码提示的回显。

[*第十章*](10.html#_idTextAnchor402)*使用不同种类的 IPC* ，都是关于 IPC 的——也就是如何让进程在系统上相互通信。本章涵盖了先进先出、Unix 套接字、消息队列、管道和共享内存。

[*第 11 章*](11.html#_idTextAnchor460)*在你的程序中使用线程*，解释了什么是线程，如何编写线程程序，如何避免竞态条件，如何优化线程程序。

[*第 12 章*](12.html#_idTextAnchor489)*调试你的程序*，涵盖了使用 GDB 和瓦尔格林调试。

# 为了充分利用这本书

为了充分利用这本书，你需要对 Linux 有一个基本的了解，一些基本的命令，熟悉文件系统的移动和新程序的安装。如果你也对编程有基本的了解，最好是 C 语言，那会有帮助。

您将需要一台具有 root 访问权限的 Linux 计算机——无论是通过 su 还是 sudo——来完成所有的食谱。您还需要安装 GCC 编译器、Make 工具、GDB、Valgrind 和其他一些较小的工具。特定的 Linux 发行版没那么重要。书中有 Debian、Ubuntu、CentOS、Fedora 和 Red Hat 这些程序的安装说明。

**如果您正在使用本书的数字版本，我们建议您自己键入代码或通过 GitHub 存储库访问代码(下一节中提供了链接)。这样做将帮助您避免任何与复制和粘贴代码相关的潜在错误。**

## 下载示例代码文件

你可以在[https://GitHub . com/PacktPublishing/Linux-系统-编程-技术](https://github.com/PacktPublishing/Linux-System-Programming-Techniques)上下载这本书的示例代码文件。如果代码有更新，它将在现有的 GitHub 存储库中更新。

我们还有来自 https://github.com/PacktPublishing/丰富的书籍和视频目录的其他代码包。看看他们！

# 行动中的代码

这本书的“行动中的代码”视频可以在 https://bit.ly/39ovGd6.观看

# 下载彩色图片

我们还提供了一个 PDF 文件，其中包含本书中使用的截图/图表的彩色图像。可以在这里下载:[http://www . packtpub . com/sites/default/files/downloads/9781789951288 _ color images . pdf](_ColorImages.pdf)。

# 使用的约定

本书通篇使用了许多文本约定。

`Code in text`:表示文本中的码字、目录、文件名、文件扩展名、路径名、伪 URL、用户输入等。下面是一个例子:“将`libprime.so.1`文件复制到`/usr/local/lib`

代码块设置如下:

```
#include <stdio.h>
int main(void)
{
    printf("Hello, world!\n");
    return 0;
}
```

当我们希望将您的注意力吸引到代码块的特定部分时，相关的行或项目以粗体显示:

```
#include <stdio.h>
int main(void)
{
    printf("Hello, world!\n");
    return 0;
}
```

任何命令行输入或输出都编写如下:

```
$> mkdir cube
$> cd cube
```

在编号列表中，命令行输入以粗体显示。`$>`字符表示提示，不是你应该写的。

1.  This is an example of a numbered listing:

    ```
    $> ./a.out
    Hello, world!
    ```

    不适合一行的长命令行使用`\`字符分解。这与您在 Linux shell 中用来打断长行的字符相同。它下面的行有一个`>`字符，表示该行是前一行的延续。`>`这个人物是*而不是*你应该写的东西；Linux shell 会自动将这个字符放在一个新的行中，其中最后一行被一个`\`字符打断。例如:

    ```
    $> ./exist.sh /asdf &> /dev/null; \
    > if [ $? -eq 3 ]; then echo "That doesn't exist"; fi 
    That doesn't exist
    ```

    组合键用斜体书写。这里有个例子:“按 *Ctrl* + *C* 退出程序。”

    **粗体**:表示一个新的术语、一个重要的单词或者你在屏幕上看到的单词。

    提示或重要注意事项

    像这样出现。

    # 路段

    在这本书里，你会发现几个经常出现的标题(*准备*，*怎么做...*、*它是如何工作的...*、*还有更多...*和*参见*。

    要给出如何完成配方的明确说明，请使用以下章节:

    ## 做好准备

    本节告诉您配方中的预期内容，并描述如何设置配方所需的任何软件或任何初步设置。

    ## 怎么做…

    本节包含遵循配方所需的步骤。

    ## 它是如何工作的…

    这一部分通常包括对前一部分发生的事情的详细解释。

    ## 还有更多…

    本节包含关于配方的附加信息，以便您更好地了解配方。

    ## 另见

    本节提供了该配方的其他有用信息的有用链接。

    # 取得联系

    我们随时欢迎读者的反馈。

    **一般反馈**:如果你对这本书的任何方面有疑问，在你的信息主题中提到书名，发邮件给我们`customercare@packtpub.com`。

    **勘误表**:虽然我们已经尽了最大的努力来保证内容的准确性，但是错误还是会发生。如果你在这本书里发现了一个错误，如果你能向我们报告，我们将不胜感激。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)，选择您的图书，点击勘误表提交链接，并输入详细信息。

    **盗版**:如果您在互联网上遇到任何形式的我们作品的非法拷贝，如果您能提供我们的位置地址或网站名称，我们将不胜感激。请通过`copyright@packt.com`联系我们，并提供材料链接。

    **如果你有兴趣成为一名作者**:如果有一个你有专长的话题，你有兴趣写或者投稿一本书，请访问[authors.packtpub.com](http://authors.packtpub.com)。

    # 评论

    请留下评论。一旦你阅读并使用了这本书，为什么不在你购买它的网站上留下评论呢？然后，潜在的读者可以看到并使用您不带偏见的意见来做出购买决定，我们在 Packt 可以了解您对我们产品的看法，我们的作者可以看到您对他们的书的反馈。谢谢大家！

    更多关于 Packt 的信息，请访问[packt.com](http://packt.com)。