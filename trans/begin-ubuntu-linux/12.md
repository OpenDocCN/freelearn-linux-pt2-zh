## 12

## 使用文本文件

Windows 视文本文件为另一种文件类型，但对 Ubuntu(事实上对整个 Linux 家族来说)来说，它们是构成系统的真正结构。配置文件和程序文档以纯文本形式存储。这与 Windows 明显不同，在 Windows 中，您应该阅读的任何信息都可能包含在 Windows 帮助文件、RTF 文件甚至 Microsoft Word 文档中。

对于 Linux 来说，文本文件是如此的重要，以至于很长一段时间你可能会陷入关于哪个文本编辑器是最好的激烈争论中！虽然传统上文本文件是用命令行工具和文本编辑器管理的，但本章的重点是介绍图形工具，如 gedit。毫无疑问，有一天你会掌握命令行文本编辑器，比如 Vim、Emacs，或者两者都掌握——但是现在的事情是让你开始使用 Natty Narwhal。

值得一提的是，Linux 下的文本文件通常没有文件扩展名。与 Windows 或其他操作系统不同，`.txt`文件扩展名很少使用。有时会在纯文本配置文件中添加一个`.conf`扩展名，但更多情况下文本文件根本没有扩展名。

### 一堂历史课

鉴于这种对文本和文本文件的依赖，对于 Linux 管理员和高级用户来说，手边拥有强大的文本操作工具总是非常重要的。

![images](images/square.jpg) **提示**大多数程序`README`文件，以及其他各种文档，都可以在`/usr/share/doc`目录中以相关程序命名的目录中找到。

#### 管道和重定向

当您在终端窗口中执行一个命令时(这曾经是——对许多人来说仍然是——一项日常任务),输出通常以文本流的形式产生。因此，应用于文本文件的相同技术也可以用在这个输出上，一个简单的操作叫做*管道*。管道是将一个命令的输出作为另一个命令的输入发送的过程，通常是一个文本操作工具。然后，该输出就像文件一样被处理。强大！

我们将用一个使用 grep 的例子来说明这一点。grep 是一种工具，它将文本作为输入，搜索并尝试匹配正则表达式或文本，并打印包含该正则表达式或文本的行。如果在终端窗口(可通过应用程序附件终端打开)中发出以下命令:

`grep Linux operatingsystems.txt`

grep 将在文件`operatingsystems.txt`中查找文本“Linux ”,并只打印包含该文本的行。因此，grep 使用文本文件来根据您设置的标准过滤文件中的行。

但是，如果您想对命令的输出而不是文本文件做同样的事情，该怎么办呢？你用管道，用`|`这个字符来表示。它指示一个命令将其输出发送给另一个命令(并让第二个命令将其作为输入)。例如，如果您想要查找一个特定的进程，比如说进程`gedit`(进程用`ps`命令列出)，您可以在命令行中键入以下内容:

`ps -d | grep gedit`

该命令将显示关于`gedit`进程的信息(如果它正在运行)。

达到类似目的的另一种方式是通过*重定向*——用字符`>`表示。重定向意味着将命令的输出发送到文本文件。因此，前面的任务可以通过执行两个命令来完成:一个命令用于列出流程信息(并重定向其输出)，另一个命令只显示与某个流程相关的行:

`ps -d > processes.txt

grep gedit processes.txt`

**标准输入和输出**

如果你读过任何 Ubuntu 手册页，你可能会看到对*标准输入*和*标准输出*的引用。像 Linux 中的许多东西一样，这听起来很复杂，但只是一种冗长的方式来指代相对简单的东西(尽管这些术语对程序员来说有特定的含义)。标准输入就是 Ubuntu 下运行的程序通常用来输入的设备。换句话说，在大多数台式电脑上，当你使用命令行 shell 时，标准输入指的是键盘。然而，值得注意的是，它也可以指鼠标或系统上任何其他能够提供输入的设备；甚至一些软件可以扮演提供标准输入的角色。

标准输出类似。它是指通常从软件向其发送命令输出的设备。在命令行的大多数情况下，这指的是监视器屏幕，尽管它可以是任何类型的输出设备，如 PC 的声卡和扬声器。

`cat`命令的手册页说它将“连接文件并在标准输出上打印”换句话说，对于大多数桌面 Ubuntu 安装来说，它会将任意数量的文件组合(连接)在一起，并将结果打印在屏幕上。如果您只指定一个文件，它将在屏幕上显示该文件。

除了硬件设备，输入也可以来自一个包含命令的文件，输出也可以发送到一个文件而不是屏幕，甚至直接发送到另一个命令。这只是命令行 shell 如此灵活和强大的原因之一。

如[表 12-1](#tab_12_1) 所示，有许多文本处理工具不仅有用，而且一旦你了解它们，你就会爱上它们。grep、sed 或 AWK 背后的力量很难被图形界面或花哨的触摸屏所取代。这些工具可以被模仿，但永远不能被取代。像 Linux 的许多其他特性一样，它们是从 UNIX 继承来的。只是作为参考，让我们向您介绍其中的一些工具；如果你成为了 Ubuntu 大师，你会学到如何更深入地使用它们，你会成为一个超级粉丝。保证！

![images](images/t1201.jpg)

![images](images/square.jpg) **注**`less`和`more`命令有时被称为*寻呼机*，因为它们能够让你滚动文本页面。在更广泛的 Linux 社区中，您可能仍然会听到有人这样称呼它们，尽管这个术语已经不再使用了。

Bash 在文本处理方面是一个非常强大的工具，它的一些工具集提供了类似文字处理的功能。难怪有些人一辈子都在 Bash 提示符下工作，不需要复杂的 GUI 工具！

表 12-2 列出了更多你可以在命令行上使用的文本处理工具。除了命令之外，还列出了使它们有效工作所需的任何命令选项。一些命令依赖于重定向和管道，这在本章前面已经解释过了。

![images](images/square.jpg) **注意【Bash 下的大多数文本处理工具都是为程序员创建的，所以当您阅读手册页时，有些选项可能看起来有点奇怪。然而，所有的工具都非常灵活，并为各种用户提供功能。**

![images](images/t1202.jpg)

![images](images/t1202a.jpg)

如果这些对你来说都没有意义，那也没关系，因为你很少需要在日常工作中用到这些知识。但是知道 Linux 有比看起来更多的东西是一个有趣的发现！

#### 正文编辑大战

在 shell 中可以使用多种文本编辑器，但是有三种编辑器非常普遍:ed、Vim 和 Emacs。列表中的第一个，ed，是最简单的。这并不一定意味着它使用简单或缺乏强大的功能，但它只是无法与 Vim 和 Emacs 的惊人能力相匹配。称 Vim 和 Emacs 为简单的文本编辑器是对它们的一种伤害，因为它们都是非常强大的交互环境。特别是，Emacs 本身实际上被认为是一个操作系统，一些 Linux 用户把它当作他们的外壳，执行命令和日常任务，比如在其中阅读和发送电子邮件。有整本书都是关于 Emacs 和 Vim 的。

![images](images/square.jpg) **提示**许多 Linux 系统上的第四种基于 shell 的文本编辑器是 nano。这提供了许多类似文字处理器的特性，如果您是从 Windows 背景进入 Linux 的，这些特性会很有帮助。

Emacs 和 Vim 强大功能的缺点是这两个包很难学会使用。即使是他们最狂热的粉丝也认为他们与众不同。两者都需要用户学习某些不熟悉的概念，以及键盘快捷键和命令。

虽然关于哪个文本编辑器更好，哪个是最好的还存在争议，但人们普遍认为 Vim 提供了强大的文本编辑功能，但并不是包罗万象的。它也默认安装在 Ubuntu 上。在 Ubuntu 上，Emacs 必须作为可选附件安装。这两种文本编辑器通常可以在几乎所有的 Linux 或 UNIX 系统上使用。我们将在这里集中使用 Vim。

理解 Vim 是一款经典软件 vi 的升级版是很重要的。其实 vi 有很多版本和更新。曾经随 UNIX 提供的原始程序现在很少使用了。Vim 是最常用的克隆；Vim 代表 *vi 改进型*。另一个版本是猫王(`[http://elvis.the-little-red-haired-girl.org](http://elvis.the-little-red-haired-girl.org)`)。然而，大多数人仍然称 Vim 和 elvis 为 vi，即使它们是全新的软件。

![images](images/square.jpg) **注**在 vi 和 Emacs 的拥护者之间，曾经有过一场关于哪个更好的持续不断的激烈争论。这可能是一场非常激烈和绝望的辩论，你使用的文本编辑器经常被用来衡量你的性格！如今，两个阵营之间的斗争已经软化，Emacs 与 vi 的辩论被认为是 Linux 和 UNIX 使用的一个有趣的陈词滥调。当用户在网上声明他们更喜欢哪种文本编辑器时，他们通常会加上一个笑脸符号来表示对曾经狂热的情绪的认可。

### 使用文本文件

幸运的是，如果你不喜欢，你不需要学习如何使用这些工具，因为 Ubuntu 配备了一个强大的，是的，*图形*，文本编辑工具:gedit。gedit 实际上是 GNOME 桌面环境的默认文本编辑器，所以你可以在其他 Linux 发行版中找到它，比如 Fedora 和 SUSE。

#### 【gedit 简介

正如你在[图 12-1](#fig_12_1) 中看到的，gedit 的基本界面与记事本的界面非常相似，在许多方面，两个应用程序的工作非常相似。但是 gedit 有一些突出的特性，比如插件支持，这使它超越了记事本这样的简单文本编辑工具。您将会看到，gedit 有许多可用的插件，这些插件将使您能够做一些其他文本编辑器做梦也想不到的事情。在这方面，它是一个尊重 Linux 历史的工具；它不仅仅是 Vim 或 Emacs 的简单 GUI 替代品。

![images](images/1201.jpg)

***图 12-1。** gedit:一个简单而强大的图形文本编辑器*

其中一个很好的特性是能够使用标签，就像在你最喜欢的浏览器中一样。每个选项卡都是一个打开的文本文件。例如，当你在写剧本或做笔记时，你可以在另一个标签页打开西班牙作家米格尔·德·塞万提斯·萨维德拉的经典小说《堂吉诃德》*，以便短暂休息一下！*

 *gedit 窗口具有以下元素:

> 1.  *Menu bar* : The menu bar allows you to access all gedit commands.
> 2.  *Toolbar* : Use the toolbar to perform common tasks such as creating, opening and saving text files.
> 3.  *Display area* : The display area is where the action is located! This is where the text is actually displayed.
> 4.  *Status bar* : The status bar is displayed at the bottom of the window, showing the information of current activity and context menu.
> 5.  *Side pane* : The side pane displays the list of open documents and other information, depending on which plug-ins are enabled. By default, the side pane is not displayed. To show it, select View Side Pane.
> 6.  *Bottom pane* : The bottom pane is used by some plug-ins related to programming to display its output. By default, the bottom pane is not displayed. To show it, select View Bottom Pane.

要启动 gedit，只需在 Unity 面板的应用程序项中输入 Text Editor。，或者右键单击文本文件并选择“用文本编辑器打开”如果你双击一个文本文件，它很可能会自动用 gedit 打开。

使用这些方法打开 gedit 假设您将使用日常用户帐户编辑该文件。但是如果您想编辑一个只有超级用户才能访问的配置文件呢？普通用户只能以只读模式打开它，这意味着他们无法保存所做的更改。要编辑配置文件，请按 Alt+F2 调用 Run a Comm 搜索框，并在文本字段中键入 **gksu gedit** 。输入密码后，gedit 将以 root 权限打开。

简单说明了基本操作。工具栏上有按钮，菜单上有选项。要创建一个新文件，只需单击 File new，就会创建一个包含空白文档的新选项卡(如果单击工具栏上的 New 按钮，也会出现同样的情况)。要打开现有文件，请单击文件打开…，将出现一个对话框，让您浏览要打开的文本文件。最后，单击文件保存将工作结果保存到磁盘。

一旦在显示区域中有了所需的文件，就可以像使用任何文本编辑器一样开始工作了。您可以编写新文本，选择文本块并将其拷贝到剪贴板，或者粘贴其他来源的文本。您不能对文件的某些部分应用格式，因为 gedit 只是一个文本编辑器，而不是像 LibreOffice Writer 这样的文字处理工具。你保存的是文本文件，因此 gedit 可以与记事本完全互操作。

gedit 保存最近打开的文件的历史记录，您可以通过展开文件菜单或单击工具栏中打开按钮旁边的小箭头来查看。如果你点击一个文件，它会再次打开。

#### 使用 gedit

使用 gedit 只是在显示区域输入文本，并不时地保存文件。虽然简单，但它确实提供了大量选项，可以使您的任务更容易、更愉快。

菜单栏让您可以访问可以用 gedit 执行的所有操作。表 12-3 列出了菜单栏中所有可用的选项。您可以打开一个测试文件，使用这些选项来熟悉它们。您也可以使用“个性化”对话框来修改程序的一般行为。

![images](images/t1203.jpg)

![images](images/t1203a.jpg)

![images](images/t1203b.jpg)

值得注意的是，有时每个菜单还会有额外的选项。这取决于您启用了哪些插件。插件将在本章的后面详细解释，它扩展了 gedit 的基本功能，允许您做更多的事情。他们还可以扩展基本界面—例如，创建一个名为 Tools 的新菜单。所以 gedit 是非常可扩展的。

您可以通过“编辑”菜单访问“首选项”对话框，该对话框允许您更改文本的显示方式，以及启用或禁用插件。对话框中有四个不同的选项卡:

1.  *视图*:视图选项允许您配置文本的显示方式。
    *   *文本换行:*选择“启用文本换行”选项，让长文本行进入段落，而不是从文本窗口边缘溢出。这避免了必须水平滚动。选择“不要将单词拆分为两行”选项，使文本换行选项在将文本排到下一行时保留整个单词。这使得文本更容易阅读。
    *   *行号:*选择“显示行号”选项，在 gedit 窗口的左侧显示行号。
    *   *当前行:*选择“高亮当前行”选项，高亮光标所在的行。
    *   *右边距:*选择“显示右边距”选项，显示一条指示右边距的垂直线。使用“列的右边距”数字显示框来指定垂直线的位置。
    *   *括号匹配:*选择“高亮匹配括号”选项，当光标位于括号字符上时，高亮对应的括号。
2.  *编辑器*:编辑器选项允许你配置如何编辑文本和自动备份文件。
    *   *制表位:*使用“制表符宽度”数字显示框来指定按 Tab 键时 gedit 插入的空格的宽度。选择“插入空格而不是制表符”选项，使 gedit 在您按 tab 键时插入指定数量的空格而不是制表符。
    *   *自动缩进:*选择“启用自动缩进”选项，使下一行从当前行的缩进层次开始。
    *   *文件保存:*选择“保存前创建文件备份”选项，在每次保存文件时创建文件备份。文件的备份副本
        在文件名末尾包含一个~。选择“每…分钟自动存储文件”选项，以定期自动存储当前文件。使用数字显示框指定保存文件的频率。
3.  *字体&颜色*:该选项卡上的选项允许您指定显示文本的字体，以及文本和背景的颜色。
    *   *字体:*选择“使用系统固定宽度字体”选项，为 gedit 文本窗口中的文本使用默认的系统字体。“编辑器字体”字段显示 gedit 用来显示文本的字体。点按按钮以指定用于文本的字体类型、样式和大小。
    *   *配色方案:*您可以从配色方案列表中选择一种配色方案。
4.  *插件*:插件是非常强大的功能，可以让你打开或关闭 gedit 的某些高级功能。通过选择活动插件列表中插件名称旁边的复选框来配置它们。默认插件的完整列表在[表 12-4](#tab_12_4) 中给出。

![images](images/t1204.jpg)

![images](images/t1204a.jpg)

正如您所看到的，gedit 默认包含了许多有用的插件。但是如果插件不是可扩展的，那么插件有什么用呢？正如你所料，在官方的 Ubuntu 库和其他来源都有更多的插件。

额外的插件是可用的，例如，在包`gedit-plugins`中，您可以通过使用 Ubuntu 软件中心来安装它。第三方插件也可以从几个来源获得。您可以查看页面`[http://live.gnome.org/Gedit/Plugins](http://live.gnome.org/Gedit/Plugins)`了解可用插件的信息。

#### 用漫射比较多个文件

另一个非常方便的图形工具是漫射合并工具。它结合了许多已经在命令行工具中看到的功能，比如 paste of diff。例如，它可以让你一行一行地比较两个甚至三个文本文件，它可以帮你找出不同之处，这样你就可以把一个文件的内容合并到另一个文件中。例如，如果您正在比较一个程序源代码的两个版本，或者如果您是一名教师，比较来自不同学生的两个考试，这将非常有用。

默认情况下不安装漫反射，但是很容易获得。只需打开 Ubuntu 软件中心，搜索“Diffuse”漫射合并工具将是列表中的第一个，所以只需点击安装并等待(关于软件安装的更多细节，见第 20 章)。正如你在[图 12-2](#fig_12_2) 中看到的，Diffuse 将主窗格分成两个或三个窗口，以实现文本文件的并排比较，并突出显示有差异的行。

![images](images/1202.jpg)

***图 12-2。**漫射合并工具结合了许多命令行工具的强大功能。*

主窗格中的第三个元素位于文档的右侧，是比较摘要。摘要显示了所有文档，并说明了哪些行有差异(红色)，哪些行被手动编辑过(绿色)。只需移动比较摘要中的地址栏，就可以从文档的一个部分移动到另一个部分。

一旦您检查了差异，您可以选择根据另一个文件修改其中一个文件。使用工具栏上的按钮将文本从一个文档复制到另一个文档。修改后的文件名称将在末尾附加一个星号(*)；这意味着该文件自上次保存以来已被更改。确保你不时地保存你的文件以避免丢失你的工作。

### 总结

在这一章中，我们展示了如何操作文本文件。在许多方面，Bash shell 都是围绕操作文本而构建的，我们展示了各种工具都是以此为目标而创建的。然后我们讨论了文本文件编辑器曾经是 Linux 用户最重要的应用程序。

有了 Ubuntu，这类工具的日常使用需求就大大降低了。尽管如此，Ubuntu 包含了一个强大的可扩展的文本编辑器:gedit。它开箱即用，具有许多记事本中没有的功能，而且新的插件一直在添加。与漫射合并工具结合使用，它可以满足您对文本文件操作的大部分需求。*