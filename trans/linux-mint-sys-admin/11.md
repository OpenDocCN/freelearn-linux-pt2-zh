# 第十一章。解决纷争

*系统管理员迟早会面临影响电脑的问题。有时这些问题会与硬件有关，有时与软件有关。了解我们可以使用哪些工具来识别问题并尝试解决它们非常重要。在本章中，我们将学习基本的命令和工具，它们可以帮助我们确定网络、硬件、内核、进程和文件系统发生了什么。*

在本章中，我们将学习以下主题:

*   五金器具
*   检查日志文件
*   核心
*   建立工作关系网
*   进程和文件系统

# 硬件

很多时候用户检测到硬件相关的小问题，系统管理员可以快速解决。然而，有可能发生检测到的问题难以解决或难以检测的情况。此外，许多设备或资源可能会引发多个问题。

内存和 CPU 是我们电脑非常重要的硬件组件。我们需要处理它们，因为高负载会阻塞操作系统，因此，我们的计算机会出故障。另外，PCI 和 USB 设备可能会停止正常工作，所以我们应该在检测到硬件问题时进行检查。

# 行动时间-检查内存、中央处理器、通用串行总线和 PCI 设备

在 Linux Mint 中，我们可以找到工具和命令，它们可以帮助我们发现我们的硬件发生了什么。让我们发现一些检查内存、中央处理器和通用串行总线、PCI 设备的命令。

1.  我们的第一个目标是获取安装在我们电脑上的所有通用串行总线设备的信息。照常打开 MATE 终端，输入以下命令:

    ```
    $ lsusb

    ```

2.  现在，轮到 PCI 设备了，所以我们要执行下一个命令:

    ```
    $ lspci

    ```

3.  The output of the previous command will show you something similar to the following screenshot:

    ![Time for action – checking memory, CPU, USB, and PCI devices](graphics/9601_11_01.jpg)

4.  通过执行以下命令可以获得我们所有硬件的完整详细列表:

    ```
    $ sudo lshw

    ```

5.  为了获得关于内存的信息，我们将执行以下命令:

    ```
    $ cat /etc/meminfo

    ```

6.  作为输出，我们将得到如下几行:

    ```
    MemTotal:      824188 kB
    MemFree:       285016 kB
    Buffers:        64228 kB

    ```

7.  关于我们的 CPU，我们可以启动以下命令来获取安装在我们机器上的处理器的信息:

    ```
    $ cat /etc/cpuinfo

    ```

## *刚刚发生了什么？*

为了获得一个包含大量关于我们的 PCI 和 USB 设备信息的完整列表，我们可以分别执行`lspci`和`lusb`命令。这些命令帮助我们知道设备是否被我们的计算机识别。请记住，有些设备无法被操作系统检测到，在这种情况下，我们需要解决这个问题。

另一方面，`/proc/cpu`是包含安装在计算机上的 CPU 的信息的文件。`cat`命令用于显示上述文件的内容。关于`/proc/cpu`文件，我们找到了`/proc/meminfo`文件，它包含了关于我们计算机内存使用的数据。上述文件提供的一些信息包括总内存大小和可用内存量。

`lshw`命令的意思是“列出硬件”，它向我们显示了计算机上安装的所有硬件的详尽列表。不要忘记以 root 用户身份执行`lshw`命令。

# 检查日志文件

Linux Mint 使用一组文件来记录操作系统中发生的不同活动。这类信息包括关于资源(如文件或网络)如何使用的数据。所有这些文件都位于`/var/log/`目录中。只有根用户可以更改这些文件，但其他用户可以读取这些文件。最重要的日志文件之一是`/var/log/syslog`，这是一个通用日志，不同的应用程序在其中写入关于其活动的数据。除了这个通用日志文件，我们还可以找到很多，比如`Xorg.0.log`、`dmesg`、`kern.log`、`dpkg.log`。通常，特定的应用程序，如 MySQL 和 Apache，在`/var/log/`目录中使用自己的日志文件。检查提到的日志目录以了解我们的计算机中正在发生什么是一个很好的做法。

# 行动时间–列出系统日志文件的最后五行

我们将使用`tail`命令检查文件的最后五行。

1.  像往常一样打开 MATE 终端。
2.  执行以下命令:

    ```
    $ tail -5 /var/log/syslog

    ```

3.  作为输出，您将获得一些行，通知您最后保存在`syslog`文件中的操作。

## *刚刚发生了什么？*

我们使用了一个名为`tail`的命令来读取我们的`syslog`文件的最后几行。该命令以相反的顺序读取文件，并且可以接收一个数字作为参数。该数字用于显示文件的特定行数。显然，您可以使用您最喜欢的编辑器来读取`syslog`文件，但是使用`tail`更容易，因为该命令的输出会直接发送到您的终端。

# 内核

Linux 内核是我们的 Linux Mint 操作系统最重要的组件，所以我们需要照顾它，我们应该检查它是否正常工作。Linux 内核使用**模块** ，它们是实现和扩展内核功能的组件，并且可以根据需要加载或卸载到内核中，而无需重启。

使用模块有很多优点；其中之一就是我们可以通过只加载所需的模块来节省内存。另一个明显的优势是可以选择在不重启计算机的情况下动态加载模块。它节省了很多时间，而且我们不需要停止服务。由于模块的重要性，系统管理员应该检查内核和模块状态。我们可以做到这一点，这要归功于我们稍后将学习使用的命令。

# 行动时间–使用 lsmod、modprobe 和 dmesg 命令

系统管理员可以使用一些命令来获取关于内核的信息，其中一些是`lsmod`、`modprobe`和`dmesg`。让我们来看看如何使用这些命令。

1.  启动 MATE 终端应用程序。
2.  执行以下命令:

    ```
    $ lsmod

    ```

3.  前一个命令的输出将显示关于您加载的内核模块的信息。
4.  我们将执行下面的命令来获得所有可以在内核中加载的模块的列表:

    ```
    $ modprobe -l

    ```

5.  然后是执行`dmesg`命令的时候了，这个命令会发出很多消息，所以我们会少用它来控制输出。在您的终端中键入下一个命令:

    ```
    $ dmesg | more

    ```

## *刚刚发生了什么？*

为了知道 Linux 内核加载的每个模块的状态，我们可以执行`lsmod`命令。从技术角度来看，该命令只格式化`/proc/modules`文件的内容。

系统管理员需要知道如何在 Linux 内核中加载和卸载模块。`modprobe`命令允许我们执行这些动作。它接收将要加载或卸载的模块的名称作为参数。通过`-l`参数，我们可以找出哪些模块可以加载。

最后，`dmesg`命令对于获取内核操作相关信息非常有用。例如，如果我们将一个 USB 设备插入我们的计算机，内核将创建一个日志消息，可以使用`dmesg`命令读取。多亏了`more`命令，你可以更容易地阅读台词。当然，您已经意识到我们使用管道将`dmesg`的输出发送到`more`的输入。

# 联网

如今，网络是计算机使用的最有价值的资源之一。很难想象一家公司没有互联网或本地网络连接。有时系统管理员需要处理与网络相关的问题，所以了解哪些工具可以用来检测和解决常见问题是非常有趣的。

当然，你听说过`ping`，一个向计算机和设备(如打印机)发送信息的命令，目的是获得响应并确保它们正常工作。这个命令对于检查网络连接非常有用，如果`ping`没有得到响应，连接就无法建立，有设备或电脑的东西网络通信失败。与`ping`相关，我们找到`route`，一个显示我们电脑的 IP 路由表的命令。此外，`route`允许我们更改该表。不可能在我们的路由表之外建立连接，所以当连接失败时，检查一下是很重要的。

获取网络接口信息的另一个有用命令是`ifconfig`。例如，使用`ifconfig`我们可以找出哪个 IP 正在使用我们服务器的每个网络接口。此外，`ifconfig` 允许我们通过命令行配置网络接口。

Linux Mint 还包括`netstat`，一个提供网络连接信息的命令，路由表，接口统计，伪装连接和组播成员资格。稍后我们将了解更多关于`netstat`命令的信息。

# 行动时间-检查谁在哪个端口监听

我们将前往了解如何使用`netstat`命令来找出哪些应用程序正在监听哪些端口。

1.  像往常一样打开 MATE 终端。
2.  键入并执行以下命令:

    ```
    $ netstat -tln

    ```

## *刚刚发生了什么？*

尽管执行`netstat`只是为了找出哪些程序正在哪些端口上监听，但是这个命令可以用来获取更多关于我们的网络连接和使用情况的信息。如果你在没有任何参数的情况下执行`netstat`，你会得到你电脑上所有打开的插座的信息。基本上，`netstat`可以用来检查和监控你电脑上的所有网络活动。您可以通过`man`和`info`命令获得更多关于`netstat`命令的信息。

# 进程和文件系统

进程和文件系统导致许多计算机问题。请记住进程是由驻留在文件系统中的程序创建的，因此两者密切相关。如果计算机出现问题，最好看看哪些进程正在运行，以及与这些进程相关联的文件系统的状态如何。

`fuser`命令非常有用，因为它提供了一个列表，显示什么文件用于什么过程。基本上，我们只需要通过传递特定进程的名称作为参数来执行这个命令。

Linux Mint 和其他 GNU/Linux 发行版包括`strace` ，一个可以用来发现特定进程使用什么系统调用和库的工具。您可以键入`strace`，后跟您想要跟踪的命令或应用程序。

通常，系统管理员使用`top` ，这个命令提供关于正在运行的进程的完整信息，包括关于 CPU 和内存消耗的数据。处理流程的另一个有用工具是`ps`。我们将学习如何使用该命令找到特定的进程。

当系统管理员需要快速查看连接到特定计算机的文件系统时，他们会使用`df`命令，该命令提供有关文件系统磁盘空间使用情况的信息。通过传递`-h`参数，我们将获得一个列表，其中包含大小、可用和已用空间、使用百分比以及每个文件系统的挂载位置。当文件系统没有空间或没有挂载时，会出现很多问题，所以使用`df`来检测这类问题是个好主意。

# 行动时间——找到具体的流程

您将学习如何使用`ps`命令来查找您计算机上运行的特定进程的信息。在我们的例子中，我们将寻找 SSH 服务器守护进程。

1.  启动 MATE 终端。
2.  在 shell 中键入以下命令:

    ```
    $ ps -ef | fgrep -i sshd

    ```

3.  作为最后执行的命令的结果，我们将得到以下响应:

    ```
    root       768     1  0       09:06    ?            00:00:00  /usr/sbin/sshd -D
    arturo   16017 10434  0 16:07 pts/3    00:00:00   fgrep -i sshd

    ```

## *刚刚发生了什么？*

正如您所观察到的，我们通过一个管道连接器一起使用了`ps`和`fgrep`命令。`frep`命令寻找一个特定的模式，在我们的例子中`sshd`作为那个模式工作。`ef`参数表示我们正在查看所有正在运行的进程，使用根据`ps`命令的默认值格式化的输出。使用管道，我们可以将`ps`命令的输出重定向到`fgrep`。

当然，你可能会想，如果我们只有一个`sshd`进程在运行，为什么会有两行。答案很容易解释:`sshd` string 是管道命令`fgrep`的另一个名称，因此也显示了它的输出。

`ps`的每一条输出线都为我们提供了关于进程所有者、运行进程的路径、进程标识、相关终端以及启动时间的信息。请记住，我们对`sshd`进程有一个问号，因为它是一个不与任何终端相关联的守护进程。

如果您需要终止一个进程或获得更多关于它的信息，您可以使用 Linux Mint 中包含的系统监视器工具。有关该工具的更多信息，请参见[第 10 章](10.html "Chapter 10. Monitoring Your System")、*监控*。

# 总结

在本章中，您已经了解了哪些工具和命令可以帮助系统管理员检测和解决与硬件、网络、内核、文件系统和进程相关的常见问题。尽管每个问题都是独一无二的，但本章中描述的工具对于检查不同的资源和设备是否正常工作非常有用。

具体来说，我们包括:

*   检查硬件组件，如内存、中央处理器、通用串行总线和 PCI 设备
*   检查日志文件
*   了解如何在内核中列出加载的模块
*   检查网络连接并找出哪些进程正在哪些端口上侦听的有用工具
*   处理正在运行的进程

如果您需要寻求特定问题的帮助，以下资源可能非常有用:

*   为系统管理员提供完整信息的维基，可在[http://sysadmin.wikia.com/wiki/Main_Page](http://sysadmin.wikia.com/wiki/Main_Page)获得。
*   Linux 文档项目提供了一个很好的文档和指南集合，可从以下网址获得:
    *   [http://tldp.org/docs.html#howto](http://tldp.org/docs.html#howto)
    *   [http://tldp.org/guides.html](http://tldp.org/guides.html)
*   官方 Linux 造币厂文档可在[http://www.linuxmint.com/documentation.php](http://www.linuxmint.com/documentation.php)获得
*   官方 Linux 内核文档可在[http://kernel.org/doc/](http://kernel.org/doc/)获得

至此，您已经了解了 Linux Mint 中系统管理的基本知识。在本书中，我们解释了如何处理用户帐户、如何安装和配置软件、网络和安全的基本知识、如何创建和恢复备份，最后一章专门介绍了系统监控。最后，我们完成了对工具和命令的学习，这些工具和命令可以帮助我们面对常见的日常问题。